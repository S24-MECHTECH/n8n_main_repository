{
  "updatedAt": "2025-12-20T08:09:05.012Z",
  "createdAt": "2025-12-12T04:29:41.476Z",
  "id": "ftZOou7HNgLOwzE5",
  "name": "***MECHTECH_MERCHANT_CENTER_ADMIN",
  "description": "Dieser Workflow ist ein Google_Merchant_center optimierungs workflow, der durch Gemini, die Artikel f√ºr alle gelisteten shops im Google Merchant Center optimieren soll!",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "id": "f96504d2-acb9-45ec-a38f-03464ef3dfde",
      "name": "Chat Trigger (RAG Query)",
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        2112,
        2928
      ],
      "webhookId": "1bcc39ec-5b0a-4f6c-abf6-21235fcb6cb1"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "Du bist der MECHTECH Workflow Assistent!\n\nDu hast Zugriff auf die komplette Historie aller Workflow-Ausf√ºhrungen in der Supabase Vector Database.\n\nDeine Aufgaben:\n1. Beantworte Fragen zur Workflow-Historie (Approval Rates, verarbeitete Produkte, Phasen, etc.)\n2. Analysiere Trends und Muster in den Daten\n3. Gib Empfehlungen basierend auf historischen Daten\n4. Erkl√§re was in bestimmten Zeitr√§umen passiert ist\n\nDu kannst auf folgende Informationen zugreifen:\n- Shop-Namen und IDs\n- Verarbeitete Produkte pro Run\n- Success/Failure Counts\n- Approval Rates\n- Phasen (adult_flags, text, images)\n- Timestamps\n- Reasoning der Gemini Decisions\n\nAntworte auf Deutsch, pr√§zise und hilfreich!"
        }
      },
      "id": "6e10e95a-839e-466b-b8da-7c6f592cde23",
      "name": "Chat Agent (RAG)",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        2320,
        2928
      ]
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash-exp",
        "options": {}
      },
      "id": "de414013-9235-4fae-9857-9797d076fab6",
      "name": "Gemini Chat Model (RAG)",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2240,
        3120
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "tableName": {
          "__rl": true,
          "mode": "id",
          "value": "n8n_mechtech_historie"
        },
        "options": {
          "queryName": "match_documents"
        }
      },
      "id": "12f4b51e-fb64-46eb-b6d3-b911006b95c7",
      "name": "Supabase Vector Store (Retrieve)",
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        2704,
        2928
      ],
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      }
    },
    {
      "parameters": {},
      "id": "2fe06bad-939b-4ba4-b4db-bff406780c81",
      "name": "Gemini Embeddings (RAG)",
      "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
      "typeVersion": 1,
      "position": [
        2736,
        3120
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "mechtech_chat_session",
        "tableName": "n8n_chat_historie",
        "contextWindowLength": 25
      },
      "id": "500f3e8c-afb0-4130-8b60-aec646431b4d",
      "name": "Postgres Chat Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        2416,
        3120
      ],
      "credentials": {
        "postgres": {
          "id": "pIp690wi4X79QCKb",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "useCustomSchema": true,
        "operation": "getAll",
        "tableId": "workflow_runs",
        "returnAll": true,
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "created_at",
              "condition": "gte",
              "keyValue": "=={{ $now.startOf('day').toISO() }}"
            }
          ]
        }
      },
      "id": "dbb8abd3-3f3a-4d0c-af9d-e745a31b88a1",
      "name": "Check Last Run",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1024,
        3488
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// PREPARE PRODUCTS LOOP - GIBT ARRAY ZUR√úCK F√úR SPLIT\n// ============================================================================\n// ‚úÖ Dieser Node gibt ein Array zur√ºck (f√ºr n8n Split/Iteration)\n// ‚Üí n8n wird dann JEDES Item einzeln an den n√§chsten Node weitergeben\n// ÔøΩÔøΩÔøΩ Die nachfolgenden Nodes (Prepare Images, etc.) m√ºssen sequenziell arbeiten\n\nconst inputData = $input.first().json;\nconst config = $('Shop Configuration2').first().json;\n\n// Get products from input (Gemini Decision passes them)\nconst productsToFix = inputData.products || [];\nconst maxProducts = inputData.products_to_process || productsToFix.length;\n\n// Shop info from config\nconst shopId = inputData.shop_id || config.shop1_id;\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\nconst productsSlice = productsToFix.slice(0, maxProducts);\n\n// ‚úÖ Gibt Array zur√ºck - n8n wird jedes Item einzeln weiterleiten\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    originalProduct: product, // Behalte original product data\n    action: 'prepare',\n    priority: 'prepare',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
      },
      "id": "d050a0ab-21dd-42c1-b169-6541b305b430",
      "name": "Prepare Products Loop",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1392,
        3360
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $('Shop Configuration2').item.json.shop1_id }}/products/{{ $json.product_id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "adult",
              "value": "true"
            },
            {
              "name": "ageGroup",
              "value": "adult"
            },
            {
              "name": "googleProductCategory",
              "value": "778"
            }
          ]
        },
        "options": {}
      },
      "id": "4cf2bb26-c5b7-4f0a-9ae2-b9a2b40b7d4c",
      "name": "Update Product Adult Flag",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1616,
        3280
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "amount": 2
      },
      "id": "8c969733-0a5e-4c70-b741-db20428a1d3a",
      "name": "Rate Limiting",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1840,
        3360
      ],
      "webhookId": "77aa4d35-4b1e-410d-9f22-138e57a732c7",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "tableId": "workflow_runs",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "run_date",
              "fieldValue": "={{ $json.run_date }}"
            },
            {
              "fieldId": "shop_id",
              "fieldValue": "={{ $json.shop_id }}"
            },
            {
              "fieldId": "phase",
              "fieldValue": "={{ $json.phase }}"
            },
            {
              "fieldId": "products_processed",
              "fieldValue": "={{ $json.products_processed }}"
            },
            {
              "fieldId": "success_count",
              "fieldValue": "={{ $json.success_count }}"
            },
            {
              "fieldId": "approval_rate_after",
              "fieldValue": "={{ $json.approval_rate_after }}"
            }
          ]
        }
      },
      "id": "b5ac38f9-71ff-41b9-b9be-a72006b6b814",
      "name": "Save Workflow Run",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        704,
        4176
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE"
        },
        "sheetName": {
          "__rl": true,
          "mode": "name",
          "value": "üìù Daily_Log"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Timestamp": "={{ $json.run_date }}",
            "Shop": "={{ $json.shop_id }}",
            "Phase": "={{ $json.phase }}",
            "Products Processed": "={{ $json.products_processed }}",
            "Success Count": "={{ $json.success_count }}",
            "Failed Count": "={{ $json.failed_count }}",
            "Status": "={{ $json.created_at }}",
            "Action": "={{ $json.gemini_decision }}",
            "Details": "={{ $json.approval_rate_after }}"
          },
          "matchingColumns": [
            "Timestamp"
          ],
          "schema": [
            {
              "id": "Timestamp",
              "displayName": "Timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Shop",
              "displayName": "Shop",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Phase",
              "displayName": "Phase",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Action",
              "displayName": "Action",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Products Processed",
              "displayName": "Products Processed",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Success Count",
              "displayName": "Success Count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Failed Count",
              "displayName": "Failed Count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Details",
              "displayName": "Details",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false,
          "mappings": [
            {
              "column": "Timestamp",
              "value": "={{ $json.run_date }}"
            },
            {
              "column": "Shop",
              "value": "={{ $json.shop_name }}"
            },
            {
              "column": "Phase",
              "value": "={{ $json.phase }}"
            },
            {
              "column": "Action",
              "value": "Daily Run"
            },
            {
              "column": "Products Processed",
              "value": "={{ $json.products_processed }}"
            },
            {
              "column": "Success Count",
              "value": "={{ $json.success_count }}"
            },
            {
              "column": "Failed Count",
              "value": "={{ $json.failed_count }}"
            },
            {
              "column": "Status",
              "value": "={{ $json.status }}"
            },
            {
              "column": "Details",
              "value": "={{ $json.reasoning }}"
            }
          ]
        },
        "options": {}
      },
      "id": "c60e7ccd-9c89-451d-ab5e-ae217cd3c8e1",
      "name": "Log Results to Sheets",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.4,
      "position": [
        736,
        6256
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "pbNsBLFTIuL9ArMn",
          "name": "Google Sheets"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "chatId": "8562069918:AAFtzEUzCDeUchzybcp2l9Cg4WZ0KBmsWzI",
        "text": "=ü§ñ GEMINI DAILY REPORT - {{ $json.shop_name }}\n\nüìä Phase: {{ $json.phase }}\n‚úÖ Verarbeitet: {{ $json.success_count }}\n‚ùå Fehler: {{ $json.failed_count }}\nüìà Approval Rate: {{ $json.approval_rate_after }}%\n\nüí° Reasoning: {{ $json.reasoning }}\n\nAlles OK? üëç",
        "additionalFields": {}
      },
      "id": "25574648-d32f-47dd-b63b-156d003b6a1e",
      "name": "Send Daily Report",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1376,
        5872
      ],
      "webhookId": "b5c4cc7d-d366-4cd7-ac2c-0a91ed811e96",
      "credentials": {
        "telegramApi": {
          "id": "CefgWOY6zLuQ1eyX",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "={{ $json.to }}",
        "subject": "={{ $json.subject }}",
        "message": "={{ $json.html }}",
        "options": {}
      },
      "id": "9b60a1c9-e3bc-415a-84e5-7e20fa87937a",
      "name": "Export Report to Gmail",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        2432,
        5824
      ],
      "webhookId": "da822d06-d1b7-4cfe-804f-5e778bedbac4",
      "credentials": {
        "gmailOAuth2": {
          "id": "piLkk7aEWM1RFevI",
          "name": "s24.mechtech@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyX",
              "value": 1,
              "unit": "minutes"
            }
          ]
        },
        "filters": {
          "labelIds": [
            "Label_4215695195142173388",
            "Label_2937160366021595910",
            "INBOX"
          ],
          "readStatus": "unread"
        }
      },
      "id": "d8757cf8-e22e-4330-a756-110eab6b9582",
      "name": "Import Commands from Gmail",
      "type": "n8n-nodes-base.gmailTrigger",
      "typeVersion": 1.3,
      "position": [
        -1536,
        3504
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "credentials": {
        "gmailOAuth2": {
          "id": "piLkk7aEWM1RFevI",
          "name": "s24.mechtech@gmail.com"
        }
      },
      "disabled": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "send",
        "recipientPhoneNumber": "<__PLACEHOLDER_VALUE__Expert WhatsApp Number__>",
        "textBody": "=üö® EXPERT ALERT - MECHTECH Merchant Center\n\nShop: {{ $json.shop_name }}\nPhase: {{ $json.phase }}\n\n‚ö†Ô∏è CRITICAL ISSUES:\n‚ùå Failed: {{ $json.failed_count }}\nüìâ Approval Rate: {{ $json.approval_rate_after }}%\n\nImmediate action required!\n\nDetails: {{ $json.reasoning }}",
        "additionalFields": {}
      },
      "id": "93129dda-6724-4aa9-8d65-3339c4c09eac",
      "name": "Send WhatsApp Expert Alert",
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1.1,
      "position": [
        2160,
        6224
      ],
      "webhookId": "fd8ea9df-d0d5-4e11-a0df-a43a8e68297e",
      "disabled": true
    },
    {
      "parameters": {
        "updates": [
          "messages"
        ],
        "options": {}
      },
      "id": "2577d786-9125-4bca-80e2-8bcd2942ded0",
      "name": "Import Commands from WhatsApp",
      "type": "n8n-nodes-base.whatsAppTrigger",
      "typeVersion": 1,
      "position": [
        -1536,
        3248
      ],
      "webhookId": "472f5025-2ce8-4fba-9322-7f5fe0256023",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "const data = $input.item.json; const html = `<h2>ü§ñ MECHTECH Merchant Center Daily Report</h2><h3>Shop: ${data.shop_name}</h3><table border='1' cellpadding='10'><tr><th>Metric</th><th>Value</th></tr><tr><td>Phase</td><td>${data.phase}</td></tr><tr><td>Products Processed</td><td>${data.products_processed}</td></tr><tr><td>Success Count</td><td>${data.success_count}</td></tr><tr><td>Failed Count</td><td>${data.failed_count}</td></tr><tr><td>Approval Rate</td><td>${data.approval_rate_after}%</td></tr><tr><td>Status</td><td>${data.status}</td></tr></table><p><strong>Reasoning:</strong> ${data.reasoning}</p><p><em>Generated: ${data.run_date}</em></p>`; return [{ json: { subject: `Daily Report - ${data.shop_name} - ${data.phase}`, html: html, to: '<__PLACEHOLDER_VALUE__Report Email Address__>' } }];"
      },
      "id": "f8ee66d8-89e5-49df-abf0-ae4fdbe8cb76",
      "name": "Format Report for Email",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1600,
        5840
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// FIXED: Only check SUBJECT for commands (ignore spam)\nconst input = $input.item.json;\n\n// Only use subject - ignore body/snippet to avoid spam\nconst subject = (input.subject || '').toLowerCase().trim();\n\n// Check if subject contains \"command\" keyword\nif (!subject.includes('command') && !subject.includes('mechtech')) {\n  // Not a command email - skip it\n  return [];\n}\n\n// Extract command from subject\nconst text = subject.replace('command:', '').replace('mechtech:', '').trim();\n\nlet action = 'unknown';\nlet params = {};\n\nif (text.includes('status')) {\n  action = 'get_status';\n} else if (text.includes('pause')) {\n  action = 'pause_workflow';\n} else if (text.includes('resume')) {\n  action = 'resume_workflow';\n} else if (text.includes('report')) {\n  action = 'send_report';\n} else if (text.includes('help')) {\n  action = 'show_help';\n} else if (text.includes('optimize')) {\n  action = 'run_optimization';\n  // Check which shop\n  if (text.includes('shop1') || text.includes('siliconedolls24')) {\n    params.shop = 'shop1';\n  } else if (text.includes('shop2') || text.includes('dreamdoll')) {\n    params.shop = 'shop2';\n  } else {\n    params.shop = 'both';\n  }\n} else {\n  // Unknown command\n  action = 'unknown';\n}\n\nreturn [{\n  json: {\n    action: action,\n    params: params,\n    original_text: text,\n    source: input.from || input.sender || 'unknown',\n    subject: input.subject || ''\n  }\n}];"
      },
      "id": "7e2dc1f3-37b1-4464-a872-e6762b67bb01",
      "name": "Parse Command Input",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1264,
        3328
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "id-1",
              "leftValue": "={{ $json.failed_count }}",
              "rightValue": 10,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            },
            {
              "id": "id-2",
              "leftValue": "={{ $json.approval_rate_after }}",
              "rightValue": 50,
              "operator": {
                "type": "number",
                "operation": "lt"
              }
            }
          ],
          "combinator": "or"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "bae0f683-3bb7-4f9d-80b3-5c9d3b87dee1",
      "name": "Check if Expert Needed",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        1600,
        6064
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.action }}",
                    "rightValue": "get_status",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "445605f9-402d-4973-9957-5754b69fb8fc"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Status"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "renameFallbackOutput": "Unknown Command"
        }
      },
      "id": "2f6ec8b1-4afb-4d4a-9f3f-efd35d95c9d8",
      "name": "Route Command",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -928,
        3008
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "sendTo": "info@mechtech-support.com",
        "subject": "=",
        "emailType": "text",
        "message": "={{ $('Get Workflow Status REAL').item.json.error }}",
        "options": {}
      },
      "id": "47c6f2d5-70ef-4e31-ab24-5b7f4af92605",
      "name": "Send Command Response",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        1008,
        3024
      ],
      "webhookId": "5cf94981-2360-49f1-b7d4-6c512f562360",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "credentials": {
        "gmailOAuth2": {
          "id": "piLkk7aEWM1RFevI",
          "name": "s24.mechtech@gmail.com"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// FIX: PREPARE IMAGES LOOP - WORKING VERSION\n// ============================================================================\nconst inputData = $input.first().json;\nconst config = $('Shop Configuration2').first().json;\n\nconst productsToFix = inputData.products || [];\nconst maxProducts = inputData.products_to_process || productsToFix.length;\n\nconst shopId = inputData.shop_id || config.shop1_id;\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\nconst productsSlice = productsToFix.slice(0, maxProducts);\n\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    image_link: product.imageLink,\n    action: 'images',\n    priority: 'images',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
      },
      "id": "7e80edea-09fd-4ccb-b64c-0dd8612cd411",
      "name": "Prepare Images Loop",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1392,
        3520
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $('Shop Configuration2').item.json.shop1_id }}/products/{{ $json.product.id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "imageLink",
              "value": "={{ $json.product.imageLink }}"
            }
          ]
        },
        "options": {}
      },
      "id": "babd8406-0c00-4594-94ec-769af1fa4e6f",
      "name": "Update Product Images",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1616,
        3456
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "amount": 2
      },
      "id": "81aa9927-fead-49b4-a982-79e8e243b416",
      "name": "Rate Limiting Images",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1840,
        3552
      ],
      "webhookId": "03758724-2fd2-4cf0-bc96-1ba04b9fa35c",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// FIX: PREPARE TEXT LOOP - WORKING VERSION\n// ============================================================================\nconst inputData = $input.first().json;\nconst config = $('Shop Configuration2').first().json;\n\nconst productsToFix = inputData.products || [];\nconst maxProducts = inputData.products_to_process || productsToFix.length;\n\nconst shopId = inputData.shop_id || config.shop1_id;\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\nconst productsSlice = productsToFix.slice(0, maxProducts);\n\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    description: product.description,\n    action: 'text',\n    priority: 'text',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
      },
      "id": "3d671ed4-54b4-44e7-b1ce-9e8506c895ee",
      "name": "Prepare Text Loop",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1392,
        3680
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $('Shop Configuration2').item.json.shop1_id }}/products/{{ $json.product.id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "title",
              "value": "={{ $json.product.title }}"
            },
            {
              "name": "description",
              "value": "={{ $json.product.description }}"
            }
          ]
        },
        "options": {}
      },
      "id": "7de8fac9-7917-4e18-82ee-b38e9582acda",
      "name": "Update Product Text",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        1616,
        3632
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "amount": 2
      },
      "id": "bcfb6712-8553-429b-a051-2fd97f511a71",
      "name": "Rate Limiting Text",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1840,
        3744
      ],
      "webhookId": "fade3537-0739-4667-80c9-7636461ed902",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const input = $input.item.json;\nconst invalidPriority = input.priority || 'unknown';\nconst reasoning = input.reasoning || 'No reasoning provided';\n\nconst errorResult = {\n  processed_count: 0,\n  failed_count: 0,\n  error: 'Invalid priority received from Gemini',\n  invalid_priority: invalidPriority,\n  gemini_reasoning: reasoning,\n  timestamp: new Date().toISOString(),\n  debug_info: {\n    expected_priorities: ['adult_flags', 'images', 'text'],\n    received_priority: invalidPriority,\n    full_gemini_response: input\n  }\n};\n\nreturn [{ json: errorResult }];"
      },
      "id": "301318e0-3c19-4c68-ae59-360ae0ce5648",
      "name": "Handle Invalid Priority",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        112,
        4304
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "shop1_id",
              "name": "shop1_id",
              "value": "5339977843",
              "type": "string"
            },
            {
              "id": "shop1_name",
              "name": "shop1_name",
              "value": "Siliconedolls24",
              "type": "string"
            },
            {
              "id": "shop2_id",
              "name": "shop2_id",
              "value": "124485833",
              "type": "string"
            },
            {
              "id": "shop2_name",
              "name": "shop2_name",
              "value": "DreamDoll",
              "type": "string"
            },
            {
              "id": "google_sheet_id",
              "name": "google_sheet_id",
              "value": "1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE",
              "type": "string"
            },
            {
              "id": "id-6",
              "name": "supabase_url",
              "value": "https://mxswxdnnjhhukovixzvb.supabase.co/functions/v1/database-access",
              "type": "string"
            },
            {
              "id": "id-7",
              "name": "supabase_key",
              "value": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im14c3d4ZG5uamhodWtvdml4enZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3OTM4NDAsImV4cCI6MjA3OTM2OTg0MH0.60grD1zV6gF7Uf80N8CG8eiEwMw3zY5KR0Q-KKvvSWQ",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "name": "Shop Configuration2",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1264,
        3808
      ],
      "id": "4be5f686-f307-4f66-be08-b0d3c1d450a4",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "url": "=https://www.googleapis.com/content/v2.1/{{ $('Shop Configuration2').item.json.shop1_id }}/products?maxResults=100",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "options": {}
      },
      "name": "Get Merchant Products2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1008,
        4000
      ],
      "id": "b0ab7fdc-3fb9-4c8a-be9b-23fa9ba02066",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const products = $input.item.json.resources || [];\nconst productsNeedingFix = products.filter(p => !p.adult);\nconst disapproved = products.filter(p => p.issues && p.issues.length > 0).length;\nconst approved = products.length - disapproved;\nconst approvalRate = products.length > 0 ? ((approved / products.length) * 100).toFixed(2) : 0;\n\nreturn [{\n  json: {\n    products_needing_fix: productsNeedingFix.slice(0, 100),\n    current_approval_rate: approvalRate,\n    total_products: products.length,\n    approved_count: approved,\n    disapproved_count: disapproved\n  }\n}];"
      },
      "id": "b8c5ac4e-0efa-424b-879a-664d874d3858",
      "name": "Analyze Products2",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        448,
        3776
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst processedCount = items.filter(i => i.json.processed_count !== undefined).reduce((sum, i) => sum + i.json.processed_count, 0);\nconst failedCount = items.filter(i => i.json.failed_count !== undefined).reduce((sum, i) => sum + i.json.failed_count, 0);\nconst config = $('Shop Configuration2').item.json;\nconst analysis = $('Analyze Products2').item.json;\nconst decision = $('Gemini Daily Decision').item.json;\n\nreturn [{\n  json: {\n    shop_id: config.shop1_id,\n    shop_name: config.shop1_name,\n    run_date: new Date().toISOString(),\n    phase: decision.priority || 'adult_flags',\n    products_processed: processedCount,\n    success_count: processedCount,\n    failed_count: failedCount,\n    approval_rate_before: analysis.current_approval_rate,\n    approval_rate_after: analysis.current_approval_rate,\n    reasoning: decision.reasoning || 'Processing products',\n    status: failedCount === 0 ? 'success' : 'partial_success'\n  }\n}];"
      },
      "id": "ed039f97-9357-4343-be1a-79906778f089",
      "name": "Aggregate Results2",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        448,
        4288
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// FIX: PREPARE MERCHANT QUALITY LOOP - WORKING VERSION\n// ============================================================================\nconst inputData = $input.first().json;\nconst config = $('Shop Configuration2').first().json;\n\nconst productsToFix = inputData.products || [];\nconst maxProducts = inputData.products_to_process || productsToFix.length;\n\nconst shopId = inputData.shop_id || config.shop1_id;\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\nconst productsSlice = productsToFix.slice(0, maxProducts);\n\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    action: 'merchant_quality',\n    priority: 'merchant_quality',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
      },
      "name": "Prepare Merchant Quality Loop",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1392,
        3856
      ],
      "id": "be5cb90c-7a46-4847-b367-000ad4eff92d",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/shippingsettings",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"accountId\": \"{{ $json.shop_id }}\",\n  \"services\": [{\n    \"name\": \"Standard Shipping\",\n    \"active\": true,\n    \"deliveryCountry\": \"DE\",\n    \"deliveryTime\": {\n      \"minHandlingTimeInDays\": 1,\n      \"maxHandlingTimeInDays\": 3,\n      \"minTransitTimeInDays\": 2,\n      \"maxTransitTimeInDays\": 5\n    },\n    \"rateGroups\": [{\n      \"singleValue\": {\n        \"flatRate\": {\n          \"value\": \"0\",\n          \"currency\": \"EUR\"\n        }\n      }\n    }]\n  }]\n}",
        "options": {}
      },
      "name": "Update Merchant Settings",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1616,
        3808
      ],
      "id": "c0723274-0580-47a6-9041-28af376849d8",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "amount": 2
      },
      "name": "Rate Limiting Merchant",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1840,
        3936
      ],
      "id": "8852af00-4385-408d-8987-fe55e5e94fe3",
      "webhookId": "rate-limit-merchant-webhook",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// PREPARE MULTI COUNTRY LOOP - SEQUENTIELLE VERARBEITUNG\n// ============================================================================\nconst inputItem = $input.first().json;\nconst config = $('Shop Configuration2').first().json;\n\n// Multi-Country Logik - sequenziell verarbeiten (ein Item)\nreturn {\n  json: {\n    ...inputItem,\n    action: 'multi_country',\n    priority: 'multi_country',\n    multi_country_processed: true,\n    countries: inputItem.countries || inputItem.countries_from_gemini || [],\n    shipping: inputItem.shipping || []\n  }\n};"
      },
      "name": "Prepare Multi Country Loop",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1392,
        4064
      ],
      "id": "64a0acd7-c17f-4769-acce-c2e20df6a620",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/products/{{ $json.product_id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"destinations\": [\n    {{ $json.countries.map(c => `{\"destinationName\": \"Shopping_ads\", \"country\": \"${c}\"}`).join(',') }}\n  ],\n  \"shipping\": [\n    {{ $json.countries.map(c => `{\"country\": \"${c}\", \"price\": {\"value\": \"0\", \"currency\": \"EUR\"}}`).join(',') }}\n  ]\n}",
        "options": {}
      },
      "name": "Update Country Feeds",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1616,
        4016
      ],
      "id": "6ee6d55b-35fe-41df-a44c-df2239899cfd",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "amount": 2
      },
      "name": "Rate Limiting Country",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1840,
        4128
      ],
      "id": "dab02d93-e398-4696-873d-8e9fd10ad1e1",
      "webhookId": "rate-limit-country-webhook",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "adult_flags",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "adult-flags-condition"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Adult Flags"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "images",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "images-condition"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Images"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "text",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "text-condition"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "merchant_quality",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "merchant-quality-condition"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Merchant Quality"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "multi_country",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "multi-country-condition"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Multi Country"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b85d4e72-545e-46d6-9d63-bb8819eeffb5",
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "multi_gtn_ean",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Multi GTN/EAN"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "59b9840f-42a0-40e1-8219-74cda70e3389",
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "H√§ndlerqualit√§t",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "H√§ndlerqualit√§t"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "0c1be4fa-a537-4377-97e3-6f36cd0ba8d0",
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "Gemini_S24",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Gemini_S24"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "51567b03-a03e-487d-9083-fbc339177f75",
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "Gemini_DDC",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Gemini_DDC"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "renameFallbackOutput": "Fallback"
        }
      },
      "name": "Route by Priority",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1056,
        3632
      ],
      "id": "69a3920f-9edf-4706-aa02-75e8daf68e0b",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "url": "=https://www.googleapis.com/content/v2.1/{{ $('Shop Configuration2').item.json.shop2_id }}/products?maxResults=250",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "options": {}
      },
      "name": "Get Merchant Products Shop2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1008,
        3792
      ],
      "id": "baf201f8-4500-48be-a91a-072256344a25",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Shop Configuration2').item.json.supabase_url }}/rest/v1/products",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $('Shop Configuration2').item.json.supabase_key }}"
            },
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('Shop Configuration2').item.json.supabase_key }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Prefer",
              "value": "resolution=merge-duplicates"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"shop_id\": \"{{ $json.shop_id }}\",\n  \"shop_name\": \"{{ $json.shop_name }}\",\n  \"shop_url\": \"{{ $json.shop_id === '5339977843' ? 'www.siliconedolls24.com' : 'www.dreamdoll.de' }}\",\n  \"product_id\": \"{{ $json.product_id }}\",\n  \"offer_id\": \"{{ $json.offer_id }}\",\n  \"title\": \"{{ $json.title }}\",\n  \"image_link\": \"{{ $json.image_link || '' }}\",\n  \"adult_flag_set\": {{ $json.action === 'adult_flags' || $json.priority === 'adult_flags' ? 'true' : 'false' }},\n  \"text_sanitized\": {{ $json.action === 'text' || $json.priority === 'text' ? 'true' : 'false' }},\n  \"image_optimized\": {{ $json.action === 'images' || $json.priority === 'images' ? 'true' : 'false' }},\n  \"feed_optimized\": true,\n  \"shipping_set\": {{ $json.action === 'merchant_quality' || $json.priority === 'merchant_quality' ? 'true' : 'false' }},\n  \"returns_set\": {{ $json.action === 'merchant_quality' || $json.priority === 'merchant_quality' ? 'true' : 'false' }},\n  \"tax_set\": {{ $json.action === 'merchant_quality' || $json.priority === 'merchant_quality' ? 'true' : 'false' }},\n  \"multi_country\": {{ $json.action === 'multi_country' || $json.priority === 'multi_country' ? 'true' : 'false' }},\n  \"status\": \"SUCCESS\",\n  \"last_optimized_at\": \"{{ $now.toISO() }}\"\n}",
        "options": {}
      },
      "name": "Save to Supabase Products",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1376,
        6240
      ],
      "id": "93e3d642-ca2c-4879-9986-eb33006db588",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "waitBetweenTries": 3000,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Shop Configuration2').item.json.supabase_url }}/rest/v1/rpc/update_pattern_success",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $('Shop Configuration2').item.json.supabase_key }}"
            },
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('Shop Configuration2').item.json.supabase_key }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"p_pattern_type\": \"{{ $json.action || $json.priority }}\",\n  \"p_success\": true\n}",
        "options": {}
      },
      "name": "Update Optimization Patterns",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1600,
        6240
      ],
      "id": "efe4ee21-30fa-4ea2-9a3e-0777bcb28879",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1R1fYQTswbGBDzLoizyTNPKVLup1ie0_ksqBTLc5E48s/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1181382825,
          "mode": "list",
          "cachedResultName": "üß† AI_Learning",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1R1fYQTswbGBDzLoizyTNPKVLup1ie0_ksqBTLc5E48s/edit#gid=1181382825"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "Timestamp",
              "displayName": "Timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Problem_Type",
              "displayName": "Problem_Type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Human_Instruction",
              "displayName": "Human_Instruction",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "AI_Solution",
              "displayName": "AI_Solution",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Success_Rate",
              "displayName": "Success_Rate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Applied_Count",
              "displayName": "Applied_Count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Pattern_ID",
              "displayName": "Pattern_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "name": "Get Human Instructions",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.4,
      "position": [
        448,
        4496
      ],
      "id": "1bd24030-179c-4c5a-b985-11de6adda716",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "cztAb4CKfRPRO8KX",
          "name": "Google Sheets account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// Filter nur Zeilen MIT Instructions und OHNE AI Response\nconst items = $input.all();\n\nconst needsProcessing = items.filter(item => {\n  const instruction = item.json.Human_Instructions;\n  const aiResponse = item.json.AI_Response;\n  return instruction && instruction.trim() !== '' && (!aiResponse || aiResponse.trim() === '');\n});\n\nif (needsProcessing.length === 0) {\n  // Keine Instructions zu verarbeiten\n  return [];\n}\n\nreturn needsProcessing;"
      },
      "name": "Filter Unprocessed Instructions",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        704,
        4416
      ],
      "id": "3f1c1a07-802e-4f38-bc10-aa71bd398ce2",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=HUMAN INSTRUCTION:\nProdukt: {{ $json.Title }}\nProdukt ID: {{ $json.Product_ID }}\nAnweisung: {{ $json.Human_Instructions }}\n\nAnalysiere die Anweisung und:\n1. Erstelle L√∂sung\n2. Finde √§hnliche Produkte\n3. Gib Pattern-Type an\n4. Confidence Score (0-100)\n\nAntworte als JSON!",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "Du bist der Learning Agent f√ºr MECHTECH!\n\nDeine Aufgabe:\n1. Lese Human Instructions aus Google Sheets\n2. Verstehe was der Mensch will\n3. Erstelle Pattern/L√∂sung\n4. Wende auf √§hnliche Produkte an\n5. Speichere Learning in Supabase\n\nWenn Mensch Fehler macht:\n- Erkenne es!\n- Gib freundlichen Hinweis\n- Schlage bessere L√∂sung vor\n\nAntworte IMMER als JSON:\n{\n  \"ai_response\": \"Deine Antwort an den Menschen\",\n  \"solution\": \"Was du tun wirst\",\n  \"pattern_type\": \"adult_flags|text|images|merchant_quality|multi_country/multi gtn/ean\",\n  \"ai_confidence\": 85,\n  \"apply_to_similar\": true,\n  \"similar_keywords\": [\"keyword1\", \"keyword2\"],\n  \"warning\": \"Optional: Wenn Mensch Fehler macht\"\n}"
        }
      },
      "name": "Process Instructions with Gemini",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        944,
        4400
      ],
      "id": "0d7a07de-fcbf-4789-9956-5d472d0d9774",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash-exp",
        "options": {}
      },
      "name": "Gemini Model Learning",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        944,
        4592
      ],
      "id": "72b7fdcd-8fbf-4c1e-8a37-2a4d3230e32e",
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {},
      "name": "JSON Parser Learning",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        1088,
        4592
      ],
      "id": "d2622e4b-0c5a-4801-b5ba-230485a1c5e6"
    },
    {
      "parameters": {
        "jsCode": "// Apply solution to similar products\nconst instruction = $input.item.json;\nconst geminiResponse = $('Process Instructions with Gemini').item.json;\n\nif (!geminiResponse.apply_to_similar) {\n  return [{\n    json: {\n      ...instruction,\n      ai_response: geminiResponse.ai_response,\n      ai_confidence: geminiResponse.ai_confidence,\n      applied_to_similar: 0\n    }\n  }];\n}\n\n// Get all products from previous steps\nconst allProducts = $('Get Merchant Products2').all();\nconst keywords = geminiResponse.similar_keywords || [];\n\n// Find similar products\nconst similarProducts = allProducts.filter(p => {\n  const title = (p.json.title || '').toLowerCase();\n  return keywords.some(keyword => title.includes(keyword.toLowerCase()));\n});\n\nreturn [{\n  json: {\n    ...instruction,\n    ai_response: geminiResponse.ai_response,\n    ai_confidence: geminiResponse.ai_confidence,\n    applied_to_similar: similarProducts.length,\n    similar_product_ids: similarProducts.map(p => p.json.id),\n    pattern_type: geminiResponse.pattern_type,\n    solution: geminiResponse.solution,\n    warning: geminiResponse.warning || null\n  }\n}];"
      },
      "name": "Apply to Similar Products",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1376,
        6432
      ],
      "id": "f583872e-5be2-4768-9a8b-8d19d18b623a",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "={{ $('Shop Configuration2').item.json.sheet_id }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $json.shop_url || 'www.siliconedolls24.com' }}",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false,
          "mappings": [
            {
              "column": "AI_Response",
              "value": "={{ $json.ai_response }}"
            },
            {
              "column": "AI_Confidence",
              "value": "={{ $json.ai_confidence }}"
            },
            {
              "column": "Applied_To_Similar",
              "value": "={{ $json.applied_to_similar }}"
            }
          ]
        },
        "options": {}
      },
      "name": "Update Sheet with AI Response",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.4,
      "position": [
        1600,
        6432
      ],
      "id": "e02a0a6d-212b-46ec-8a49-1b1dec6ff6e1",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "cztAb4CKfRPRO8KX",
          "name": "Google Sheets account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Shop Configuration2').item.json.supabase_url }}/rest/v1/human_instructions",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $('Shop Configuration2').item.json.supabase_key }}"
            },
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('Shop Configuration2').item.json.supabase_key }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"product_id\": \"{{ $json.Product_ID }}\",\n  \"shop_id\": \"{{ $json.shop_id }}\",\n  \"instruction\": \"{{ $json.Human_Instructions }}\",\n  \"instruction_type\": \"{{ $json.pattern_type }}\",\n  \"ai_response\": \"{{ $json.ai_response }}\",\n  \"ai_confidence\": {{ $json.ai_confidence }},\n  \"ai_action_taken\": \"{{ $json.solution }}\",\n  \"applied_to_similar\": {{ $json.applied_to_similar }},\n  \"status\": \"EXECUTED\",\n  \"executed_at\": \"{{ $now.toISO() }}\"\n}",
        "options": {}
      },
      "name": "Save Learning to Supabase",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1808,
        6432
      ],
      "id": "325a78b7-c0be-42b2-91be-469e4dee1e8f",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "url": "=https://mxswxdnnjhhukovixzvb.supabase.co/rest/v1/workflow_status?select=*&order=created_at.desc&limit=100",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "=id",
              "value": "={{ $json.id }}"
            },
            {
              "name": "run_date",
              "value": "={{ $json.run_date }}"
            },
            {
              "name": "shop_id",
              "value": "={{ $json.shop_id }}"
            },
            {
              "name": "shop_name",
              "value": "={{ $json.shop_name }}"
            },
            {
              "name": "phase",
              "value": "={{ $json.phase }}"
            },
            {
              "name": "products_processed",
              "value": "={{ $json.products_processed }}"
            },
            {
              "name": "success_count",
              "value": "={{ $json.success_count }}"
            },
            {
              "name": "failed_count",
              "value": "={{ $json.failed_count }}"
            },
            {
              "name": "budget_used",
              "value": "={{ $json.budget_used }}"
            },
            {
              "name": "duration_seconds",
              "value": "={{ $json.duration_seconds }}"
            },
            {
              "name": "gemini_decision",
              "value": "={{ $json.gemini_decision }}"
            },
            {
              "name": "approval_rate_before",
              "value": "={{ $json.approval_rate_before }}"
            },
            {
              "name": "approval_rate_after",
              "value": "={{ $json.approval_rate_after }}"
            },
            {
              "name": "created_at",
              "value": "={{ $json.created_at }}"
            },
            {
              "name": "updated_at",
              "value": "={{ $json.updated_at }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "name": "Get Workflow Status REAL",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        448,
        3216
      ],
      "id": "b8256e24-65c5-48cb-88e0-f0d0af7362e0",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      },
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// FIXED VERSION - handles both array and object responses\nconst response = $input.item.json;\n\n// Check if response is array or needs to be wrapped\nlet decisions = Array.isArray(response) ? response : (response.data || [response]);\n\n// Filter out empty/null entries\ndecisions = decisions.filter(d => d && d.created_at);\n\nif (!decisions || decisions.length === 0) {\n  return [{\n    json: {\n      response: 'üìä MECHTECH Status\\n\\n‚ùå Noch keine Daten!\\n\\nWorkflow l√§uft t√§glich alle 4 Stunden.',\n      recipient: $('Parse Command Input').item.json.source,\n      subject: 'MECHTECH Status Report'\n    }\n  }];\n}\n\nconst lastRun = decisions[0];\nconst total = decisions.reduce((sum, d) => sum + (d.products_processed || 0), 0);\nconst successRate = total > 0 \n  ? ((decisions.reduce((sum, d) => sum + (d.success_count || 0), 0) / total) * 100).toFixed(1)\n  : 0;\n\nconst responseText = `üìä MECHTECH WORKFLOW STATUS\n\n‚úÖ Letzte Ausf√ºhrung:\n- Shop: ${lastRun.shop_name || 'N/A'}\n- Datum: ${new Date(lastRun.created_at).toLocaleString('de-DE')}\n- Phase: ${lastRun.decision_type || 'N/A'}\n- Produkte: ${lastRun.products_processed || 0}\n- Erfolge: ${lastRun.success_count || 0}\n\nüìà Letzte ${decisions.length} Runs:\n- Total Produkte: ${total}\n- Success Rate: ${successRate}%\n- Kosten: ‚Ç¨0.00\n\n‚è∞ N√§chster Run: T√§glich 2:00 AM\n\nüí° Commands:\n- status: Aktueller Status\n- report: Vollst√§ndiger Report\n- help: Hilfe`;\n\nreturn [{\n  json: {\n    response: responseText,\n    recipient: $('Parse Command Input').item.json.source,\n    subject: 'MECHTECH Status Report'\n  }\n}];"
      },
      "name": "Format Status Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        720,
        3200
      ],
      "id": "fcda15a3-cb6f-4555-8311-06d6417327f4",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        2560,
        3120
      ],
      "id": "9fc70bd5-d620-41bb-a57b-9c65947cee68",
      "name": "MCP Client"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -1552,
        3984
      ],
      "id": "97c802c9-8598-4fda-9d34-0b6a526d631e",
      "name": "When clicking ‚ÄòExecute workflow‚Äô"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 4
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        -1552,
        4208
      ],
      "id": "f7365647-a5e5-41de-91d7-06bc4200a338",
      "name": "Schedule Trigger",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Current Approval Rate: {{ $json.current_approval_rate }}%. Products needing fix: {{ $json.products_needing_fix.length }}. Total products: {{ $json.total_products }}. Approved: {{ $json.approved_count }}. Disapproved: {{ $json.disapproved_count }}.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "\"Update Gemini System Prompt im Workflow:\n\nDu bist Gemini f√ºr MECHTECH Merchant Center.\n\nT√ÑGLICHE AUFGABE:\n1. Lade Produkte aus Shop (5339977843 + 124485833)\n2. Analysiere jeden Artikel:\n   - Hat Adult Flag? (adult: true, ageGroup: adult)\n   - GTIN/EAN vorhanden?\n   - Text ok? (keine expliziten Begriffe)\n   - Bilder ok? (Explicitness < 70)\n   - Country Feeds ok?\n   - Country Einstellungen ok?\n   - Sichtbare Signale, alle ok?\n   - H√§ndlerqualit√§t ok?\n   - H√§ndlerqualit√§t Versand Einstellungen alle L√§nder ok?\n   - Versand und Retouren ok?\n   - Versandrichtlinien Status / Sichtbarke ok?\n   - Vorhandene Signale (alle L√§nder), Alle Vorgaben ok?\n   - Empfehlungen ansehen = 0,00 - ok?\n   - GTIN/EAN ok?\n3. Entscheide PRIORIT√ÑT:\n   - Phase 1: Fehlende Adult Flags ‚Üí SOFORT!\n   - Phase 2: Schlechte Texte ‚Üí dann\n   - Phase 3: Bilder problematisch ‚Üí zuletzt\n   - Phase 4: GTIN/EAN fehlt ‚Üí parallel\n\n4. Pro Phase OUTPUT:\n\n{\n  'phase': 'adult_flags|text|images|gtin',\n  'products_count': XXX,\n  'products': [\n    {\n      'sku': 'ABC123',\n      'action': 'set_adult_flag|sanitize_text|check_images|fix_gtin',\n      'current_value': '...',\n      'new_value': '...',\n      'reason': 'Adult content in description',\n      'confidence': 85,\n      'cost': '‚Ç¨0.00'\n    }\n  ],\n  'quality_score_before': 45,\n  'quality_score_after': 52,\n  'approval_rate_before': '0,06%',\n  'approval_rate_after': '1,2%',\n  'estimated_time': '15 min',\n  'next_phase': 'sanitize_text'\n}\n\n5. WICHTIG:\n   - Kostenlos? Wenn NEIN ‚Üí Frag!\n   - Adult Flags = UNBEGRENZT\n   - Text Fix = KOSTENLOS\n   - Bilder = Max 33/Tag\n   - GTIN/EAN = Lookup oder identifier_exists=false\n   - Logging zu Supabase + Sheets\n\n6. REGELN:\n   - Niemals: Preise, Delete, Verf√ºgbarkeit √§ndern\n   - Immer: Adult Flag setzen!\n   - Langsam aber stetig\n   - Logs schreiben vor Update!\n\n7. ERFOLGS-Meldung (KEINE Errors):\n   - An: info@mechtech-support.com\n   - Format: Daily Success Report\n   - Nur Erfolge, keine Errors!\""
        }
      },
      "id": "ae69ec67-5fdf-4321-807f-08c6e1a9e42d",
      "name": "Gemini Daily Decision",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        672,
        3760
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "id": "e2a41dfb-678f-498c-ab43-89556794736a",
      "name": "Gemini flash_2.0",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        480,
        3968
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        624,
        3968
      ],
      "id": "4d339d74-f9c3-4320-8741-f19bafc66e28",
      "name": "MCP Client1"
    },
    {
      "parameters": {
        "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        864,
        3968
      ],
      "id": "b88cf11b-4d3e-4402-9439-950c9d529daa",
      "name": "Supabase RAG Context",
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        720,
        3472
      ],
      "id": "b5521515-d0ac-45f6-b0b1-b303ed836c12",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/products/{{ $json.product_id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "options": {}
      },
      "name": "Update GTN/EAN",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1616,
        4224
      ],
      "id": "6ed2f287-110a-4965-956f-e570764c8d17",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "amount": 2
      },
      "name": "Rate Limiting GTN/EAN",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1840,
        4320
      ],
      "id": "9aaeba37-60f8-4d17-9eab-ace3c8e62609",
      "webhookId": "rate-limit-country-webhook",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// PREPARE GTIN/EAN LOOP - F√ºr Gemini GTIN/EAN Updates\n// ============================================================================\nconst inputData = $input.first().json;\nconst config = $('Shop Configuration2').first().json;\n\n// ‚úÖ Hole Products von Analyze Products2:\nconst analysis = $('Analyze Products2').first().json;\nconst productsToFix = analysis.products_needing_fix || [];\n\n// ‚úÖ Hole Priority und Max Products von Gemini Decision:\nconst decision = $('Gemini Daily Decision').first().json.output || {};\nconst maxProducts = decision.products_to_process || productsToFix.length;\n\n// ‚úÖ Shop ID von Decision ODER Config:\nconst shopId = decision.shop_id || config.shop1_id;\n\n// ‚úÖ Shop Info aus Config:\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\n// Filtere nur Products die GTIN/EAN Updates brauchen\nconst productsNeedingGtinEan = productsToFix.filter(product => {\n  // Pr√ºfe ob Gemini empfohlen hat GTIN/EAN zu aktualisieren\n  return product.needs_gtin_ean === true || \n         product.missing_gtin === true || \n         product.missing_mpn === true ||\n         product.missing_brand === true ||\n         (product.priority && product.priority === 'multi_gtn_ean');\n});\n\n// Slice f√ºr Batch Processing\nconst productsSlice = productsNeedingGtinEan.slice(0, maxProducts);\n\n// ‚úÖ Erstelle Items mit GTIN/EAN Daten:\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    \n    // GTIN/EAN Daten (von Gemini oder Product)\n    gtin: product.gtin || product.gtin_from_gemini || product.recommended_gtin || '',\n    mpn: product.mpn || product.mpn_from_gemini || product.recommended_mpn || '',\n    brand: product.brand || product.brand_from_gemini || product.recommended_brand || '',\n    \n    action: 'gtin_ean',\n    priority: 'multi_gtn_ean',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
      },
      "name": "Prepare GTN/EAN_Loop",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1392,
        4272
      ],
      "id": "94f879e2-8f20-4964-bd15-d3f5c4ee21e0",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": "üìù Daily_Log"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Timestamp": "={{ $json.run_date }}",
            "Shop": "={{ $json.shop_id }}",
            "Phase": "={{ $json.phase }}",
            "Products Processed": "={{ $json.products_processed }}",
            "Success Count": "={{ $json.success_count }}",
            "Failed Count": "={{ $json.failed_count }}",
            "Status": "={{ $json.created_at }}",
            "Action": "={{ $json.gemini_decision }}",
            "Details": "={{ $json.approval_rate_after }}"
          },
          "matchingColumns": [
            "Timestamp"
          ],
          "schema": [
            {
              "id": "Timestamp",
              "displayName": "Timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Shop",
              "displayName": "Shop",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Phase",
              "displayName": "Phase",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Action",
              "displayName": "Action",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Products Processed",
              "displayName": "Products Processed",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Success Count",
              "displayName": "Success Count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Failed Count",
              "displayName": "Failed Count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Details",
              "displayName": "Details",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false,
          "mappings": [
            {
              "column": "Timestamp",
              "value": "={{ $json.run_date }}"
            },
            {
              "column": "Shop",
              "value": "={{ $json.shop_name }}"
            },
            {
              "column": "Phase",
              "value": "={{ $json.phase }}"
            },
            {
              "column": "Action",
              "value": "Daily Run"
            },
            {
              "column": "Products Processed",
              "value": "={{ $json.products_processed }}"
            },
            {
              "column": "Success Count",
              "value": "={{ $json.success_count }}"
            },
            {
              "column": "Failed Count",
              "value": "={{ $json.failed_count }}"
            },
            {
              "column": "Status",
              "value": "={{ $json.status }}"
            },
            {
              "column": "Details",
              "value": "={{ $json.reasoning }}"
            }
          ]
        },
        "options": {}
      },
      "id": "17f274ec-bf87-41de-baeb-bbda9150cf42",
      "name": "Log Results_Sheets_01",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.4,
      "position": [
        2160,
        5984
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "pbNsBLFTIuL9ArMn",
          "name": "Google Sheets"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.emailReadImap",
      "typeVersion": 2.1,
      "position": [
        -1552,
        3792
      ],
      "id": "46e35eaf-c32a-4a08-8f4b-a9837aca2fac",
      "name": "Email Trigger (IMAP)1",
      "credentials": {
        "imap": {
          "id": "CdpePT9CweqekWEC",
          "name": "IMAP info@mechtech-support.com"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "id": "d10a4fe1-9929-400a-8ed5-d00547c0efc2",
      "name": "Gemini Error Handler Adult Flags",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2672,
        3296
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "5b458ee1-3e91-4f93-a274-dd8c6dec569a",
      "name": "Gemini Error Handler Images",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2672,
        3504
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        2944,
        3296
      ],
      "id": "0fecc373-8d59-416f-a56d-8d380ec6a1d7",
      "name": "MCP Client2"
    },
    {
      "parameters": {
        "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        2816,
        3296
      ],
      "id": "4d6f327e-b8e8-4f15-96bd-8e17cbfd079b",
      "name": "Supabase RAG Context1",
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Error from Update Product Adult Flag: {{ $json.error || $json.message || \"Unknown error\" }}. Product ID: {{ $json.product_id }}. Analyze this error and suggest a fix.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the Update Product Adult Flag operation and provide actionable solutions. Return a JSON response with: error_type, root_cause, suggested_fix, retry_recommended (boolean), and confidence_score (0-100)."
        }
      },
      "id": "4530d562-0e08-4477-9232-a40577c0259a",
      "name": "AI Error Analyzer Adult Flags",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        2320,
        3360
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        2944,
        3504
      ],
      "id": "e08dffe9-0f22-40ab-a74b-0a932095d03b",
      "name": "MCP Client3"
    },
    {
      "parameters": {
        "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        2816,
        3504
      ],
      "id": "1f130c48-940d-4f22-b6c2-4932f0c08486",
      "name": "Supabase RAG Context2",
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.error }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists"
                    },
                    "id": "31be9c5b-39e7-49b3-9bed-4c9581c621b1"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Error"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "renameFallbackOutput": "Success"
        }
      },
      "id": "a2259150-518d-4ba2-af60-0a49d41702d9",
      "name": "Error Check Adult Flags",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        2112,
        3360
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "f0a8ebb8-aa3c-49fa-b98f-e40ec08d512f"
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "id": "8001e77a-1b21-41bb-adea-933184be6e93",
      "name": "Error Check Images",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        2112,
        3568
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "id": "efee3d48-1966-44bd-a370-2ecff1d997ec",
      "name": "Error Check Text",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        2112,
        3760
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "id": "0a3ee0f3-ce39-4cc0-bf0b-fc9c8588ce78",
      "name": "Error Check Merchant",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        2112,
        3952
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Error from Update Product Images: {{ $json.error || $json.message || \"Unknown error\" }}. Product ID: {{ $json.product_id }}. Analyze this error and suggest a fix.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the Update Product Images operation and provide actionable solutions. Return a JSON response with: error_type, root_cause, suggested_fix, retry_recommended (boolean), and confidence_score (0-100)."
        }
      },
      "id": "6b164448-305b-4b29-ae3d-246a6bccea33",
      "name": "AI Error Analyzer Images",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        2320,
        3568
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "id": "a1450a21-5dbe-4b2a-b605-1ee1d499fcc8",
      "name": "Gemini Error Handler Adult Flags1",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2672,
        3696
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        2944,
        3696
      ],
      "id": "5b17fbeb-dc3c-460e-90c0-597c4ed9a199",
      "name": "MCP Client4"
    },
    {
      "parameters": {
        "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        2816,
        3696
      ],
      "id": "a3d4e8fb-1946-44eb-b9aa-efe391dfd2b4",
      "name": "Supabase RAG Context3",
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Error from Update Product Text: {{ $json.error || $json.message || \"Unknown error\" }}. Product ID: {{ $json.product_id }}. Analyze this error and suggest a fix.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the Update Product Text operation and provide actionable solutions. Return a JSON response with: error_type, root_cause, suggested_fix, retry_recommended (boolean), and confidence_score (0-100)."
        }
      },
      "id": "06db2f55-efb0-4d80-ba14-2652fa34607f",
      "name": "AI Error Analyzer Text",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        2320,
        3760
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        2944,
        3888
      ],
      "id": "cca475f7-febd-451d-92e5-c8335008a2e5",
      "name": "MCP Client5"
    },
    {
      "parameters": {
        "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        2816,
        3888
      ],
      "id": "578441cb-2609-46b2-b9ab-496c2bc42e3a",
      "name": "Supabase RAG Context4",
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3344,
        3904
      ],
      "id": "a58090fe-3d4a-45f0-b2f5-39ddc0053f02",
      "name": "Google Gemini Chat Model4",
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "id": "ed464ebb-cb22-4a9f-9007-da3e9c71f972",
      "name": "Gemini Error Handler Merchant Quality",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2672,
        3888
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Error from Update Product Merchant Quality: {{ $json.error || $json.message || \"Unknown error\" }}. Product ID: {{ $json.product_id }}. Analyze this error and suggest a fix.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the Update Product Merchant Quality operation and provide actionable solutions. Return a JSON response with: error_type, root_cause, suggested_fix, retry_recommended (boolean), and confidence_score (0-100)."
        }
      },
      "id": "6c8f0fd7-f7b6-4808-bd9c-f6980d8b5525",
      "name": "AI Error Analyzer Merchant",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        2320,
        3952
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"priority\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"enum\": [\"adult_flags\", \"images\", \"text\"]\n\t\t},\n\t\t\"reasoning\": {\n\t\t\t\"type\": \"string\"\n\t\t},\n\t\t\"products_to_process\": {\n\t\t\t\"type\": \"number\"\n\t\t}\n\t},\n\t\"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}",
        "autoFix": true
      },
      "id": "6e12ef43-d070-41cc-bb7a-dd5ad2cad08d",
      "name": "Adult_Flags_Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        3056,
        3296
      ]
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"priority\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"enum\": [\"adult_flags\", \"images\", \"text\"]\n\t\t},\n\t\t\"reasoning\": {\n\t\t\t\"type\": \"string\"\n\t\t},\n\t\t\"products_to_process\": {\n\t\t\t\"type\": \"number\"\n\t\t}\n\t},\n\t\"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}",
        "autoFix": true
      },
      "id": "b8e0354b-05a8-421e-b271-eb8eec1c281c",
      "name": "Images Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        3056,
        3488
      ]
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"priority\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"enum\": [\"adult_flags\", \"images\", \"text\"]\n\t\t},\n\t\t\"reasoning\": {\n\t\t\t\"type\": \"string\"\n\t\t},\n\t\t\"products_to_process\": {\n\t\t\t\"type\": \"number\"\n\t\t}\n\t},\n\t\"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}",
        "autoFix": true
      },
      "id": "efd9b66e-54b7-4233-98b3-52f71c4ff379",
      "name": "Text_Output_Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        3056,
        3696
      ]
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3344,
        3296
      ],
      "id": "69654bcc-b6fa-4667-a46f-d6d6f91b3160",
      "name": "Gemini Chat flash_2",
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3344,
        3504
      ],
      "id": "6d31dda8-e5d6-41df-8075-dcb311b43f83",
      "name": "Gemini_Chat_Flash_2",
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3344,
        3696
      ],
      "id": "d9475579-a297-45af-831c-47fc1a430737",
      "name": "Google_Gemini_Chat",
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        2816,
        4080
      ],
      "id": "c805d280-d918-46f7-a385-84d50487cd93",
      "name": "Supabase RAG Context5",
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3344,
        4096
      ],
      "id": "21f39432-9052-4d19-a2b9-4d7bc59e2b6b",
      "name": "Google Gemini Chat Model5",
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "ec67e3ab-088f-4442-a0eb-74ed7c7c4bbb"
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "id": "447e207d-a9fb-4e18-a2e4-c8ec9c0b829e",
      "name": "Error_Multi_Country",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        2112,
        4144
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Error from Update Product Error Multi Country: {{ $json.error || $json.message || \"Unknown error\" }}. Product ID: {{ $json.product_id }}. Analyze this error and suggest a fix.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the Update Product Error Multi Country operation and provide actionable solutions. Return a JSON response with: error_type, root_cause, suggested_fix, retry_recommended (boolean), and confidence_score (0-100)."
        }
      },
      "id": "1b7fdcca-867b-4d7c-b7d8-a638ede5cc5b",
      "name": "AI Error Analyzer Error_Multi_Country",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        2320,
        4144
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "id": "3930989d-81c1-4d87-8078-b7330dba1c7f",
      "name": "Error Handler_Multi_Country",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2672,
        4080
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        2944,
        4080
      ],
      "id": "927b0952-1315-4ff0-ae4f-739c4b3751c4",
      "name": "MCP Client_6"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"priority\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"enum\": [\"adult_flags\", \"images\", \"text\"]\n\t\t},\n\t\t\"reasoning\": {\n\t\t\t\"type\": \"string\"\n\t\t},\n\t\t\"products_to_process\": {\n\t\t\t\"type\": \"number\"\n\t\t}\n\t},\n\t\"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}",
        "autoFix": true
      },
      "id": "0c73a23a-57f9-4dd1-92a8-a6d36ac3da8f",
      "name": "Country_Out_Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        3056,
        4080
      ]
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"priority\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"enum\": [\"adult_flags\", \"images\", \"text\"]\n\t\t},\n\t\t\"reasoning\": {\n\t\t\t\"type\": \"string\"\n\t\t},\n\t\t\"products_to_process\": {\n\t\t\t\"type\": \"number\"\n\t\t}\n\t},\n\t\"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}",
        "autoFix": true
      },
      "id": "7121e339-972e-4c1e-9fa2-0113ff3aadca",
      "name": "Merchant_Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        3056,
        3888
      ]
    },
    {
      "parameters": {
        "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        2816,
        4272
      ],
      "id": "5bbc16eb-06d2-4c99-b2fb-54efa52ddad9",
      "name": "Supabase RAG Context6",
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3344,
        4288
      ],
      "id": "e40486bb-914a-48c5-8612-8de68fbd8ff0",
      "name": "Google Gemini Chat Model6",
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        2944,
        4272
      ],
      "id": "8d60552e-67ef-4d1e-b2d1-3088e7c80463",
      "name": "MCP Client_"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "ec67e3ab-088f-4442-a0eb-74ed7c7c4bbb"
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "id": "f4e12d45-3c30-440d-82d3-a1cdc410f04f",
      "name": "Error_Multi_GTN/EAN",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        2112,
        4336
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Error from Update Product Error Multi GTN/EAN: {{ $json.error || $json.message || \"Unknown error\" }}. Product ID: {{ $json.product_id }}. Analyze this error and suggest a fix.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the Update Product Error Multi GTN/EAN operation and provide actionable solutions. Return a JSON response with: error_type, root_cause, suggested_fix, retry_recommended (boolean), and confidence_score (0-100)."
        }
      },
      "id": "361c2e21-76c0-43fa-99a3-83c73a676095",
      "name": "AI Error Analyzer Error_Multi_GTN/EAN",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        2320,
        4336
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"priority\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"enum\": [\"adult_flags\", \"images\", \"text\"]\n\t\t},\n\t\t\"reasoning\": {\n\t\t\t\"type\": \"string\"\n\t\t},\n\t\t\"products_to_process\": {\n\t\t\t\"type\": \"number\"\n\t\t}\n\t},\n\t\"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}",
        "autoFix": true
      },
      "id": "8052dcaa-6fc6-4884-93e8-b9ebc26e7ef0",
      "name": "Multi_GTN/EAN_Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        3056,
        4272
      ]
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "id": "2abee768-b31f-45d5-b645-346eb3bde44d",
      "name": "Error_GTN/EAN",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2672,
        4272
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        2816,
        4480
      ],
      "id": "8ed54e38-5083-4d7d-83d6-816d09fe5c35",
      "name": "Supabase RAG Context7",
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3344,
        4496
      ],
      "id": "807404fa-f887-4cc3-b3b2-f0beff9a1107",
      "name": "Google Gemini Chat Model7",
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        2944,
        4480
      ],
      "id": "9d8c4030-6ab2-459d-8b55-7845448fd3c4",
      "name": "MCP Client_1"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// PREPARE H√ÑNDERQUALIT√ÑTR LOOP - F√ºr Gemini H√ÑNDLERQUALIT√ÑT Updates\n// ============================================================================\nconst inputData = $input.first().json;\nconst config = $('Shop Configuration2').first().json;\n\n// ‚úÖ Hole Products von Analyze Products2:\nconst analysis = $('Analyze Products2').first().json;\nconst productsToFix = analysis.products_needing_fix || [];\n\n// ‚úÖ Hole Priority und Max Products von Gemini Decision:\nconst decision = $('Gemini Daily Decision').first().json.output || {};\nconst maxProducts = decision.products_to_process || productsToFix.length;\n\n// ‚úÖ Shop ID von Decision ODER Config:\nconst shopId = decision.shop_id || config.shop1_id;\n\n// ‚úÖ Shop Info aus Config:\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\n// Filtere nur H√§ndlerqualit√§t die Updates brauchen\nconst productsNeedingHaendlerqualitaet = productsToFix.filter(product => {\n  // Pr√ºfe ob Gemini empfohlen hat H√§ndlerqualit√§t zu aktualisieren\n  return product.needs_Haendlerqualitaet === true || \n         product.missing_Haendlerqualitaet === true || \n         product.missing_mpn === true ||\n         product.missing_brand === true ||\n         (product.priority && product.priority === 'multi_gtn_ean');\n});\n\n// Slice f√ºr Batch Processing\nconst productsSlice = productsNeedingGtinEan.slice(0, maxProducts);\n\n// ‚úÖ Erstelle Items mit GTIN/EAN Daten:\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    \n    // GTIN/EAN Daten (von Gemini oder Product)\n    gtin: product.gtin || product.gtin_from_gemini || product.recommended_gtin || '',\n    mpn: product.mpn || product.mpn_from_gemini || product.recommended_mpn || '',\n    brand: product.brand || product.brand_from_gemini || product.recommended_brand || '',\n    \n    action: 'gtin_ean',\n    priority: 'multi_gtn_ean',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
      },
      "name": "Prepare H√§ndlerqualit√§t",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1392,
        4480
      ],
      "id": "6639d3bd-d025-421f-8f37-3ddfc554f4f3",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "id": "b3f3ded7-6e82-4432-8e4f-4d584e546553",
      "name": "Error_H√§ndlerqualit√§t",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2672,
        4480
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"priority\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"enum\": [\"adult_flags\", \"images\", \"text\"]\n\t\t},\n\t\t\"reasoning\": {\n\t\t\t\"type\": \"string\"\n\t\t},\n\t\t\"products_to_process\": {\n\t\t\t\"type\": \"number\"\n\t\t}\n\t},\n\t\"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}",
        "autoFix": true
      },
      "id": "c0b30d6f-23fb-4eb6-a953-248646d1bbe6",
      "name": "H√§ndlerqualit√§t_Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        3056,
        4480
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "ec67e3ab-088f-4442-a0eb-74ed7c7c4bbb"
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "id": "a4ab0fe8-a3c3-4df0-b85c-488180138a62",
      "name": "Error_H√§ndlerqualit√§t1",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        2112,
        4544
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Error from Update Product Error Multi GTN/EAN: {{ $json.error || $json.message || \"Unknown error\" }}. Product ID: {{ $json.product_id }}. Analyze this error and suggest a fix.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the Update Product Error H√§ndlerqualit√§t operation and provide actionable solutions. Return a JSON response with: error_type, root_cause, suggested_fix, retry_recommended (boolean), and confidence_score (0-100)."
        }
      },
      "id": "99aea2f8-9d74-47ca-b49f-e76fd09d9ed6",
      "name": "AI Error Analyzer_H√§ndlerqualit√§t",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        2320,
        4544
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "amount": 2
      },
      "name": "Rate Limiting H√§ndlerqualit√§t",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        1840,
        4528
      ],
      "id": "5f195b85-5390-4954-ac17-ae6ba0ee18ce",
      "webhookId": "rate-limit-country-webhook",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/products/{{ $json.product_id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "options": {}
      },
      "name": "Update H√§ndlerqualit√§t",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1616,
        4432
      ],
      "id": "e29819e3-0587-4c97-a6e2-adba595573e5",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "contextWindowLength": 50
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        736,
        3968
      ],
      "id": "1d6dfbd7-4d36-4b6e-b146-403d23798fd1",
      "name": "Memory"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"priority\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"enum\": [\"adult_flags\", \"images\", \"text\"]\n\t\t},\n\t\t\"reasoning\": {\n\t\t\t\"type\": \"string\"\n\t\t},\n\t\t\"products_to_process\": {\n\t\t\t\"type\": \"number\"\n\t\t}\n\t},\n\t\"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}",
        "autoFix": true
      },
      "id": "80ea7d6c-c070-4ba8-88ad-8942b454bcba",
      "name": "Decision_Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        672,
        3632
      ]
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "id": "f07c1896-1e7b-4b73-b25e-24b4906bf0a5",
      "name": "Gemini Product Optimizer (NEW)",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3344,
        4768
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const parsed = $input.item.json;\nconst confidence = parsed.confidence || 0;\nconst errorsCount = (parsed.errors_detected || []).length;\nconst needsLookup = parsed.gtin_lookup_needed || false;\n\nreturn [{\n  json: {\n    ...parsed,\n    quality_score: confidence,\n    has_errors: errorsCount > 0,\n    needs_correction: confidence < 70,\n    needs_gtin_lookup: needsLookup,\n    correction_needed: {\n      title: confidence < 70,\n      description: confidence < 70,\n      images: errorsCount > 0,\n      identifiers: !parsed.changes.identifier_exists\n    }\n  }\n}];"
      },
      "id": "fb3e7db2-f14e-4a70-907e-8645e8ccacf8",
      "name": "Check Quality Score",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3936,
        3504
      ]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.needs_correction }}",
              "value2": "true"
            }
          ]
        },
        "combineOperation": "any"
      },
      "id": "e468ef99-47bc-461d-8f63-641990fe3600",
      "name": "Route: Needs Correction?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        3664,
        3504
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash-exp",
        "options": {}
      },
      "id": "912bcfc9-f85b-4dec-ad55-24b97eadede0",
      "name": "Gemini: Error Correction",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3632,
        3264
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const correctionOutput = $input.item.json;\nconst originalChanges = $('Check Quality Score').first().json.changes || {};\n\nconst mergedChanges = {\n  ...originalChanges,\n  ...correctionOutput\n};\n\nreturn [{\n  json: {\n    ...$('Check Quality Score').first().json,\n    changes: mergedChanges,\n    correction_applied: true,\n    correction_source: 'gemini-error-correction'\n  }\n}];"
      },
      "id": "e2f0f727-b488-42f5-a0c4-5f367ad2679e",
      "name": "Apply Corrections",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3920,
        3328
      ]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.needs_gtin_lookup }}",
              "value2": "true"
            }
          ]
        }
      },
      "id": "3773b202-9df5-4494-8d2f-e84547689ecf",
      "name": "Route: GTIN Lookup Needed?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        3664,
        3744
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "url": "=https://www.googleapis.com/customsearch/v1?q={{ $json.title }}&key={{ env.GOOGLE_API_KEY }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleApi",
        "options": {}
      },
      "id": "a260bd6f-3a1c-4c13-a288-14f4da568e57",
      "name": "GTIN Lookup (Search)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4128,
        3680
      ],
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const searchResults = $input.item.json.items || [];\nconst firstResult = searchResults[0] || {};\n\nconst gtin = firstResult.snippet?.match(/GTIN[:\\s]+([\\d-]+)/)?.[1] || null;\n\nreturn [{\n  json: {\n    ...$('Check Quality Score').first().json,\n    gtin_found: gtin ? true : false,\n    gtin_value: gtin,\n    changes: {\n      ...($('Check Quality Score').first().json.changes || {}),\n      gtin: gtin\n    }\n  }\n}];"
      },
      "id": "dffb21dd-3b84-470d-9a53-987aa391f79e",
      "name": "Extract GTIN",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4352,
        3664
      ]
    },
    {
      "parameters": {
        "jsCode": "const changes = $json.changes || {};\nconst body = {};\n\nif (changes.title) body.title = changes.title;\nif (changes.description) body.description = changes.description;\nif (changes.image_link) body.imageLink = changes.image_link;\nif (changes.brand) body.brand = changes.brand;\nif (changes.gtin) body.gtin = changes.gtin;\nif (changes.mpn) body.mpn = changes.mpn;\nif (typeof changes.identifier_exists === 'boolean') {\n  body.identifierExists = changes.identifier_exists;\n}\n\nreturn [{\n  json: {\n    patch_body: body,\n    product_id: $json.product_id,\n    shop_id: $json.shop_id,\n    changes_count: Object.keys(body).length\n  }\n}];"
      },
      "id": "ad9d66dd-c482-49e6-b547-825106e323e3",
      "name": "Build PATCH Body",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4352,
        3488
      ]
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://shoppingcontent.googleapis.com/content/v2.1/{{ $json.shop_id }}/products/{{ $json.product_id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendBody": "json",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "id": "480bd5df-f7fb-4829-a5e5-c66877141f20",
      "name": "Update Product in GCM",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4144,
        3488
      ],
      "credentials": {
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const response = $input.item.json;\nconst isSuccess = response.status === 200 || response.id;\n\nreturn [{\n  json: {\n    product_id: $('Build PATCH Body').first().json.product_id,\n    update_status: isSuccess ? 'success' : 'failed',\n    updated_fields: $('Build PATCH Body').first().json.changes_count,\n    timestamp: new Date().toISOString(),\n    response: response\n  }\n}];"
      },
      "id": "44adbc17-2545-4d2c-b6e7-35f5c2138284",
      "name": "Log Update Result",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4544,
        3472
      ]
    },
    {
      "parameters": {
        "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        2944,
        4768
      ],
      "id": "28e4e2b8-84cf-4f56-a0f7-64388efcae77",
      "name": "MCP Client_2"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "id": "b29b902b-e9ed-4205-9a1e-d9addb91c75e",
      "name": "MC_Prepare_S24",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2688,
        4768
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://www.googleapis.com/content/v2.1/{{ $('Shop Configuration2').item.json.shop1_id }}/productstatuses?maxResults=250",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "id": "d4a8602f-8e22-4212-8b78-672a0d787356",
      "name": "MC_Get_Products_S24",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1616,
        4672
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"product_id\": {\n      \"type\": \"string\",\n      \"description\": \"Eindeutige Produkt ID\"\n    },\n    \"title\": {\n      \"type\": \"string\",\n      \"description\": \"Produkt Titel\"\n    },\n    \"changes\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"field\": {\"type\": \"string\"},\n          \"old_value\": {\"type\": \"string\"},\n          \"new_value\": {\"type\": \"string\"},\n          \"reason\": {\"type\": \"string\"}\n        }\n      },\n      \"description\": \"Array von √Ñnderungen\"\n    },\n    \"gtin_lookup_query\": {\n      \"type\": \"string\",\n      \"description\": \"Query f√ºr GTIN Lookup falls ben√∂tigt\"\n    },\n    \"gtin_lookup_needed\": {\n      \"type\": \"boolean\",\n      \"description\": \"Ist GTIN Lookup n√∂tig?\"\n    },\n    \"confidence\": {\n      \"type\": \"number\",\n      \"minimum\": 0,\n      \"maximum\": 100,\n      \"description\": \"Confidence Score 0-100\"\n    },\n    \"reasoning\": {\n      \"type\": \"string\",\n      \"description\": \"Reasoning f√ºr √Ñnderungen\"\n    },\n    \"errors_detected\": {\n      \"type\": \"array\",\n      \"items\": {\"type\": \"string\"},\n      \"description\": \"Liste von Fehlern wenn vorhanden\"\n    }\n  },\n  \"required\": [\"product_id\", \"title\", \"confidence\", \"reasoning\"]\n}",
        "autoFix": true
      },
      "id": "3fffd75f-8d24-4691-9d46-5850ea133dfd",
      "name": "MC_Parse_S24",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        3056,
        4768
      ]
    },
    {
      "parameters": {
        "jsCode": "const productsData = $('Get Merchant Products2').first().json;\nconst statusData = $('MC_Get_Products_S24').first().json;\n\nconst products = Array.isArray(productsData.resources) ? productsData.resources : [productsData];\nconst statuses = Array.isArray(statusData.resources) ? statusData.resources : [statusData];\n\nconst statusMap = {};\nstatuses.forEach(s => {\n  if (s.productId) {\n    statusMap[s.productId] = s;\n  }\n});\n\nconst merged = products.map(product => {\n  const productStatus = statusMap[product.id] || {};\n  const issues = productStatus.itemLevelIssues || [];\n  const price = product.price || {};\n\n  return {\n    json: {\n      product_id: product.id,\n      offer_id: product.offerId || null,\n      title: product.title || null,\n      description: product.description || null,\n      link: product.link || null,\n      image_link: product.imageLink || null,\n      additional_image_links: product.additionalImageLinks || [],\n      price: price.value || null,\n      currency: price.currency || null,\n      brand: product.brand || null,\n      gtin: product.gtin || null,\n      mpn: product.mpn || null,\n      identifier_exists: product.identifierExists || false,\n      approval_status: productStatus.destinationStatuses || [],\n      issues: issues,\n      issue_count: issues.length,\n      raw_product: product,\n      raw_status: productStatus\n    }\n  };\n});\n\nreturn merged;"
      },
      "id": "28c0cd75-494c-4fe8-872a-b8dd994fdaf6",
      "name": "MC Merge Products + Status S24",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1840,
        4752
      ],
      "alwaysOutputData": true,
      "retryOnFail": true
    },
    {
      "parameters": {
        "jsCode": "const item = $input.item.json;\nconst config = $('Shop Configuration2').item.json;\n\nreturn [{\n  json: {\n    shop_id: config.shop1_id,\n    shop_name: config.shop1_name,\n    product_id: item.product_id,\n    offer_id: item.offer_id,\n    title: item.title,\n    description: item.description,\n    link: item.link,\n    image_link: item.image_link,\n    additional_image_links: item.additional_image_links,\n    price: item.price,\n    currency: item.currency,\n    brand: item.brand,\n    gtin: item.gtin,\n    mpn: item.mpn,\n    identifier_exists: item.identifier_exists,\n    issues: item.issues || [],\n    issue_count: item.issue_count || 0,\n    approval_status: item.approval_status || [],\n    needs_optimization: item.issue_count > 0,\n    approval_types: item.approval_status.map(a => a.status || '') || [],\n    timestamp: new Date().toISOString(),\n    raw_product: item.raw_product,\n    raw_status: item.raw_status\n  }\n}];"
      },
      "id": "ba16d0b6-64b7-4fd9-ad60-a96d9b83c52b",
      "name": "Prepare MC For Gemini S24",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1392,
        4752
      ],
      "alwaysOutputData": true,
      "retryOnFail": true
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "ec67e3ab-088f-4442-a0eb-74ed7c7c4bbb"
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "id": "5a1e228a-5402-4eb9-bbfb-5beac231c846",
      "name": "Error_Shop_S24",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        2112,
        4752
      ]
    },
    {
      "parameters": {
        "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        2736,
        5248
      ],
      "id": "9d0151f3-b5d8-46eb-b490-2fb7e9adf5b6",
      "name": "MCP Client_3"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "ec67e3ab-088f-4442-a0eb-74ed7c7c4bbb"
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "id": "c658a39d-4c81-4374-9603-4b29f9d9ef2d",
      "name": "Error_Shop_S",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        2112,
        4960
      ]
    },
    {
      "parameters": {
        "jsCode": "const item = $input.item.json;\nconst config = $('Shop Configuration2').item.json;\n\nreturn [{\n  json: {\n    shop_id: config.shop1_id,\n    shop_name: config.shop1_name,\n    product_id: item.product_id,\n    offer_id: item.offer_id,\n    title: item.title,\n    description: item.description,\n    link: item.link,\n    image_link: item.image_link,\n    additional_image_links: item.additional_image_links,\n    price: item.price,\n    currency: item.currency,\n    brand: item.brand,\n    gtin: item.gtin,\n    mpn: item.mpn,\n    identifier_exists: item.identifier_exists,\n    issues: item.issues || [],\n    issue_count: item.issue_count || 0,\n    approval_status: item.approval_status || [],\n    needs_optimization: item.issue_count > 0,\n    approval_types: item.approval_status.map(a => a.status || '') || [],\n    timestamp: new Date().toISOString(),\n    raw_product: item.raw_product,\n    raw_status: item.raw_status\n  }\n}];"
      },
      "id": "11346f0b-1681-4f98-9f96-07ecb3272e6e",
      "name": "Prepare MC For Gemini DDC",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1392,
        4960
      ],
      "alwaysOutputData": true,
      "retryOnFail": true
    },
    {
      "parameters": {
        "url": "=https://www.googleapis.com/content/v2.1/{{ $('Shop Configuration2').item.json.shop1_id }}/productstatuses?maxResults=250",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "id": "4130e858-6aab-4eb1-9657-7db6d8828b1f",
      "name": "MC_Get_Products_DDC",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1616,
        4880
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const productsData = $('Get Merchant Products2').first().json;\nconst statusData = $('MC_Get_Products_DDC').first().json;\n\nconst products = Array.isArray(productsData.resources) ? productsData.resources : [productsData];\nconst statuses = Array.isArray(statusData.resources) ? statusData.resources : [statusData];\n\nconst statusMap = {};\nstatuses.forEach(s => {\n  if (s.productId) {\n    statusMap[s.productId] = s;\n  }\n});\n\nconst merged = products.map(product => {\n  const productStatus = statusMap[product.id] || {};\n  const issues = productStatus.itemLevelIssues || [];\n  const price = product.price || {};\n\n  return {\n    json: {\n      product_id: product.id,\n      offer_id: product.offerId || null,\n      title: product.title || null,\n      description: product.description || null,\n      link: product.link || null,\n      image_link: product.imageLink || null,\n      additional_image_links: product.additionalImageLinks || [],\n      price: price.value || null,\n      currency: price.currency || null,\n      brand: product.brand || null,\n      gtin: product.gtin || null,\n      mpn: product.mpn || null,\n      identifier_exists: product.identifierExists || false,\n      approval_status: productStatus.destinationStatuses || [],\n      issues: issues,\n      issue_count: issues.length,\n      raw_product: product,\n      raw_status: productStatus\n    }\n  };\n});\n\nreturn merged;"
      },
      "id": "b0d06fd8-a15a-4769-95b6-21f80257e618",
      "name": "MC Merge Products + Status DDC",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1840,
        4960
      ],
      "alwaysOutputData": true,
      "retryOnFail": true
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "id": "5c23e171-642d-4a62-a2b2-5559deec8309",
      "name": "MC_Pre_DDC",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2288,
        5168
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        2416,
        5232
      ],
      "id": "371b91e9-f6ac-4306-8ec5-6486a98d8d2c",
      "name": "Supabase_S24",
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      }
    },
    {
      "parameters": {
        "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        2816,
        4768
      ],
      "id": "7f642742-4033-4976-832d-383064bfb5cd",
      "name": "Supabase_S",
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Error from Update Product Error Multi GTN/EAN: {{ $json.error || $json.message || \"Unknown error\" }}. Product ID: {{ $json.product_id }}. Analyze this error and suggest a fix.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the Update Product Error Gemini S24 operation and provide actionable solutions. Return a JSON response with: error_type, root_cause, suggested_fix, retry_recommended (boolean), and confidence_score (0-100)."
        }
      },
      "id": "e8fd3469-a00f-4c0a-b7f2-29bf0acd92ca",
      "name": "Error_Ana_S24",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        2320,
        4752
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Error from Update Product Error Multi GTN/EAN: {{ $json.error || $json.message || \"Unknown error\" }}. Product ID: {{ $json.product_id }}. Analyze this error and suggest a fix.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the Update Product Error Gemini DDC operation and provide actionable solutions. Return a JSON response with: error_type, root_cause, suggested_fix, retry_recommended (boolean), and confidence_score (0-100)."
        }
      },
      "id": "4f04188e-234f-470d-b78c-5f38cb715a01",
      "name": "Error_Ana_DDC",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        2320,
        4960
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"product_id\": {\n      \"type\": \"string\",\n      \"description\": \"Eindeutige Produkt ID\"\n    },\n    \"title\": {\n      \"type\": \"string\",\n      \"description\": \"Produkt Titel\"\n    },\n    \"changes\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"field\": {\"type\": \"string\"},\n          \"old_value\": {\"type\": \"string\"},\n          \"new_value\": {\"type\": \"string\"},\n          \"reason\": {\"type\": \"string\"}\n        }\n      },\n      \"description\": \"Array von √Ñnderungen\"\n    },\n    \"gtin_lookup_query\": {\n      \"type\": \"string\",\n      \"description\": \"Query f√ºr GTIN Lookup falls ben√∂tigt\"\n    },\n    \"gtin_lookup_needed\": {\n      \"type\": \"boolean\",\n      \"description\": \"Ist GTIN Lookup n√∂tig?\"\n    },\n    \"confidence\": {\n      \"type\": \"number\",\n      \"minimum\": 0,\n      \"maximum\": 100,\n      \"description\": \"Confidence Score 0-100\"\n    },\n    \"reasoning\": {\n      \"type\": \"string\",\n      \"description\": \"Reasoning f√ºr √Ñnderungen\"\n    },\n    \"errors_detected\": {\n      \"type\": \"array\",\n      \"items\": {\"type\": \"string\"},\n      \"description\": \"Liste von Fehlern wenn vorhanden\"\n    }\n  },\n  \"required\": [\"product_id\", \"title\", \"confidence\", \"reasoning\"]\n}",
        "autoFix": true
      },
      "id": "a7ace6d0-3790-412f-845d-f29778a2dfbb",
      "name": "MC_Parse_DDC",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        3056,
        4976
      ]
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "id": "dd88f2d7-8868-4e55-ade6-d2e8825e6540",
      "name": "Optimizer DDC",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3344,
        4976
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    }
  ],
  "connections": {
    "2d6517f1-ebbc-48fd-894c-287420175a7a": {
      "main": [
        [
          {
            "node": "9bf990d0-1d87-4bbb-9153-46146b506ae6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "9bf990d0-1d87-4bbb-9153-46146b506ae6": {
      "main": [
        [
          {
            "node": "3245d64d-7810-44de-beaa-f97d55eb2274",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "3245d64d-7810-44de-beaa-f97d55eb2274": {
      "main": [
        [
          {
            "node": "92b514de-5cd0-4f79-9857-123e685a1405",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "39d79c98-55c7-418a-8c36-bce59d3efd3f": {
      "main": [
        [
          {
            "node": "40a1e96b-15f2-4eb0-bdad-bd7532b02a22",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "40a1e96b-15f2-4eb0-bdad-bd7532b02a22": {
      "main": [
        [
          {
            "node": "f0a9ce99-2f4c-4baf-857a-02c81d0cae4d",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "f0a9ce99-2f4c-4baf-857a-02c81d0cae4d": {
      "main": [
        [
          {
            "node": "09ba4846-6da9-425c-a762-4f9f4bc1b4e6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "f49cb6b3-195b-42f6-a025-a0e78d62cfca": {
      "main": [
        [
          {
            "node": "2d6517f1-ebbc-48fd-894c-287420175a7a",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "92b514de-5cd0-4f79-9857-123e685a1405": {
      "main": [
        [
          {
            "node": "40a1e96b-15f2-4eb0-bdad-bd7532b02a22",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Error Handler": {
      "main": [
        [
          {
            "node": "Retry Queue",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Retry Queue": {
      "main": [
        [
          {
            "node": "Expression Repair",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "main": [
      [
        [
          {
            "node": "7a01b7e8-3184-4982-92f4-a0ba03f781a4",
            "type": "main",
            "index": 0
          },
          {
            "node": "errorHandler-1766014501177-9ez5es86k",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "errorHandler-1766014501177-9ez5es86k",
            "type": "main",
            "index": 0
          },
          {
            "node": "4c9f8649-a6b7-45dd-9ed9-b9134be84018",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "4c9f8649-a6b7-45dd-9ed9-b9134be84018",
            "type": "main",
            "index": 0
          },
          {
            "node": "c0c41789-4c7d-4efc-861f-885743a1aff8",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "errorHandler-1766014501177-9ez5es86k",
            "type": "main",
            "index": 1
          },
          {
            "node": "80b0ee00-87d9-44ec-8b62-8c86eda7737b",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "7a01b7e8-3184-4982-92f4-a0ba03f781a4",
            "type": "main",
            "index": 1
          },
          {
            "node": "65ca06d9-ae1b-4669-ba03-4418312d0442",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "c0c41789-4c7d-4efc-861f-885743a1aff8",
            "type": "main",
            "index": 0
          },
          {
            "node": "7a01b7e8-3184-4982-92f4-a0ba03f781a4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "15586a83-cda8-4ac9-9826-9ed77f24fa1c",
            "type": "main",
            "index": 0
          },
          {
            "node": "ai-error-handler-adult-1766019421751-xxxuhgnln",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ai-error-handler-adult-1766019421751-xxxuhgnln",
            "type": "main",
            "index": 0
          },
          {
            "node": "retry-queue-adult-1766019421751-10y8tihcx",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "retry-queue-adult-1766019421751-10y8tihcx",
            "type": "main",
            "index": 0
          },
          {
            "node": "expression-repair-adult-1766019421752-5eytl5tjg",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "expression-repair-adult-1766019421752-5eytl5tjg",
            "type": "main",
            "index": 0
          },
          {
            "node": "15586a83-cda8-4ac9-9826-9ed77f24fa1c",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "34310e5a-2422-4ce3-a615-5b8f911b5407",
            "type": "main",
            "index": 0
          },
          {
            "node": "ai-error-handler-text-1766019421752-tx9bpgxr6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ai-error-handler-text-1766019421752-tx9bpgxr6",
            "type": "main",
            "index": 0
          },
          {
            "node": "retry-queue-text-1766019421752-b389yhp5y",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "retry-queue-text-1766019421752-b389yhp5y",
            "type": "main",
            "index": 0
          },
          {
            "node": "expression-repair-text-1766019421752-rngvhbii6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "expression-repair-text-1766019421752-rngvhbii6",
            "type": "main",
            "index": 0
          },
          {
            "node": "34310e5a-2422-4ce3-a615-5b8f911b5407",
            "type": "main",
            "index": 0
          }
        ]
      ]
    ],
    "Expression Repair": {
      "main": [
        [
          {
            "node": "Prepare GTN/EAN_Loop",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Chat Trigger (RAG Query)": {
      "main": [
        [
          {
            "node": "Chat Agent (RAG)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Chat Model (RAG)": {
      "ai_languageModel": [
        [
          {
            "node": "Chat Agent (RAG)",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Embeddings (RAG)": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store (Retrieve)",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "Chat Agent (RAG)",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Check Last Run": {
      "main": [
        [
          {
            "node": "Get Merchant Products Shop2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Merchant Products2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Workflow Status REAL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Products Loop": {
      "main": [
        [
          {
            "node": "Prepare Images Loop",
            "type": "main",
            "index": 0
          },
          {
            "node": "Update Product Adult Flag",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Product Adult Flag": {
      "main": [
        [
          {
            "node": "Rate Limiting",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rate Limiting": {
      "main": [
        [
          {
            "node": "Prepare Products Loop",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results_Sheets_01",
            "type": "main",
            "index": 0
          },
          {
            "node": "Save to Supabase Products",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          },
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Error Check Adult Flags",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error Check Adult Flags",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Workflow Run": {
      "main": [
        [
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log Results to Sheets": {
      "main": [
        [
          {
            "node": "Send Daily Report",
            "type": "main",
            "index": 0
          },
          {
            "node": "Save to Supabase Products",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Daily Report": {
      "main": [
        [
          {
            "node": "Format Report for Email",
            "type": "main",
            "index": 0
          },
          {
            "node": "Check if Expert Needed",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Import Commands from Gmail": {
      "main": [
        [
          {
            "node": "Parse Command Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Import Commands from WhatsApp": {
      "main": [
        [
          {
            "node": "Parse Command Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Report for Email": {
      "main": [
        [
          {
            "node": "Export Report to Gmail",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Command Input": {
      "main": [
        [
          {
            "node": "Route Command",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check if Expert Needed": {
      "main": [
        [
          {
            "node": "Send WhatsApp Expert Alert",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Format Report for Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route Command": {
      "main": [
        [
          {
            "node": "Shop Configuration2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Workflow Status REAL",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Command Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Images Loop": {
      "main": [
        [
          {
            "node": "Prepare Text Loop",
            "type": "main",
            "index": 0
          },
          {
            "node": "Update Product Images",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Product Images": {
      "main": [
        [
          {
            "node": "Rate Limiting Images",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rate Limiting Images": {
      "main": [
        [
          {
            "node": "Prepare Images Loop",
            "type": "main",
            "index": 0
          },
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results_Sheets_01",
            "type": "main",
            "index": 0
          },
          {
            "node": "Save to Supabase Products",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          },
          {
            "node": "Error Check Images",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error Check Images",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Text Loop": {
      "main": [
        [
          {
            "node": "Prepare Merchant Quality Loop",
            "type": "main",
            "index": 0
          },
          {
            "node": "Update Product Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Product Text": {
      "main": [
        [
          {
            "node": "Rate Limiting Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rate Limiting Text": {
      "main": [
        [
          {
            "node": "Prepare Text Loop",
            "type": "main",
            "index": 0
          },
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results_Sheets_01",
            "type": "main",
            "index": 0
          },
          {
            "node": "Save to Supabase Products",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          },
          {
            "node": "Error Check Text",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error Check Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Handle Invalid Priority": {
      "main": [
        [
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Shop Configuration2": {
      "main": [
        [
          {
            "node": "Check Last Run",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Merchant Products Shop2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Merchant Products2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Merchant Products2": {
      "main": [
        []
      ]
    },
    "Analyze Products2": {
      "main": [
        [
          {
            "node": "Gemini Daily Decision",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate Results2": {
      "main": [
        [
          {
            "node": "Save Workflow Run",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Human Instructions",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Workflow Status REAL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Merchant Quality Loop": {
      "main": [
        [
          {
            "node": "Prepare Multi Country Loop",
            "type": "main",
            "index": 0
          },
          {
            "node": "Update Merchant Settings",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Merchant Settings": {
      "main": [
        [
          {
            "node": "Rate Limiting Merchant",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Multi Country Loop": {
      "main": [
        [
          {
            "node": "Prepare GTN/EAN_Loop",
            "type": "main",
            "index": 0
          },
          {
            "node": "Update Country Feeds",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Country Feeds": {
      "main": [
        [
          {
            "node": "Rate Limiting Country",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rate Limiting Merchant": {
      "main": [
        [
          {
            "node": "Prepare Merchant Quality Loop",
            "type": "main",
            "index": 0
          },
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Save to Supabase Products",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results_Sheets_01",
            "type": "main",
            "index": 0
          },
          {
            "node": "Error Check Merchant",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error Check Merchant",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rate Limiting Country": {
      "main": [
        [
          {
            "node": "Prepare Multi Country Loop",
            "type": "main",
            "index": 0
          },
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results_Sheets_01",
            "type": "main",
            "index": 0
          },
          {
            "node": "Save to Supabase Products",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          },
          {
            "node": "Error_Multi_Country",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error_Multi_Country",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route by Priority": {
      "main": [
        [
          {
            "node": "Prepare Products Loop",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare Images Loop",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare Text Loop",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare Merchant Quality Loop",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare Multi Country Loop",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare GTN/EAN_Loop",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare H√§ndlerqualit√§t",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare MC For Gemini S24",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare MC For Gemini DDC",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Handle Invalid Priority",
            "type": "main",
            "index": 0
          },
          {
            "node": "Gemini Daily Decision",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Get Merchant Products Shop2": {
      "main": [
        [
          {
            "node": "Analyze Products2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save to Supabase Products": {
      "main": [
        [
          {
            "node": "Update Optimization Patterns",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Optimization Patterns": {
      "main": [
        [
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Human Instructions": {
      "main": [
        [
          {
            "node": "Filter Unprocessed Instructions",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Unprocessed Instructions": {
      "main": [
        [
          {
            "node": "Process Instructions with Gemini",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Instructions with Gemini": {
      "main": [
        [
          {
            "node": "Apply to Similar Products",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Model Learning": {
      "ai_languageModel": [
        [
          {
            "node": "Process Instructions with Gemini",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "JSON Parser Learning": {
      "ai_outputParser": [
        [
          {
            "node": "Process Instructions with Gemini",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Apply to Similar Products": {
      "main": [
        [
          {
            "node": "Update Sheet with AI Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Sheet with AI Response": {
      "main": [
        [
          {
            "node": "Save Learning to Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Learning to Supabase": {
      "main": [
        [
          {
            "node": "Send Daily Report",
            "type": "main",
            "index": 0
          },
          {
            "node": "Format Report for Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Workflow Status REAL": {
      "main": [
        [
          {
            "node": "Format Status Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Status Response": {
      "main": [
        [
          {
            "node": "Send Command Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client": {
      "ai_tool": [
        [
          {
            "node": "Chat Agent (RAG)",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‚ÄòExecute workflow‚Äô": {
      "main": [
        [
          {
            "node": "Shop Configuration2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Shop Configuration2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Daily Decision": {
      "main": [
        [
          {
            "node": "Route by Priority",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini flash_2.0": {
      "ai_languageModel": [
        [
          {
            "node": "Gemini Daily Decision",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client1": {
      "ai_tool": [
        [
          {
            "node": "Gemini Daily Decision",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase RAG Context": {
      "ai_tool": [
        [
          {
            "node": "Gemini Daily Decision",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Decision_Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Update GTN/EAN": {
      "main": [
        [
          {
            "node": "Rate Limiting GTN/EAN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rate Limiting GTN/EAN": {
      "main": [
        [
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results_Sheets_01",
            "type": "main",
            "index": 0
          },
          {
            "node": "Error_Multi_GTN/EAN",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error_Multi_GTN/EAN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare GTN/EAN_Loop": {
      "main": [
        [
          {
            "node": "Update GTN/EAN",
            "type": "main",
            "index": 0
          },
          {
            "node": "Prepare H√§ndlerqualit√§t",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log Results_Sheets_01": {
      "main": [
        [
          {
            "node": "Send WhatsApp Expert Alert",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Email Trigger (IMAP)1": {
      "main": [
        [
          {
            "node": "Shop Configuration2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Error Handler Adult Flags": {
      "ai_languageModel": [
        [
          {
            "node": "AI Error Analyzer Adult Flags",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Error Handler Images": {
      "ai_languageModel": [
        [
          {
            "node": "AI Error Analyzer Images",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client2": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer Adult Flags",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase RAG Context1": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer Adult Flags",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client3": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer Images",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase RAG Context2": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer Images",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Error Check Adult Flags": {
      "main": [
        [
          {
            "node": "AI Error Analyzer Adult Flags",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare Products Loop",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error Check Images": {
      "main": [
        [
          {
            "node": "AI Error Analyzer Images",
            "type": "main",
            "index": 0
          },
          {
            "node": "Prepare Images Loop",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Error Handler Adult Flags1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Error Analyzer Text",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client4": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer Text",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase RAG Context3": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer Text",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Error Check Text": {
      "main": [
        [
          {
            "node": "AI Error Analyzer Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client5": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer Merchant",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase RAG Context4": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer Merchant",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "Merchant_Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Error Check Merchant": {
      "main": [
        [
          {
            "node": "AI Error Analyzer Merchant",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Error Handler Merchant Quality": {
      "ai_languageModel": [
        [
          {
            "node": "AI Error Analyzer Merchant",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Adult_Flags_Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Error Analyzer Adult Flags",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Images Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Error Analyzer Images",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Text_Output_Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Error Analyzer Text",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Chat flash_2": {
      "ai_languageModel": [
        [
          {
            "node": "Adult_Flags_Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Gemini_Chat_Flash_2": {
      "ai_languageModel": [
        [
          {
            "node": "Images Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google_Gemini_Chat": {
      "ai_languageModel": [
        [
          {
            "node": "Text_Output_Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Supabase RAG Context5": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer Error_Multi_Country",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model5": {
      "ai_languageModel": [
        [
          {
            "node": "Country_Out_Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Error_Multi_Country": {
      "main": [
        [
          {
            "node": "AI Error Analyzer Error_Multi_Country",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error Handler_Multi_Country": {
      "ai_languageModel": [
        [
          {
            "node": "AI Error Analyzer Error_Multi_Country",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client_6": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer Error_Multi_Country",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Country_Out_Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Error Analyzer Error_Multi_Country",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Merchant_Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Error Analyzer Merchant",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Supabase RAG Context6": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer Error_Multi_GTN/EAN",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model6": {
      "ai_languageModel": [
        [
          {
            "node": "Multi_GTN/EAN_Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client_": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer Error_Multi_GTN/EAN",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Error_Multi_GTN/EAN": {
      "main": [
        [
          {
            "node": "AI Error Analyzer Error_Multi_GTN/EAN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Multi_GTN/EAN_Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Error Analyzer Error_Multi_GTN/EAN",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Error_GTN/EAN": {
      "ai_languageModel": [
        [
          {
            "node": "AI Error Analyzer Error_Multi_GTN/EAN",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Supabase RAG Context7": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer_H√§ndlerqualit√§t",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model7": {
      "ai_languageModel": [
        [
          {
            "node": "H√§ndlerqualit√§t_Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Prepare H√§ndlerqualit√§t": {
      "main": [
        [
          {
            "node": "Update H√§ndlerqualit√§t",
            "type": "main",
            "index": 0
          },
          {
            "node": "Prepare MC For Gemini S24",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error_H√§ndlerqualit√§t": {
      "ai_languageModel": [
        [
          {
            "node": "AI Error Analyzer_H√§ndlerqualit√§t",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "H√§ndlerqualit√§t_Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Error Analyzer_H√§ndlerqualit√§t",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Error_H√§ndlerqualit√§t1": {
      "main": [
        [
          {
            "node": "AI Error Analyzer_H√§ndlerqualit√§t",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rate Limiting H√§ndlerqualit√§t": {
      "main": [
        [
          {
            "node": "Error_H√§ndlerqualit√§t1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results_Sheets_01",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error_H√§ndlerqualit√§t1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update H√§ndlerqualit√§t": {
      "main": [
        [
          {
            "node": "Rate Limiting H√§ndlerqualit√§t",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Error Analyzer_H√§ndlerqualit√§t": {
      "main": [
        [
          {
            "node": "Gemini Daily Decision",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Gemini Daily Decision",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Error Analyzer Error_Multi_GTN/EAN": {
      "main": [
        [
          {
            "node": "Gemini Daily Decision",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Gemini Daily Decision",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Error Analyzer Error_Multi_Country": {
      "main": [
        [
          {
            "node": "Gemini Daily Decision",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Gemini Daily Decision",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Error Analyzer Merchant": {
      "main": [
        [
          {
            "node": "Gemini Daily Decision",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Gemini Daily Decision",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Error Analyzer Text": {
      "main": [
        [
          {
            "node": "Gemini Daily Decision",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Gemini Daily Decision",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Error Analyzer Images": {
      "main": [
        [
          {
            "node": "Gemini Daily Decision",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Gemini Daily Decision",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Error Analyzer Adult Flags": {
      "main": [
        [
          {
            "node": "Gemini Daily Decision",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Gemini Daily Decision",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Memory": {
      "ai_memory": [
        [
          {
            "node": "Gemini Daily Decision",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Decision_Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Gemini Daily Decision",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Product Optimizer (NEW)": {
      "ai_languageModel": [
        [
          {
            "node": "MC_Parse_S24",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client_1": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer_H√§ndlerqualit√§t",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client_2": {
      "ai_tool": [
        [
          {
            "node": "Error_Ana_S24",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "MC_Prepare_S24": {
      "ai_languageModel": [
        [
          {
            "node": "Error_Ana_S24",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "MC_Get_Products_S24": {
      "main": [
        [
          {
            "node": "MC Merge Products + Status S24",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MC_Parse_S24": {
      "ai_outputParser": [
        [
          {
            "node": "Error_Ana_S24",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "MC Merge Products + Status S24": {
      "main": [
        [
          {
            "node": "Prepare MC For Gemini S24",
            "type": "main",
            "index": 0
          },
          {
            "node": "Error_Shop_S24",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results_Sheets_01",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare MC For Gemini S24": {
      "main": [
        [
          {
            "node": "MC_Get_Products_S24",
            "type": "main",
            "index": 0
          },
          {
            "node": "Prepare MC For Gemini DDC",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error_Shop_S24": {
      "main": [
        [
          {
            "node": "Error_Ana_S24",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client_3": {
      "ai_tool": [
        [
          {
            "node": "Error_Ana_DDC",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Error_Shop_S": {
      "main": [
        [
          {
            "node": "Error_Ana_DDC",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare MC For Gemini DDC": {
      "main": [
        [
          {
            "node": "MC_Get_Products_DDC",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MC_Get_Products_DDC": {
      "main": [
        [
          {
            "node": "MC Merge Products + Status DDC",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MC Merge Products + Status DDC": {
      "main": [
        [
          {
            "node": "Prepare MC For Gemini DDC",
            "type": "main",
            "index": 0
          },
          {
            "node": "Error_Shop_S",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results_Sheets_01",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MC_Pre_DDC": {
      "ai_languageModel": [
        [
          {
            "node": "Error_Ana_DDC",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Supabase_S24": {
      "ai_tool": [
        [
          {
            "node": "Error_Ana_DDC",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase_S": {
      "ai_tool": [
        [
          {
            "node": "Error_Ana_S24",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Error_Ana_S24": {
      "main": [
        [
          {
            "node": "Analyze Products2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Gemini Daily Decision",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MC_Parse_DDC": {
      "ai_outputParser": [
        [
          {
            "node": "Error_Ana_DDC",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Optimizer DDC": {
      "ai_languageModel": [
        [
          {
            "node": "MC_Parse_DDC",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Error_Ana_DDC": {
      "main": [
        [
          {
            "node": "Gemini Daily Decision",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Gemini Daily Decision",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "timeSavedMode": "fixed",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false
  },
  "staticData": {
    "node:Schedule Trigger": {
      "recurrenceRules": [
        20
      ]
    },
    "node:MCP Polling Trigger": {
      "recurrenceRules": []
    },
    "node:Import Commands from Gmail": {
      "Import Commands from Gmail": {
        "lastTimeChecked": 1765824135,
        "possibleDuplicates": [
          "19b235202b40cabe",
          "19b1b0de26275989"
        ]
      }
    },
    "node:Schedule Trigger (Daily 2 AM)": {
      "recurrenceRules": []
    },
    "node:Schedule Daily 2AM": {
      "recurrenceRules": []
    },
    "node:Email Trigger (IMAP)1": {
      "lastMessageUid": 53030
    }
  },
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {
    "Gemini Daily Decision": [
      {
        "json": {
          "output": {
            "priority": "images",
            "reasoning": "All adult flags and texts are OK, but images may need to be checked.",
            "products_to_process": 33
          }
        },
        "pairedItem": {
          "item": 0
        }
      }
    ],
    "Check Last Run": [
      {
        "json": {
          "id": "45f03152-8d68-4724-adf3-9eb175ce7647",
          "run_date": "2025-12-14T02:23:31.196",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T02:23:31.322845",
          "updated_at": "2025-12-14T02:23:31.322845"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "07de4b82-6677-499c-8a95-a70e8d920f37",
          "run_date": "2025-12-14T02:31:21.538",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T02:31:21.754658",
          "updated_at": "2025-12-14T02:31:21.754658"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "eeb0a2cb-f262-4e00-ba73-7e4ad97f65fb",
          "run_date": "2025-12-14T02:40:13.151",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T02:40:13.272195",
          "updated_at": "2025-12-14T02:40:13.272195"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "a43e22ba-1a2d-4d63-a380-d9f5448496fd",
          "run_date": "2025-12-14T02:45:07.863",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T02:45:07.971867",
          "updated_at": "2025-12-14T02:45:07.971867"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "29bc6842-42f6-4a16-907f-e58c0e51a419",
          "run_date": "2025-12-14T02:47:40.848",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T02:47:40.93805",
          "updated_at": "2025-12-14T02:47:40.93805"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "b32f6e18-1e04-4a8d-bb85-d94f2f8f4130",
          "run_date": "2025-12-14T02:50:40.496",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T02:50:40.606527",
          "updated_at": "2025-12-14T02:50:40.606527"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "11e89e7e-81e4-4595-aa72-0da988595226",
          "run_date": "2025-12-14T02:51:14.277",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T02:51:14.383428",
          "updated_at": "2025-12-14T02:51:14.383428"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "074b32c3-89ef-4958-9494-939b57d7068a",
          "run_date": "2025-12-14T02:51:54.144",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T02:51:54.224518",
          "updated_at": "2025-12-14T02:51:54.224518"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "6f997b6e-5cfa-415a-b66f-1c4d6dcc99a4",
          "run_date": "2025-12-14T02:54:39.718",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T02:54:39.791705",
          "updated_at": "2025-12-14T02:54:39.791705"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "180961ae-6f93-48a2-b8c8-2368a5415f6c",
          "run_date": "2025-12-14T02:56:09.428",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T02:56:09.528086",
          "updated_at": "2025-12-14T02:56:09.528086"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "c1d0a6c5-3184-4ec6-b671-1f21941e8240",
          "run_date": "2025-12-14T02:58:17.417",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T02:58:17.509162",
          "updated_at": "2025-12-14T02:58:17.509162"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "18e04a18-038c-4485-9dba-7f86e68c6f3c",
          "run_date": "2025-12-14T02:59:20.795",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T02:59:20.894555",
          "updated_at": "2025-12-14T02:59:20.894555"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "a07eb01a-88fd-48e1-bee9-e7d658802561",
          "run_date": "2025-12-14T03:00:17.857",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:00:17.938177",
          "updated_at": "2025-12-14T03:00:17.938177"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "a925a0be-eec6-420d-a16e-1c37063083cc",
          "run_date": "2025-12-14T03:00:42.279",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:00:42.363988",
          "updated_at": "2025-12-14T03:00:42.363988"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "870ab485-c7fe-4f24-b1a4-f198f0427f6c",
          "run_date": "2025-12-14T03:00:54.672",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:00:54.747378",
          "updated_at": "2025-12-14T03:00:54.747378"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "82784b62-1226-4883-a3ed-50b6cd2f4964",
          "run_date": "2025-12-14T03:05:18.072",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:05:18.162666",
          "updated_at": "2025-12-14T03:05:18.162666"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "d281ac70-449a-48a6-b704-cf1bb14dcf74",
          "run_date": "2025-12-14T03:06:15.955",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:06:16.047067",
          "updated_at": "2025-12-14T03:06:16.047067"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "224f47a0-2fe3-42fc-bb55-fea09c227592",
          "run_date": "2025-12-14T03:10:16.477",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:10:16.556637",
          "updated_at": "2025-12-14T03:10:16.556637"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "25891b68-8438-4e35-b05e-96a49168c592",
          "run_date": "2025-12-14T03:15:22.203",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:15:22.293724",
          "updated_at": "2025-12-14T03:15:22.293724"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "ea7a05b0-6140-4269-9db7-92e979ce54d2",
          "run_date": "2025-12-14T03:20:16.4",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:20:16.505658",
          "updated_at": "2025-12-14T03:20:16.505658"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "cfe61c27-4500-4cac-8932-822fb6d70848",
          "run_date": "2025-12-14T03:25:14.266",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:25:14.35766",
          "updated_at": "2025-12-14T03:25:14.35766"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "f29d7a8d-9cad-4e88-a6a4-6bf5567f7b10",
          "run_date": "2025-12-14T03:25:17.211",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:25:17.283931",
          "updated_at": "2025-12-14T03:25:17.283931"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "2a41f48a-4bb7-4d37-aca3-59695a36c84f",
          "run_date": "2025-12-14T03:25:29.447",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:25:29.533971",
          "updated_at": "2025-12-14T03:25:29.533971"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "28ed3b20-49cb-491b-bd01-fd615e772f88",
          "run_date": "2025-12-14T03:30:15.232",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:30:15.309181",
          "updated_at": "2025-12-14T03:30:15.309181"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "0029d9ef-f428-4680-bf2f-274c40bec175",
          "run_date": "2025-12-14T03:35:17.555",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:35:17.645607",
          "updated_at": "2025-12-14T03:35:17.645607"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "c046394a-43dd-4ca3-9183-ecd583138085",
          "run_date": "2025-12-14T03:36:11.396",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:36:11.487099",
          "updated_at": "2025-12-14T03:36:11.487099"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "0d593706-85b2-47e3-9aec-9fef21679510",
          "run_date": "2025-12-14T03:36:20.073",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:36:20.155502",
          "updated_at": "2025-12-14T03:36:20.155502"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "a582b440-4023-4505-a5c4-8f8f218707d6",
          "run_date": "2025-12-14T03:40:14.531",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:40:14.68539",
          "updated_at": "2025-12-14T03:40:14.68539"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "58b76888-bf1d-4e74-a5cb-67671b82e3fe",
          "run_date": "2025-12-14T03:45:40.77",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:45:40.863308",
          "updated_at": "2025-12-14T03:45:40.863308"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "144efb55-a4d0-491f-9fc9-89ddcf96989e",
          "run_date": "2025-12-14T03:45:47.544",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:45:47.614398",
          "updated_at": "2025-12-14T03:45:47.614398"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "9a1641fb-8eb0-42b2-a5a0-e9759ef94580",
          "run_date": "2025-12-14T03:45:59.122",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:45:59.318792",
          "updated_at": "2025-12-14T03:45:59.318792"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "9bcfc8c4-3d0e-4bb8-97e2-cc090612b139",
          "run_date": "2025-12-14T03:46:10.023",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:46:10.124507",
          "updated_at": "2025-12-14T03:46:10.124507"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "32a782b5-4d89-43be-88fd-415bb9831189",
          "run_date": "2025-12-14T03:50:41.166",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:50:41.239995",
          "updated_at": "2025-12-14T03:50:41.239995"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "8dec47b9-582d-4da3-bd90-c5f0594c6330",
          "run_date": "2025-12-14T03:50:51.164",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:50:51.279928",
          "updated_at": "2025-12-14T03:50:51.279928"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "de8fb357-e91f-45af-8d47-8b55c3657ed2",
          "run_date": "2025-12-14T03:51:15.133",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:51:15.19263",
          "updated_at": "2025-12-14T03:51:15.19263"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "682e4995-f64d-4206-990d-abeca5c9a1d0",
          "run_date": "2025-12-14T03:51:25.948",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:51:26.003095",
          "updated_at": "2025-12-14T03:51:26.003095"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "1a521172-60a5-4015-93aa-4b9f145f7a4c",
          "run_date": "2025-12-14T03:55:41.82",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:55:41.888237",
          "updated_at": "2025-12-14T03:55:41.888237"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "8b5c435a-673a-4b7b-ab19-f50559b5b344",
          "run_date": "2025-12-14T03:55:48.903",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:55:48.960909",
          "updated_at": "2025-12-14T03:55:48.960909"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "b5723836-00ef-4b93-a1c7-1b58382cd1c6",
          "run_date": "2025-12-14T03:56:01.557",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:56:01.625966",
          "updated_at": "2025-12-14T03:56:01.625966"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "a65fa116-005c-4329-9fb7-d0a7eb864ea4",
          "run_date": "2025-12-14T03:56:10.774",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:56:10.838255",
          "updated_at": "2025-12-14T03:56:10.838255"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "0e325fa7-c314-4424-8e42-5e83d7875e2a",
          "run_date": "2025-12-14T04:00:42.112",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T04:00:42.184668",
          "updated_at": "2025-12-14T04:00:42.184668"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "12db7008-d2d5-4156-9ed7-b884e2225450",
          "run_date": "2025-12-14T04:00:57.076",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T04:00:57.130209",
          "updated_at": "2025-12-14T04:00:57.130209"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "dea8f233-fef9-4900-857d-c9ee42d6ad99",
          "run_date": "2025-12-14T04:01:17.941",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T04:01:18.008727",
          "updated_at": "2025-12-14T04:01:18.008727"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "d5f56207-4477-4a5a-80e3-f7574c7eb275",
          "run_date": "2025-12-14T04:01:24.557",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T04:01:24.619889",
          "updated_at": "2025-12-14T04:01:24.619889"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "8a69c73c-8167-4f31-9a06-b636df5dcc9d",
          "run_date": "2025-12-14T04:05:43.08",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T04:05:43.180256",
          "updated_at": "2025-12-14T04:05:43.180256"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "484cd2bc-8261-49b8-961b-4215ae815d32",
          "run_date": "2025-12-14T04:05:56.432",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T04:05:56.526671",
          "updated_at": "2025-12-14T04:05:56.526671"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "5445962f-d6ea-4e61-90ff-07f930e878d3",
          "run_date": "2025-12-14T04:06:05.461",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T04:06:05.536424",
          "updated_at": "2025-12-14T04:06:05.536424"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "8b6d5735-75f9-45f0-8802-47d386a5568d",
          "run_date": "2025-12-14T04:06:13.992",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T04:06:14.060709",
          "updated_at": "2025-12-14T04:06:14.060709"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "c26c835d-9fdb-45ed-ac14-ec4f94cbded5",
          "run_date": "2025-12-14T04:10:43.597",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T04:10:43.695869",
          "updated_at": "2025-12-14T04:10:43.695869"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "a939644d-d45b-4c8c-8233-9efe3cb43b22",
          "run_date": "2025-12-14T04:10:55.986",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T04:10:56.117324",
          "updated_at": "2025-12-14T04:10:56.117324"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "24bcd2d7-4996-471a-834b-a7fedb180486",
          "run_date": "2025-12-14T04:11:06.263",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T04:11:06.339832",
          "updated_at": "2025-12-14T04:11:06.339832"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "ad1459cc-88a9-43f6-867e-0fcf4298cfd9",
          "run_date": "2025-12-14T04:11:14.837",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T04:11:14.903107",
          "updated_at": "2025-12-14T04:11:14.903107"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "cacbca34-26ad-4910-82de-3fc5fc021448",
          "run_date": "2025-12-15T21:55:51.187",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-15T21:55:57.365656",
          "updated_at": "2025-12-15T21:55:57.365656"
        },
        "pairedItem": {
          "item": 0
        }
      }
    ],
    "Get Workflow Status REAL": [
      {
        "json": {},
        "pairedItem": [
          {
            "item": 0,
            "input": 0
          },
          {
            "item": 1,
            "input": 0
          },
          {
            "item": 2,
            "input": 0
          },
          {
            "item": 3,
            "input": 0
          },
          {
            "item": 4,
            "input": 0
          },
          {
            "item": 5,
            "input": 0
          },
          {
            "item": 6,
            "input": 0
          },
          {
            "item": 7,
            "input": 0
          },
          {
            "item": 8,
            "input": 0
          },
          {
            "item": 9,
            "input": 0
          },
          {
            "item": 10,
            "input": 0
          },
          {
            "item": 11,
            "input": 0
          },
          {
            "item": 12,
            "input": 0
          },
          {
            "item": 13,
            "input": 0
          },
          {
            "item": 14,
            "input": 0
          },
          {
            "item": 15,
            "input": 0
          },
          {
            "item": 16,
            "input": 0
          },
          {
            "item": 17,
            "input": 0
          },
          {
            "item": 18,
            "input": 0
          },
          {
            "item": 19,
            "input": 0
          },
          {
            "item": 20,
            "input": 0
          },
          {
            "item": 21,
            "input": 0
          },
          {
            "item": 22,
            "input": 0
          },
          {
            "item": 23,
            "input": 0
          },
          {
            "item": 24,
            "input": 0
          },
          {
            "item": 25,
            "input": 0
          },
          {
            "item": 26,
            "input": 0
          },
          {
            "item": 27,
            "input": 0
          },
          {
            "item": 28,
            "input": 0
          },
          {
            "item": 29,
            "input": 0
          },
          {
            "item": 30,
            "input": 0
          },
          {
            "item": 31,
            "input": 0
          },
          {
            "item": 32,
            "input": 0
          },
          {
            "item": 33,
            "input": 0
          },
          {
            "item": 34,
            "input": 0
          },
          {
            "item": 35,
            "input": 0
          },
          {
            "item": 36,
            "input": 0
          },
          {
            "item": 37,
            "input": 0
          },
          {
            "item": 38,
            "input": 0
          },
          {
            "item": 39,
            "input": 0
          },
          {
            "item": 40,
            "input": 0
          },
          {
            "item": 41,
            "input": 0
          },
          {
            "item": 42,
            "input": 0
          },
          {
            "item": 43,
            "input": 0
          },
          {
            "item": 44,
            "input": 0
          },
          {
            "item": 45,
            "input": 0
          },
          {
            "item": 46,
            "input": 0
          },
          {
            "item": 47,
            "input": 0
          },
          {
            "item": 48,
            "input": 0
          },
          {
            "item": 49,
            "input": 0
          },
          {
            "item": 50,
            "input": 0
          },
          {
            "item": 51,
            "input": 0
          },
          {
            "item": 52,
            "input": 0
          }
        ]
      }
    ],
    "AI Error Analyzer Adult Flags": [
      {
        "json": {
          "output": {
            "priority": "images",
            "reasoning": "All adult flags and texts are OK, but images may need to be checked.",
            "products_to_process": 33
          }
        }
      }
    ],
    "AI Error Analyzer Images": [
      {
        "json": {
          "output": {
            "priority": "images",
            "reasoning": "All adult flags and texts are OK, but images may need to be checked.",
            "products_to_process": 33
          }
        }
      }
    ],
    "AI Error Analyzer Text": [
      {
        "json": {
          "output": {
            "priority": "images",
            "reasoning": "All adult flags and texts are OK, but images may need to be checked.",
            "products_to_process": 33
          }
        }
      }
    ],
    "AI Error Analyzer Merchant": [
      {
        "json": {
          "output": {
            "priority": "images",
            "reasoning": "All adult flags and texts are OK, but images may need to be checked.",
            "products_to_process": 33
          }
        }
      }
    ],
    "AI Error Analyzer Error_Multi_Country": [
      {
        "json": {
          "output": {
            "priority": "images",
            "reasoning": "All adult flags and texts are OK, but images may need to be checked.",
            "products_to_process": 33
          }
        }
      }
    ],
    "AI Error Analyzer Error_Multi_GTN/EAN": [
      {
        "json": {
          "output": {
            "priority": "images",
            "reasoning": "All adult flags and texts are OK, but images may need to be checked.",
            "products_to_process": 33
          }
        }
      }
    ],
    "AI Error Analyzer_H√§ndlerqualit√§t": [
      {
        "json": {
          "output": {
            "priority": "images",
            "reasoning": "All adult flags and texts are OK, but images may need to be checked.",
            "products_to_process": 33
          }
        }
      }
    ],
    "Error_Ana_S24": [
      {
        "json": {
          "output": {
            "priority": "images",
            "reasoning": "All adult flags and texts are OK, but images may need to be checked.",
            "products_to_process": 33
          }
        }
      }
    ],
    "Error_Ana_DDC": [
      {
        "json": {
          "output": {
            "priority": "images",
            "reasoning": "All adult flags and texts are OK, but images may need to be checked.",
            "products_to_process": 33
          }
        }
      }
    ]
  },
  "versionId": "e6ee1011-efdc-40e7-8b7c-0dd130b9e11c",
  "activeVersionId": "3cc58665-31e9-4894-a9af-956641b9eb0f",
  "versionCounter": 692,
  "triggerCount": 3,
  "shared": [
    {
      "updatedAt": "2025-12-12T04:29:41.486Z",
      "createdAt": "2025-12-12T04:29:41.486Z",
      "role": "workflow:owner",
      "workflowId": "ftZOou7HNgLOwzE5",
      "projectId": "eYBRLdtGaWLyIIOy",
      "project": {
        "updatedAt": "2025-11-06T02:18:23.292Z",
        "createdAt": "2025-11-06T01:50:03.327Z",
        "id": "eYBRLdtGaWLyIIOy",
        "name": "Andree Schulz <info@mechtech-support.com>",
        "type": "personal",
        "icon": null,
        "description": null,
        "projectRelations": [
          {
            "updatedAt": "2025-11-06T01:50:03.327Z",
            "createdAt": "2025-11-06T01:50:03.327Z",
            "userId": "905b93e2-2ccd-4e6b-a613-4d01485a9251",
            "projectId": "eYBRLdtGaWLyIIOy",
            "user": {
              "updatedAt": "2025-12-19T23:00:26.000Z",
              "createdAt": "2025-11-06T01:50:02.958Z",
              "id": "905b93e2-2ccd-4e6b-a613-4d01485a9251",
              "email": "info@mechtech-support.com",
              "firstName": "Andree",
              "lastName": "Schulz",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2025-11-06T02:19:06.535Z",
                "personalization_survey_n8n_version": "1.118.2",
                "companySize": "<20",
                "companyType": "ecommerce",
                "role": "business-owner",
                "reportedSource": "youtube"
              },
              "settings": {
                "userActivated": true,
                "easyAIWorkflowOnboarded": true,
                "firstSuccessfulWorkflowId": "uok6olNDUiRKpaE8",
                "userActivatedAt": 1764952348935,
                "npsSurvey": {
                  "responded": true,
                  "lastShownAt": 1765239138708
                }
              },
              "disabled": false,
              "mfaEnabled": false,
              "lastActiveAt": "2025-12-19",
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": [],
  "activeVersion": {
    "updatedAt": "2025-12-20T00:09:05.946Z",
    "createdAt": "2025-12-20T00:09:05.946Z",
    "versionId": "3cc58665-31e9-4894-a9af-956641b9eb0f",
    "workflowId": "ftZOou7HNgLOwzE5",
    "nodes": [
      {
        "parameters": {
          "options": {}
        },
        "id": "9baabb04-7161-4ec5-b55e-f60db618fb2a",
        "name": "Chat Trigger (RAG Query)",
        "type": "@n8n/n8n-nodes-langchain.chatTrigger",
        "typeVersion": 1.4,
        "position": [
          496,
          3984
        ],
        "webhookId": "1bcc39ec-5b0a-4f6c-abf6-21235fcb6cb1",
        "disabled": false
      },
      {
        "parameters": {
          "options": {
            "systemMessage": "Du bist der MECHTECH Workflow Assistent!\n\nDu hast Zugriff auf die komplette Historie aller Workflow-Ausf√ºhrungen in der Supabase Vector Database.\n\nDeine Aufgaben:\n1. Beantworte Fragen zur Workflow-Historie (Approval Rates, verarbeitete Produkte, Phasen, etc.)\n2. Analysiere Trends und Muster in den Daten\n3. Gib Empfehlungen basierend auf historischen Daten\n4. Erkl√§re was in bestimmten Zeitr√§umen passiert ist\n\nDu kannst auf folgende Informationen zugreifen:\n- Shop-Namen und IDs\n- Verarbeitete Produkte pro Run\n- Success/Failure Counts\n- Approval Rates\n- Phasen (adult_flags, text, images)\n- Timestamps\n- Reasoning der Gemini Decisions\n\nAntworte auf Deutsch, pr√§zise und hilfreich!"
          }
        },
        "id": "9bc4af95-f5bd-4f66-92af-9dd4780285f6",
        "name": "Chat Agent (RAG)",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3,
        "position": [
          720,
          3984
        ],
        "disabled": false
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash-exp",
          "options": {}
        },
        "id": "c23df7d5-2db0-4397-a635-8fe929c75f0d",
        "name": "Gemini Chat Model (RAG)",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          560,
          4240
        ],
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "disabled": false
      },
      {
        "parameters": {
          "tableName": {
            "__rl": true,
            "mode": "id",
            "value": "n8n_mechtech_historie"
          },
          "options": {
            "queryName": "match_documents"
          }
        },
        "id": "15b38e7b-23bd-4e25-847c-9bd727d3161f",
        "name": "Supabase Vector Store (Retrieve)",
        "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
        "typeVersion": 1.3,
        "position": [
          704,
          4432
        ],
        "credentials": {
          "supabaseApi": {
            "id": "f1qLUdIsbZ2A3wdC",
            "name": "Supabase-MySQL"
          }
        },
        "disabled": false
      },
      {
        "parameters": {},
        "id": "d4606641-fd18-4201-844a-3bcc80a70fcf",
        "name": "Gemini Embeddings (RAG)",
        "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
        "typeVersion": 1,
        "position": [
          1072,
          4304
        ],
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "disabled": false
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "mechtech_chat_session",
          "tableName": "n8n_chat_historie",
          "contextWindowLength": 25
        },
        "id": "2bff2895-6846-4720-bfd4-1a8eaff1386e",
        "name": "Postgres Chat Memory",
        "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
        "typeVersion": 1.3,
        "position": [
          720,
          4240
        ],
        "credentials": {
          "postgres": {
            "id": "pIp690wi4X79QCKb",
            "name": "Postgres account"
          }
        },
        "disabled": false
      },
      {
        "parameters": {
          "useCustomSchema": true,
          "operation": "getAll",
          "tableId": "workflow_runs",
          "returnAll": true,
          "matchType": "allFilters",
          "filters": {
            "conditions": [
              {
                "keyName": "created_at",
                "condition": "gte",
                "keyValue": "=={{ $now.startOf('day').toISO() }}"
              }
            ]
          }
        },
        "id": "e217bdb8-8710-475d-acaa-c033d138c2cd",
        "name": "Check Last Run",
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          1072,
          3360
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "waitBetweenTries": 3000,
        "credentials": {
          "supabaseApi": {
            "id": "f1qLUdIsbZ2A3wdC",
            "name": "Supabase-MySQL"
          }
        },
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "jsCode": "// ============================================================================\n// PREPARE PRODUCTS LOOP - GIBT ARRAY ZUR√úCK F√úR SPLIT\n// ============================================================================\n// ‚úÖ Dieser Node gibt ein Array zur√ºck (f√ºr n8n Split/Iteration)\n// ‚Üí n8n wird dann JEDES Item einzeln an den n√§chsten Node weitergeben\n// ‚Üí Die nachfolgenden Nodes (Prepare Images, etc.) m√ºssen sequenziell arbeiten\n\nconst inputData = $input.first().json;\nconst config = $('Shop Configuration2').first().json;\n\n// Get products from input (Gemini Decision passes them)\nconst productsToFix = inputData.products || [];\nconst maxProducts = inputData.products_to_process || productsToFix.length;\n\n// Shop info from config\nconst shopId = inputData.shop_id || config.shop1_id;\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\nconst productsSlice = productsToFix.slice(0, maxProducts);\n\n// ‚úÖ Gibt Array zur√ºck - n8n wird jedes Item einzeln weiterleiten\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    originalProduct: product, // Behalte original product data\n    action: 'prepare',\n    priority: 'prepare',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
        },
        "id": "2d6517f1-ebbc-48fd-894c-287420175a7a",
        "name": "Prepare Products Loop",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2272,
          3152
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $('Shop Configuration2').item.json.shop1_id }}/products/{{ $json.product_id }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "adult",
                "value": "true"
              },
              {
                "name": "ageGroup",
                "value": "adult"
              },
              {
                "name": "googleProductCategory",
                "value": "778"
              }
            ]
          },
          "options": {}
        },
        "id": "15586a83-cda8-4ac9-9826-9ed77f24fa1c",
        "name": "Update Product Adult Flag",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          2496,
          3056
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "amount": 2
        },
        "id": "09ba4846-6da9-425c-a762-4f9f4bc1b4e6",
        "name": "Rate Limiting",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          2720,
          3152
        ],
        "webhookId": "77aa4d35-4b1e-410d-9f22-138e57a732c7",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "tableId": "workflow_runs",
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "run_date",
                "fieldValue": "={{ $json.run_date }}"
              },
              {
                "fieldId": "shop_id",
                "fieldValue": "={{ $json.shop_id }}"
              },
              {
                "fieldId": "phase",
                "fieldValue": "={{ $json.phase }}"
              },
              {
                "fieldId": "products_processed",
                "fieldValue": "={{ $json.products_processed }}"
              },
              {
                "fieldId": "success_count",
                "fieldValue": "={{ $json.success_count }}"
              },
              {
                "fieldId": "approval_rate_after",
                "fieldValue": "={{ $json.approval_rate_after }}"
              }
            ]
          }
        },
        "id": "588efd00-c612-4bb9-9837-abab980e50ab",
        "name": "Save Workflow Run",
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          1584,
          3968
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "supabaseApi": {
            "id": "f1qLUdIsbZ2A3wdC",
            "name": "Supabase-MySQL"
          }
        },
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "operation": "appendOrUpdate",
          "documentId": {
            "__rl": true,
            "mode": "id",
            "value": "1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE"
          },
          "sheetName": {
            "__rl": true,
            "mode": "name",
            "value": "üìù Daily_Log"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Timestamp": "={{ $json.run_date }}",
              "Shop": "={{ $json.shop_id }}",
              "Phase": "={{ $json.phase }}",
              "Products Processed": "={{ $json.products_processed }}",
              "Success Count": "={{ $json.success_count }}",
              "Failed Count": "={{ $json.failed_count }}",
              "Status": "={{ $json.created_at }}",
              "Action": "={{ $json.gemini_decision }}",
              "Details": "={{ $json.approval_rate_after }}"
            },
            "matchingColumns": [
              "Timestamp"
            ],
            "schema": [
              {
                "id": "Timestamp",
                "displayName": "Timestamp",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Shop",
                "displayName": "Shop",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Phase",
                "displayName": "Phase",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Action",
                "displayName": "Action",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Products Processed",
                "displayName": "Products Processed",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Success Count",
                "displayName": "Success Count",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Failed Count",
                "displayName": "Failed Count",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Status",
                "displayName": "Status",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Details",
                "displayName": "Details",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false,
            "mappings": [
              {
                "column": "Timestamp",
                "value": "={{ $json.run_date }}"
              },
              {
                "column": "Shop",
                "value": "={{ $json.shop_name }}"
              },
              {
                "column": "Phase",
                "value": "={{ $json.phase }}"
              },
              {
                "column": "Action",
                "value": "Daily Run"
              },
              {
                "column": "Products Processed",
                "value": "={{ $json.products_processed }}"
              },
              {
                "column": "Success Count",
                "value": "={{ $json.success_count }}"
              },
              {
                "column": "Failed Count",
                "value": "={{ $json.failed_count }}"
              },
              {
                "column": "Status",
                "value": "={{ $json.status }}"
              },
              {
                "column": "Details",
                "value": "={{ $json.reasoning }}"
              }
            ]
          },
          "options": {}
        },
        "id": "108880c3-e17a-4976-bce9-9edef6a441a7",
        "name": "Log Results to Sheets",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          1824,
          4080
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "pbNsBLFTIuL9ArMn",
            "name": "Google Sheets"
          }
        },
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "chatId": "8562069918:AAFtzEUzCDeUchzybcp2l9Cg4WZ0KBmsWzI",
          "text": "=ü§ñ GEMINI DAILY REPORT - {{ $json.shop_name }}\n\nüìä Phase: {{ $json.phase }}\n‚úÖ Verarbeitet: {{ $json.success_count }}\n‚ùå Fehler: {{ $json.failed_count }}\nüìà Approval Rate: {{ $json.approval_rate_after }}%\n\nüí° Reasoning: {{ $json.reasoning }}\n\nAlles OK? üëç",
          "additionalFields": {}
        },
        "id": "5e5a1e29-70f7-45bf-9d3f-80ec9efb83f7",
        "name": "Send Daily Report",
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          2256,
          4400
        ],
        "webhookId": "b5c4cc7d-d366-4cd7-ac2c-0a91ed811e96",
        "credentials": {
          "telegramApi": {
            "id": "CefgWOY6zLuQ1eyX",
            "name": "Telegram account"
          }
        },
        "disabled": false
      },
      {
        "parameters": {
          "sendTo": "={{ $json.to }}",
          "subject": "={{ $json.subject }}",
          "message": "={{ $json.html }}",
          "options": {}
        },
        "id": "b8be1226-8b56-4499-927f-611b6d5f606a",
        "name": "Export Report to Gmail",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          2704,
          4400
        ],
        "webhookId": "da822d06-d1b7-4cfe-804f-5e778bedbac4",
        "credentials": {
          "gmailOAuth2": {
            "id": "piLkk7aEWM1RFevI",
            "name": "s24.mechtech@gmail.com"
          }
        },
        "disabled": false
      },
      {
        "parameters": {
          "pollTimes": {
            "item": [
              {
                "mode": "everyX",
                "value": 1,
                "unit": "minutes"
              }
            ]
          },
          "filters": {
            "labelIds": [
              "Label_4215695195142173388",
              "Label_2937160366021595910",
              "INBOX"
            ],
            "readStatus": "unread"
          }
        },
        "id": "cdb90d0d-ccc5-473c-94a8-ea3ac6adc09b",
        "name": "Import Commands from Gmail",
        "type": "n8n-nodes-base.gmailTrigger",
        "typeVersion": 1.3,
        "position": [
          480,
          3296
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "waitBetweenTries": 3000,
        "credentials": {
          "gmailOAuth2": {
            "id": "piLkk7aEWM1RFevI",
            "name": "s24.mechtech@gmail.com"
          }
        },
        "disabled": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "operation": "send",
          "recipientPhoneNumber": "<__PLACEHOLDER_VALUE__Expert WhatsApp Number__>",
          "textBody": "=üö® EXPERT ALERT - MECHTECH Merchant Center\n\nShop: {{ $json.shop_name }}\nPhase: {{ $json.phase }}\n\n‚ö†Ô∏è CRITICAL ISSUES:\n‚ùå Failed: {{ $json.failed_count }}\nüìâ Approval Rate: {{ $json.approval_rate_after }}%\n\nImmediate action required!\n\nDetails: {{ $json.reasoning }}",
          "additionalFields": {}
        },
        "id": "b1701b06-0047-42f9-8558-b9d2bf7453ad",
        "name": "Send WhatsApp Expert Alert",
        "type": "n8n-nodes-base.whatsApp",
        "typeVersion": 1.1,
        "position": [
          2704,
          4576
        ],
        "webhookId": "fd8ea9df-d0d5-4e11-a0df-a43a8e68297e",
        "disabled": true
      },
      {
        "parameters": {
          "updates": [
            "messages"
          ],
          "options": {}
        },
        "id": "dad0b159-2230-417c-9a99-35aad6692aa9",
        "name": "Import Commands from WhatsApp",
        "type": "n8n-nodes-base.whatsAppTrigger",
        "typeVersion": 1,
        "position": [
          480,
          3040
        ],
        "webhookId": "472f5025-2ce8-4fba-9322-7f5fe0256023",
        "disabled": true
      },
      {
        "parameters": {
          "jsCode": "const data = $input.item.json; const html = `<h2>ü§ñ MECHTECH Merchant Center Daily Report</h2><h3>Shop: ${data.shop_name}</h3><table border='1' cellpadding='10'><tr><th>Metric</th><th>Value</th></tr><tr><td>Phase</td><td>${data.phase}</td></tr><tr><td>Products Processed</td><td>${data.products_processed}</td></tr><tr><td>Success Count</td><td>${data.success_count}</td></tr><tr><td>Failed Count</td><td>${data.failed_count}</td></tr><tr><td>Approval Rate</td><td>${data.approval_rate_after}%</td></tr><tr><td>Status</td><td>${data.status}</td></tr></table><p><strong>Reasoning:</strong> ${data.reasoning}</p><p><em>Generated: ${data.run_date}</em></p>`; return [{ json: { subject: `Daily Report - ${data.shop_name} - ${data.phase}`, html: html, to: '<__PLACEHOLDER_VALUE__Report Email Address__>' } }];"
        },
        "id": "f42a4d00-e073-42db-a62a-e6fc4afdea43",
        "name": "Format Report for Email",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2480,
          4384
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "jsCode": "// FIXED: Only check SUBJECT for commands (ignore spam)\nconst input = $input.item.json;\n\n// Only use subject - ignore body/snippet to avoid spam\nconst subject = (input.subject || '').toLowerCase().trim();\n\n// Check if subject contains \"command\" keyword\nif (!subject.includes('command') && !subject.includes('mechtech')) {\n  // Not a command email - skip it\n  return [];\n}\n\n// Extract command from subject\nconst text = subject.replace('command:', '').replace('mechtech:', '').trim();\n\nlet action = 'unknown';\nlet params = {};\n\nif (text.includes('status')) {\n  action = 'get_status';\n} else if (text.includes('pause')) {\n  action = 'pause_workflow';\n} else if (text.includes('resume')) {\n  action = 'resume_workflow';\n} else if (text.includes('report')) {\n  action = 'send_report';\n} else if (text.includes('help')) {\n  action = 'show_help';\n} else if (text.includes('optimize')) {\n  action = 'run_optimization';\n  // Check which shop\n  if (text.includes('shop1') || text.includes('siliconedolls24')) {\n    params.shop = 'shop1';\n  } else if (text.includes('shop2') || text.includes('dreamdoll')) {\n    params.shop = 'shop2';\n  } else {\n    params.shop = 'both';\n  }\n} else {\n  // Unknown command\n  action = 'unknown';\n}\n\nreturn [{\n  json: {\n    action: action,\n    params: params,\n    original_text: text,\n    source: input.from || input.sender || 'unknown',\n    subject: input.subject || ''\n  }\n}];"
        },
        "id": "1508074b-8edb-4df0-86d3-9830444fb9e1",
        "name": "Parse Command Input",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          768,
          3168
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "loose",
              "version": 3
            },
            "conditions": [
              {
                "id": "id-1",
                "leftValue": "={{ $json.failed_count }}",
                "rightValue": 10,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              },
              {
                "id": "id-2",
                "leftValue": "={{ $json.approval_rate_after }}",
                "rightValue": 50,
                "operator": {
                  "type": "number",
                  "operation": "lt"
                }
              }
            ],
            "combinator": "or"
          },
          "looseTypeValidation": true,
          "options": {}
        },
        "id": "3f130224-b8e7-4411-a208-572c46510fae",
        "name": "Check if Expert Needed",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          2480,
          4592
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.action }}",
                      "rightValue": "get_status",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "445605f9-402d-4973-9957-5754b69fb8fc"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Status"
              }
            ]
          },
          "options": {
            "fallbackOutput": "extra",
            "renameFallbackOutput": "Unknown Command"
          }
        },
        "id": "8d4d4848-43b2-4809-b459-1c262b31cd0d",
        "name": "Route Command",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.4,
        "position": [
          1072,
          3136
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "sendTo": "info@mechtech-support.com",
          "subject": "={{ $json.subject || 'MECHTECH Workflow Report' }}",
          "emailType": "text",
          "message": "={{ $json.response || $json.message || 'No message available' }}",
          "options": {}
        },
        "id": "45396118-d2da-455e-9a97-75cbabde112b",
        "name": "Send Command Response",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          1920,
          3152
        ],
        "webhookId": "5cf94981-2360-49f1-b7d4-6c512f562360",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "waitBetweenTries": 3000,
        "credentials": {
          "gmailOAuth2": {
            "id": "piLkk7aEWM1RFevI",
            "name": "s24.mechtech@gmail.com"
          }
        },
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "jsCode": "// ============================================================================\n// FIX: PREPARE IMAGES LOOP - WORKING VERSION\n// ============================================================================\nconst inputData = $input.first().json;\nconst config = $('Shop Configuration2').first().json;\n\nconst productsToFix = inputData.products || [];\nconst maxProducts = inputData.products_to_process || productsToFix.length;\n\nconst shopId = inputData.shop_id || config.shop1_id;\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\nconst productsSlice = productsToFix.slice(0, maxProducts);\n\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    image_link: product.imageLink,\n    action: 'images',\n    priority: 'images',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
        },
        "id": "9bf990d0-1d87-4bbb-9153-46146b506ae6",
        "name": "Prepare Images Loop",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2272,
          3312
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $('Shop Configuration2').item.json.shop1_id }}/products/{{ $json.product.id }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "imageLink",
                "value": "={{ $json.product.imageLink }}"
              }
            ]
          },
          "options": {}
        },
        "id": "3c250fa7-ca68-49fa-869d-1d0b1761a4b1",
        "name": "Update Product Images",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          2496,
          3248
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "amount": 2
        },
        "id": "bfed81ba-0dfb-4fd3-9161-3dadb6aebe1d",
        "name": "Rate Limiting Images",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          2720,
          3344
        ],
        "webhookId": "03758724-2fd2-4cf0-bc96-1ba04b9fa35c",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "jsCode": "// ============================================================================\n// FIX: PREPARE TEXT LOOP - WORKING VERSION\n// ============================================================================\nconst inputData = $input.first().json;\nconst config = $('Shop Configuration2').first().json;\n\nconst productsToFix = inputData.products || [];\nconst maxProducts = inputData.products_to_process || productsToFix.length;\n\nconst shopId = inputData.shop_id || config.shop1_id;\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\nconst productsSlice = productsToFix.slice(0, maxProducts);\n\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    description: product.description,\n    action: 'text',\n    priority: 'text',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
        },
        "id": "3245d64d-7810-44de-beaa-f97d55eb2274",
        "name": "Prepare Text Loop",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2272,
          3472
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $('Shop Configuration2').item.json.shop1_id }}/products/{{ $json.product.id }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "title",
                "value": "={{ $json.product.title }}"
              },
              {
                "name": "description",
                "value": "={{ $json.product.description }}"
              }
            ]
          },
          "options": {}
        },
        "id": "34310e5a-2422-4ce3-a615-5b8f911b5407",
        "name": "Update Product Text",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          2496,
          3424
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "amount": 2
        },
        "id": "dcf77ef7-4f9b-4487-be98-b0480a6b9b2a",
        "name": "Rate Limiting Text",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          2720,
          3536
        ],
        "webhookId": "fade3537-0739-4667-80c9-7636461ed902",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "jsCode": "const input = $input.item.json;\nconst invalidPriority = input.priority || 'unknown';\nconst reasoning = input.reasoning || 'No reasoning provided';\n\nconst errorResult = {\n  processed_count: 0,\n  failed_count: 0,\n  error: 'Invalid priority received from Gemini',\n  invalid_priority: invalidPriority,\n  gemini_reasoning: reasoning,\n  timestamp: new Date().toISOString(),\n  debug_info: {\n    expected_priorities: ['adult_flags', 'images', 'text'],\n    received_priority: invalidPriority,\n    full_gemini_response: input\n  }\n};\n\nreturn [{ json: errorResult }];"
        },
        "id": "80b0ee00-87d9-44ec-8b62-8c86eda7737b",
        "name": "Handle Invalid Priority",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1072,
          4096
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "shop1_id",
                "name": "shop1_id",
                "value": "5339977843",
                "type": "string"
              },
              {
                "id": "shop1_name",
                "name": "shop1_name",
                "value": "Siliconedolls24",
                "type": "string"
              },
              {
                "id": "shop2_id",
                "name": "shop2_id",
                "value": "124485833",
                "type": "string"
              },
              {
                "id": "shop2_name",
                "name": "shop2_name",
                "value": "DreamDoll",
                "type": "string"
              },
              {
                "id": "google_sheet_id",
                "name": "google_sheet_id",
                "value": "1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE",
                "type": "string"
              },
              {
                "id": "id-6",
                "name": "supabase_url",
                "value": "https://mxswxdnnjhhukovixzvb.supabase.co/functions/v1/database-access",
                "type": "string"
              },
              {
                "id": "id-7",
                "name": "supabase_key",
                "value": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im14c3d4ZG5uamhodWtvdml4enZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3OTM4NDAsImV4cCI6MjA3OTM2OTg0MH0.60grD1zV6gF7Uf80N8CG8eiEwMw3zY5KR0Q-KKvvSWQ",
                "type": "string"
              }
            ]
          },
          "includeOtherFields": true,
          "options": {}
        },
        "name": "Shop Configuration2",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          784,
          3584
        ],
        "id": "c56a220a-81d4-49e8-8f8b-70b5051f89d0",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "waitBetweenTries": 3000,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "url": "=https://www.googleapis.com/content/v2.1/{{ $('Shop Configuration2').item.json.shop1_id }}/products?maxResults=100",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "options": {}
        },
        "name": "Get Merchant Products2",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1072,
          3568
        ],
        "id": "39d79c98-55c7-418a-8c36-bce59d3efd3f",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "jsCode": "const products = $input.item.json.resources || [];\nconst productsNeedingFix = products.filter(p => !p.adult);\nconst disapproved = products.filter(p => p.issues && p.issues.length > 0).length;\nconst approved = products.length - disapproved;\nconst approvalRate = products.length > 0 ? ((approved / products.length) * 100).toFixed(2) : 0;\n\nreturn [{\n  json: {\n    products_needing_fix: productsNeedingFix.slice(0, 100),\n    current_approval_rate: approvalRate,\n    total_products: products.length,\n    approved_count: approved,\n    disapproved_count: disapproved\n  }\n}];"
        },
        "id": "f49cb6b3-195b-42f6-a025-a0e78d62cfca",
        "name": "Analyze Products2",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1328,
          3568
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "jsCode": "const items = $input.all();\nconst processedCount = items.filter(i => i.json.processed_count !== undefined).reduce((sum, i) => sum + i.json.processed_count, 0);\nconst failedCount = items.filter(i => i.json.failed_count !== undefined).reduce((sum, i) => sum + i.json.failed_count, 0);\nconst config = $('Shop Configuration2').item.json;\nconst analysis = $('Analyze Products2').item.json;\nconst decision = $('Gemini Daily Decision').item.json;\n\nreturn [{\n  json: {\n    shop_id: config.shop1_id,\n    shop_name: config.shop1_name,\n    run_date: new Date().toISOString(),\n    phase: decision.priority || 'adult_flags',\n    products_processed: processedCount,\n    success_count: processedCount,\n    failed_count: failedCount,\n    approval_rate_before: analysis.current_approval_rate,\n    approval_rate_after: analysis.current_approval_rate,\n    reasoning: decision.reasoning || 'Processing products',\n    status: failedCount === 0 ? 'success' : 'partial_success'\n  }\n}];"
        },
        "id": "e8e880e8-557c-42e8-a95f-fb077510c508",
        "name": "Aggregate Results2",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1328,
          4080
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "schemaType": "manual",
          "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"priority\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"enum\": [\"adult_flags\", \"images\", \"text\"]\n\t\t},\n\t\t\"reasoning\": {\n\t\t\t\"type\": \"string\"\n\t\t},\n\t\t\"products_to_process\": {\n\t\t\t\"type\": \"number\"\n\t\t}\n\t},\n\t\"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}",
          "autoFix": true
        },
        "id": "984a5be4-d1fa-4229-aa5b-5a50528673ec",
        "name": "JSON Output Parser1",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.3,
        "position": [
          1824,
          3856
        ],
        "disabled": false
      },
      {
        "parameters": {
          "jsCode": "// ============================================================================\n// FIX: PREPARE MERCHANT QUALITY LOOP - WORKING VERSION\n// ============================================================================\nconst inputData = $input.first().json;\nconst config = $('Shop Configuration2').first().json;\n\nconst productsToFix = inputData.products || [];\nconst maxProducts = inputData.products_to_process || productsToFix.length;\n\nconst shopId = inputData.shop_id || config.shop1_id;\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\nconst productsSlice = productsToFix.slice(0, maxProducts);\n\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    action: 'merchant_quality',\n    priority: 'merchant_quality',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
        },
        "name": "Prepare Merchant Quality Loop",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2272,
          3648
        ],
        "id": "92b514de-5cd0-4f79-9857-123e685a1405",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/shippingsettings",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"accountId\": \"{{ $json.shop_id }}\",\n  \"services\": [{\n    \"name\": \"Standard Shipping\",\n    \"active\": true,\n    \"deliveryCountry\": \"DE\",\n    \"deliveryTime\": {\n      \"minHandlingTimeInDays\": 1,\n      \"maxHandlingTimeInDays\": 3,\n      \"minTransitTimeInDays\": 2,\n      \"maxTransitTimeInDays\": 5\n    },\n    \"rateGroups\": [{\n      \"singleValue\": {\n        \"flatRate\": {\n          \"value\": \"0\",\n          \"currency\": \"EUR\"\n        }\n      }\n    }]\n  }]\n}",
          "options": {}
        },
        "name": "Update Merchant Settings",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          2512,
          3600
        ],
        "id": "3ad28c6f-6828-483e-a696-c83bd1382966",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "amount": 2
        },
        "name": "Rate Limiting Merchant",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          2720,
          3728
        ],
        "id": "3226b31b-79d4-4877-9432-a192258a6099",
        "webhookId": "rate-limit-merchant-webhook",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "jsCode": "// ============================================================================\n// PREPARE MULTI COUNTRY LOOP - SEQUENTIELLE VERARBEITUNG\n// ============================================================================\nconst inputItem = $input.first().json;\nconst config = $('Shop Configuration2').first().json;\n\n// Multi-Country Logik - sequenziell verarbeiten (ein Item)\nreturn {\n  json: {\n    ...inputItem,\n    action: 'multi_country',\n    priority: 'multi_country',\n    multi_country_processed: true,\n    countries: inputItem.countries || inputItem.countries_from_gemini || [],\n    shipping: inputItem.shipping || []\n  }\n};"
        },
        "name": "Prepare Multi Country Loop",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2272,
          3856
        ],
        "id": "40a1e96b-15f2-4eb0-bdad-bd7532b02a22",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/products/{{ $json.product_id }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"destinations\": [\n    {{ $json.countries.map(c => `{\"destinationName\": \"Shopping_ads\", \"country\": \"${c}\"}`).join(',') }}\n  ],\n  \"shipping\": [\n    {{ $json.countries.map(c => `{\"country\": \"${c}\", \"price\": {\"value\": \"0\", \"currency\": \"EUR\"}}`).join(',') }}\n  ]\n}",
          "options": {}
        },
        "name": "Update Country Feeds",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          2496,
          3808
        ],
        "id": "3c873a42-3df1-4f70-89a4-08a7391cf78e",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "amount": 2
        },
        "name": "Rate Limiting Country",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          2720,
          3920
        ],
        "id": "62a07200-0815-4098-869a-8ec5fa3927f5",
        "webhookId": "rate-limit-country-webhook",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "adult_flags",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "adult-flags-condition"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Adult Flags"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "images",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "images-condition"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Images"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "text",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "text-condition"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Text"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "merchant_quality",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "merchant-quality-condition"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Merchant Quality"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "multi_country",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "multi-country-condition"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Multi Country"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "b85d4e72-545e-46d6-9d63-bb8819eeffb5",
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "multi_gtn_ean",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Multi GTN/EAN"
              }
            ]
          },
          "options": {
            "fallbackOutput": "extra",
            "renameFallbackOutput": "Fallback"
          }
        },
        "name": "Route by Priority",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          1936,
          3440
        ],
        "id": "d4b56adf-ee7f-4c31-91ff-22d64ef182a0",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "url": "=https://www.googleapis.com/content/v2.1/{{ $('Shop Configuration2').item.json.shop2_id }}/products?maxResults=250",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "options": {}
        },
        "name": "Get Merchant Products Shop2",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1072,
          3760
        ],
        "id": "07c684bc-18ff-493d-833f-4fc1a26e2cca",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $('Shop Configuration2').item.json.supabase_url }}/rest/v1/products",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "apikey",
                "value": "={{ $('Shop Configuration2').item.json.supabase_key }}"
              },
              {
                "name": "Authorization",
                "value": "=Bearer {{ $('Shop Configuration2').item.json.supabase_key }}"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              },
              {
                "name": "Prefer",
                "value": "resolution=merge-duplicates"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"shop_id\": \"{{ $json.shop_id }}\",\n  \"shop_name\": \"{{ $json.shop_name }}\",\n  \"shop_url\": \"{{ $json.shop_id === '5339977843' ? 'www.siliconedolls24.com' : 'www.dreamdoll.de' }}\",\n  \"product_id\": \"{{ $json.product_id }}\",\n  \"offer_id\": \"{{ $json.offer_id }}\",\n  \"title\": \"{{ $json.title }}\",\n  \"image_link\": \"{{ $json.image_link || '' }}\",\n  \"adult_flag_set\": {{ $json.action === 'adult_flags' || $json.priority === 'adult_flags' ? 'true' : 'false' }},\n  \"text_sanitized\": {{ $json.action === 'text' || $json.priority === 'text' ? 'true' : 'false' }},\n  \"image_optimized\": {{ $json.action === 'images' || $json.priority === 'images' ? 'true' : 'false' }},\n  \"feed_optimized\": true,\n  \"shipping_set\": {{ $json.action === 'merchant_quality' || $json.priority === 'merchant_quality' ? 'true' : 'false' }},\n  \"returns_set\": {{ $json.action === 'merchant_quality' || $json.priority === 'merchant_quality' ? 'true' : 'false' }},\n  \"tax_set\": {{ $json.action === 'merchant_quality' || $json.priority === 'merchant_quality' ? 'true' : 'false' }},\n  \"multi_country\": {{ $json.action === 'multi_country' || $json.priority === 'multi_country' ? 'true' : 'false' }},\n  \"status\": \"SUCCESS\",\n  \"last_optimized_at\": \"{{ $now.toISO() }}\"\n}",
          "options": {}
        },
        "name": "Save to Supabase Products",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          2256,
          4768
        ],
        "id": "725473eb-3d1e-4d65-84cf-084cc1c521fb",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "waitBetweenTries": 3000,
        "continueOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $('Shop Configuration2').item.json.supabase_url }}/rest/v1/rpc/update_pattern_success",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "apikey",
                "value": "={{ $('Shop Configuration2').item.json.supabase_key }}"
              },
              {
                "name": "Authorization",
                "value": "=Bearer {{ $('Shop Configuration2').item.json.supabase_key }}"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"p_pattern_type\": \"{{ $json.action || $json.priority }}\",\n  \"p_success\": true\n}",
          "options": {}
        },
        "name": "Update Optimization Patterns",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          2480,
          4768
        ],
        "id": "12c519ef-b6b4-4f07-86b6-0bb9dc47f074",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "operation": "appendOrUpdate",
          "documentId": {
            "__rl": true,
            "value": "https://docs.google.com/spreadsheets/d/1R1fYQTswbGBDzLoizyTNPKVLup1ie0_ksqBTLc5E48s/edit?gid=0#gid=0",
            "mode": "url"
          },
          "sheetName": {
            "__rl": true,
            "value": 1181382825,
            "mode": "list",
            "cachedResultName": "üß† AI_Learning",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1R1fYQTswbGBDzLoizyTNPKVLup1ie0_ksqBTLc5E48s/edit#gid=1181382825"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {},
            "matchingColumns": [],
            "schema": [
              {
                "id": "Timestamp",
                "displayName": "Timestamp",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Problem_Type",
                "displayName": "Problem_Type",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Human_Instruction",
                "displayName": "Human_Instruction",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "AI_Solution",
                "displayName": "AI_Solution",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Success_Rate",
                "displayName": "Success_Rate",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Applied_Count",
                "displayName": "Applied_Count",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Pattern_ID",
                "displayName": "Pattern_ID",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "name": "Get Human Instructions",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          1328,
          4288
        ],
        "id": "42e30df8-bb6a-4410-a1aa-35d8be0f9ddb",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "waitBetweenTries": 3000,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "cztAb4CKfRPRO8KX",
            "name": "Google Sheets account"
          }
        },
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "jsCode": "// Filter nur Zeilen MIT Instructions und OHNE AI Response\nconst items = $input.all();\n\nconst needsProcessing = items.filter(item => {\n  const instruction = item.json.Human_Instructions;\n  const aiResponse = item.json.AI_Response;\n  return instruction && instruction.trim() !== '' && (!aiResponse || aiResponse.trim() === '');\n});\n\nif (needsProcessing.length === 0) {\n  // Keine Instructions zu verarbeiten\n  return [];\n}\n\nreturn needsProcessing;"
        },
        "name": "Filter Unprocessed Instructions",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1584,
          4208
        ],
        "id": "02c7b8d8-d36f-4ef9-866e-069bf77eddbf",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=HUMAN INSTRUCTION:\nProdukt: {{ $json.Title }}\nProdukt ID: {{ $json.Product_ID }}\nAnweisung: {{ $json.Human_Instructions }}\n\nAnalysiere die Anweisung und:\n1. Erstelle L√∂sung\n2. Finde √§hnliche Produkte\n3. Gib Pattern-Type an\n4. Confidence Score (0-100)\n\nAntworte als JSON!",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "Du bist der Learning Agent f√ºr MECHTECH!\n\nDeine Aufgabe:\n1. Lese Human Instructions aus Google Sheets\n2. Verstehe was der Mensch will\n3. Erstelle Pattern/L√∂sung\n4. Wende auf √§hnliche Produkte an\n5. Speichere Learning in Supabase\n\nWenn Mensch Fehler macht:\n- Erkenne es!\n- Gib freundlichen Hinweis\n- Schlage bessere L√∂sung vor\n\nAntworte IMMER als JSON:\n{\n  \"ai_response\": \"Deine Antwort an den Menschen\",\n  \"solution\": \"Was du tun wirst\",\n  \"pattern_type\": \"adult_flags|text|images|merchant_quality|multi_country/multi gtn/ean\",\n  \"ai_confidence\": 85,\n  \"apply_to_similar\": true,\n  \"similar_keywords\": [\"keyword1\", \"keyword2\"],\n  \"warning\": \"Optional: Wenn Mensch Fehler macht\"\n}"
          }
        },
        "name": "Process Instructions with Gemini",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.7,
        "position": [
          1824,
          4320
        ],
        "id": "f2b6a65c-9975-4082-afbc-91acf0a73604",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash-exp",
          "options": {}
        },
        "name": "Gemini Model Learning",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          1824,
          4528
        ],
        "id": "55f39251-adad-438f-975f-011c7a1497d6",
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "disabled": false
      },
      {
        "parameters": {},
        "name": "JSON Parser Learning",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.2,
        "position": [
          1968,
          4576
        ],
        "id": "1faa2330-99e5-4acd-8253-a9d6dd30c5bd",
        "disabled": false
      },
      {
        "parameters": {
          "jsCode": "// Apply solution to similar products\nconst instruction = $input.item.json;\nconst geminiResponse = $('Process Instructions with Gemini').item.json;\n\nif (!geminiResponse.apply_to_similar) {\n  return [{\n    json: {\n      ...instruction,\n      ai_response: geminiResponse.ai_response,\n      ai_confidence: geminiResponse.ai_confidence,\n      applied_to_similar: 0\n    }\n  }];\n}\n\n// Get all products from previous steps\nconst allProducts = $('Get Merchant Products2').all();\nconst keywords = geminiResponse.similar_keywords || [];\n\n// Find similar products\nconst similarProducts = allProducts.filter(p => {\n  const title = (p.json.title || '').toLowerCase();\n  return keywords.some(keyword => title.includes(keyword.toLowerCase()));\n});\n\nreturn [{\n  json: {\n    ...instruction,\n    ai_response: geminiResponse.ai_response,\n    ai_confidence: geminiResponse.ai_confidence,\n    applied_to_similar: similarProducts.length,\n    similar_product_ids: similarProducts.map(p => p.json.id),\n    pattern_type: geminiResponse.pattern_type,\n    solution: geminiResponse.solution,\n    warning: geminiResponse.warning || null\n  }\n}];"
        },
        "name": "Apply to Similar Products",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2256,
          4960
        ],
        "id": "8bccc6c6-1e34-426d-80cb-90fadf6082e0",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "value": "={{ $('Shop Configuration2').item.json.sheet_id }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "={{ $json.shop_url || 'www.siliconedolls24.com' }}",
            "mode": "name"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {},
            "matchingColumns": [],
            "schema": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false,
            "mappings": [
              {
                "column": "AI_Response",
                "value": "={{ $json.ai_response }}"
              },
              {
                "column": "AI_Confidence",
                "value": "={{ $json.ai_confidence }}"
              },
              {
                "column": "Applied_To_Similar",
                "value": "={{ $json.applied_to_similar }}"
              }
            ]
          },
          "options": {}
        },
        "name": "Update Sheet with AI Response",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          2480,
          4960
        ],
        "id": "c77cdd70-7296-45e8-b454-d5d9a766f365",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "cztAb4CKfRPRO8KX",
            "name": "Google Sheets account"
          }
        },
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $('Shop Configuration2').item.json.supabase_url }}/rest/v1/human_instructions",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "apikey",
                "value": "={{ $('Shop Configuration2').item.json.supabase_key }}"
              },
              {
                "name": "Authorization",
                "value": "=Bearer {{ $('Shop Configuration2').item.json.supabase_key }}"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"product_id\": \"{{ $json.Product_ID }}\",\n  \"shop_id\": \"{{ $json.shop_id }}\",\n  \"instruction\": \"{{ $json.Human_Instructions }}\",\n  \"instruction_type\": \"{{ $json.pattern_type }}\",\n  \"ai_response\": \"{{ $json.ai_response }}\",\n  \"ai_confidence\": {{ $json.ai_confidence }},\n  \"ai_action_taken\": \"{{ $json.solution }}\",\n  \"applied_to_similar\": {{ $json.applied_to_similar }},\n  \"status\": \"EXECUTED\",\n  \"executed_at\": \"{{ $now.toISO() }}\"\n}",
          "options": {}
        },
        "name": "Save Learning to Supabase",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          2704,
          4960
        ],
        "id": "46929706-525b-42d0-adb4-1ec1932a2249",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "url": "=https://mxswxdnnjhhukovixzvb.supabase.co/rest/v1/workflow_status?select=*&order=created_at.desc&limit=100",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "supabaseApi",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "=id",
                "value": "={{ $json.id }}"
              },
              {
                "name": "run_date",
                "value": "={{ $json.run_date }}"
              },
              {
                "name": "shop_id",
                "value": "={{ $json.shop_id }}"
              },
              {
                "name": "shop_name",
                "value": "={{ $json.shop_name }}"
              },
              {
                "name": "phase",
                "value": "={{ $json.phase }}"
              },
              {
                "name": "products_processed",
                "value": "={{ $json.products_processed }}"
              },
              {
                "name": "success_count",
                "value": "={{ $json.success_count }}"
              },
              {
                "name": "failed_count",
                "value": "={{ $json.failed_count }}"
              },
              {
                "name": "budget_used",
                "value": "={{ $json.budget_used }}"
              },
              {
                "name": "duration_seconds",
                "value": "={{ $json.duration_seconds }}"
              },
              {
                "name": "gemini_decision",
                "value": "={{ $json.gemini_decision }}"
              },
              {
                "name": "approval_rate_before",
                "value": "={{ $json.approval_rate_before }}"
              },
              {
                "name": "approval_rate_after",
                "value": "={{ $json.approval_rate_after }}"
              },
              {
                "name": "created_at",
                "value": "={{ $json.created_at }}"
              },
              {
                "name": "updated_at",
                "value": "={{ $json.updated_at }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {}
            ]
          },
          "options": {
            "response": {
              "response": {
                "responseFormat": "json"
              }
            }
          }
        },
        "name": "Get Workflow Status REAL",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1344,
          3248
        ],
        "id": "24dfb842-786a-45ed-89bf-a8cf8b2b15af",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "waitBetweenTries": 3000,
        "credentials": {
          "supabaseApi": {
            "id": "f1qLUdIsbZ2A3wdC",
            "name": "Supabase-MySQL"
          }
        },
        "continueOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "jsCode": "// DEBUG LOGGING\nconsole.log('=== Format Status Response ===');\nconsole.log('Input:', JSON.stringify($input.item.json, null, 2));\n\n// FIXED VERSION - handles both array and object responses\nconst response = $input.item.json;\nconsole.log('Response:', response);\nconsole.log('Is Array?', Array.isArray(response));\n\n// Check if response is array or needs to be wrapped\nlet decisions = Array.isArray(response) ? response : (response.data || [response]);\nconsole.log('Decisions:', decisions);\nconsole.log('Decisions count:', decisions.length);\n\n// Filter out empty/null entries\ndecisions = decisions.filter(d => d && d.created_at);\n\nif (!decisions || decisions.length === 0) {\n  return [{\n    json: {\n      response: 'üìä MECHTECH Status\\n\\n‚ùå Noch keine Daten!\\n\\nWorkflow l√§uft t√§glich alle 4 Stunden.',\n      recipient: $('Parse Command Input').item.json.source,\n      subject: 'MECHTECH Status Report'\n    }\n  }];\n}\n\nconst lastRun = decisions[0];\nconst total = decisions.reduce((sum, d) => sum + (d.products_processed || 0), 0);\nconst successRate = total > 0 \n  ? ((decisions.reduce((sum, d) => sum + (d.success_count || 0), 0) / total) * 100).toFixed(1)\n  : 0;\n\nconst responseText = `üìä MECHTECH WORKFLOW STATUS\n\n‚úÖ Letzte Ausf√ºhrung:\n- Shop: ${lastRun.shop_name || 'N/A'}\n- Datum: ${new Date(lastRun.created_at).toLocaleString('de-DE')}\n- Phase: ${lastRun.decision_type || 'N/A'}\n- Produkte: ${lastRun.products_processed || 0}\n- Erfolge: ${lastRun.success_count || 0}\n\nüìà Letzte ${decisions.length} Runs:\n- Total Produkte: ${total}\n- Success Rate: ${successRate}%\n- Kosten: ‚Ç¨0.00\n\n‚è∞ N√§chster Run: T√§glich 2:00 AM\n\nüí° Commands:\n- status: Aktueller Status\n- report: Vollst√§ndiger Report\n- help: Hilfe`;\n\nconsole.log('Output:', responseText);\nconsole.log('=== END ===');\n\nreturn [{\n  json: {\n    response: responseText,\n    recipient: $('Parse Command Input').item.json.source,\n    subject: 'MECHTECH Status Report'\n  }\n}];"
        },
        "name": "Format Status Response",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1616,
          3232
        ],
        "id": "4bd56d4b-4f4e-4696-b41b-e9937892618d",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "waitBetweenTries": 3000,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "jsCode": "// Error Handler f√ºr Route Command & Format Status Response\nconst errors = $input.all();\nconst errorMessages = errors.map(err => {\n  const errorData = err.error || err.json || {};\n  return {\n    node: errorData.node || 'Unknown',\n    message: errorData.message || errorData.description || 'Unknown error',\n    timestamp: new Date().toISOString(),\n    details: errorData\n  };\n});\n\nconst source = $('Parse Command Input')?.first()?.json?.source || 'info@mechtech-support.com';\n\nreturn [{\n  json: {\n    error: true,\n    error_count: errors.length,\n    errors: errorMessages,\n    response: `‚ùå ERROR: ${errors.length} Fehler aufgetreten!\\n\\n${errorMessages.map(e => `- ${e.node}: ${e.message}`).join('\\n')}\\n\\n‚è∞ ${new Date().toLocaleString('de-DE')}`,\n    recipient: source,\n    subject: 'MECHTECH Workflow Error Report'\n  }\n}];"
        },
        "id": "df30ddeb-ad30-4510-b3a8-cbe9b8bb9eb6",
        "name": "Handle Workflow Errors",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1920,
          3360
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
        "typeVersion": 1.2,
        "position": [
          864,
          4240
        ],
        "id": "04a8f30d-72eb-494b-87ec-faff1ecf2a2b",
        "name": "MCP Client",
        "disabled": false
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.manualTrigger",
        "typeVersion": 1,
        "position": [
          160,
          3648
        ],
        "id": "c105a095-1fad-40c3-a323-e631b53cb6bd",
        "name": "When clicking ‚ÄòExecute workflow‚Äô",
        "disabled": false
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "hours",
                "hoursInterval": 4
              }
            ]
          }
        },
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.3,
        "position": [
          144,
          3872
        ],
        "id": "fa6bd48c-91d5-4e16-8bc3-f102df17f4e1",
        "name": "Schedule Trigger",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Current Approval Rate: {{ $json.current_approval_rate }}%. Products needing fix: {{ $json.products_needing_fix.length }}. Total products: {{ $json.total_products }}. Approved: {{ $json.approved_count }}. Disapproved: {{ $json.disapproved_count }}.",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "\"Update Gemini System Prompt im Workflow:\n\nDu bist Gemini f√ºr MECHTECH Merchant Center.\n\nT√ÑGLICHE AUFGABE:\n1. Lade Produkte aus Shop (5339977843 + 124485833)\n2. Analysiere jeden Artikel:\n   - Hat Adult Flag? (adult: true, ageGroup: adult)\n   - GTIN/EAN vorhanden?\n   - Text ok? (keine expliziten Begriffe)\n   - Bilder ok? (Explicitness < 70)\n   - Country Feeds ok?\n\n3. Entscheide PRIORIT√ÑT:\n   - Phase 1: Fehlende Adult Flags ‚Üí SOFORT!\n   - Phase 2: Schlechte Texte ‚Üí dann\n   - Phase 3: Bilder problematisch ‚Üí zuletzt\n   - Phase 4: GTIN/EAN fehlt ‚Üí parallel\n\n4. Pro Phase OUTPUT:\n\n{\n  'phase': 'adult_flags|text|images|gtin',\n  'products_count': XXX,\n  'products': [\n    {\n      'sku': 'ABC123',\n      'action': 'set_adult_flag|sanitize_text|check_images|fix_gtin',\n      'current_value': '...',\n      'new_value': '...',\n      'reason': 'Adult content in description',\n      'confidence': 85,\n      'cost': '‚Ç¨0.00'\n    }\n  ],\n  'quality_score_before': 45,\n  'quality_score_after': 52,\n  'approval_rate_before': '0,06%',\n  'approval_rate_after': '1,2%',\n  'estimated_time': '15 min',\n  'next_phase': 'sanitize_text'\n}\n\n5. WICHTIG:\n   - Kostenlos? Wenn NEIN ‚Üí Frag!\n   - Adult Flags = UNBEGRENZT\n   - Text Fix = KOSTENLOS\n   - Bilder = Max 33/Tag\n   - GTIN/EAN = Lookup oder identifier_exists=false\n   - Logging zu Supabase + Sheets\n\n6. REGELN:\n   - Niemals: Preise, Delete, Verf√ºgbarkeit √§ndern\n   - Immer: Adult Flag setzen!\n   - Langsam aber stetig\n   - Logs schreiben vor Update!\n\n7. ERFOLGS-Meldung (KEINE Errors):\n   - An: info@mechtech-support.com\n   - Format: Daily Success Report\n   - Nur Erfolge, keine Errors!\""
          }
        },
        "id": "d693f698-d40b-46a1-88df-ab9dd01765bf",
        "name": "Gemini Daily Decision",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3,
        "position": [
          1552,
          3552
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash",
          "options": {}
        },
        "id": "aa5fcfd4-61e9-4522-8e08-fc5739fd1fd7",
        "name": "Gemini flash_2.0",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          1360,
          3760
        ],
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "disabled": false
      },
      {
        "parameters": {
          "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
        "typeVersion": 1.2,
        "position": [
          1472,
          3760
        ],
        "id": "6a4002e5-0908-41de-bd03-1dc359e33cbe",
        "name": "MCP Client1",
        "disabled": false
      },
      {
        "parameters": {
          "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "supabaseApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {}
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequestTool",
        "typeVersion": 4.3,
        "position": [
          1600,
          3760
        ],
        "id": "69313a23-245e-4812-8f0d-6a0f49f9ae46",
        "name": "Supabase RAG Context",
        "credentials": {
          "supabaseApi": {
            "id": "f1qLUdIsbZ2A3wdC",
            "name": "Supabase-MySQL"
          }
        },
        "disabled": false
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          2080,
          4000
        ],
        "id": "81c65263-dd9c-47ce-bb36-5ef2c918c51f",
        "name": "Google Gemini Chat Model",
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "disabled": false
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/products/{{ $json.product_id }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendBody": true,
          "specifyBody": "json",
          "options": {}
        },
        "name": "Update GTN/EAN",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          2496,
          4112
        ],
        "id": "7a01b7e8-3184-4982-92f4-a0ba03f781a4",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "amount": 2
        },
        "name": "Rate Limiting GTN/EAN",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          2720,
          4208
        ],
        "id": "65ca06d9-ae1b-4669-ba03-4418312d0442",
        "webhookId": "rate-limit-country-webhook",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "jsCode": "// ============================================================================\n// PREPARE GTIN/EAN LOOP - F√ºr Gemini GTIN/EAN Updates\n// ============================================================================\nconst inputData = $input.first().json;\nconst config = $('Shop Configuration2').first().json;\n\n// ‚úÖ Hole Products von Analyze Products2:\nconst analysis = $('Analyze Products2').first().json;\nconst productsToFix = analysis.products_needing_fix || [];\n\n// ‚úÖ Hole Priority und Max Products von Gemini Decision:\nconst decision = $('Gemini Daily Decision').first().json.output || {};\nconst maxProducts = decision.products_to_process || productsToFix.length;\n\n// ‚úÖ Shop ID von Decision ODER Config:\nconst shopId = decision.shop_id || config.shop1_id;\n\n// ‚úÖ Shop Info aus Config:\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\n// Filtere nur Products die GTIN/EAN Updates brauchen\nconst productsNeedingGtinEan = productsToFix.filter(product => {\n  // Pr√ºfe ob Gemini empfohlen hat GTIN/EAN zu aktualisieren\n  return product.needs_gtin_ean === true || \n         product.missing_gtin === true || \n         product.missing_mpn === true ||\n         product.missing_brand === true ||\n         (product.priority && product.priority === 'multi_gtn_ean');\n});\n\n// Slice f√ºr Batch Processing\nconst productsSlice = productsNeedingGtinEan.slice(0, maxProducts);\n\n// ‚úÖ Erstelle Items mit GTIN/EAN Daten:\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    \n    // GTIN/EAN Daten (von Gemini oder Product)\n    gtin: product.gtin || product.gtin_from_gemini || product.recommended_gtin || '',\n    mpn: product.mpn || product.mpn_from_gemini || product.recommended_mpn || '',\n    brand: product.brand || product.brand_from_gemini || product.recommended_brand || '',\n    \n    action: 'gtin_ean',\n    priority: 'multi_gtn_ean',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
        },
        "name": "Prepare GTN/EAN_Loop",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2272,
          4176
        ],
        "id": "f0a9ce99-2f4c-4baf-857a-02c81d0cae4d",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "operation": "appendOrUpdate",
          "documentId": {
            "__rl": true,
            "mode": "id",
            "value": "1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE"
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "üìù Daily_Log"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Timestamp": "={{ $json.run_date }}",
              "Shop": "={{ $json.shop_id }}",
              "Phase": "={{ $json.phase }}",
              "Products Processed": "={{ $json.products_processed }}",
              "Success Count": "={{ $json.success_count }}",
              "Failed Count": "={{ $json.failed_count }}",
              "Status": "={{ $json.created_at }}",
              "Action": "={{ $json.gemini_decision }}",
              "Details": "={{ $json.approval_rate_after }}"
            },
            "matchingColumns": [
              "Timestamp"
            ],
            "schema": [
              {
                "id": "Timestamp",
                "displayName": "Timestamp",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Shop",
                "displayName": "Shop",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Phase",
                "displayName": "Phase",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Action",
                "displayName": "Action",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Products Processed",
                "displayName": "Products Processed",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Success Count",
                "displayName": "Success Count",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Failed Count",
                "displayName": "Failed Count",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Status",
                "displayName": "Status",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Details",
                "displayName": "Details",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false,
            "mappings": [
              {
                "column": "Timestamp",
                "value": "={{ $json.run_date }}"
              },
              {
                "column": "Shop",
                "value": "={{ $json.shop_name }}"
              },
              {
                "column": "Phase",
                "value": "={{ $json.phase }}"
              },
              {
                "column": "Action",
                "value": "Daily Run"
              },
              {
                "column": "Products Processed",
                "value": "={{ $json.products_processed }}"
              },
              {
                "column": "Success Count",
                "value": "={{ $json.success_count }}"
              },
              {
                "column": "Failed Count",
                "value": "={{ $json.failed_count }}"
              },
              {
                "column": "Status",
                "value": "={{ $json.status }}"
              },
              {
                "column": "Details",
                "value": "={{ $json.reasoning }}"
              }
            ]
          },
          "options": {}
        },
        "id": "4d05ceb8-9f63-4593-bc11-609b83f7f012",
        "name": "Log Results_Sheets_01",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          3072,
          4400
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "pbNsBLFTIuL9ArMn",
            "name": "Google Sheets"
          }
        },
        "onError": "continueErrorOutput",
        "disabled": false
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.emailReadImap",
        "typeVersion": 2.1,
        "position": [
          160,
          3424
        ],
        "id": "4aafec14-c1cf-4b56-a311-a808641ba07a",
        "name": "Email Trigger (IMAP)1",
        "credentials": {
          "imap": {
            "id": "CdpePT9CweqekWEC",
            "name": "IMAP info@mechtech-support.com"
          }
        },
        "disabled": false
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "gemini-error-adult-1766027265946",
        "name": "Gemini Error Handler Adult Flags",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          3264,
          3184
        ],
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "disabled": false
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "gemini-error-images-1766027265947",
        "name": "Gemini Error Handler Images",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          3264,
          3376
        ],
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "disabled": false
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "gemini-error-text-1766027265947",
        "name": "Gemini Error Handler Text",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          3264,
          3568
        ],
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "disabled": false
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "gemini-error-quality-1766027265948",
        "name": "Gemini Error Handler Merchant Quality",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          3264,
          3760
        ],
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "disabled": false
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "gemini-error-country-1766027265948",
        "name": "Gemini Error Handler Multi Country",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          3264,
          3968
        ],
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "disabled": false
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "gemini-error-gtnean-1766027265949",
        "name": "Gemini Error Handler GTN/EAN",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          3264,
          4240
        ],
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "disabled": false
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "string": [
                    {
                      "value1": "={{ $json.error && ($json.error.code === 429 || $json.error.code === 400 || $json.error.code === 500) }}",
                      "operation": "equals",
                      "value2": "true"
                    }
                  ]
                },
                "renameOutput": "Error"
              }
            ]
          },
          "options": {},
          "mode": "rules",
          "fallbackOutput": 1
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          3728,
          3200
        ],
        "id": "switch-action-adult-flags",
        "name": "Switch Action Handler Adult Flags",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "disabled": false
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "string": [
                    {
                      "value1": "={{ $json.error && ($json.error.code === 429 || $json.error.code === 400 || $json.error.code === 500) }}",
                      "operation": "equals",
                      "value2": "true"
                    }
                  ]
                },
                "renameOutput": "Error"
              }
            ]
          },
          "options": {},
          "mode": "rules",
          "fallbackOutput": 1
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          3728,
          3392
        ],
        "id": "switch-action-images",
        "name": "Switch Action Handler Images",
        "disabled": false
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "string": [
                    {
                      "value1": "={{ $json.error && ($json.error.code === 429 || $json.error.code === 400 || $json.error.code === 500) }}",
                      "operation": "equals",
                      "value2": "true"
                    }
                  ]
                },
                "renameOutput": "Error"
              }
            ]
          },
          "options": {},
          "mode": "rules",
          "fallbackOutput": 1
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          3728,
          3600
        ],
        "id": "switch-action-text",
        "name": "Switch Action Handler Text",
        "disabled": false
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "string": [
                    {
                      "value1": "={{ $json.error && ($json.error.code === 429 || $json.error.code === 400 || $json.error.code === 500) }}",
                      "operation": "equals",
                      "value2": "true"
                    }
                  ]
                },
                "renameOutput": "Error"
              }
            ]
          },
          "options": {},
          "mode": "rules",
          "fallbackOutput": 1
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          3728,
          3792
        ],
        "id": "switch-action-merchant-quality",
        "name": "Switch Action Handler Merchant Quality",
        "disabled": false
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "string": [
                    {
                      "value1": "={{ $json.error && ($json.error.code === 429 || $json.error.code === 400 || $json.error.code === 500) }}",
                      "operation": "equals",
                      "value2": "true"
                    }
                  ]
                },
                "renameOutput": "Error"
              }
            ]
          },
          "options": {},
          "mode": "rules",
          "fallbackOutput": 1
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          3728,
          4000
        ],
        "id": "switch-action-multi-country",
        "name": "Switch Action Handler Multi Country",
        "disabled": false
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "string": [
                    {
                      "value1": "={{ $json.error && ($json.error.code === 429 || $json.error.code === 400 || $json.error.code === 500) }}",
                      "operation": "equals",
                      "value2": "true"
                    }
                  ]
                },
                "renameOutput": "Error"
              }
            ]
          },
          "options": {},
          "mode": "rules",
          "fallbackOutput": 1
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          3728,
          4192
        ],
        "id": "switch-action-gtn-ean",
        "name": "Switch Action Handler GTN/EAN",
        "disabled": false
      }
    ],
    "connections": {
      "Chat Trigger (RAG Query)": {
        "main": [
          [
            {
              "node": "Chat Agent (RAG)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gemini Chat Model (RAG)": {
        "ai_languageModel": [
          [
            {
              "node": "Chat Agent (RAG)",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Gemini Embeddings (RAG)": {
        "ai_embedding": [
          [
            {
              "node": "Supabase Vector Store (Retrieve)",
              "type": "ai_embedding",
              "index": 0
            }
          ]
        ]
      },
      "Postgres Chat Memory": {
        "ai_memory": [
          [
            {
              "node": "Chat Agent (RAG)",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Check Last Run": {
        "main": [
          [
            {
              "node": "Get Merchant Products Shop2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Get Merchant Products2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Get Workflow Status REAL",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Products Loop": {
        "main": [
          [
            {
              "node": "Prepare Images Loop",
              "type": "main",
              "index": 0
            },
            {
              "node": "Update Product Adult Flag",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Product Adult Flag": {
        "main": [
          [
            {
              "node": "Rate Limiting",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Rate Limiting": {
        "main": [
          [
            {
              "node": "Prepare Products Loop",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results_Sheets_01",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save to Supabase Products",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            },
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Gemini Error Handler Adult Flags",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Workflow Run": {
        "main": [
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Results to Sheets": {
        "main": [
          [
            {
              "node": "Send Daily Report",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save to Supabase Products",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Daily Report": {
        "main": [
          [
            {
              "node": "Format Report for Email",
              "type": "main",
              "index": 0
            },
            {
              "node": "Check if Expert Needed",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Import Commands from Gmail": {
        "main": [
          [
            {
              "node": "Parse Command Input",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Import Commands from WhatsApp": {
        "main": [
          [
            {
              "node": "Parse Command Input",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format Report for Email": {
        "main": [
          [
            {
              "node": "Export Report to Gmail",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Command Input": {
        "main": [
          [
            {
              "node": "Route Command",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check if Expert Needed": {
        "main": [
          [
            {
              "node": "Send WhatsApp Expert Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Route Command": {
        "main": [
          [
            {
              "node": "Shop Configuration2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Get Workflow Status REAL",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Send Command Response",
              "type": "main",
              "index": 0
            }
          ]
        ],
        "error": [
          [
            {
              "node": "Handle Workflow Errors",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Images Loop": {
        "main": [
          [
            {
              "node": "Prepare Text Loop",
              "type": "main",
              "index": 0
            },
            {
              "node": "Update Product Images",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Product Images": {
        "main": [
          [
            {
              "node": "Rate Limiting Images",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Rate Limiting Images": {
        "main": [
          [
            {
              "node": "Prepare Images Loop",
              "type": "main",
              "index": 0
            },
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results_Sheets_01",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save to Supabase Products",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            },
            {
              "node": "Gemini Error Handler Images",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Text Loop": {
        "main": [
          [
            {
              "node": "Prepare Merchant Quality Loop",
              "type": "main",
              "index": 0
            },
            {
              "node": "Update Product Text",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Product Text": {
        "main": [
          [
            {
              "node": "Rate Limiting Text",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Rate Limiting Text": {
        "main": [
          [
            {
              "node": "Prepare Text Loop",
              "type": "main",
              "index": 0
            },
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results_Sheets_01",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save to Supabase Products",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            },
            {
              "node": "Gemini Error Handler Text",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Handle Invalid Priority": {
        "main": [
          [
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Shop Configuration2": {
        "main": [
          [
            {
              "node": "Check Last Run",
              "type": "main",
              "index": 0
            },
            {
              "node": "Get Merchant Products Shop2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Get Merchant Products2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Merchant Products2": {
        "main": [
          [
            {
              "node": "Analyze Products2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Analyze Products2": {
        "main": [
          [
            {
              "node": "Gemini Daily Decision",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate Results2": {
        "main": [
          [
            {
              "node": "Save Workflow Run",
              "type": "main",
              "index": 0
            },
            {
              "node": "Get Human Instructions",
              "type": "main",
              "index": 0
            },
            {
              "node": "Get Workflow Status REAL",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "JSON Output Parser1": {
        "ai_outputParser": [
          [
            {
              "node": "Gemini Daily Decision",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Merchant Quality Loop": {
        "main": [
          [
            {
              "node": "Prepare Multi Country Loop",
              "type": "main",
              "index": 0
            },
            {
              "node": "Update Merchant Settings",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Merchant Settings": {
        "main": [
          [
            {
              "node": "Rate Limiting Merchant",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Multi Country Loop": {
        "main": [
          [
            {
              "node": "Prepare GTN/EAN_Loop",
              "type": "main",
              "index": 0
            },
            {
              "node": "Update Country Feeds",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Country Feeds": {
        "main": [
          [
            {
              "node": "Rate Limiting Country",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Rate Limiting Merchant": {
        "main": [
          [
            {
              "node": "Prepare Merchant Quality Loop",
              "type": "main",
              "index": 0
            },
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save to Supabase Products",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results_Sheets_01",
              "type": "main",
              "index": 0
            },
            {
              "node": "Gemini Error Handler Merchant Quality",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Rate Limiting Country": {
        "main": [
          [
            {
              "node": "Prepare Multi Country Loop",
              "type": "main",
              "index": 0
            },
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results_Sheets_01",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save to Supabase Products",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            },
            {
              "node": "Gemini Error Handler Multi Country",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Route by Priority": {
        "main": [
          [
            {
              "node": "Prepare Products Loop",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Prepare Images Loop",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Prepare Text Loop",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Prepare Merchant Quality Loop",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Prepare Multi Country Loop",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Prepare GTN/EAN_Loop",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Handle Invalid Priority",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Merchant Products Shop2": {
        "main": [
          [
            {
              "node": "Analyze Products2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save to Supabase Products": {
        "main": [
          [
            {
              "node": "Update Optimization Patterns",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Optimization Patterns": {
        "main": [
          [
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Human Instructions": {
        "main": [
          [
            {
              "node": "Filter Unprocessed Instructions",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter Unprocessed Instructions": {
        "main": [
          [
            {
              "node": "Process Instructions with Gemini",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Instructions with Gemini": {
        "main": [
          [
            {
              "node": "Apply to Similar Products",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gemini Model Learning": {
        "ai_languageModel": [
          [
            {
              "node": "Process Instructions with Gemini",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "JSON Parser Learning": {
        "ai_outputParser": [
          [
            {
              "node": "Process Instructions with Gemini",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Apply to Similar Products": {
        "main": [
          [
            {
              "node": "Update Sheet with AI Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Sheet with AI Response": {
        "main": [
          [
            {
              "node": "Save Learning to Supabase",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Learning to Supabase": {
        "main": [
          [
            {
              "node": "Send Daily Report",
              "type": "main",
              "index": 0
            },
            {
              "node": "Format Report for Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Workflow Status REAL": {
        "main": [
          [
            {
              "node": "Format Status Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format Status Response": {
        "main": [
          [
            {
              "node": "Send Command Response",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Chat Agent (RAG)": {
        "main": [
          []
        ]
      },
      "Supabase Vector Store (Retrieve)": {
        "ai_vectorStore": [
          []
        ]
      },
      "MCP Client": {
        "ai_tool": [
          [
            {
              "node": "Chat Agent (RAG)",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "When clicking ‚ÄòExecute workflow‚Äô": {
        "main": [
          [
            {
              "node": "Shop Configuration2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Schedule Trigger": {
        "main": [
          [
            {
              "node": "Shop Configuration2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gemini Daily Decision": {
        "main": [
          [
            {
              "node": "Route by Priority",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gemini flash_2.0": {
        "ai_languageModel": [
          [
            {
              "node": "Gemini Daily Decision",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "MCP Client1": {
        "ai_tool": [
          [
            {
              "node": "Gemini Daily Decision",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Supabase RAG Context": {
        "ai_tool": [
          [
            {
              "node": "Gemini Daily Decision",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Google Gemini Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "JSON Output Parser1",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Update GTN/EAN": {
        "main": [
          [
            {
              "node": "Rate Limiting GTN/EAN",
              "type": "main",
              "index": 0
            },
            {
              "node": "AI Error Handler",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Rate Limiting GTN/EAN": {
        "main": [
          [
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results_Sheets_01",
              "type": "main",
              "index": 0
            },
            {
              "node": "Gemini Error Handler GTN/EAN",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Prepare GTN/EAN_Loop": {
        "main": [
          [
            {
              "node": "Update GTN/EAN",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Command Response": {
        "main": [
          [],
          []
        ]
      },
      "2d6517f1-ebbc-48fd-894c-287420175a7a": {
        "main": [
          [
            {
              "node": "9bf990d0-1d87-4bbb-9153-46146b506ae6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "9bf990d0-1d87-4bbb-9153-46146b506ae6": {
        "main": [
          [
            {
              "node": "3245d64d-7810-44de-beaa-f97d55eb2274",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "3245d64d-7810-44de-beaa-f97d55eb2274": {
        "main": [
          [
            {
              "node": "92b514de-5cd0-4f79-9857-123e685a1405",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "39d79c98-55c7-418a-8c36-bce59d3efd3f": {
        "main": [
          [
            {
              "node": "40a1e96b-15f2-4eb0-bdad-bd7532b02a22",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "40a1e96b-15f2-4eb0-bdad-bd7532b02a22": {
        "main": [
          [
            {
              "node": "f0a9ce99-2f4c-4baf-857a-02c81d0cae4d",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "f0a9ce99-2f4c-4baf-857a-02c81d0cae4d": {
        "main": [
          [
            {
              "node": "09ba4846-6da9-425c-a762-4f9f4bc1b4e6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "f49cb6b3-195b-42f6-a025-a0e78d62cfca": {
        "main": [
          [
            {
              "node": "2d6517f1-ebbc-48fd-894c-287420175a7a",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "92b514de-5cd0-4f79-9857-123e685a1405": {
        "main": [
          [
            {
              "node": "40a1e96b-15f2-4eb0-bdad-bd7532b02a22",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Results_Sheets_01": {
        "main": [
          [
            {
              "node": "Send WhatsApp Expert Alert",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Email Trigger (IMAP)1": {
        "main": [
          [
            {
              "node": "Shop Configuration2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Error Handler": {
        "main": [
          [
            {
              "node": "Retry Queue",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Retry Queue": {
        "main": [
          [
            {
              "node": "Expression Repair",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "main": [
        [
          [
            {
              "node": "7a01b7e8-3184-4982-92f4-a0ba03f781a4",
              "type": "main",
              "index": 0
            },
            {
              "node": "errorHandler-1766014501177-9ez5es86k",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "errorHandler-1766014501177-9ez5es86k",
              "type": "main",
              "index": 0
            },
            {
              "node": "4c9f8649-a6b7-45dd-9ed9-b9134be84018",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "4c9f8649-a6b7-45dd-9ed9-b9134be84018",
              "type": "main",
              "index": 0
            },
            {
              "node": "c0c41789-4c7d-4efc-861f-885743a1aff8",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "errorHandler-1766014501177-9ez5es86k",
              "type": "main",
              "index": 1
            },
            {
              "node": "80b0ee00-87d9-44ec-8b62-8c86eda7737b",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "7a01b7e8-3184-4982-92f4-a0ba03f781a4",
              "type": "main",
              "index": 1
            },
            {
              "node": "65ca06d9-ae1b-4669-ba03-4418312d0442",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "c0c41789-4c7d-4efc-861f-885743a1aff8",
              "type": "main",
              "index": 0
            },
            {
              "node": "7a01b7e8-3184-4982-92f4-a0ba03f781a4",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "15586a83-cda8-4ac9-9826-9ed77f24fa1c",
              "type": "main",
              "index": 0
            },
            {
              "node": "ai-error-handler-adult-1766019421751-xxxuhgnln",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "ai-error-handler-adult-1766019421751-xxxuhgnln",
              "type": "main",
              "index": 0
            },
            {
              "node": "retry-queue-adult-1766019421751-10y8tihcx",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "retry-queue-adult-1766019421751-10y8tihcx",
              "type": "main",
              "index": 0
            },
            {
              "node": "expression-repair-adult-1766019421752-5eytl5tjg",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "expression-repair-adult-1766019421752-5eytl5tjg",
              "type": "main",
              "index": 0
            },
            {
              "node": "15586a83-cda8-4ac9-9826-9ed77f24fa1c",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "34310e5a-2422-4ce3-a615-5b8f911b5407",
              "type": "main",
              "index": 0
            },
            {
              "node": "ai-error-handler-text-1766019421752-tx9bpgxr6",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "ai-error-handler-text-1766019421752-tx9bpgxr6",
              "type": "main",
              "index": 0
            },
            {
              "node": "retry-queue-text-1766019421752-b389yhp5y",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "retry-queue-text-1766019421752-b389yhp5y",
              "type": "main",
              "index": 0
            },
            {
              "node": "expression-repair-text-1766019421752-rngvhbii6",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "expression-repair-text-1766019421752-rngvhbii6",
              "type": "main",
              "index": 0
            },
            {
              "node": "34310e5a-2422-4ce3-a615-5b8f911b5407",
              "type": "main",
              "index": 0
            }
          ]
        ]
      ],
      "Expression Repair": {
        "main": [
          [
            {
              "node": "Prepare GTN/EAN_Loop",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gemini Error Handler Adult Flags": {
        "main": [
          [
            {
              "node": "Switch Action Handler Adult Flags",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gemini Error Handler Images": {
        "main": [
          [
            {
              "node": "Switch Action Handler Images",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gemini Error Handler Text": {
        "main": [
          [
            {
              "node": "Switch Action Handler Text",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gemini Error Handler Merchant Quality": {
        "main": [
          [
            {
              "node": "Switch Action Handler Merchant Quality",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gemini Error Handler Multi Country": {
        "main": [
          [
            {
              "node": "Switch Action Handler Multi Country",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gemini Error Handler GTN/EAN": {
        "main": [
          [
            {
              "node": "Switch Action Handler GTN/EAN",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch Action Handler Adult Flags": {
        "main": [
          [
            {
              "node": "Rate Limiting",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Rate Limiting",
              "type": "main",
              "index": 0
            },
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch Action Handler Images": {
        "main": [
          [
            {
              "node": "Rate Limiting Images",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Rate Limiting Images",
              "type": "main",
              "index": 0
            },
            {
              "node": "Prepare Images Loop",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch Action Handler Text": {
        "main": [
          [
            {
              "node": "Rate Limiting Text",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Rate Limiting Text",
              "type": "main",
              "index": 0
            },
            {
              "node": "Prepare Text Loop",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch Action Handler Merchant Quality": {
        "main": [
          [
            {
              "node": "Rate Limiting Merchant",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Rate Limiting Merchant",
              "type": "main",
              "index": 0
            },
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch Action Handler Multi Country": {
        "main": [
          [
            {
              "node": "Rate Limiting Country",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Rate Limiting Country",
              "type": "main",
              "index": 0
            },
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch Action Handler GTN/EAN": {
        "main": [
          [
            {
              "node": "Rate Limiting GTN/EAN",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Rate Limiting GTN/EAN",
              "type": "main",
              "index": 0
            },
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Andree Schulz",
    "name": null,
    "description": null,
    "workflowPublishHistory": [
      {
        "createdAt": "2025-12-20T00:09:06.257Z",
        "id": 293,
        "workflowId": "ftZOou7HNgLOwzE5",
        "versionId": "3cc58665-31e9-4894-a9af-956641b9eb0f",
        "event": "activated",
        "userId": "905b93e2-2ccd-4e6b-a613-4d01485a9251"
      }
    ]
  },
  "_backup_metadata": {
    "version": 1,
    "backup_date": "2025-12-20T22:00:11.474Z",
    "workflow_id": "ftZOou7HNgLOwzE5",
    "workflow_name": "***MECHTECH_MERCHANT_CENTER_ADMIN",
    "original_name": "***MECHTECH_MERCHANT_CENTER_ADMIN",
    "sanitized_name": "MECHTECH_MERCHANT_CENTER_ADMIN"
  }
}