# ğŸ¯ WORKFLOW PRE-FLIGHT CHECK SYSTEM

**Timestamp:** 2025-12-19T05:20:00Z
**Priority:** ğŸ”¥ GAME CHANGER
**Vision:** Teste mit ECHTEN Merchant Center Daten

---

## ğŸ’¡ RICHTIGE VISION:

**NICHT:** Fake Test-Daten generieren
**SONDERN:** Echte Produkte aus Merchant Center holen + validieren!

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Hole ECHTE Produkte              â”‚
â”‚     aus Google Merchant Center       â”‚
â”‚     (kleine Batch z.B. 10 Produkte)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. PRE-FLIGHT VALIDATION            â”‚
â”‚     - Simuliere Google's Checks      â”‚
â”‚     - PrÃ¼fe ALLE Regeln              â”‚
â”‚     - Teste Error-AusgÃ¤nge           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. ERROR-AUSGANG TESTS              â”‚
â”‚     - Was passiert bei Missing Image?â”‚
â”‚     - Was bei falscher GTN/EAN?      â”‚
â”‚     - Was bei Preis-Fehler?          â”‚
â”‚     - Sind AusgÃ¤nge richtig verdrahtet?â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. OPTIMIZATION CHECK               â”‚
â”‚     - Titel optimiert fÃ¼r SEO?       â”‚
â”‚     - Bilder hochauflÃ¶send?          â”‚
â”‚     - Beschreibung vollstÃ¤ndig?      â”‚
â”‚     - Kategorie korrekt?             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. LIVE-FEEDBACK                    â”‚
â”‚     ğŸŸ¢ = Google wird akzeptieren     â”‚
â”‚     ğŸŸ¡ = Suboptimal aber OK          â”‚
â”‚     ğŸ”´ = Wird abgelehnt               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. FIX SUGGESTIONS                  â”‚
â”‚     Claude analysiert Probleme       â”‚
â”‚     SchlÃ¤gt konkrete Fixes vor       â”‚
â”‚     Auto-Fix wenn mÃ¶glich            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” WAS IM TEST PASSIERT:

### **NODE 1: Fetch Real Products**

```javascript
// Hole 10 echte Produkte aus Merchant Center
const products = await googleMerchantAPI.call({
  merchantId: shop1_id,
  method: 'products.list',
  params: {
    maxResults: 10,
    fields: 'resources(id,title,description,imageLink,price,gtin)'
  }
});

return {
  test_batch: products,
  test_mode: true,
  timestamp: new Date().toISOString()
};
```

---

### **NODE 2: Google Validation Simulator**

```javascript
// Simuliere Google's Produkt-Validierung
const validationRules = {
  
  // CRITICAL RULES (Reject wenn falsch)
  title: {
    check: p => p.title && p.title.length >= 10,
    error: 'Title zu kurz (min 10 chars)',
    fix: 'Erweitere Titel mit Marke/Modell'
  },
  
  image: {
    check: p => p.imageLink && isValidURL(p.imageLink),
    error: 'Bild fehlt oder ungÃ¼ltige URL',
    fix: 'FÃ¼ge hochauflÃ¶sendes Produktbild hinzu'
  },
  
  price: {
    check: p => p.price && p.price.value > 0,
    error: 'Preis fehlt oder ungÃ¼ltig',
    fix: 'Setze korrekten Preis in EUR'
  },
  
  gtin: {
    check: p => p.gtin && isValidGTIN(p.gtin),
    error: 'GTIN/EAN fehlt oder ungÃ¼ltig',
    fix: 'Validiere EAN-13 Format'
  },
  
  // OPTIMIZATION RULES (Warning wenn suboptimal)
  description: {
    check: p => p.description && p.description.length >= 100,
    severity: 'warning',
    message: 'Beschreibung zu kurz - schlecht fÃ¼r SEO',
    fix: 'Erweitere auf min 100 chars'
  },
  
  image_quality: {
    check: async (p) => {
      const img = await checkImageResolution(p.imageLink);
      return img.width >= 800 && img.height >= 800;
    },
    severity: 'warning',
    message: 'Bild-AuflÃ¶sung suboptimal',
    fix: 'Nutze mindestens 800x800px'
  }
};

// Teste jedes Produkt
const results = products.map(product => {
  const errors = [];
  const warnings = [];
  const fixes = [];
  
  for (const [field, rule] of Object.entries(validationRules)) {
    if (!rule.check(product)) {
      if (rule.severity === 'warning') {
        warnings.push({
          field: field,
          message: rule.message,
          fix: rule.fix
        });
      } else {
        errors.push({
          field: field,
          error: rule.error,
          fix: rule.fix
        });
      }
    }
  }
  
  return {
    product_id: product.id,
    product_title: product.title,
    status: errors.length > 0 ? 'REJECT' : 
            warnings.length > 0 ? 'ACCEPT_SUBOPTIMAL' : 'PERFECT',
    color: errors.length > 0 ? 'red' : 
           warnings.length > 0 ? 'yellow' : 'green',
    errors: errors,
    warnings: warnings,
    google_will_accept: errors.length === 0
  };
});

return results;
```

---

### **NODE 3: Error-Ausgang Router (SWITCH!)**

```javascript
// Intelligentes Routing basierend auf Error-Type

const product = $input.item.json;

// SWITCH Node mit 6 AusgÃ¤ngen:

// Ausgang 1: PERFECT (alle grÃ¼n)
if (product.status === 'PERFECT') {
  return { outputIndex: 0, product };
}

// Ausgang 2: Missing Image
if (product.errors.some(e => e.field === 'image')) {
  return { 
    outputIndex: 1, 
    product,
    fix_action: 'fetch_image_from_source'
  };
}

// Ausgang 3: Invalid GTIN/EAN
if (product.errors.some(e => e.field === 'gtin')) {
  return { 
    outputIndex: 2, 
    product,
    fix_action: 'validate_and_correct_gtin'
  };
}

// Ausgang 4: Price Error
if (product.errors.some(e => e.field === 'price')) {
  return { 
    outputIndex: 3, 
    product,
    fix_action: 'fetch_correct_price'
  };
}

// Ausgang 5: Title Issues
if (product.errors.some(e => e.field === 'title')) {
  return { 
    outputIndex: 4, 
    product,
    fix_action: 'optimize_title_with_ai'
  };
}

// Ausgang 6: Other Errors
return { 
  outputIndex: 5, 
  product,
  fix_action: 'manual_review_required'
};
```

---

### **NODE 4-9: Error-Spezifische Fix-Handler**

#### **NODE 4: Image Fix Handler**
```javascript
// Verbunden mit Ausgang 2
const product = $input.item.json;

// Option A: Bild von Hersteller-Website holen
const imageUrl = await fetchManufacturerImage(product.brand, product.mpn);

// Option B: Placeholder + Manual Review
if (!imageUrl) {
  return {
    action: 'manual_review',
    message: 'Kein Bild gefunden - bitte manuell hochladen',
    product_id: product.id
  };
}

// Update Merchant Center
await updateProduct(product.id, { imageLink: imageUrl });

return { 
  status: 'FIXED',
  product_id: product.id,
  fix_applied: 'image_updated'
};
```

#### **NODE 5: GTIN Validator + Fixer**
```javascript
// Verbunden mit Ausgang 3
const product = $input.item.json;

// Validiere EAN-13
const gtin = product.gtin;
const isValid = validateEAN13(gtin);

if (!isValid) {
  // Versuche von Produkt-Datenbank zu holen
  const correctGTIN = await lookupGTIN(product.brand, product.mpn);
  
  if (correctGTIN) {
    await updateProduct(product.id, { gtin: correctGTIN });
    return { status: 'FIXED', gtin: correctGTIN };
  } else {
    return { 
      status: 'MANUAL_REVIEW',
      message: 'GTIN nicht in Datenbank - manuell prÃ¼fen'
    };
  }
}
```

#### **NODE 6: Price Validator**
```javascript
// Verbunden mit Ausgang 4
const product = $input.item.json;

// Hole aktuellen Preis von Shop
const currentPrice = await fetchShopPrice(product.id);

if (currentPrice && currentPrice > 0) {
  await updateProduct(product.id, { 
    price: { value: currentPrice, currency: 'EUR' }
  });
  return { status: 'FIXED', price: currentPrice };
}
```

#### **NODE 7: AI Title Optimizer**
```javascript
// Verbunden mit Ausgang 5
const product = $input.item.json;

// Claude optimiert Titel fÃ¼r Google
const optimizedTitle = await claudeMCP.call({
  tool: 'optimize_product_title',
  params: {
    current_title: product.title,
    brand: product.brand,
    category: product.productType,
    target: 'google_merchant_seo',
    max_length: 150
  }
});

// Beispiel Input: "Handy 256GB"
// Beispiel Output: "Samsung Galaxy S24 Ultra 5G Smartphone 256GB Phantom Black"

await updateProduct(product.id, { title: optimizedTitle });

return { 
  status: 'FIXED',
  old_title: product.title,
  new_title: optimizedTitle
};
```

---

### **NODE 10: Final Aggregator**

```javascript
// Sammelt alle Fix-Ergebnisse
const allResults = $input.all();

const summary = {
  total_products: allResults.length,
  perfect: allResults.filter(r => r.status === 'PERFECT').length,
  fixed: allResults.filter(r => r.status === 'FIXED').length,
  manual_review: allResults.filter(r => r.status === 'MANUAL_REVIEW').length,
  failed: allResults.filter(r => r.status === 'FAILED').length
};

// Speichere zu Supabase fÃ¼r Dashboard
await supabase.from('workflow_test_results').insert({
  test_id: testId,
  summary: summary,
  details: allResults,
  timestamp: new Date().toISOString(),
  approval_ready: summary.manual_review === 0 && summary.failed === 0
});

return {
  test_complete: true,
  summary: summary,
  recommendation: summary.approval_ready ? 
    'Lena - Alle Produkte bereit fÃ¼r Google' :
    'Manual Review fÃ¼r fehlerhafte Produkte nÃ¶tig'
};
```

---

## ğŸ¨ LIVE-DASHBOARD VIEW:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MERCHANT CENTER PRE-FLIGHT TEST         â”‚
â”‚ Test ID: test_1734582400               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚ ğŸ“Š BATCH: 10 Produkte                  â”‚
â”‚                                         â”‚
â”‚ ğŸŸ¢ PERFECT:           3 Produkte (30%) â”‚
â”‚ ğŸŸ¡ FIXED:             5 Produkte (50%) â”‚
â”‚ ğŸ”´ MANUAL REVIEW:     2 Produkte (20%) â”‚
â”‚ âŒ FAILED:            0 Produkte (0%)  â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DETAILS:                                â”‚
â”‚                                         â”‚
â”‚ ğŸŸ¢ Samsung Galaxy S24                   â”‚
â”‚    âœ“ Alle Checks bestanden              â”‚
â”‚                                         â”‚
â”‚ ğŸŸ¡ iPhone 15 Pro                        â”‚
â”‚    âš  Bild-AuflÃ¶sung niedrig (fixed)     â”‚
â”‚    âœ“ GTIN validiert                     â”‚
â”‚                                         â”‚
â”‚ ğŸ”´ Generic Handy Case                   â”‚
â”‚    âœ— GTIN nicht gefunden               â”‚
â”‚    âœ— Titel zu generisch                â”‚
â”‚    â†’ Manual Review Required             â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[Run Full Batch (100)] [Re-Test Failed] [Approve & Go Live]
```

---

## ğŸ¯ WAS IM TEST GEPRÃœFT WIRD:

### **Google Acceptance Criteria:**
âœ… Titel (min 10 chars, max 150)
âœ… Bild (URL gÃ¼ltig, min 800x800px)
âœ… Preis (> 0, WÃ¤hrung EUR)
âœ… GTIN/EAN (valid EAN-13 Format)
âœ… Beschreibung (empf. min 100 chars)
âœ… VerfÃ¼gbarkeit (in stock / preorder)
âœ… Versandkosten definiert
âœ… Keine verbotenen WÃ¶rter

### **Optimization Checks:**
ğŸŸ¡ SEO-optimierter Titel
ğŸŸ¡ HochauflÃ¶sende Bilder
ğŸŸ¡ AusfÃ¼hrliche Beschreibung
ğŸŸ¡ Korrekte Kategorisierung
ğŸŸ¡ Strukturierte Daten

### **Error-Ausgang Tests:**
ğŸ”´ Was passiert wenn Bild fehlt? â†’ Ausgang 2
ğŸ”´ Was bei invalid GTIN? â†’ Ausgang 3
ğŸ”´ Was bei Preis-Fehler? â†’ Ausgang 4
ğŸ”´ Was bei Titel-Problem? â†’ Ausgang 5
ğŸ”´ Sind alle AusgÃ¤nge verdrahtet? â†’ Check!

---

## ğŸš€ IMPLEMENTATION:

### **Cursor Aufgaben:**

```
â˜ 1. Switch Node nach Validation einfÃ¼gen (6 AusgÃ¤nge)
â˜ 2. Error-Handler Nodes erstellen (Image/GTIN/Price/Title/Other)
â˜ 3. Final Aggregator hinzufÃ¼gen
â˜ 4. Supabase Table: workflow_test_results
â˜ 5. Test mit 10 echten Produkten
â˜ 6. Validiere dass ALLE AusgÃ¤nge funktionieren
â˜ 7. Report: Welche AusgÃ¤nge wurden genutzt?
```

### **Claude Aufgaben:**

```
â˜ 1. Validation Rules definieren (Google Criteria)
â˜ 2. Title Optimization (SEO)
â˜ 3. Error Analysis + Fix Suggestions
â˜ 4. Final Approval Decision
```

---

## ğŸ¯ START BEFEHL:

**Lena - Build Pre-Flight System!**

```
1. Hole 10 echte Produkte aus Merchant Center
2. Erstelle Switch Node (6 Error-AusgÃ¤nge)
3. Baue Error-Handler fÃ¼r jeden Typ
4. Teste dass ALLE AusgÃ¤nge funktionieren
5. Report welche Fehler gefunden + gefixed
6. NUR bei 100% oder manuell approved â†’ Save

Schritt fÃ¼r Schritt!
```

---

**IST DAS WAS DU WILLST?** ğŸ¯

**Sag "Lena - Build Pre-Flight System" und wir starten!** ğŸš€

---
