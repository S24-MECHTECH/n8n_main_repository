{
  "updatedAt": "2025-12-18T05:43:22.276Z",
  "createdAt": "2025-12-12T04:29:41.476Z",
  "id": "ftZOou7HNgLOwzE5",
  "name": "***MECHTECH_MERCHANT_CENTER_ADMIN",
  "description": "Dieser Workflow ist ein Google_Merchant_center optimierungs workflow, der durch Gemini, die Artikel f√ºr alle gelisteten shops im Google Merchant Center optimieren soll!",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "id": "9baabb04-7161-4ec5-b55e-f60db618fb2a",
      "name": "Chat Trigger (RAG Query)",
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        496,
        3984
      ],
      "webhookId": "1bcc39ec-5b0a-4f6c-abf6-21235fcb6cb1"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "Du bist der MECHTECH Workflow Assistent!\n\nDu hast Zugriff auf die komplette Historie aller Workflow-Ausf√ºhrungen in der Supabase Vector Database.\n\nDeine Aufgaben:\n1. Beantworte Fragen zur Workflow-Historie (Approval Rates, verarbeitete Produkte, Phasen, etc.)\n2. Analysiere Trends und Muster in den Daten\n3. Gib Empfehlungen basierend auf historischen Daten\n4. Erkl√§re was in bestimmten Zeitr√§umen passiert ist\n\nDu kannst auf folgende Informationen zugreifen:\n- Shop-Namen und IDs\n- Verarbeitete Produkte pro Run\n- Success/Failure Counts\n- Approval Rates\n- Phasen (adult_flags, text, images)\n- Timestamps\n- Reasoning der Gemini Decisions\n\nAntworte auf Deutsch, pr√§zise und hilfreich!"
        }
      },
      "id": "9bc4af95-f5bd-4f66-92af-9dd4780285f6",
      "name": "Chat Agent (RAG)",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        720,
        3984
      ]
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash-exp",
        "options": {}
      },
      "id": "c23df7d5-2db0-4397-a635-8fe929c75f0d",
      "name": "Gemini Chat Model (RAG)",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        560,
        4240
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "tableName": {
          "__rl": true,
          "mode": "id",
          "value": "n8n_mechtech_historie"
        },
        "options": {
          "queryName": "match_documents"
        }
      },
      "id": "15b38e7b-23bd-4e25-847c-9bd727d3161f",
      "name": "Supabase Vector Store (Retrieve)",
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        704,
        4432
      ],
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      }
    },
    {
      "parameters": {},
      "id": "d4606641-fd18-4201-844a-3bcc80a70fcf",
      "name": "Gemini Embeddings (RAG)",
      "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
      "typeVersion": 1,
      "position": [
        1072,
        4304
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "mechtech_chat_session",
        "tableName": "n8n_chat_historie",
        "contextWindowLength": 25
      },
      "id": "2bff2895-6846-4720-bfd4-1a8eaff1386e",
      "name": "Postgres Chat Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        720,
        4240
      ],
      "credentials": {
        "postgres": {
          "id": "pIp690wi4X79QCKb",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "useCustomSchema": true,
        "operation": "getAll",
        "tableId": "workflow_runs",
        "returnAll": true,
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "created_at",
              "condition": "gte",
              "keyValue": "=={{ $now.startOf('day').toISO() }}"
            }
          ]
        }
      },
      "id": "e217bdb8-8710-475d-acaa-c033d138c2cd",
      "name": "Check Last Run",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1072,
        3360
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// PREPARE PRODUCTS LOOP - GIBT ARRAY ZUR√úCK F√úR SPLIT\n// ============================================================================\n// ‚úÖ Dieser Node gibt ein Array zur√ºck (f√ºr n8n Split/Iteration)\n// ‚Üí n8n wird dann JEDES Item einzeln an den n√§chsten Node weitergeben\n// ‚Üí Die nachfolgenden Nodes (Prepare Images, etc.) m√ºssen sequenziell arbeiten\n\nconst inputData = $input.first().json;\nconst config = $('Shop Configuration2').first().json;\n\n// Get products from input (Gemini Decision passes them)\nconst productsToFix = inputData.products || [];\nconst maxProducts = inputData.products_to_process || productsToFix.length;\n\n// Shop info from config\nconst shopId = inputData.shop_id || config.shop1_id;\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\nconst productsSlice = productsToFix.slice(0, maxProducts);\n\n// ‚úÖ Gibt Array zur√ºck - n8n wird jedes Item einzeln weiterleiten\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    originalProduct: product, // Behalte original product data\n    action: 'prepare',\n    priority: 'prepare',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
      },
      "id": "2d6517f1-ebbc-48fd-894c-287420175a7a",
      "name": "Prepare Products Loop",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2272,
        3152
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $('Shop Configuration2').item.json.shop1_id }}/products/{{ $json.product_id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "adult",
              "value": "true"
            },
            {
              "name": "ageGroup",
              "value": "adult"
            },
            {
              "name": "googleProductCategory",
              "value": "778"
            }
          ]
        },
        "options": {}
      },
      "id": "15586a83-cda8-4ac9-9826-9ed77f24fa1c",
      "name": "Update Product Adult Flag",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2496,
        3056
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "amount": 2
      },
      "id": "09ba4846-6da9-425c-a762-4f9f4bc1b4e6",
      "name": "Rate Limiting",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        2720,
        3152
      ],
      "webhookId": "77aa4d35-4b1e-410d-9f22-138e57a732c7",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "tableId": "workflow_runs",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "run_date",
              "fieldValue": "={{ $json.run_date }}"
            },
            {
              "fieldId": "shop_id",
              "fieldValue": "={{ $json.shop_id }}"
            },
            {
              "fieldId": "phase",
              "fieldValue": "={{ $json.phase }}"
            },
            {
              "fieldId": "products_processed",
              "fieldValue": "={{ $json.products_processed }}"
            },
            {
              "fieldId": "success_count",
              "fieldValue": "={{ $json.success_count }}"
            },
            {
              "fieldId": "approval_rate_after",
              "fieldValue": "={{ $json.approval_rate_after }}"
            }
          ]
        }
      },
      "id": "588efd00-c612-4bb9-9837-abab980e50ab",
      "name": "Save Workflow Run",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1584,
        3968
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE"
        },
        "sheetName": {
          "__rl": true,
          "mode": "name",
          "value": "üìù Daily_Log"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Timestamp": "={{ $json.run_date }}",
            "Shop": "={{ $json.shop_id }}",
            "Phase": "={{ $json.phase }}",
            "Products Processed": "={{ $json.products_processed }}",
            "Success Count": "={{ $json.success_count }}",
            "Failed Count": "={{ $json.failed_count }}",
            "Status": "={{ $json.created_at }}",
            "Action": "={{ $json.gemini_decision }}",
            "Details": "={{ $json.approval_rate_after }}"
          },
          "matchingColumns": [
            "Timestamp"
          ],
          "schema": [
            {
              "id": "Timestamp",
              "displayName": "Timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Shop",
              "displayName": "Shop",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Phase",
              "displayName": "Phase",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Action",
              "displayName": "Action",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Products Processed",
              "displayName": "Products Processed",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Success Count",
              "displayName": "Success Count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Failed Count",
              "displayName": "Failed Count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Details",
              "displayName": "Details",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false,
          "mappings": [
            {
              "column": "Timestamp",
              "value": "={{ $json.run_date }}"
            },
            {
              "column": "Shop",
              "value": "={{ $json.shop_name }}"
            },
            {
              "column": "Phase",
              "value": "={{ $json.phase }}"
            },
            {
              "column": "Action",
              "value": "Daily Run"
            },
            {
              "column": "Products Processed",
              "value": "={{ $json.products_processed }}"
            },
            {
              "column": "Success Count",
              "value": "={{ $json.success_count }}"
            },
            {
              "column": "Failed Count",
              "value": "={{ $json.failed_count }}"
            },
            {
              "column": "Status",
              "value": "={{ $json.status }}"
            },
            {
              "column": "Details",
              "value": "={{ $json.reasoning }}"
            }
          ]
        },
        "options": {}
      },
      "id": "108880c3-e17a-4976-bce9-9edef6a441a7",
      "name": "Log Results to Sheets",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.4,
      "position": [
        1824,
        4080
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "pbNsBLFTIuL9ArMn",
          "name": "Google Sheets"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "chatId": "8562069918:AAFtzEUzCDeUchzybcp2l9Cg4WZ0KBmsWzI",
        "text": "=ü§ñ GEMINI DAILY REPORT - {{ $json.shop_name }}\n\nüìä Phase: {{ $json.phase }}\n‚úÖ Verarbeitet: {{ $json.success_count }}\n‚ùå Fehler: {{ $json.failed_count }}\nüìà Approval Rate: {{ $json.approval_rate_after }}%\n\nüí° Reasoning: {{ $json.reasoning }}\n\nAlles OK? üëç",
        "additionalFields": {}
      },
      "id": "5e5a1e29-70f7-45bf-9d3f-80ec9efb83f7",
      "name": "Send Daily Report",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2256,
        4400
      ],
      "webhookId": "b5c4cc7d-d366-4cd7-ac2c-0a91ed811e96",
      "credentials": {
        "telegramApi": {
          "id": "CefgWOY6zLuQ1eyX",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "={{ $json.to }}",
        "subject": "={{ $json.subject }}",
        "message": "={{ $json.html }}",
        "options": {}
      },
      "id": "b8be1226-8b56-4499-927f-611b6d5f606a",
      "name": "Export Report to Gmail",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        2704,
        4400
      ],
      "webhookId": "da822d06-d1b7-4cfe-804f-5e778bedbac4",
      "credentials": {
        "gmailOAuth2": {
          "id": "piLkk7aEWM1RFevI",
          "name": "s24.mechtech@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyX",
              "value": 1,
              "unit": "minutes"
            }
          ]
        },
        "filters": {
          "labelIds": [
            "Label_4215695195142173388",
            "Label_2937160366021595910",
            "INBOX"
          ],
          "readStatus": "unread"
        }
      },
      "id": "cdb90d0d-ccc5-473c-94a8-ea3ac6adc09b",
      "name": "Import Commands from Gmail",
      "type": "n8n-nodes-base.gmailTrigger",
      "typeVersion": 1.3,
      "position": [
        480,
        3296
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "credentials": {
        "gmailOAuth2": {
          "id": "piLkk7aEWM1RFevI",
          "name": "s24.mechtech@gmail.com"
        }
      },
      "disabled": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "send",
        "recipientPhoneNumber": "<__PLACEHOLDER_VALUE__Expert WhatsApp Number__>",
        "textBody": "=üö® EXPERT ALERT - MECHTECH Merchant Center\n\nShop: {{ $json.shop_name }}\nPhase: {{ $json.phase }}\n\n‚ö†Ô∏è CRITICAL ISSUES:\n‚ùå Failed: {{ $json.failed_count }}\nüìâ Approval Rate: {{ $json.approval_rate_after }}%\n\nImmediate action required!\n\nDetails: {{ $json.reasoning }}",
        "additionalFields": {}
      },
      "id": "b1701b06-0047-42f9-8558-b9d2bf7453ad",
      "name": "Send WhatsApp Expert Alert",
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1.1,
      "position": [
        2704,
        4576
      ],
      "webhookId": "fd8ea9df-d0d5-4e11-a0df-a43a8e68297e",
      "disabled": true
    },
    {
      "parameters": {
        "updates": [
          "messages"
        ],
        "options": {}
      },
      "id": "dad0b159-2230-417c-9a99-35aad6692aa9",
      "name": "Import Commands from WhatsApp",
      "type": "n8n-nodes-base.whatsAppTrigger",
      "typeVersion": 1,
      "position": [
        480,
        3040
      ],
      "webhookId": "472f5025-2ce8-4fba-9322-7f5fe0256023",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "const data = $input.item.json; const html = `<h2>ü§ñ MECHTECH Merchant Center Daily Report</h2><h3>Shop: ${data.shop_name}</h3><table border='1' cellpadding='10'><tr><th>Metric</th><th>Value</th></tr><tr><td>Phase</td><td>${data.phase}</td></tr><tr><td>Products Processed</td><td>${data.products_processed}</td></tr><tr><td>Success Count</td><td>${data.success_count}</td></tr><tr><td>Failed Count</td><td>${data.failed_count}</td></tr><tr><td>Approval Rate</td><td>${data.approval_rate_after}%</td></tr><tr><td>Status</td><td>${data.status}</td></tr></table><p><strong>Reasoning:</strong> ${data.reasoning}</p><p><em>Generated: ${data.run_date}</em></p>`; return [{ json: { subject: `Daily Report - ${data.shop_name} - ${data.phase}`, html: html, to: '<__PLACEHOLDER_VALUE__Report Email Address__>' } }];"
      },
      "id": "f42a4d00-e073-42db-a62a-e6fc4afdea43",
      "name": "Format Report for Email",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2480,
        4384
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// FIXED: Only check SUBJECT for commands (ignore spam)\nconst input = $input.item.json;\n\n// Only use subject - ignore body/snippet to avoid spam\nconst subject = (input.subject || '').toLowerCase().trim();\n\n// Check if subject contains \"command\" keyword\nif (!subject.includes('command') && !subject.includes('mechtech')) {\n  // Not a command email - skip it\n  return [];\n}\n\n// Extract command from subject\nconst text = subject.replace('command:', '').replace('mechtech:', '').trim();\n\nlet action = 'unknown';\nlet params = {};\n\nif (text.includes('status')) {\n  action = 'get_status';\n} else if (text.includes('pause')) {\n  action = 'pause_workflow';\n} else if (text.includes('resume')) {\n  action = 'resume_workflow';\n} else if (text.includes('report')) {\n  action = 'send_report';\n} else if (text.includes('help')) {\n  action = 'show_help';\n} else if (text.includes('optimize')) {\n  action = 'run_optimization';\n  // Check which shop\n  if (text.includes('shop1') || text.includes('siliconedolls24')) {\n    params.shop = 'shop1';\n  } else if (text.includes('shop2') || text.includes('dreamdoll')) {\n    params.shop = 'shop2';\n  } else {\n    params.shop = 'both';\n  }\n} else {\n  // Unknown command\n  action = 'unknown';\n}\n\nreturn [{\n  json: {\n    action: action,\n    params: params,\n    original_text: text,\n    source: input.from || input.sender || 'unknown',\n    subject: input.subject || ''\n  }\n}];"
      },
      "id": "1508074b-8edb-4df0-86d3-9830444fb9e1",
      "name": "Parse Command Input",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        768,
        3168
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "id-1",
              "leftValue": "={{ $json.failed_count }}",
              "rightValue": 10,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            },
            {
              "id": "id-2",
              "leftValue": "={{ $json.approval_rate_after }}",
              "rightValue": 50,
              "operator": {
                "type": "number",
                "operation": "lt"
              }
            }
          ],
          "combinator": "or"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "3f130224-b8e7-4411-a208-572c46510fae",
      "name": "Check if Expert Needed",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        2480,
        4592
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.action }}",
                    "rightValue": "get_status",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "445605f9-402d-4973-9957-5754b69fb8fc"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Status"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "renameFallbackOutput": "Unknown Command"
        }
      },
      "id": "8d4d4848-43b2-4809-b459-1c262b31cd0d",
      "name": "Route Command",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        1072,
        3136
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "sendTo": "info@mechtech-support.com",
        "subject": "=",
        "emailType": "text",
        "message": "={{ $('Get Workflow Status REAL').item.json.error }}",
        "options": {}
      },
      "id": "45396118-d2da-455e-9a97-75cbabde112b",
      "name": "Send Command Response",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        1920,
        3152
      ],
      "webhookId": "5cf94981-2360-49f1-b7d4-6c512f562360",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "credentials": {
        "gmailOAuth2": {
          "id": "piLkk7aEWM1RFevI",
          "name": "s24.mechtech@gmail.com"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// FIX: PREPARE IMAGES LOOP - WORKING VERSION\n// ============================================================================\nconst inputData = $input.first().json;\nconst config = $('Shop Configuration2').first().json;\n\nconst productsToFix = inputData.products || [];\nconst maxProducts = inputData.products_to_process || productsToFix.length;\n\nconst shopId = inputData.shop_id || config.shop1_id;\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\nconst productsSlice = productsToFix.slice(0, maxProducts);\n\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    image_link: product.imageLink,\n    action: 'images',\n    priority: 'images',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
      },
      "id": "9bf990d0-1d87-4bbb-9153-46146b506ae6",
      "name": "Prepare Images Loop",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2272,
        3312
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $('Shop Configuration2').item.json.shop1_id }}/products/{{ $json.product.id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "imageLink",
              "value": "={{ $json.product.imageLink }}"
            }
          ]
        },
        "options": {}
      },
      "id": "3c250fa7-ca68-49fa-869d-1d0b1761a4b1",
      "name": "Update Product Images",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        2496,
        3248
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "amount": 2
      },
      "id": "bfed81ba-0dfb-4fd3-9161-3dadb6aebe1d",
      "name": "Rate Limiting Images",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        2720,
        3344
      ],
      "webhookId": "03758724-2fd2-4cf0-bc96-1ba04b9fa35c",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// FIX: PREPARE TEXT LOOP - WORKING VERSION\n// ============================================================================\nconst inputData = $input.first().json;\nconst config = $('Shop Configuration2').first().json;\n\nconst productsToFix = inputData.products || [];\nconst maxProducts = inputData.products_to_process || productsToFix.length;\n\nconst shopId = inputData.shop_id || config.shop1_id;\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\nconst productsSlice = productsToFix.slice(0, maxProducts);\n\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    description: product.description,\n    action: 'text',\n    priority: 'text',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
      },
      "id": "3245d64d-7810-44de-beaa-f97d55eb2274",
      "name": "Prepare Text Loop",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2272,
        3472
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $('Shop Configuration2').item.json.shop1_id }}/products/{{ $json.product.id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "title",
              "value": "={{ $json.product.title }}"
            },
            {
              "name": "description",
              "value": "={{ $json.product.description }}"
            }
          ]
        },
        "options": {}
      },
      "id": "34310e5a-2422-4ce3-a615-5b8f911b5407",
      "name": "Update Product Text",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        2496,
        3424
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "amount": 2
      },
      "id": "dcf77ef7-4f9b-4487-be98-b0480a6b9b2a",
      "name": "Rate Limiting Text",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        2720,
        3536
      ],
      "webhookId": "fade3537-0739-4667-80c9-7636461ed902",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const input = $input.item.json;\nconst invalidPriority = input.priority || 'unknown';\nconst reasoning = input.reasoning || 'No reasoning provided';\n\nconst errorResult = {\n  processed_count: 0,\n  failed_count: 0,\n  error: 'Invalid priority received from Gemini',\n  invalid_priority: invalidPriority,\n  gemini_reasoning: reasoning,\n  timestamp: new Date().toISOString(),\n  debug_info: {\n    expected_priorities: ['adult_flags', 'images', 'text'],\n    received_priority: invalidPriority,\n    full_gemini_response: input\n  }\n};\n\nreturn [{ json: errorResult }];"
      },
      "id": "80b0ee00-87d9-44ec-8b62-8c86eda7737b",
      "name": "Handle Invalid Priority",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1072,
        4096
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "shop1_id",
              "name": "shop1_id",
              "value": "5339977843",
              "type": "string"
            },
            {
              "id": "shop1_name",
              "name": "shop1_name",
              "value": "Siliconedolls24",
              "type": "string"
            },
            {
              "id": "shop2_id",
              "name": "shop2_id",
              "value": "124485833",
              "type": "string"
            },
            {
              "id": "shop2_name",
              "name": "shop2_name",
              "value": "DreamDoll",
              "type": "string"
            },
            {
              "id": "google_sheet_id",
              "name": "google_sheet_id",
              "value": "1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE",
              "type": "string"
            },
            {
              "id": "id-6",
              "name": "supabase_url",
              "value": "https://mxswxdnnjhhukovixzvb.supabase.co/functions/v1/database-access",
              "type": "string"
            },
            {
              "id": "id-7",
              "name": "supabase_key",
              "value": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im14c3d4ZG5uamhodWtvdml4enZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3OTM4NDAsImV4cCI6MjA3OTM2OTg0MH0.60grD1zV6gF7Uf80N8CG8eiEwMw3zY5KR0Q-KKvvSWQ",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "name": "Shop Configuration2",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        784,
        3584
      ],
      "id": "c56a220a-81d4-49e8-8f8b-70b5051f89d0",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "url": "=https://www.googleapis.com/content/v2.1/{{ $('Shop Configuration2').item.json.shop1_id }}/products?maxResults=100",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "options": {}
      },
      "name": "Get Merchant Products2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1072,
        3568
      ],
      "id": "39d79c98-55c7-418a-8c36-bce59d3efd3f",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const products = $input.item.json.resources || [];\nconst productsNeedingFix = products.filter(p => !p.adult);\nconst disapproved = products.filter(p => p.issues && p.issues.length > 0).length;\nconst approved = products.length - disapproved;\nconst approvalRate = products.length > 0 ? ((approved / products.length) * 100).toFixed(2) : 0;\n\nreturn [{\n  json: {\n    products_needing_fix: productsNeedingFix.slice(0, 100),\n    current_approval_rate: approvalRate,\n    total_products: products.length,\n    approved_count: approved,\n    disapproved_count: disapproved\n  }\n}];"
      },
      "id": "f49cb6b3-195b-42f6-a025-a0e78d62cfca",
      "name": "Analyze Products2",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1328,
        3568
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst processedCount = items.filter(i => i.json.processed_count !== undefined).reduce((sum, i) => sum + i.json.processed_count, 0);\nconst failedCount = items.filter(i => i.json.failed_count !== undefined).reduce((sum, i) => sum + i.json.failed_count, 0);\nconst config = $('Shop Configuration2').item.json;\nconst analysis = $('Analyze Products2').item.json;\nconst decision = $('Gemini Daily Decision').item.json;\n\nreturn [{\n  json: {\n    shop_id: config.shop1_id,\n    shop_name: config.shop1_name,\n    run_date: new Date().toISOString(),\n    phase: decision.priority || 'adult_flags',\n    products_processed: processedCount,\n    success_count: processedCount,\n    failed_count: failedCount,\n    approval_rate_before: analysis.current_approval_rate,\n    approval_rate_after: analysis.current_approval_rate,\n    reasoning: decision.reasoning || 'Processing products',\n    status: failedCount === 0 ? 'success' : 'partial_success'\n  }\n}];"
      },
      "id": "e8e880e8-557c-42e8-a95f-fb077510c508",
      "name": "Aggregate Results2",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1328,
        4080
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"priority\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"enum\": [\"adult_flags\", \"images\", \"text\"]\n\t\t},\n\t\t\"reasoning\": {\n\t\t\t\"type\": \"string\"\n\t\t},\n\t\t\"products_to_process\": {\n\t\t\t\"type\": \"number\"\n\t\t}\n\t},\n\t\"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}",
        "autoFix": true
      },
      "id": "984a5be4-d1fa-4229-aa5b-5a50528673ec",
      "name": "JSON Output Parser1",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        1824,
        3856
      ]
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// FIX: PREPARE MERCHANT QUALITY LOOP - WORKING VERSION\n// ============================================================================\nconst inputData = $input.first().json;\nconst config = $('Shop Configuration2').first().json;\n\nconst productsToFix = inputData.products || [];\nconst maxProducts = inputData.products_to_process || productsToFix.length;\n\nconst shopId = inputData.shop_id || config.shop1_id;\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\nconst productsSlice = productsToFix.slice(0, maxProducts);\n\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    action: 'merchant_quality',\n    priority: 'merchant_quality',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
      },
      "name": "Prepare Merchant Quality Loop",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2272,
        3648
      ],
      "id": "92b514de-5cd0-4f79-9857-123e685a1405",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/shippingsettings",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"accountId\": \"{{ $json.shop_id }}\",\n  \"services\": [{\n    \"name\": \"Standard Shipping\",\n    \"active\": true,\n    \"deliveryCountry\": \"DE\",\n    \"deliveryTime\": {\n      \"minHandlingTimeInDays\": 1,\n      \"maxHandlingTimeInDays\": 3,\n      \"minTransitTimeInDays\": 2,\n      \"maxTransitTimeInDays\": 5\n    },\n    \"rateGroups\": [{\n      \"singleValue\": {\n        \"flatRate\": {\n          \"value\": \"0\",\n          \"currency\": \"EUR\"\n        }\n      }\n    }]\n  }]\n}",
        "options": {}
      },
      "name": "Update Merchant Settings",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2512,
        3600
      ],
      "id": "3ad28c6f-6828-483e-a696-c83bd1382966",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "amount": 2
      },
      "name": "Rate Limiting Merchant",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        2720,
        3728
      ],
      "id": "3226b31b-79d4-4877-9432-a192258a6099",
      "webhookId": "rate-limit-merchant-webhook",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// PREPARE MULTI COUNTRY LOOP - SEQUENTIELLE VERARBEITUNG\n// ============================================================================\nconst inputItem = $input.first().json;\nconst config = $('Shop Configuration2').first().json;\n\n// Multi-Country Logik - sequenziell verarbeiten (ein Item)\nreturn {\n  json: {\n    ...inputItem,\n    action: 'multi_country',\n    priority: 'multi_country',\n    multi_country_processed: true,\n    countries: inputItem.countries || inputItem.countries_from_gemini || [],\n    shipping: inputItem.shipping || []\n  }\n};"
      },
      "name": "Prepare Multi Country Loop",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2272,
        3856
      ],
      "id": "40a1e96b-15f2-4eb0-bdad-bd7532b02a22",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/products/{{ $json.product_id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"destinations\": [\n    {{ $json.countries.map(c => `{\"destinationName\": \"Shopping_ads\", \"country\": \"${c}\"}`).join(',') }}\n  ],\n  \"shipping\": [\n    {{ $json.countries.map(c => `{\"country\": \"${c}\", \"price\": {\"value\": \"0\", \"currency\": \"EUR\"}}`).join(',') }}\n  ]\n}",
        "options": {}
      },
      "name": "Update Country Feeds",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2496,
        3808
      ],
      "id": "3c873a42-3df1-4f70-89a4-08a7391cf78e",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "amount": 2
      },
      "name": "Rate Limiting Country",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        2720,
        3920
      ],
      "id": "62a07200-0815-4098-869a-8ec5fa3927f5",
      "webhookId": "rate-limit-country-webhook",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "adult_flags",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "adult-flags-condition"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Adult Flags"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "images",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "images-condition"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Images"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "text",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "text-condition"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "merchant_quality",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "merchant-quality-condition"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Merchant Quality"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "multi_country",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "multi-country-condition"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Multi Country"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b85d4e72-545e-46d6-9d63-bb8819eeffb5",
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "multi_gtn_ean",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Multi GTN/EAN"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "renameFallbackOutput": "Fallback"
        }
      },
      "name": "Route by Priority",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        1936,
        3440
      ],
      "id": "d4b56adf-ee7f-4c31-91ff-22d64ef182a0",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "url": "=https://www.googleapis.com/content/v2.1/{{ $('Shop Configuration2').item.json.shop2_id }}/products?maxResults=250",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "options": {}
      },
      "name": "Get Merchant Products Shop2",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1072,
        3760
      ],
      "id": "07c684bc-18ff-493d-833f-4fc1a26e2cca",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Shop Configuration2').item.json.supabase_url }}/rest/v1/products",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $('Shop Configuration2').item.json.supabase_key }}"
            },
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('Shop Configuration2').item.json.supabase_key }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Prefer",
              "value": "resolution=merge-duplicates"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"shop_id\": \"{{ $json.shop_id }}\",\n  \"shop_name\": \"{{ $json.shop_name }}\",\n  \"shop_url\": \"{{ $json.shop_id === '5339977843' ? 'www.siliconedolls24.com' : 'www.dreamdoll.de' }}\",\n  \"product_id\": \"{{ $json.product_id }}\",\n  \"offer_id\": \"{{ $json.offer_id }}\",\n  \"title\": \"{{ $json.title }}\",\n  \"image_link\": \"{{ $json.image_link || '' }}\",\n  \"adult_flag_set\": {{ $json.action === 'adult_flags' || $json.priority === 'adult_flags' ? 'true' : 'false' }},\n  \"text_sanitized\": {{ $json.action === 'text' || $json.priority === 'text' ? 'true' : 'false' }},\n  \"image_optimized\": {{ $json.action === 'images' || $json.priority === 'images' ? 'true' : 'false' }},\n  \"feed_optimized\": true,\n  \"shipping_set\": {{ $json.action === 'merchant_quality' || $json.priority === 'merchant_quality' ? 'true' : 'false' }},\n  \"returns_set\": {{ $json.action === 'merchant_quality' || $json.priority === 'merchant_quality' ? 'true' : 'false' }},\n  \"tax_set\": {{ $json.action === 'merchant_quality' || $json.priority === 'merchant_quality' ? 'true' : 'false' }},\n  \"multi_country\": {{ $json.action === 'multi_country' || $json.priority === 'multi_country' ? 'true' : 'false' }},\n  \"status\": \"SUCCESS\",\n  \"last_optimized_at\": \"{{ $now.toISO() }}\"\n}",
        "options": {}
      },
      "name": "Save to Supabase Products",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2256,
        4768
      ],
      "id": "725473eb-3d1e-4d65-84cf-084cc1c521fb",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "waitBetweenTries": 3000,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Shop Configuration2').item.json.supabase_url }}/rest/v1/rpc/update_pattern_success",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $('Shop Configuration2').item.json.supabase_key }}"
            },
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('Shop Configuration2').item.json.supabase_key }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"p_pattern_type\": \"{{ $json.action || $json.priority }}\",\n  \"p_success\": true\n}",
        "options": {}
      },
      "name": "Update Optimization Patterns",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2480,
        4768
      ],
      "id": "12c519ef-b6b4-4f07-86b6-0bb9dc47f074",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1R1fYQTswbGBDzLoizyTNPKVLup1ie0_ksqBTLc5E48s/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1181382825,
          "mode": "list",
          "cachedResultName": "üß† AI_Learning",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1R1fYQTswbGBDzLoizyTNPKVLup1ie0_ksqBTLc5E48s/edit#gid=1181382825"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "Timestamp",
              "displayName": "Timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Problem_Type",
              "displayName": "Problem_Type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Human_Instruction",
              "displayName": "Human_Instruction",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "AI_Solution",
              "displayName": "AI_Solution",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Success_Rate",
              "displayName": "Success_Rate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Applied_Count",
              "displayName": "Applied_Count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Pattern_ID",
              "displayName": "Pattern_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "name": "Get Human Instructions",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.4,
      "position": [
        1328,
        4288
      ],
      "id": "42e30df8-bb6a-4410-a1aa-35d8be0f9ddb",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "cztAb4CKfRPRO8KX",
          "name": "Google Sheets account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// Filter nur Zeilen MIT Instructions und OHNE AI Response\nconst items = $input.all();\n\nconst needsProcessing = items.filter(item => {\n  const instruction = item.json.Human_Instructions;\n  const aiResponse = item.json.AI_Response;\n  return instruction && instruction.trim() !== '' && (!aiResponse || aiResponse.trim() === '');\n});\n\nif (needsProcessing.length === 0) {\n  // Keine Instructions zu verarbeiten\n  return [];\n}\n\nreturn needsProcessing;"
      },
      "name": "Filter Unprocessed Instructions",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1584,
        4208
      ],
      "id": "02c7b8d8-d36f-4ef9-866e-069bf77eddbf",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=HUMAN INSTRUCTION:\nProdukt: {{ $json.Title }}\nProdukt ID: {{ $json.Product_ID }}\nAnweisung: {{ $json.Human_Instructions }}\n\nAnalysiere die Anweisung und:\n1. Erstelle L√∂sung\n2. Finde √§hnliche Produkte\n3. Gib Pattern-Type an\n4. Confidence Score (0-100)\n\nAntworte als JSON!",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "Du bist der Learning Agent f√ºr MECHTECH!\n\nDeine Aufgabe:\n1. Lese Human Instructions aus Google Sheets\n2. Verstehe was der Mensch will\n3. Erstelle Pattern/L√∂sung\n4. Wende auf √§hnliche Produkte an\n5. Speichere Learning in Supabase\n\nWenn Mensch Fehler macht:\n- Erkenne es!\n- Gib freundlichen Hinweis\n- Schlage bessere L√∂sung vor\n\nAntworte IMMER als JSON:\n{\n  \"ai_response\": \"Deine Antwort an den Menschen\",\n  \"solution\": \"Was du tun wirst\",\n  \"pattern_type\": \"adult_flags|text|images|merchant_quality|multi_country/multi gtn/ean\",\n  \"ai_confidence\": 85,\n  \"apply_to_similar\": true,\n  \"similar_keywords\": [\"keyword1\", \"keyword2\"],\n  \"warning\": \"Optional: Wenn Mensch Fehler macht\"\n}"
        }
      },
      "name": "Process Instructions with Gemini",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        1824,
        4320
      ],
      "id": "f2b6a65c-9975-4082-afbc-91acf0a73604",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash-exp",
        "options": {}
      },
      "name": "Gemini Model Learning",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1824,
        4528
      ],
      "id": "55f39251-adad-438f-975f-011c7a1497d6",
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {},
      "name": "JSON Parser Learning",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        1968,
        4576
      ],
      "id": "1faa2330-99e5-4acd-8253-a9d6dd30c5bd"
    },
    {
      "parameters": {
        "jsCode": "// Apply solution to similar products\nconst instruction = $input.item.json;\nconst geminiResponse = $('Process Instructions with Gemini').item.json;\n\nif (!geminiResponse.apply_to_similar) {\n  return [{\n    json: {\n      ...instruction,\n      ai_response: geminiResponse.ai_response,\n      ai_confidence: geminiResponse.ai_confidence,\n      applied_to_similar: 0\n    }\n  }];\n}\n\n// Get all products from previous steps\nconst allProducts = $('Get Merchant Products2').all();\nconst keywords = geminiResponse.similar_keywords || [];\n\n// Find similar products\nconst similarProducts = allProducts.filter(p => {\n  const title = (p.json.title || '').toLowerCase();\n  return keywords.some(keyword => title.includes(keyword.toLowerCase()));\n});\n\nreturn [{\n  json: {\n    ...instruction,\n    ai_response: geminiResponse.ai_response,\n    ai_confidence: geminiResponse.ai_confidence,\n    applied_to_similar: similarProducts.length,\n    similar_product_ids: similarProducts.map(p => p.json.id),\n    pattern_type: geminiResponse.pattern_type,\n    solution: geminiResponse.solution,\n    warning: geminiResponse.warning || null\n  }\n}];"
      },
      "name": "Apply to Similar Products",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2256,
        4960
      ],
      "id": "8bccc6c6-1e34-426d-80cb-90fadf6082e0",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "={{ $('Shop Configuration2').item.json.sheet_id }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $json.shop_url || 'www.siliconedolls24.com' }}",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false,
          "mappings": [
            {
              "column": "AI_Response",
              "value": "={{ $json.ai_response }}"
            },
            {
              "column": "AI_Confidence",
              "value": "={{ $json.ai_confidence }}"
            },
            {
              "column": "Applied_To_Similar",
              "value": "={{ $json.applied_to_similar }}"
            }
          ]
        },
        "options": {}
      },
      "name": "Update Sheet with AI Response",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.4,
      "position": [
        2480,
        4960
      ],
      "id": "c77cdd70-7296-45e8-b454-d5d9a766f365",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "cztAb4CKfRPRO8KX",
          "name": "Google Sheets account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('Shop Configuration2').item.json.supabase_url }}/rest/v1/human_instructions",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $('Shop Configuration2').item.json.supabase_key }}"
            },
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('Shop Configuration2').item.json.supabase_key }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"product_id\": \"{{ $json.Product_ID }}\",\n  \"shop_id\": \"{{ $json.shop_id }}\",\n  \"instruction\": \"{{ $json.Human_Instructions }}\",\n  \"instruction_type\": \"{{ $json.pattern_type }}\",\n  \"ai_response\": \"{{ $json.ai_response }}\",\n  \"ai_confidence\": {{ $json.ai_confidence }},\n  \"ai_action_taken\": \"{{ $json.solution }}\",\n  \"applied_to_similar\": {{ $json.applied_to_similar }},\n  \"status\": \"EXECUTED\",\n  \"executed_at\": \"{{ $now.toISO() }}\"\n}",
        "options": {}
      },
      "name": "Save Learning to Supabase",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2704,
        4960
      ],
      "id": "46929706-525b-42d0-adb4-1ec1932a2249",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "url": "=https://mxswxdnnjhhukovixzvb.supabase.co/rest/v1/workflow_status?select=*&order=created_at.desc&limit=100",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "=id",
              "value": "={{ $json.id }}"
            },
            {
              "name": "run_date",
              "value": "={{ $json.run_date }}"
            },
            {
              "name": "shop_id",
              "value": "={{ $json.shop_id }}"
            },
            {
              "name": "shop_name",
              "value": "={{ $json.shop_name }}"
            },
            {
              "name": "phase",
              "value": "={{ $json.phase }}"
            },
            {
              "name": "products_processed",
              "value": "={{ $json.products_processed }}"
            },
            {
              "name": "success_count",
              "value": "={{ $json.success_count }}"
            },
            {
              "name": "failed_count",
              "value": "={{ $json.failed_count }}"
            },
            {
              "name": "budget_used",
              "value": "={{ $json.budget_used }}"
            },
            {
              "name": "duration_seconds",
              "value": "={{ $json.duration_seconds }}"
            },
            {
              "name": "gemini_decision",
              "value": "={{ $json.gemini_decision }}"
            },
            {
              "name": "approval_rate_before",
              "value": "={{ $json.approval_rate_before }}"
            },
            {
              "name": "approval_rate_after",
              "value": "={{ $json.approval_rate_after }}"
            },
            {
              "name": "created_at",
              "value": "={{ $json.created_at }}"
            },
            {
              "name": "updated_at",
              "value": "={{ $json.updated_at }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "name": "Get Workflow Status REAL",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1344,
        3248
      ],
      "id": "24dfb842-786a-45ed-89bf-a8cf8b2b15af",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      },
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// FIXED VERSION - handles both array and object responses\nconst response = $input.item.json;\n\n// Check if response is array or needs to be wrapped\nlet decisions = Array.isArray(response) ? response : (response.data || [response]);\n\n// Filter out empty/null entries\ndecisions = decisions.filter(d => d && d.created_at);\n\nif (!decisions || decisions.length === 0) {\n  return [{\n    json: {\n      response: 'üìä MECHTECH Status\\n\\n‚ùå Noch keine Daten!\\n\\nWorkflow l√§uft t√§glich alle 4 Stunden.',\n      recipient: $('Parse Command Input').item.json.source,\n      subject: 'MECHTECH Status Report'\n    }\n  }];\n}\n\nconst lastRun = decisions[0];\nconst total = decisions.reduce((sum, d) => sum + (d.products_processed || 0), 0);\nconst successRate = total > 0 \n  ? ((decisions.reduce((sum, d) => sum + (d.success_count || 0), 0) / total) * 100).toFixed(1)\n  : 0;\n\nconst responseText = `üìä MECHTECH WORKFLOW STATUS\n\n‚úÖ Letzte Ausf√ºhrung:\n- Shop: ${lastRun.shop_name || 'N/A'}\n- Datum: ${new Date(lastRun.created_at).toLocaleString('de-DE')}\n- Phase: ${lastRun.decision_type || 'N/A'}\n- Produkte: ${lastRun.products_processed || 0}\n- Erfolge: ${lastRun.success_count || 0}\n\nüìà Letzte ${decisions.length} Runs:\n- Total Produkte: ${total}\n- Success Rate: ${successRate}%\n- Kosten: ‚Ç¨0.00\n\n‚è∞ N√§chster Run: T√§glich 2:00 AM\n\nüí° Commands:\n- status: Aktueller Status\n- report: Vollst√§ndiger Report\n- help: Hilfe`;\n\nreturn [{\n  json: {\n    response: responseText,\n    recipient: $('Parse Command Input').item.json.source,\n    subject: 'MECHTECH Status Report'\n  }\n}];"
      },
      "name": "Format Status Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1616,
        3232
      ],
      "id": "4bd56d4b-4f4e-4696-b41b-e9937892618d",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        864,
        4240
      ],
      "id": "04a8f30d-72eb-494b-87ec-faff1ecf2a2b",
      "name": "MCP Client"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        160,
        3648
      ],
      "id": "c105a095-1fad-40c3-a323-e631b53cb6bd",
      "name": "When clicking ‚ÄòExecute workflow‚Äô"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 4
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        144,
        3872
      ],
      "id": "fa6bd48c-91d5-4e16-8bc3-f102df17f4e1",
      "name": "Schedule Trigger",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Current Approval Rate: {{ $json.current_approval_rate }}%. Products needing fix: {{ $json.products_needing_fix.length }}. Total products: {{ $json.total_products }}. Approved: {{ $json.approved_count }}. Disapproved: {{ $json.disapproved_count }}.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "\"Update Gemini System Prompt im Workflow:\n\nDu bist Gemini f√ºr MECHTECH Merchant Center.\n\nT√ÑGLICHE AUFGABE:\n1. Lade Produkte aus Shop (5339977843 + 124485833)\n2. Analysiere jeden Artikel:\n   - Hat Adult Flag? (adult: true, ageGroup: adult)\n   - GTIN/EAN vorhanden?\n   - Text ok? (keine expliziten Begriffe)\n   - Bilder ok? (Explicitness < 70)\n   - Country Feeds ok?\n\n3. Entscheide PRIORIT√ÑT:\n   - Phase 1: Fehlende Adult Flags ‚Üí SOFORT!\n   - Phase 2: Schlechte Texte ‚Üí dann\n   - Phase 3: Bilder problematisch ‚Üí zuletzt\n   - Phase 4: GTIN/EAN fehlt ‚Üí parallel\n\n4. Pro Phase OUTPUT:\n\n{\n  'phase': 'adult_flags|text|images|gtin',\n  'products_count': XXX,\n  'products': [\n    {\n      'sku': 'ABC123',\n      'action': 'set_adult_flag|sanitize_text|check_images|fix_gtin',\n      'current_value': '...',\n      'new_value': '...',\n      'reason': 'Adult content in description',\n      'confidence': 85,\n      'cost': '‚Ç¨0.00'\n    }\n  ],\n  'quality_score_before': 45,\n  'quality_score_after': 52,\n  'approval_rate_before': '0,06%',\n  'approval_rate_after': '1,2%',\n  'estimated_time': '15 min',\n  'next_phase': 'sanitize_text'\n}\n\n5. WICHTIG:\n   - Kostenlos? Wenn NEIN ‚Üí Frag!\n   - Adult Flags = UNBEGRENZT\n   - Text Fix = KOSTENLOS\n   - Bilder = Max 33/Tag\n   - GTIN/EAN = Lookup oder identifier_exists=false\n   - Logging zu Supabase + Sheets\n\n6. REGELN:\n   - Niemals: Preise, Delete, Verf√ºgbarkeit √§ndern\n   - Immer: Adult Flag setzen!\n   - Langsam aber stetig\n   - Logs schreiben vor Update!\n\n7. ERFOLGS-Meldung (KEINE Errors):\n   - An: info@mechtech-support.com\n   - Format: Daily Success Report\n   - Nur Erfolge, keine Errors!\""
        }
      },
      "id": "d693f698-d40b-46a1-88df-ab9dd01765bf",
      "name": "Gemini Daily Decision",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        1552,
        3552
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "id": "aa5fcfd4-61e9-4522-8e08-fc5739fd1fd7",
      "name": "Gemini flash_2.0",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1360,
        3760
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        1472,
        3760
      ],
      "id": "6a4002e5-0908-41de-bd03-1dc359e33cbe",
      "name": "MCP Client1"
    },
    {
      "parameters": {
        "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        1600,
        3760
      ],
      "id": "69313a23-245e-4812-8f0d-6a0f49f9ae46",
      "name": "Supabase RAG Context",
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2080,
        4000
      ],
      "id": "81c65263-dd9c-47ce-bb36-5ef2c918c51f",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/products/{{ $json.product_id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "options": {}
      },
      "name": "Update GTN/EAN",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2496,
        4112
      ],
      "id": "7a01b7e8-3184-4982-92f4-a0ba03f781a4",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "amount": 2
      },
      "name": "Rate Limiting GTN/EAN",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        2720,
        4208
      ],
      "id": "65ca06d9-ae1b-4669-ba03-4418312d0442",
      "webhookId": "rate-limit-country-webhook",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// PREPARE GTIN/EAN LOOP - F√ºr Gemini GTIN/EAN Updates\n// ============================================================================\nconst inputData = $input.first().json;\nconst config = $('Shop Configuration2').first().json;\n\n// ‚úÖ Hole Products von Analyze Products2:\nconst analysis = $('Analyze Products2').first().json;\nconst productsToFix = analysis.products_needing_fix || [];\n\n// ‚úÖ Hole Priority und Max Products von Gemini Decision:\nconst decision = $('Gemini Daily Decision').first().json.output || {};\nconst maxProducts = decision.products_to_process || productsToFix.length;\n\n// ‚úÖ Shop ID von Decision ODER Config:\nconst shopId = decision.shop_id || config.shop1_id;\n\n// ‚úÖ Shop Info aus Config:\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\n// Filtere nur Products die GTIN/EAN Updates brauchen\nconst productsNeedingGtinEan = productsToFix.filter(product => {\n  // Pr√ºfe ob Gemini empfohlen hat GTIN/EAN zu aktualisieren\n  return product.needs_gtin_ean === true || \n         product.missing_gtin === true || \n         product.missing_mpn === true ||\n         product.missing_brand === true ||\n         (product.priority && product.priority === 'multi_gtn_ean');\n});\n\n// Slice f√ºr Batch Processing\nconst productsSlice = productsNeedingGtinEan.slice(0, maxProducts);\n\n// ‚úÖ Erstelle Items mit GTIN/EAN Daten:\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    \n    // GTIN/EAN Daten (von Gemini oder Product)\n    gtin: product.gtin || product.gtin_from_gemini || product.recommended_gtin || '',\n    mpn: product.mpn || product.mpn_from_gemini || product.recommended_mpn || '',\n    brand: product.brand || product.brand_from_gemini || product.recommended_brand || '',\n    \n    action: 'gtin_ean',\n    priority: 'multi_gtn_ean',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
      },
      "name": "Prepare GTN/EAN_Loop",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2272,
        4176
      ],
      "id": "f0a9ce99-2f4c-4baf-857a-02c81d0cae4d",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE"
        },
        "sheetName": {
          "__rl": true,
          "mode": "list",
          "value": "üìù Daily_Log"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Timestamp": "={{ $json.run_date }}",
            "Shop": "={{ $json.shop_id }}",
            "Phase": "={{ $json.phase }}",
            "Products Processed": "={{ $json.products_processed }}",
            "Success Count": "={{ $json.success_count }}",
            "Failed Count": "={{ $json.failed_count }}",
            "Status": "={{ $json.created_at }}",
            "Action": "={{ $json.gemini_decision }}",
            "Details": "={{ $json.approval_rate_after }}"
          },
          "matchingColumns": [
            "Timestamp"
          ],
          "schema": [
            {
              "id": "Timestamp",
              "displayName": "Timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Shop",
              "displayName": "Shop",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Phase",
              "displayName": "Phase",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Action",
              "displayName": "Action",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Products Processed",
              "displayName": "Products Processed",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Success Count",
              "displayName": "Success Count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Failed Count",
              "displayName": "Failed Count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Details",
              "displayName": "Details",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false,
          "mappings": [
            {
              "column": "Timestamp",
              "value": "={{ $json.run_date }}"
            },
            {
              "column": "Shop",
              "value": "={{ $json.shop_name }}"
            },
            {
              "column": "Phase",
              "value": "={{ $json.phase }}"
            },
            {
              "column": "Action",
              "value": "Daily Run"
            },
            {
              "column": "Products Processed",
              "value": "={{ $json.products_processed }}"
            },
            {
              "column": "Success Count",
              "value": "={{ $json.success_count }}"
            },
            {
              "column": "Failed Count",
              "value": "={{ $json.failed_count }}"
            },
            {
              "column": "Status",
              "value": "={{ $json.status }}"
            },
            {
              "column": "Details",
              "value": "={{ $json.reasoning }}"
            }
          ]
        },
        "options": {}
      },
      "id": "4d05ceb8-9f63-4593-bc11-609b83f7f012",
      "name": "Log Results_Sheets_01",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.4,
      "position": [
        3072,
        4400
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "pbNsBLFTIuL9ArMn",
          "name": "Google Sheets"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.emailReadImap",
      "typeVersion": 2.1,
      "position": [
        160,
        3424
      ],
      "id": "4aafec14-c1cf-4b56-a311-a808641ba07a",
      "name": "Email Trigger (IMAP)1",
      "credentials": {
        "imap": {
          "id": "CdpePT9CweqekWEC",
          "name": "IMAP info@mechtech-support.com"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "gemini-error-adult-1766027265946",
      "name": "Gemini Error Handler Adult Flags",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3264,
        3184
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "gemini-error-images-1766027265947",
      "name": "Gemini Error Handler Images",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3264,
        3376
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "gemini-error-text-1766027265947",
      "name": "Gemini Error Handler Text",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3264,
        3568
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "gemini-error-quality-1766027265948",
      "name": "Gemini Error Handler Merchant Quality",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3264,
        3760
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "gemini-error-country-1766027265948",
      "name": "Gemini Error Handler Multi Country",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3264,
        3968
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "gemini-error-gtnean-1766027265949",
      "name": "Gemini Error Handler GTN/EAN",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3264,
        4240
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "string": [
                  {
                    "value1": "={{ $json.error && ($json.error.code === 429 || $json.error.code === 400 || $json.error.code === 500) }}",
                    "operation": "equals",
                    "value2": "true"
                  }
                ]
              },
              "renameOutput": "Error"
            }
          ]
        },
        "options": {},
        "mode": "rules",
        "fallbackOutput": 1
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        3728,
        3200
      ],
      "id": "switch-action-adult-flags",
      "name": "Switch Action Handler Adult Flags",
      "alwaysOutputData": true,
      "retryOnFail": true
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "string": [
                  {
                    "value1": "={{ $json.error && ($json.error.code === 429 || $json.error.code === 400 || $json.error.code === 500) }}",
                    "operation": "equals",
                    "value2": "true"
                  }
                ]
              },
              "renameOutput": "Error"
            }
          ]
        },
        "options": {},
        "mode": "rules",
        "fallbackOutput": 1
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        3728,
        3392
      ],
      "id": "switch-action-images",
      "name": "Switch Action Handler Images"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "string": [
                  {
                    "value1": "={{ $json.error && ($json.error.code === 429 || $json.error.code === 400 || $json.error.code === 500) }}",
                    "operation": "equals",
                    "value2": "true"
                  }
                ]
              },
              "renameOutput": "Error"
            }
          ]
        },
        "options": {},
        "mode": "rules",
        "fallbackOutput": 1
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        3728,
        3600
      ],
      "id": "switch-action-text",
      "name": "Switch Action Handler Text"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "string": [
                  {
                    "value1": "={{ $json.error && ($json.error.code === 429 || $json.error.code === 400 || $json.error.code === 500) }}",
                    "operation": "equals",
                    "value2": "true"
                  }
                ]
              },
              "renameOutput": "Error"
            }
          ]
        },
        "options": {},
        "mode": "rules",
        "fallbackOutput": 1
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        3728,
        3792
      ],
      "id": "switch-action-merchant-quality",
      "name": "Switch Action Handler Merchant Quality"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "string": [
                  {
                    "value1": "={{ $json.error && ($json.error.code === 429 || $json.error.code === 400 || $json.error.code === 500) }}",
                    "operation": "equals",
                    "value2": "true"
                  }
                ]
              },
              "renameOutput": "Error"
            }
          ]
        },
        "options": {},
        "mode": "rules",
        "fallbackOutput": 1
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        3728,
        4000
      ],
      "id": "switch-action-multi-country",
      "name": "Switch Action Handler Multi Country"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "string": [
                  {
                    "value1": "={{ $json.error && ($json.error.code === 429 || $json.error.code === 400 || $json.error.code === 500) }}",
                    "operation": "equals",
                    "value2": "true"
                  }
                ]
              },
              "renameOutput": "Error"
            }
          ]
        },
        "options": {},
        "mode": "rules",
        "fallbackOutput": 1
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        3728,
        4192
      ],
      "id": "switch-action-gtn-ean",
      "name": "Switch Action Handler GTN/EAN"
    }
  ],
  "connections": {
    "Chat Trigger (RAG Query)": {
      "main": [
        [
          {
            "node": "Chat Agent (RAG)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Chat Model (RAG)": {
      "ai_languageModel": [
        [
          {
            "node": "Chat Agent (RAG)",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Embeddings (RAG)": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store (Retrieve)",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "Chat Agent (RAG)",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Check Last Run": {
      "main": [
        [
          {
            "node": "Get Merchant Products Shop2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Merchant Products2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Workflow Status REAL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Products Loop": {
      "main": [
        [
          {
            "node": "Prepare Images Loop",
            "type": "main",
            "index": 0
          },
          {
            "node": "Update Product Adult Flag",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Product Adult Flag": {
      "main": [
        [
          {
            "node": "Rate Limiting",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rate Limiting": {
      "main": [
        [
          {
            "node": "Prepare Products Loop",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results_Sheets_01",
            "type": "main",
            "index": 0
          },
          {
            "node": "Save to Supabase Products",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          },
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Gemini Error Handler Adult Flags",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Workflow Run": {
      "main": [
        [
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log Results to Sheets": {
      "main": [
        [
          {
            "node": "Send Daily Report",
            "type": "main",
            "index": 0
          },
          {
            "node": "Save to Supabase Products",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Daily Report": {
      "main": [
        [
          {
            "node": "Format Report for Email",
            "type": "main",
            "index": 0
          },
          {
            "node": "Check if Expert Needed",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Import Commands from Gmail": {
      "main": [
        [
          {
            "node": "Parse Command Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Import Commands from WhatsApp": {
      "main": [
        [
          {
            "node": "Parse Command Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Report for Email": {
      "main": [
        [
          {
            "node": "Export Report to Gmail",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Command Input": {
      "main": [
        [
          {
            "node": "Route Command",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check if Expert Needed": {
      "main": [
        [
          {
            "node": "Send WhatsApp Expert Alert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route Command": {
      "main": [
        [
          {
            "node": "Shop Configuration2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Workflow Status REAL",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Command Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Images Loop": {
      "main": [
        [
          {
            "node": "Prepare Text Loop",
            "type": "main",
            "index": 0
          },
          {
            "node": "Update Product Images",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Product Images": {
      "main": [
        [
          {
            "node": "Rate Limiting Images",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rate Limiting Images": {
      "main": [
        [
          {
            "node": "Prepare Images Loop",
            "type": "main",
            "index": 0
          },
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results_Sheets_01",
            "type": "main",
            "index": 0
          },
          {
            "node": "Save to Supabase Products",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          },
          {
            "node": "Gemini Error Handler Images",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Text Loop": {
      "main": [
        [
          {
            "node": "Prepare Merchant Quality Loop",
            "type": "main",
            "index": 0
          },
          {
            "node": "Update Product Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Product Text": {
      "main": [
        [
          {
            "node": "Rate Limiting Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rate Limiting Text": {
      "main": [
        [
          {
            "node": "Prepare Text Loop",
            "type": "main",
            "index": 0
          },
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results_Sheets_01",
            "type": "main",
            "index": 0
          },
          {
            "node": "Save to Supabase Products",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          },
          {
            "node": "Gemini Error Handler Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Handle Invalid Priority": {
      "main": [
        [
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Shop Configuration2": {
      "main": [
        [
          {
            "node": "Check Last Run",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Merchant Products Shop2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Merchant Products2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Merchant Products2": {
      "main": [
        [
          {
            "node": "Analyze Products2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze Products2": {
      "main": [
        [
          {
            "node": "Gemini Daily Decision",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate Results2": {
      "main": [
        [
          {
            "node": "Save Workflow Run",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Human Instructions",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Workflow Status REAL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "JSON Output Parser1": {
      "ai_outputParser": [
        [
          {
            "node": "Gemini Daily Decision",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Merchant Quality Loop": {
      "main": [
        [
          {
            "node": "Prepare Multi Country Loop",
            "type": "main",
            "index": 0
          },
          {
            "node": "Update Merchant Settings",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Merchant Settings": {
      "main": [
        [
          {
            "node": "Rate Limiting Merchant",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Multi Country Loop": {
      "main": [
        [
          {
            "node": "Prepare GTN/EAN_Loop",
            "type": "main",
            "index": 0
          },
          {
            "node": "Update Country Feeds",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Country Feeds": {
      "main": [
        [
          {
            "node": "Rate Limiting Country",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rate Limiting Merchant": {
      "main": [
        [
          {
            "node": "Prepare Merchant Quality Loop",
            "type": "main",
            "index": 0
          },
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Save to Supabase Products",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results_Sheets_01",
            "type": "main",
            "index": 0
          },
          {
            "node": "Gemini Error Handler Merchant Quality",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rate Limiting Country": {
      "main": [
        [
          {
            "node": "Prepare Multi Country Loop",
            "type": "main",
            "index": 0
          },
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results_Sheets_01",
            "type": "main",
            "index": 0
          },
          {
            "node": "Save to Supabase Products",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          },
          {
            "node": "Gemini Error Handler Multi Country",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route by Priority": {
      "main": [
        [
          {
            "node": "Prepare Products Loop",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare Images Loop",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare Text Loop",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare Merchant Quality Loop",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare Multi Country Loop",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare GTN/EAN_Loop",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Handle Invalid Priority",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Merchant Products Shop2": {
      "main": [
        [
          {
            "node": "Analyze Products2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save to Supabase Products": {
      "main": [
        [
          {
            "node": "Update Optimization Patterns",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Optimization Patterns": {
      "main": [
        [
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Human Instructions": {
      "main": [
        [
          {
            "node": "Filter Unprocessed Instructions",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Unprocessed Instructions": {
      "main": [
        [
          {
            "node": "Process Instructions with Gemini",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Instructions with Gemini": {
      "main": [
        [
          {
            "node": "Apply to Similar Products",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Model Learning": {
      "ai_languageModel": [
        [
          {
            "node": "Process Instructions with Gemini",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "JSON Parser Learning": {
      "ai_outputParser": [
        [
          {
            "node": "Process Instructions with Gemini",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Apply to Similar Products": {
      "main": [
        [
          {
            "node": "Update Sheet with AI Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Sheet with AI Response": {
      "main": [
        [
          {
            "node": "Save Learning to Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Learning to Supabase": {
      "main": [
        [
          {
            "node": "Send Daily Report",
            "type": "main",
            "index": 0
          },
          {
            "node": "Format Report for Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Workflow Status REAL": {
      "main": [
        [
          {
            "node": "Format Status Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Status Response": {
      "main": [
        [
          {
            "node": "Send Command Response",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Chat Agent (RAG)": {
      "main": [
        []
      ]
    },
    "Supabase Vector Store (Retrieve)": {
      "ai_vectorStore": [
        []
      ]
    },
    "MCP Client": {
      "ai_tool": [
        [
          {
            "node": "Chat Agent (RAG)",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‚ÄòExecute workflow‚Äô": {
      "main": [
        [
          {
            "node": "Shop Configuration2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Shop Configuration2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Daily Decision": {
      "main": [
        [
          {
            "node": "Route by Priority",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini flash_2.0": {
      "ai_languageModel": [
        [
          {
            "node": "Gemini Daily Decision",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client1": {
      "ai_tool": [
        [
          {
            "node": "Gemini Daily Decision",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase RAG Context": {
      "ai_tool": [
        [
          {
            "node": "Gemini Daily Decision",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "JSON Output Parser1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Update GTN/EAN": {
      "main": [
        [
          {
            "node": "Rate Limiting GTN/EAN",
            "type": "main",
            "index": 0
          },
          {
            "node": "AI Error Handler",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rate Limiting GTN/EAN": {
      "main": [
        [
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results_Sheets_01",
            "type": "main",
            "index": 0
          },
          {
            "node": "Gemini Error Handler GTN/EAN",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Prepare GTN/EAN_Loop": {
      "main": [
        [
          {
            "node": "Update GTN/EAN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Command Response": {
      "main": [
        [],
        []
      ]
    },
    "2d6517f1-ebbc-48fd-894c-287420175a7a": {
      "main": [
        [
          {
            "node": "9bf990d0-1d87-4bbb-9153-46146b506ae6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "9bf990d0-1d87-4bbb-9153-46146b506ae6": {
      "main": [
        [
          {
            "node": "3245d64d-7810-44de-beaa-f97d55eb2274",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "3245d64d-7810-44de-beaa-f97d55eb2274": {
      "main": [
        [
          {
            "node": "92b514de-5cd0-4f79-9857-123e685a1405",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "39d79c98-55c7-418a-8c36-bce59d3efd3f": {
      "main": [
        [
          {
            "node": "40a1e96b-15f2-4eb0-bdad-bd7532b02a22",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "40a1e96b-15f2-4eb0-bdad-bd7532b02a22": {
      "main": [
        [
          {
            "node": "f0a9ce99-2f4c-4baf-857a-02c81d0cae4d",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "f0a9ce99-2f4c-4baf-857a-02c81d0cae4d": {
      "main": [
        [
          {
            "node": "09ba4846-6da9-425c-a762-4f9f4bc1b4e6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "f49cb6b3-195b-42f6-a025-a0e78d62cfca": {
      "main": [
        [
          {
            "node": "2d6517f1-ebbc-48fd-894c-287420175a7a",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "92b514de-5cd0-4f79-9857-123e685a1405": {
      "main": [
        [
          {
            "node": "40a1e96b-15f2-4eb0-bdad-bd7532b02a22",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log Results_Sheets_01": {
      "main": [
        [
          {
            "node": "Send WhatsApp Expert Alert",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Email Trigger (IMAP)1": {
      "main": [
        [
          {
            "node": "Shop Configuration2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Error Handler": {
      "main": [
        [
          {
            "node": "Retry Queue",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Retry Queue": {
      "main": [
        [
          {
            "node": "Expression Repair",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "main": [
      [
        [
          {
            "node": "7a01b7e8-3184-4982-92f4-a0ba03f781a4",
            "type": "main",
            "index": 0
          },
          {
            "node": "errorHandler-1766014501177-9ez5es86k",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "errorHandler-1766014501177-9ez5es86k",
            "type": "main",
            "index": 0
          },
          {
            "node": "4c9f8649-a6b7-45dd-9ed9-b9134be84018",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "4c9f8649-a6b7-45dd-9ed9-b9134be84018",
            "type": "main",
            "index": 0
          },
          {
            "node": "c0c41789-4c7d-4efc-861f-885743a1aff8",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "errorHandler-1766014501177-9ez5es86k",
            "type": "main",
            "index": 1
          },
          {
            "node": "80b0ee00-87d9-44ec-8b62-8c86eda7737b",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "7a01b7e8-3184-4982-92f4-a0ba03f781a4",
            "type": "main",
            "index": 1
          },
          {
            "node": "65ca06d9-ae1b-4669-ba03-4418312d0442",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "c0c41789-4c7d-4efc-861f-885743a1aff8",
            "type": "main",
            "index": 0
          },
          {
            "node": "7a01b7e8-3184-4982-92f4-a0ba03f781a4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "15586a83-cda8-4ac9-9826-9ed77f24fa1c",
            "type": "main",
            "index": 0
          },
          {
            "node": "ai-error-handler-adult-1766019421751-xxxuhgnln",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ai-error-handler-adult-1766019421751-xxxuhgnln",
            "type": "main",
            "index": 0
          },
          {
            "node": "retry-queue-adult-1766019421751-10y8tihcx",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "retry-queue-adult-1766019421751-10y8tihcx",
            "type": "main",
            "index": 0
          },
          {
            "node": "expression-repair-adult-1766019421752-5eytl5tjg",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "expression-repair-adult-1766019421752-5eytl5tjg",
            "type": "main",
            "index": 0
          },
          {
            "node": "15586a83-cda8-4ac9-9826-9ed77f24fa1c",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "34310e5a-2422-4ce3-a615-5b8f911b5407",
            "type": "main",
            "index": 0
          },
          {
            "node": "ai-error-handler-text-1766019421752-tx9bpgxr6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ai-error-handler-text-1766019421752-tx9bpgxr6",
            "type": "main",
            "index": 0
          },
          {
            "node": "retry-queue-text-1766019421752-b389yhp5y",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "retry-queue-text-1766019421752-b389yhp5y",
            "type": "main",
            "index": 0
          },
          {
            "node": "expression-repair-text-1766019421752-rngvhbii6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "expression-repair-text-1766019421752-rngvhbii6",
            "type": "main",
            "index": 0
          },
          {
            "node": "34310e5a-2422-4ce3-a615-5b8f911b5407",
            "type": "main",
            "index": 0
          }
        ]
      ]
    ],
    "Expression Repair": {
      "main": [
        [
          {
            "node": "Prepare GTN/EAN_Loop",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Error Handler Adult Flags": {
      "main": [
        [
          {
            "node": "Switch Action Handler Adult Flags",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Error Handler Images": {
      "main": [
        [
          {
            "node": "Switch Action Handler Images",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Error Handler Text": {
      "main": [
        [
          {
            "node": "Switch Action Handler Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Error Handler Merchant Quality": {
      "main": [
        [
          {
            "node": "Switch Action Handler Merchant Quality",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Error Handler Multi Country": {
      "main": [
        [
          {
            "node": "Switch Action Handler Multi Country",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Error Handler GTN/EAN": {
      "main": [
        [
          {
            "node": "Switch Action Handler GTN/EAN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch Action Handler Adult Flags": {
      "main": [
        [
          {
            "node": "Rate Limiting",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Rate Limiting",
            "type": "main",
            "index": 0
          },
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch Action Handler Images": {
      "main": [
        [
          {
            "node": "Rate Limiting Images",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Rate Limiting Images",
            "type": "main",
            "index": 0
          },
          {
            "node": "Prepare Images Loop",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch Action Handler Text": {
      "main": [
        [
          {
            "node": "Rate Limiting Text",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Rate Limiting Text",
            "type": "main",
            "index": 0
          },
          {
            "node": "Prepare Text Loop",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch Action Handler Merchant Quality": {
      "main": [
        [
          {
            "node": "Rate Limiting Merchant",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Rate Limiting Merchant",
            "type": "main",
            "index": 0
          },
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch Action Handler Multi Country": {
      "main": [
        [
          {
            "node": "Rate Limiting Country",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Rate Limiting Country",
            "type": "main",
            "index": 0
          },
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch Action Handler GTN/EAN": {
      "main": [
        [
          {
            "node": "Rate Limiting GTN/EAN",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Rate Limiting GTN/EAN",
            "type": "main",
            "index": 0
          },
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "timeSavedMode": "fixed",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false
  },
  "staticData": {
    "node:Schedule Trigger": {
      "recurrenceRules": [
        0
      ]
    },
    "node:MCP Polling Trigger": {
      "recurrenceRules": []
    },
    "node:Import Commands from Gmail": {
      "Import Commands from Gmail": {
        "lastTimeChecked": 1765824135,
        "possibleDuplicates": [
          "19b235202b40cabe",
          "19b1b0de26275989"
        ]
      }
    },
    "node:Schedule Trigger (Daily 2 AM)": {
      "recurrenceRules": []
    },
    "node:Schedule Daily 2AM": {
      "recurrenceRules": []
    },
    "node:Email Trigger (IMAP)1": {}
  },
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {
    "Gemini Daily Decision": [
      {
        "json": {
          "output": {
            "priority": "images",
            "reasoning": "All adult flags and texts are OK, but images may need to be checked.",
            "products_to_process": 33
          }
        },
        "pairedItem": {
          "item": 0
        }
      }
    ],
    "Check Last Run": [
      {
        "json": {
          "id": "45f03152-8d68-4724-adf3-9eb175ce7647",
          "run_date": "2025-12-14T02:23:31.196",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T02:23:31.322845",
          "updated_at": "2025-12-14T02:23:31.322845"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "07de4b82-6677-499c-8a95-a70e8d920f37",
          "run_date": "2025-12-14T02:31:21.538",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T02:31:21.754658",
          "updated_at": "2025-12-14T02:31:21.754658"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "eeb0a2cb-f262-4e00-ba73-7e4ad97f65fb",
          "run_date": "2025-12-14T02:40:13.151",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T02:40:13.272195",
          "updated_at": "2025-12-14T02:40:13.272195"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "a43e22ba-1a2d-4d63-a380-d9f5448496fd",
          "run_date": "2025-12-14T02:45:07.863",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T02:45:07.971867",
          "updated_at": "2025-12-14T02:45:07.971867"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "29bc6842-42f6-4a16-907f-e58c0e51a419",
          "run_date": "2025-12-14T02:47:40.848",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T02:47:40.93805",
          "updated_at": "2025-12-14T02:47:40.93805"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "b32f6e18-1e04-4a8d-bb85-d94f2f8f4130",
          "run_date": "2025-12-14T02:50:40.496",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T02:50:40.606527",
          "updated_at": "2025-12-14T02:50:40.606527"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "11e89e7e-81e4-4595-aa72-0da988595226",
          "run_date": "2025-12-14T02:51:14.277",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T02:51:14.383428",
          "updated_at": "2025-12-14T02:51:14.383428"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "074b32c3-89ef-4958-9494-939b57d7068a",
          "run_date": "2025-12-14T02:51:54.144",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T02:51:54.224518",
          "updated_at": "2025-12-14T02:51:54.224518"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "6f997b6e-5cfa-415a-b66f-1c4d6dcc99a4",
          "run_date": "2025-12-14T02:54:39.718",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T02:54:39.791705",
          "updated_at": "2025-12-14T02:54:39.791705"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "180961ae-6f93-48a2-b8c8-2368a5415f6c",
          "run_date": "2025-12-14T02:56:09.428",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T02:56:09.528086",
          "updated_at": "2025-12-14T02:56:09.528086"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "c1d0a6c5-3184-4ec6-b671-1f21941e8240",
          "run_date": "2025-12-14T02:58:17.417",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T02:58:17.509162",
          "updated_at": "2025-12-14T02:58:17.509162"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "18e04a18-038c-4485-9dba-7f86e68c6f3c",
          "run_date": "2025-12-14T02:59:20.795",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T02:59:20.894555",
          "updated_at": "2025-12-14T02:59:20.894555"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "a07eb01a-88fd-48e1-bee9-e7d658802561",
          "run_date": "2025-12-14T03:00:17.857",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:00:17.938177",
          "updated_at": "2025-12-14T03:00:17.938177"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "a925a0be-eec6-420d-a16e-1c37063083cc",
          "run_date": "2025-12-14T03:00:42.279",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:00:42.363988",
          "updated_at": "2025-12-14T03:00:42.363988"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "870ab485-c7fe-4f24-b1a4-f198f0427f6c",
          "run_date": "2025-12-14T03:00:54.672",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:00:54.747378",
          "updated_at": "2025-12-14T03:00:54.747378"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "82784b62-1226-4883-a3ed-50b6cd2f4964",
          "run_date": "2025-12-14T03:05:18.072",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:05:18.162666",
          "updated_at": "2025-12-14T03:05:18.162666"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "d281ac70-449a-48a6-b704-cf1bb14dcf74",
          "run_date": "2025-12-14T03:06:15.955",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:06:16.047067",
          "updated_at": "2025-12-14T03:06:16.047067"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "224f47a0-2fe3-42fc-bb55-fea09c227592",
          "run_date": "2025-12-14T03:10:16.477",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:10:16.556637",
          "updated_at": "2025-12-14T03:10:16.556637"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "25891b68-8438-4e35-b05e-96a49168c592",
          "run_date": "2025-12-14T03:15:22.203",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:15:22.293724",
          "updated_at": "2025-12-14T03:15:22.293724"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "ea7a05b0-6140-4269-9db7-92e979ce54d2",
          "run_date": "2025-12-14T03:20:16.4",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:20:16.505658",
          "updated_at": "2025-12-14T03:20:16.505658"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "cfe61c27-4500-4cac-8932-822fb6d70848",
          "run_date": "2025-12-14T03:25:14.266",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:25:14.35766",
          "updated_at": "2025-12-14T03:25:14.35766"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "f29d7a8d-9cad-4e88-a6a4-6bf5567f7b10",
          "run_date": "2025-12-14T03:25:17.211",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:25:17.283931",
          "updated_at": "2025-12-14T03:25:17.283931"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "2a41f48a-4bb7-4d37-aca3-59695a36c84f",
          "run_date": "2025-12-14T03:25:29.447",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:25:29.533971",
          "updated_at": "2025-12-14T03:25:29.533971"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "28ed3b20-49cb-491b-bd01-fd615e772f88",
          "run_date": "2025-12-14T03:30:15.232",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:30:15.309181",
          "updated_at": "2025-12-14T03:30:15.309181"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "0029d9ef-f428-4680-bf2f-274c40bec175",
          "run_date": "2025-12-14T03:35:17.555",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:35:17.645607",
          "updated_at": "2025-12-14T03:35:17.645607"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "c046394a-43dd-4ca3-9183-ecd583138085",
          "run_date": "2025-12-14T03:36:11.396",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:36:11.487099",
          "updated_at": "2025-12-14T03:36:11.487099"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "0d593706-85b2-47e3-9aec-9fef21679510",
          "run_date": "2025-12-14T03:36:20.073",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:36:20.155502",
          "updated_at": "2025-12-14T03:36:20.155502"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "a582b440-4023-4505-a5c4-8f8f218707d6",
          "run_date": "2025-12-14T03:40:14.531",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:40:14.68539",
          "updated_at": "2025-12-14T03:40:14.68539"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "58b76888-bf1d-4e74-a5cb-67671b82e3fe",
          "run_date": "2025-12-14T03:45:40.77",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:45:40.863308",
          "updated_at": "2025-12-14T03:45:40.863308"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "144efb55-a4d0-491f-9fc9-89ddcf96989e",
          "run_date": "2025-12-14T03:45:47.544",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:45:47.614398",
          "updated_at": "2025-12-14T03:45:47.614398"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "9a1641fb-8eb0-42b2-a5a0-e9759ef94580",
          "run_date": "2025-12-14T03:45:59.122",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:45:59.318792",
          "updated_at": "2025-12-14T03:45:59.318792"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "9bcfc8c4-3d0e-4bb8-97e2-cc090612b139",
          "run_date": "2025-12-14T03:46:10.023",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:46:10.124507",
          "updated_at": "2025-12-14T03:46:10.124507"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "32a782b5-4d89-43be-88fd-415bb9831189",
          "run_date": "2025-12-14T03:50:41.166",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:50:41.239995",
          "updated_at": "2025-12-14T03:50:41.239995"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "8dec47b9-582d-4da3-bd90-c5f0594c6330",
          "run_date": "2025-12-14T03:50:51.164",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:50:51.279928",
          "updated_at": "2025-12-14T03:50:51.279928"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "de8fb357-e91f-45af-8d47-8b55c3657ed2",
          "run_date": "2025-12-14T03:51:15.133",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:51:15.19263",
          "updated_at": "2025-12-14T03:51:15.19263"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "682e4995-f64d-4206-990d-abeca5c9a1d0",
          "run_date": "2025-12-14T03:51:25.948",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:51:26.003095",
          "updated_at": "2025-12-14T03:51:26.003095"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "1a521172-60a5-4015-93aa-4b9f145f7a4c",
          "run_date": "2025-12-14T03:55:41.82",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:55:41.888237",
          "updated_at": "2025-12-14T03:55:41.888237"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "8b5c435a-673a-4b7b-ab19-f50559b5b344",
          "run_date": "2025-12-14T03:55:48.903",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:55:48.960909",
          "updated_at": "2025-12-14T03:55:48.960909"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "b5723836-00ef-4b93-a1c7-1b58382cd1c6",
          "run_date": "2025-12-14T03:56:01.557",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:56:01.625966",
          "updated_at": "2025-12-14T03:56:01.625966"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "a65fa116-005c-4329-9fb7-d0a7eb864ea4",
          "run_date": "2025-12-14T03:56:10.774",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T03:56:10.838255",
          "updated_at": "2025-12-14T03:56:10.838255"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "0e325fa7-c314-4424-8e42-5e83d7875e2a",
          "run_date": "2025-12-14T04:00:42.112",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T04:00:42.184668",
          "updated_at": "2025-12-14T04:00:42.184668"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "12db7008-d2d5-4156-9ed7-b884e2225450",
          "run_date": "2025-12-14T04:00:57.076",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T04:00:57.130209",
          "updated_at": "2025-12-14T04:00:57.130209"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "dea8f233-fef9-4900-857d-c9ee42d6ad99",
          "run_date": "2025-12-14T04:01:17.941",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T04:01:18.008727",
          "updated_at": "2025-12-14T04:01:18.008727"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "d5f56207-4477-4a5a-80e3-f7574c7eb275",
          "run_date": "2025-12-14T04:01:24.557",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T04:01:24.619889",
          "updated_at": "2025-12-14T04:01:24.619889"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "8a69c73c-8167-4f31-9a06-b636df5dcc9d",
          "run_date": "2025-12-14T04:05:43.08",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T04:05:43.180256",
          "updated_at": "2025-12-14T04:05:43.180256"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "484cd2bc-8261-49b8-961b-4215ae815d32",
          "run_date": "2025-12-14T04:05:56.432",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T04:05:56.526671",
          "updated_at": "2025-12-14T04:05:56.526671"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "5445962f-d6ea-4e61-90ff-07f930e878d3",
          "run_date": "2025-12-14T04:06:05.461",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T04:06:05.536424",
          "updated_at": "2025-12-14T04:06:05.536424"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "8b6d5735-75f9-45f0-8802-47d386a5568d",
          "run_date": "2025-12-14T04:06:13.992",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T04:06:14.060709",
          "updated_at": "2025-12-14T04:06:14.060709"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "c26c835d-9fdb-45ed-ac14-ec4f94cbded5",
          "run_date": "2025-12-14T04:10:43.597",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T04:10:43.695869",
          "updated_at": "2025-12-14T04:10:43.695869"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "a939644d-d45b-4c8c-8233-9efe3cb43b22",
          "run_date": "2025-12-14T04:10:55.986",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T04:10:56.117324",
          "updated_at": "2025-12-14T04:10:56.117324"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "24bcd2d7-4996-471a-834b-a7fedb180486",
          "run_date": "2025-12-14T04:11:06.263",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T04:11:06.339832",
          "updated_at": "2025-12-14T04:11:06.339832"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "ad1459cc-88a9-43f6-867e-0fcf4298cfd9",
          "run_date": "2025-12-14T04:11:14.837",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-14T04:11:14.903107",
          "updated_at": "2025-12-14T04:11:14.903107"
        },
        "pairedItem": {
          "item": 0
        }
      },
      {
        "json": {
          "id": "cacbca34-26ad-4910-82de-3fc5fc021448",
          "run_date": "2025-12-15T21:55:51.187",
          "shop_id": "5339977843",
          "shop_name": null,
          "phase": "adult_flags",
          "products_processed": 0,
          "success_count": 0,
          "failed_count": 0,
          "budget_used": 0,
          "duration_seconds": null,
          "gemini_decision": null,
          "approval_rate_before": null,
          "approval_rate_after": 100,
          "created_at": "2025-12-15T21:55:57.365656",
          "updated_at": "2025-12-15T21:55:57.365656"
        },
        "pairedItem": {
          "item": 0
        }
      }
    ],
    "Get Workflow Status REAL": [
      {
        "json": {},
        "pairedItem": [
          {
            "item": 0,
            "input": 0
          },
          {
            "item": 1,
            "input": 0
          },
          {
            "item": 2,
            "input": 0
          },
          {
            "item": 3,
            "input": 0
          },
          {
            "item": 4,
            "input": 0
          },
          {
            "item": 5,
            "input": 0
          },
          {
            "item": 6,
            "input": 0
          },
          {
            "item": 7,
            "input": 0
          },
          {
            "item": 8,
            "input": 0
          },
          {
            "item": 9,
            "input": 0
          },
          {
            "item": 10,
            "input": 0
          },
          {
            "item": 11,
            "input": 0
          },
          {
            "item": 12,
            "input": 0
          },
          {
            "item": 13,
            "input": 0
          },
          {
            "item": 14,
            "input": 0
          },
          {
            "item": 15,
            "input": 0
          },
          {
            "item": 16,
            "input": 0
          },
          {
            "item": 17,
            "input": 0
          },
          {
            "item": 18,
            "input": 0
          },
          {
            "item": 19,
            "input": 0
          },
          {
            "item": 20,
            "input": 0
          },
          {
            "item": 21,
            "input": 0
          },
          {
            "item": 22,
            "input": 0
          },
          {
            "item": 23,
            "input": 0
          },
          {
            "item": 24,
            "input": 0
          },
          {
            "item": 25,
            "input": 0
          },
          {
            "item": 26,
            "input": 0
          },
          {
            "item": 27,
            "input": 0
          },
          {
            "item": 28,
            "input": 0
          },
          {
            "item": 29,
            "input": 0
          },
          {
            "item": 30,
            "input": 0
          },
          {
            "item": 31,
            "input": 0
          },
          {
            "item": 32,
            "input": 0
          },
          {
            "item": 33,
            "input": 0
          },
          {
            "item": 34,
            "input": 0
          },
          {
            "item": 35,
            "input": 0
          },
          {
            "item": 36,
            "input": 0
          },
          {
            "item": 37,
            "input": 0
          },
          {
            "item": 38,
            "input": 0
          },
          {
            "item": 39,
            "input": 0
          },
          {
            "item": 40,
            "input": 0
          },
          {
            "item": 41,
            "input": 0
          },
          {
            "item": 42,
            "input": 0
          },
          {
            "item": 43,
            "input": 0
          },
          {
            "item": 44,
            "input": 0
          },
          {
            "item": 45,
            "input": 0
          },
          {
            "item": 46,
            "input": 0
          },
          {
            "item": 47,
            "input": 0
          },
          {
            "item": 48,
            "input": 0
          },
          {
            "item": 49,
            "input": 0
          },
          {
            "item": 50,
            "input": 0
          },
          {
            "item": 51,
            "input": 0
          },
          {
            "item": 52,
            "input": 0
          }
        ]
      }
    ]
  },
  "versionId": "9fcf4182-2ebc-4572-a5de-3ee73e50ebac",
  "activeVersionId": "9fcf4182-2ebc-4572-a5de-3ee73e50ebac",
  "versionCounter": 541,
  "triggerCount": 3,
  "shared": [
    {
      "updatedAt": "2025-12-12T04:29:41.486Z",
      "createdAt": "2025-12-12T04:29:41.486Z",
      "role": "workflow:owner",
      "workflowId": "ftZOou7HNgLOwzE5",
      "projectId": "eYBRLdtGaWLyIIOy",
      "project": {
        "updatedAt": "2025-11-06T02:18:23.292Z",
        "createdAt": "2025-11-06T01:50:03.327Z",
        "id": "eYBRLdtGaWLyIIOy",
        "name": "Andree Schulz <info@mechtech-support.com>",
        "type": "personal",
        "icon": null,
        "description": null,
        "projectRelations": [
          {
            "updatedAt": "2025-11-06T01:50:03.327Z",
            "createdAt": "2025-11-06T01:50:03.327Z",
            "userId": "905b93e2-2ccd-4e6b-a613-4d01485a9251",
            "projectId": "eYBRLdtGaWLyIIOy",
            "user": {
              "updatedAt": "2025-12-18T02:41:45.000Z",
              "createdAt": "2025-11-06T01:50:02.958Z",
              "id": "905b93e2-2ccd-4e6b-a613-4d01485a9251",
              "email": "info@mechtech-support.com",
              "firstName": "Andree",
              "lastName": "Schulz",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2025-11-06T02:19:06.535Z",
                "personalization_survey_n8n_version": "1.118.2",
                "companySize": "<20",
                "companyType": "ecommerce",
                "role": "business-owner",
                "reportedSource": "youtube"
              },
              "settings": {
                "userActivated": true,
                "easyAIWorkflowOnboarded": true,
                "firstSuccessfulWorkflowId": "uok6olNDUiRKpaE8",
                "userActivatedAt": 1764952348935,
                "npsSurvey": {
                  "responded": true,
                  "lastShownAt": 1765239138708
                }
              },
              "disabled": false,
              "mfaEnabled": false,
              "lastActiveAt": "2025-12-17",
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": [],
  "activeVersion": {
    "updatedAt": "2025-12-18T05:43:21.777Z",
    "createdAt": "2025-12-18T05:43:21.777Z",
    "versionId": "9fcf4182-2ebc-4572-a5de-3ee73e50ebac",
    "workflowId": "ftZOou7HNgLOwzE5",
    "nodes": [
      {
        "parameters": {
          "options": {}
        },
        "id": "9baabb04-7161-4ec5-b55e-f60db618fb2a",
        "name": "Chat Trigger (RAG Query)",
        "type": "@n8n/n8n-nodes-langchain.chatTrigger",
        "typeVersion": 1.4,
        "position": [
          496,
          3984
        ],
        "webhookId": "1bcc39ec-5b0a-4f6c-abf6-21235fcb6cb1"
      },
      {
        "parameters": {
          "options": {
            "systemMessage": "Du bist der MECHTECH Workflow Assistent!\n\nDu hast Zugriff auf die komplette Historie aller Workflow-Ausf√ºhrungen in der Supabase Vector Database.\n\nDeine Aufgaben:\n1. Beantworte Fragen zur Workflow-Historie (Approval Rates, verarbeitete Produkte, Phasen, etc.)\n2. Analysiere Trends und Muster in den Daten\n3. Gib Empfehlungen basierend auf historischen Daten\n4. Erkl√§re was in bestimmten Zeitr√§umen passiert ist\n\nDu kannst auf folgende Informationen zugreifen:\n- Shop-Namen und IDs\n- Verarbeitete Produkte pro Run\n- Success/Failure Counts\n- Approval Rates\n- Phasen (adult_flags, text, images)\n- Timestamps\n- Reasoning der Gemini Decisions\n\nAntworte auf Deutsch, pr√§zise und hilfreich!"
          }
        },
        "id": "9bc4af95-f5bd-4f66-92af-9dd4780285f6",
        "name": "Chat Agent (RAG)",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3,
        "position": [
          720,
          3984
        ]
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash-exp",
          "options": {}
        },
        "id": "c23df7d5-2db0-4397-a635-8fe929c75f0d",
        "name": "Gemini Chat Model (RAG)",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          560,
          4240
        ],
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        }
      },
      {
        "parameters": {
          "tableName": {
            "__rl": true,
            "mode": "id",
            "value": "n8n_mechtech_historie"
          },
          "options": {
            "queryName": "match_documents"
          }
        },
        "id": "15b38e7b-23bd-4e25-847c-9bd727d3161f",
        "name": "Supabase Vector Store (Retrieve)",
        "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
        "typeVersion": 1.3,
        "position": [
          704,
          4432
        ],
        "credentials": {
          "supabaseApi": {
            "id": "f1qLUdIsbZ2A3wdC",
            "name": "Supabase-MySQL"
          }
        }
      },
      {
        "parameters": {},
        "id": "d4606641-fd18-4201-844a-3bcc80a70fcf",
        "name": "Gemini Embeddings (RAG)",
        "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
        "typeVersion": 1,
        "position": [
          1072,
          4304
        ],
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        }
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "mechtech_chat_session",
          "tableName": "n8n_chat_historie",
          "contextWindowLength": 25
        },
        "id": "2bff2895-6846-4720-bfd4-1a8eaff1386e",
        "name": "Postgres Chat Memory",
        "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
        "typeVersion": 1.3,
        "position": [
          720,
          4240
        ],
        "credentials": {
          "postgres": {
            "id": "pIp690wi4X79QCKb",
            "name": "Postgres account"
          }
        }
      },
      {
        "parameters": {
          "useCustomSchema": true,
          "operation": "getAll",
          "tableId": "workflow_runs",
          "returnAll": true,
          "matchType": "allFilters",
          "filters": {
            "conditions": [
              {
                "keyName": "created_at",
                "condition": "gte",
                "keyValue": "=={{ $now.startOf('day').toISO() }}"
              }
            ]
          }
        },
        "id": "e217bdb8-8710-475d-acaa-c033d138c2cd",
        "name": "Check Last Run",
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          1072,
          3360
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "waitBetweenTries": 3000,
        "credentials": {
          "supabaseApi": {
            "id": "f1qLUdIsbZ2A3wdC",
            "name": "Supabase-MySQL"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "// ============================================================================\n// PREPARE PRODUCTS LOOP - GIBT ARRAY ZUR√úCK F√úR SPLIT\n// ============================================================================\n// ‚úÖ Dieser Node gibt ein Array zur√ºck (f√ºr n8n Split/Iteration)\n// ‚Üí n8n wird dann JEDES Item einzeln an den n√§chsten Node weitergeben\n// ‚Üí Die nachfolgenden Nodes (Prepare Images, etc.) m√ºssen sequenziell arbeiten\n\nconst inputData = $input.first().json;\nconst config = $('Shop Configuration2').first().json;\n\n// Get products from input (Gemini Decision passes them)\nconst productsToFix = inputData.products || [];\nconst maxProducts = inputData.products_to_process || productsToFix.length;\n\n// Shop info from config\nconst shopId = inputData.shop_id || config.shop1_id;\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\nconst productsSlice = productsToFix.slice(0, maxProducts);\n\n// ‚úÖ Gibt Array zur√ºck - n8n wird jedes Item einzeln weiterleiten\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    originalProduct: product, // Behalte original product data\n    action: 'prepare',\n    priority: 'prepare',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
        },
        "id": "2d6517f1-ebbc-48fd-894c-287420175a7a",
        "name": "Prepare Products Loop",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2272,
          3152
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $('Shop Configuration2').item.json.shop1_id }}/products/{{ $json.product_id }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "adult",
                "value": "true"
              },
              {
                "name": "ageGroup",
                "value": "adult"
              },
              {
                "name": "googleProductCategory",
                "value": "778"
              }
            ]
          },
          "options": {}
        },
        "id": "15586a83-cda8-4ac9-9826-9ed77f24fa1c",
        "name": "Update Product Adult Flag",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          2496,
          3056
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "amount": 2
        },
        "id": "09ba4846-6da9-425c-a762-4f9f4bc1b4e6",
        "name": "Rate Limiting",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          2720,
          3152
        ],
        "webhookId": "77aa4d35-4b1e-410d-9f22-138e57a732c7",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "tableId": "workflow_runs",
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "run_date",
                "fieldValue": "={{ $json.run_date }}"
              },
              {
                "fieldId": "shop_id",
                "fieldValue": "={{ $json.shop_id }}"
              },
              {
                "fieldId": "phase",
                "fieldValue": "={{ $json.phase }}"
              },
              {
                "fieldId": "products_processed",
                "fieldValue": "={{ $json.products_processed }}"
              },
              {
                "fieldId": "success_count",
                "fieldValue": "={{ $json.success_count }}"
              },
              {
                "fieldId": "approval_rate_after",
                "fieldValue": "={{ $json.approval_rate_after }}"
              }
            ]
          }
        },
        "id": "588efd00-c612-4bb9-9837-abab980e50ab",
        "name": "Save Workflow Run",
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          1584,
          3968
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "supabaseApi": {
            "id": "f1qLUdIsbZ2A3wdC",
            "name": "Supabase-MySQL"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "operation": "appendOrUpdate",
          "documentId": {
            "__rl": true,
            "mode": "id",
            "value": "1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE"
          },
          "sheetName": {
            "__rl": true,
            "mode": "name",
            "value": "üìù Daily_Log"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Timestamp": "={{ $json.run_date }}",
              "Shop": "={{ $json.shop_id }}",
              "Phase": "={{ $json.phase }}",
              "Products Processed": "={{ $json.products_processed }}",
              "Success Count": "={{ $json.success_count }}",
              "Failed Count": "={{ $json.failed_count }}",
              "Status": "={{ $json.created_at }}",
              "Action": "={{ $json.gemini_decision }}",
              "Details": "={{ $json.approval_rate_after }}"
            },
            "matchingColumns": [
              "Timestamp"
            ],
            "schema": [
              {
                "id": "Timestamp",
                "displayName": "Timestamp",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Shop",
                "displayName": "Shop",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Phase",
                "displayName": "Phase",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Action",
                "displayName": "Action",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Products Processed",
                "displayName": "Products Processed",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Success Count",
                "displayName": "Success Count",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Failed Count",
                "displayName": "Failed Count",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Status",
                "displayName": "Status",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Details",
                "displayName": "Details",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false,
            "mappings": [
              {
                "column": "Timestamp",
                "value": "={{ $json.run_date }}"
              },
              {
                "column": "Shop",
                "value": "={{ $json.shop_name }}"
              },
              {
                "column": "Phase",
                "value": "={{ $json.phase }}"
              },
              {
                "column": "Action",
                "value": "Daily Run"
              },
              {
                "column": "Products Processed",
                "value": "={{ $json.products_processed }}"
              },
              {
                "column": "Success Count",
                "value": "={{ $json.success_count }}"
              },
              {
                "column": "Failed Count",
                "value": "={{ $json.failed_count }}"
              },
              {
                "column": "Status",
                "value": "={{ $json.status }}"
              },
              {
                "column": "Details",
                "value": "={{ $json.reasoning }}"
              }
            ]
          },
          "options": {}
        },
        "id": "108880c3-e17a-4976-bce9-9edef6a441a7",
        "name": "Log Results to Sheets",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          1824,
          4080
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "pbNsBLFTIuL9ArMn",
            "name": "Google Sheets"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "chatId": "8562069918:AAFtzEUzCDeUchzybcp2l9Cg4WZ0KBmsWzI",
          "text": "=ü§ñ GEMINI DAILY REPORT - {{ $json.shop_name }}\n\nüìä Phase: {{ $json.phase }}\n‚úÖ Verarbeitet: {{ $json.success_count }}\n‚ùå Fehler: {{ $json.failed_count }}\nüìà Approval Rate: {{ $json.approval_rate_after }}%\n\nüí° Reasoning: {{ $json.reasoning }}\n\nAlles OK? üëç",
          "additionalFields": {}
        },
        "id": "5e5a1e29-70f7-45bf-9d3f-80ec9efb83f7",
        "name": "Send Daily Report",
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          2256,
          4400
        ],
        "webhookId": "b5c4cc7d-d366-4cd7-ac2c-0a91ed811e96",
        "credentials": {
          "telegramApi": {
            "id": "CefgWOY6zLuQ1eyX",
            "name": "Telegram account"
          }
        }
      },
      {
        "parameters": {
          "sendTo": "={{ $json.to }}",
          "subject": "={{ $json.subject }}",
          "message": "={{ $json.html }}",
          "options": {}
        },
        "id": "b8be1226-8b56-4499-927f-611b6d5f606a",
        "name": "Export Report to Gmail",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          2704,
          4400
        ],
        "webhookId": "da822d06-d1b7-4cfe-804f-5e778bedbac4",
        "credentials": {
          "gmailOAuth2": {
            "id": "piLkk7aEWM1RFevI",
            "name": "s24.mechtech@gmail.com"
          }
        }
      },
      {
        "parameters": {
          "pollTimes": {
            "item": [
              {
                "mode": "everyX",
                "value": 1,
                "unit": "minutes"
              }
            ]
          },
          "filters": {
            "labelIds": [
              "Label_4215695195142173388",
              "Label_2937160366021595910",
              "INBOX"
            ],
            "readStatus": "unread"
          }
        },
        "id": "cdb90d0d-ccc5-473c-94a8-ea3ac6adc09b",
        "name": "Import Commands from Gmail",
        "type": "n8n-nodes-base.gmailTrigger",
        "typeVersion": 1.3,
        "position": [
          480,
          3296
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "waitBetweenTries": 3000,
        "credentials": {
          "gmailOAuth2": {
            "id": "piLkk7aEWM1RFevI",
            "name": "s24.mechtech@gmail.com"
          }
        },
        "disabled": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "operation": "send",
          "recipientPhoneNumber": "<__PLACEHOLDER_VALUE__Expert WhatsApp Number__>",
          "textBody": "=üö® EXPERT ALERT - MECHTECH Merchant Center\n\nShop: {{ $json.shop_name }}\nPhase: {{ $json.phase }}\n\n‚ö†Ô∏è CRITICAL ISSUES:\n‚ùå Failed: {{ $json.failed_count }}\nüìâ Approval Rate: {{ $json.approval_rate_after }}%\n\nImmediate action required!\n\nDetails: {{ $json.reasoning }}",
          "additionalFields": {}
        },
        "id": "b1701b06-0047-42f9-8558-b9d2bf7453ad",
        "name": "Send WhatsApp Expert Alert",
        "type": "n8n-nodes-base.whatsApp",
        "typeVersion": 1.1,
        "position": [
          2704,
          4576
        ],
        "webhookId": "fd8ea9df-d0d5-4e11-a0df-a43a8e68297e",
        "disabled": true
      },
      {
        "parameters": {
          "updates": [
            "messages"
          ],
          "options": {}
        },
        "id": "dad0b159-2230-417c-9a99-35aad6692aa9",
        "name": "Import Commands from WhatsApp",
        "type": "n8n-nodes-base.whatsAppTrigger",
        "typeVersion": 1,
        "position": [
          480,
          3040
        ],
        "webhookId": "472f5025-2ce8-4fba-9322-7f5fe0256023",
        "disabled": true
      },
      {
        "parameters": {
          "jsCode": "const data = $input.item.json; const html = `<h2>ü§ñ MECHTECH Merchant Center Daily Report</h2><h3>Shop: ${data.shop_name}</h3><table border='1' cellpadding='10'><tr><th>Metric</th><th>Value</th></tr><tr><td>Phase</td><td>${data.phase}</td></tr><tr><td>Products Processed</td><td>${data.products_processed}</td></tr><tr><td>Success Count</td><td>${data.success_count}</td></tr><tr><td>Failed Count</td><td>${data.failed_count}</td></tr><tr><td>Approval Rate</td><td>${data.approval_rate_after}%</td></tr><tr><td>Status</td><td>${data.status}</td></tr></table><p><strong>Reasoning:</strong> ${data.reasoning}</p><p><em>Generated: ${data.run_date}</em></p>`; return [{ json: { subject: `Daily Report - ${data.shop_name} - ${data.phase}`, html: html, to: '<__PLACEHOLDER_VALUE__Report Email Address__>' } }];"
        },
        "id": "f42a4d00-e073-42db-a62a-e6fc4afdea43",
        "name": "Format Report for Email",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2480,
          4384
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "// FIXED: Only check SUBJECT for commands (ignore spam)\nconst input = $input.item.json;\n\n// Only use subject - ignore body/snippet to avoid spam\nconst subject = (input.subject || '').toLowerCase().trim();\n\n// Check if subject contains \"command\" keyword\nif (!subject.includes('command') && !subject.includes('mechtech')) {\n  // Not a command email - skip it\n  return [];\n}\n\n// Extract command from subject\nconst text = subject.replace('command:', '').replace('mechtech:', '').trim();\n\nlet action = 'unknown';\nlet params = {};\n\nif (text.includes('status')) {\n  action = 'get_status';\n} else if (text.includes('pause')) {\n  action = 'pause_workflow';\n} else if (text.includes('resume')) {\n  action = 'resume_workflow';\n} else if (text.includes('report')) {\n  action = 'send_report';\n} else if (text.includes('help')) {\n  action = 'show_help';\n} else if (text.includes('optimize')) {\n  action = 'run_optimization';\n  // Check which shop\n  if (text.includes('shop1') || text.includes('siliconedolls24')) {\n    params.shop = 'shop1';\n  } else if (text.includes('shop2') || text.includes('dreamdoll')) {\n    params.shop = 'shop2';\n  } else {\n    params.shop = 'both';\n  }\n} else {\n  // Unknown command\n  action = 'unknown';\n}\n\nreturn [{\n  json: {\n    action: action,\n    params: params,\n    original_text: text,\n    source: input.from || input.sender || 'unknown',\n    subject: input.subject || ''\n  }\n}];"
        },
        "id": "1508074b-8edb-4df0-86d3-9830444fb9e1",
        "name": "Parse Command Input",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          768,
          3168
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "loose",
              "version": 3
            },
            "conditions": [
              {
                "id": "id-1",
                "leftValue": "={{ $json.failed_count }}",
                "rightValue": 10,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              },
              {
                "id": "id-2",
                "leftValue": "={{ $json.approval_rate_after }}",
                "rightValue": 50,
                "operator": {
                  "type": "number",
                  "operation": "lt"
                }
              }
            ],
            "combinator": "or"
          },
          "looseTypeValidation": true,
          "options": {}
        },
        "id": "3f130224-b8e7-4411-a208-572c46510fae",
        "name": "Check if Expert Needed",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          2480,
          4592
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.action }}",
                      "rightValue": "get_status",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "445605f9-402d-4973-9957-5754b69fb8fc"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Status"
              }
            ]
          },
          "options": {
            "fallbackOutput": "extra",
            "renameFallbackOutput": "Unknown Command"
          }
        },
        "id": "8d4d4848-43b2-4809-b459-1c262b31cd0d",
        "name": "Route Command",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.4,
        "position": [
          1072,
          3136
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "sendTo": "info@mechtech-support.com",
          "subject": "=",
          "emailType": "text",
          "message": "={{ $('Get Workflow Status REAL').item.json.error }}",
          "options": {}
        },
        "id": "45396118-d2da-455e-9a97-75cbabde112b",
        "name": "Send Command Response",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          1920,
          3152
        ],
        "webhookId": "5cf94981-2360-49f1-b7d4-6c512f562360",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "waitBetweenTries": 3000,
        "credentials": {
          "gmailOAuth2": {
            "id": "piLkk7aEWM1RFevI",
            "name": "s24.mechtech@gmail.com"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "// ============================================================================\n// FIX: PREPARE IMAGES LOOP - WORKING VERSION\n// ============================================================================\nconst inputData = $input.first().json;\nconst config = $('Shop Configuration2').first().json;\n\nconst productsToFix = inputData.products || [];\nconst maxProducts = inputData.products_to_process || productsToFix.length;\n\nconst shopId = inputData.shop_id || config.shop1_id;\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\nconst productsSlice = productsToFix.slice(0, maxProducts);\n\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    image_link: product.imageLink,\n    action: 'images',\n    priority: 'images',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
        },
        "id": "9bf990d0-1d87-4bbb-9153-46146b506ae6",
        "name": "Prepare Images Loop",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2272,
          3312
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $('Shop Configuration2').item.json.shop1_id }}/products/{{ $json.product.id }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "imageLink",
                "value": "={{ $json.product.imageLink }}"
              }
            ]
          },
          "options": {}
        },
        "id": "3c250fa7-ca68-49fa-869d-1d0b1761a4b1",
        "name": "Update Product Images",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          2496,
          3248
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "amount": 2
        },
        "id": "bfed81ba-0dfb-4fd3-9161-3dadb6aebe1d",
        "name": "Rate Limiting Images",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          2720,
          3344
        ],
        "webhookId": "03758724-2fd2-4cf0-bc96-1ba04b9fa35c",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "// ============================================================================\n// FIX: PREPARE TEXT LOOP - WORKING VERSION\n// ============================================================================\nconst inputData = $input.first().json;\nconst config = $('Shop Configuration2').first().json;\n\nconst productsToFix = inputData.products || [];\nconst maxProducts = inputData.products_to_process || productsToFix.length;\n\nconst shopId = inputData.shop_id || config.shop1_id;\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\nconst productsSlice = productsToFix.slice(0, maxProducts);\n\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    description: product.description,\n    action: 'text',\n    priority: 'text',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
        },
        "id": "3245d64d-7810-44de-beaa-f97d55eb2274",
        "name": "Prepare Text Loop",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2272,
          3472
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $('Shop Configuration2').item.json.shop1_id }}/products/{{ $json.product.id }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "title",
                "value": "={{ $json.product.title }}"
              },
              {
                "name": "description",
                "value": "={{ $json.product.description }}"
              }
            ]
          },
          "options": {}
        },
        "id": "34310e5a-2422-4ce3-a615-5b8f911b5407",
        "name": "Update Product Text",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          2496,
          3424
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "amount": 2
        },
        "id": "dcf77ef7-4f9b-4487-be98-b0480a6b9b2a",
        "name": "Rate Limiting Text",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          2720,
          3536
        ],
        "webhookId": "fade3537-0739-4667-80c9-7636461ed902",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "const input = $input.item.json;\nconst invalidPriority = input.priority || 'unknown';\nconst reasoning = input.reasoning || 'No reasoning provided';\n\nconst errorResult = {\n  processed_count: 0,\n  failed_count: 0,\n  error: 'Invalid priority received from Gemini',\n  invalid_priority: invalidPriority,\n  gemini_reasoning: reasoning,\n  timestamp: new Date().toISOString(),\n  debug_info: {\n    expected_priorities: ['adult_flags', 'images', 'text'],\n    received_priority: invalidPriority,\n    full_gemini_response: input\n  }\n};\n\nreturn [{ json: errorResult }];"
        },
        "id": "80b0ee00-87d9-44ec-8b62-8c86eda7737b",
        "name": "Handle Invalid Priority",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1072,
          4096
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "shop1_id",
                "name": "shop1_id",
                "value": "5339977843",
                "type": "string"
              },
              {
                "id": "shop1_name",
                "name": "shop1_name",
                "value": "Siliconedolls24",
                "type": "string"
              },
              {
                "id": "shop2_id",
                "name": "shop2_id",
                "value": "124485833",
                "type": "string"
              },
              {
                "id": "shop2_name",
                "name": "shop2_name",
                "value": "DreamDoll",
                "type": "string"
              },
              {
                "id": "google_sheet_id",
                "name": "google_sheet_id",
                "value": "1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE",
                "type": "string"
              },
              {
                "id": "id-6",
                "name": "supabase_url",
                "value": "https://mxswxdnnjhhukovixzvb.supabase.co/functions/v1/database-access",
                "type": "string"
              },
              {
                "id": "id-7",
                "name": "supabase_key",
                "value": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im14c3d4ZG5uamhodWtvdml4enZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3OTM4NDAsImV4cCI6MjA3OTM2OTg0MH0.60grD1zV6gF7Uf80N8CG8eiEwMw3zY5KR0Q-KKvvSWQ",
                "type": "string"
              }
            ]
          },
          "includeOtherFields": true,
          "options": {}
        },
        "name": "Shop Configuration2",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          784,
          3584
        ],
        "id": "c56a220a-81d4-49e8-8f8b-70b5051f89d0",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "waitBetweenTries": 3000,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "url": "=https://www.googleapis.com/content/v2.1/{{ $('Shop Configuration2').item.json.shop1_id }}/products?maxResults=100",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "options": {}
        },
        "name": "Get Merchant Products2",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1072,
          3568
        ],
        "id": "39d79c98-55c7-418a-8c36-bce59d3efd3f",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "const products = $input.item.json.resources || [];\nconst productsNeedingFix = products.filter(p => !p.adult);\nconst disapproved = products.filter(p => p.issues && p.issues.length > 0).length;\nconst approved = products.length - disapproved;\nconst approvalRate = products.length > 0 ? ((approved / products.length) * 100).toFixed(2) : 0;\n\nreturn [{\n  json: {\n    products_needing_fix: productsNeedingFix.slice(0, 100),\n    current_approval_rate: approvalRate,\n    total_products: products.length,\n    approved_count: approved,\n    disapproved_count: disapproved\n  }\n}];"
        },
        "id": "f49cb6b3-195b-42f6-a025-a0e78d62cfca",
        "name": "Analyze Products2",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1328,
          3568
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "const items = $input.all();\nconst processedCount = items.filter(i => i.json.processed_count !== undefined).reduce((sum, i) => sum + i.json.processed_count, 0);\nconst failedCount = items.filter(i => i.json.failed_count !== undefined).reduce((sum, i) => sum + i.json.failed_count, 0);\nconst config = $('Shop Configuration2').item.json;\nconst analysis = $('Analyze Products2').item.json;\nconst decision = $('Gemini Daily Decision').item.json;\n\nreturn [{\n  json: {\n    shop_id: config.shop1_id,\n    shop_name: config.shop1_name,\n    run_date: new Date().toISOString(),\n    phase: decision.priority || 'adult_flags',\n    products_processed: processedCount,\n    success_count: processedCount,\n    failed_count: failedCount,\n    approval_rate_before: analysis.current_approval_rate,\n    approval_rate_after: analysis.current_approval_rate,\n    reasoning: decision.reasoning || 'Processing products',\n    status: failedCount === 0 ? 'success' : 'partial_success'\n  }\n}];"
        },
        "id": "e8e880e8-557c-42e8-a95f-fb077510c508",
        "name": "Aggregate Results2",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1328,
          4080
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "schemaType": "manual",
          "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"priority\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"enum\": [\"adult_flags\", \"images\", \"text\"]\n\t\t},\n\t\t\"reasoning\": {\n\t\t\t\"type\": \"string\"\n\t\t},\n\t\t\"products_to_process\": {\n\t\t\t\"type\": \"number\"\n\t\t}\n\t},\n\t\"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}",
          "autoFix": true
        },
        "id": "984a5be4-d1fa-4229-aa5b-5a50528673ec",
        "name": "JSON Output Parser1",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.3,
        "position": [
          1824,
          3856
        ]
      },
      {
        "parameters": {
          "jsCode": "// ============================================================================\n// FIX: PREPARE MERCHANT QUALITY LOOP - WORKING VERSION\n// ============================================================================\nconst inputData = $input.first().json;\nconst config = $('Shop Configuration2').first().json;\n\nconst productsToFix = inputData.products || [];\nconst maxProducts = inputData.products_to_process || productsToFix.length;\n\nconst shopId = inputData.shop_id || config.shop1_id;\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\nconst productsSlice = productsToFix.slice(0, maxProducts);\n\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    action: 'merchant_quality',\n    priority: 'merchant_quality',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
        },
        "name": "Prepare Merchant Quality Loop",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2272,
          3648
        ],
        "id": "92b514de-5cd0-4f79-9857-123e685a1405",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/shippingsettings",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"accountId\": \"{{ $json.shop_id }}\",\n  \"services\": [{\n    \"name\": \"Standard Shipping\",\n    \"active\": true,\n    \"deliveryCountry\": \"DE\",\n    \"deliveryTime\": {\n      \"minHandlingTimeInDays\": 1,\n      \"maxHandlingTimeInDays\": 3,\n      \"minTransitTimeInDays\": 2,\n      \"maxTransitTimeInDays\": 5\n    },\n    \"rateGroups\": [{\n      \"singleValue\": {\n        \"flatRate\": {\n          \"value\": \"0\",\n          \"currency\": \"EUR\"\n        }\n      }\n    }]\n  }]\n}",
          "options": {}
        },
        "name": "Update Merchant Settings",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          2512,
          3600
        ],
        "id": "3ad28c6f-6828-483e-a696-c83bd1382966",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "amount": 2
        },
        "name": "Rate Limiting Merchant",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          2720,
          3728
        ],
        "id": "3226b31b-79d4-4877-9432-a192258a6099",
        "webhookId": "rate-limit-merchant-webhook",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "// ============================================================================\n// PREPARE MULTI COUNTRY LOOP - SEQUENTIELLE VERARBEITUNG\n// ============================================================================\nconst inputItem = $input.first().json;\nconst config = $('Shop Configuration2').first().json;\n\n// Multi-Country Logik - sequenziell verarbeiten (ein Item)\nreturn {\n  json: {\n    ...inputItem,\n    action: 'multi_country',\n    priority: 'multi_country',\n    multi_country_processed: true,\n    countries: inputItem.countries || inputItem.countries_from_gemini || [],\n    shipping: inputItem.shipping || []\n  }\n};"
        },
        "name": "Prepare Multi Country Loop",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2272,
          3856
        ],
        "id": "40a1e96b-15f2-4eb0-bdad-bd7532b02a22",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/products/{{ $json.product_id }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"destinations\": [\n    {{ $json.countries.map(c => `{\"destinationName\": \"Shopping_ads\", \"country\": \"${c}\"}`).join(',') }}\n  ],\n  \"shipping\": [\n    {{ $json.countries.map(c => `{\"country\": \"${c}\", \"price\": {\"value\": \"0\", \"currency\": \"EUR\"}}`).join(',') }}\n  ]\n}",
          "options": {}
        },
        "name": "Update Country Feeds",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          2496,
          3808
        ],
        "id": "3c873a42-3df1-4f70-89a4-08a7391cf78e",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "amount": 2
        },
        "name": "Rate Limiting Country",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          2720,
          3920
        ],
        "id": "62a07200-0815-4098-869a-8ec5fa3927f5",
        "webhookId": "rate-limit-country-webhook",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "adult_flags",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "adult-flags-condition"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Adult Flags"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "images",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "images-condition"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Images"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "text",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "text-condition"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Text"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "merchant_quality",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "merchant-quality-condition"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Merchant Quality"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "multi_country",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "multi-country-condition"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Multi Country"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "b85d4e72-545e-46d6-9d63-bb8819eeffb5",
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "multi_gtn_ean",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Multi GTN/EAN"
              }
            ]
          },
          "options": {
            "fallbackOutput": "extra",
            "renameFallbackOutput": "Fallback"
          }
        },
        "name": "Route by Priority",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          1936,
          3440
        ],
        "id": "d4b56adf-ee7f-4c31-91ff-22d64ef182a0",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "url": "=https://www.googleapis.com/content/v2.1/{{ $('Shop Configuration2').item.json.shop2_id }}/products?maxResults=250",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "options": {}
        },
        "name": "Get Merchant Products Shop2",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1072,
          3760
        ],
        "id": "07c684bc-18ff-493d-833f-4fc1a26e2cca",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $('Shop Configuration2').item.json.supabase_url }}/rest/v1/products",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "apikey",
                "value": "={{ $('Shop Configuration2').item.json.supabase_key }}"
              },
              {
                "name": "Authorization",
                "value": "=Bearer {{ $('Shop Configuration2').item.json.supabase_key }}"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              },
              {
                "name": "Prefer",
                "value": "resolution=merge-duplicates"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"shop_id\": \"{{ $json.shop_id }}\",\n  \"shop_name\": \"{{ $json.shop_name }}\",\n  \"shop_url\": \"{{ $json.shop_id === '5339977843' ? 'www.siliconedolls24.com' : 'www.dreamdoll.de' }}\",\n  \"product_id\": \"{{ $json.product_id }}\",\n  \"offer_id\": \"{{ $json.offer_id }}\",\n  \"title\": \"{{ $json.title }}\",\n  \"image_link\": \"{{ $json.image_link || '' }}\",\n  \"adult_flag_set\": {{ $json.action === 'adult_flags' || $json.priority === 'adult_flags' ? 'true' : 'false' }},\n  \"text_sanitized\": {{ $json.action === 'text' || $json.priority === 'text' ? 'true' : 'false' }},\n  \"image_optimized\": {{ $json.action === 'images' || $json.priority === 'images' ? 'true' : 'false' }},\n  \"feed_optimized\": true,\n  \"shipping_set\": {{ $json.action === 'merchant_quality' || $json.priority === 'merchant_quality' ? 'true' : 'false' }},\n  \"returns_set\": {{ $json.action === 'merchant_quality' || $json.priority === 'merchant_quality' ? 'true' : 'false' }},\n  \"tax_set\": {{ $json.action === 'merchant_quality' || $json.priority === 'merchant_quality' ? 'true' : 'false' }},\n  \"multi_country\": {{ $json.action === 'multi_country' || $json.priority === 'multi_country' ? 'true' : 'false' }},\n  \"status\": \"SUCCESS\",\n  \"last_optimized_at\": \"{{ $now.toISO() }}\"\n}",
          "options": {}
        },
        "name": "Save to Supabase Products",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          2256,
          4768
        ],
        "id": "725473eb-3d1e-4d65-84cf-084cc1c521fb",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "waitBetweenTries": 3000,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $('Shop Configuration2').item.json.supabase_url }}/rest/v1/rpc/update_pattern_success",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "apikey",
                "value": "={{ $('Shop Configuration2').item.json.supabase_key }}"
              },
              {
                "name": "Authorization",
                "value": "=Bearer {{ $('Shop Configuration2').item.json.supabase_key }}"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"p_pattern_type\": \"{{ $json.action || $json.priority }}\",\n  \"p_success\": true\n}",
          "options": {}
        },
        "name": "Update Optimization Patterns",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          2480,
          4768
        ],
        "id": "12c519ef-b6b4-4f07-86b6-0bb9dc47f074",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "operation": "appendOrUpdate",
          "documentId": {
            "__rl": true,
            "value": "https://docs.google.com/spreadsheets/d/1R1fYQTswbGBDzLoizyTNPKVLup1ie0_ksqBTLc5E48s/edit?gid=0#gid=0",
            "mode": "url"
          },
          "sheetName": {
            "__rl": true,
            "value": 1181382825,
            "mode": "list",
            "cachedResultName": "üß† AI_Learning",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1R1fYQTswbGBDzLoizyTNPKVLup1ie0_ksqBTLc5E48s/edit#gid=1181382825"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {},
            "matchingColumns": [],
            "schema": [
              {
                "id": "Timestamp",
                "displayName": "Timestamp",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Problem_Type",
                "displayName": "Problem_Type",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Human_Instruction",
                "displayName": "Human_Instruction",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "AI_Solution",
                "displayName": "AI_Solution",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Success_Rate",
                "displayName": "Success_Rate",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Applied_Count",
                "displayName": "Applied_Count",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Pattern_ID",
                "displayName": "Pattern_ID",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "name": "Get Human Instructions",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          1328,
          4288
        ],
        "id": "42e30df8-bb6a-4410-a1aa-35d8be0f9ddb",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "waitBetweenTries": 3000,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "cztAb4CKfRPRO8KX",
            "name": "Google Sheets account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "// Filter nur Zeilen MIT Instructions und OHNE AI Response\nconst items = $input.all();\n\nconst needsProcessing = items.filter(item => {\n  const instruction = item.json.Human_Instructions;\n  const aiResponse = item.json.AI_Response;\n  return instruction && instruction.trim() !== '' && (!aiResponse || aiResponse.trim() === '');\n});\n\nif (needsProcessing.length === 0) {\n  // Keine Instructions zu verarbeiten\n  return [];\n}\n\nreturn needsProcessing;"
        },
        "name": "Filter Unprocessed Instructions",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1584,
          4208
        ],
        "id": "02c7b8d8-d36f-4ef9-866e-069bf77eddbf",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=HUMAN INSTRUCTION:\nProdukt: {{ $json.Title }}\nProdukt ID: {{ $json.Product_ID }}\nAnweisung: {{ $json.Human_Instructions }}\n\nAnalysiere die Anweisung und:\n1. Erstelle L√∂sung\n2. Finde √§hnliche Produkte\n3. Gib Pattern-Type an\n4. Confidence Score (0-100)\n\nAntworte als JSON!",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "Du bist der Learning Agent f√ºr MECHTECH!\n\nDeine Aufgabe:\n1. Lese Human Instructions aus Google Sheets\n2. Verstehe was der Mensch will\n3. Erstelle Pattern/L√∂sung\n4. Wende auf √§hnliche Produkte an\n5. Speichere Learning in Supabase\n\nWenn Mensch Fehler macht:\n- Erkenne es!\n- Gib freundlichen Hinweis\n- Schlage bessere L√∂sung vor\n\nAntworte IMMER als JSON:\n{\n  \"ai_response\": \"Deine Antwort an den Menschen\",\n  \"solution\": \"Was du tun wirst\",\n  \"pattern_type\": \"adult_flags|text|images|merchant_quality|multi_country/multi gtn/ean\",\n  \"ai_confidence\": 85,\n  \"apply_to_similar\": true,\n  \"similar_keywords\": [\"keyword1\", \"keyword2\"],\n  \"warning\": \"Optional: Wenn Mensch Fehler macht\"\n}"
          }
        },
        "name": "Process Instructions with Gemini",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.7,
        "position": [
          1824,
          4320
        ],
        "id": "f2b6a65c-9975-4082-afbc-91acf0a73604",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash-exp",
          "options": {}
        },
        "name": "Gemini Model Learning",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          1824,
          4528
        ],
        "id": "55f39251-adad-438f-975f-011c7a1497d6",
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        }
      },
      {
        "parameters": {},
        "name": "JSON Parser Learning",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.2,
        "position": [
          1968,
          4576
        ],
        "id": "1faa2330-99e5-4acd-8253-a9d6dd30c5bd"
      },
      {
        "parameters": {
          "jsCode": "// Apply solution to similar products\nconst instruction = $input.item.json;\nconst geminiResponse = $('Process Instructions with Gemini').item.json;\n\nif (!geminiResponse.apply_to_similar) {\n  return [{\n    json: {\n      ...instruction,\n      ai_response: geminiResponse.ai_response,\n      ai_confidence: geminiResponse.ai_confidence,\n      applied_to_similar: 0\n    }\n  }];\n}\n\n// Get all products from previous steps\nconst allProducts = $('Get Merchant Products2').all();\nconst keywords = geminiResponse.similar_keywords || [];\n\n// Find similar products\nconst similarProducts = allProducts.filter(p => {\n  const title = (p.json.title || '').toLowerCase();\n  return keywords.some(keyword => title.includes(keyword.toLowerCase()));\n});\n\nreturn [{\n  json: {\n    ...instruction,\n    ai_response: geminiResponse.ai_response,\n    ai_confidence: geminiResponse.ai_confidence,\n    applied_to_similar: similarProducts.length,\n    similar_product_ids: similarProducts.map(p => p.json.id),\n    pattern_type: geminiResponse.pattern_type,\n    solution: geminiResponse.solution,\n    warning: geminiResponse.warning || null\n  }\n}];"
        },
        "name": "Apply to Similar Products",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2256,
          4960
        ],
        "id": "8bccc6c6-1e34-426d-80cb-90fadf6082e0",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "value": "={{ $('Shop Configuration2').item.json.sheet_id }}",
            "mode": "id"
          },
          "sheetName": {
            "__rl": true,
            "value": "={{ $json.shop_url || 'www.siliconedolls24.com' }}",
            "mode": "name"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {},
            "matchingColumns": [],
            "schema": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false,
            "mappings": [
              {
                "column": "AI_Response",
                "value": "={{ $json.ai_response }}"
              },
              {
                "column": "AI_Confidence",
                "value": "={{ $json.ai_confidence }}"
              },
              {
                "column": "Applied_To_Similar",
                "value": "={{ $json.applied_to_similar }}"
              }
            ]
          },
          "options": {}
        },
        "name": "Update Sheet with AI Response",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          2480,
          4960
        ],
        "id": "c77cdd70-7296-45e8-b454-d5d9a766f365",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "cztAb4CKfRPRO8KX",
            "name": "Google Sheets account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $('Shop Configuration2').item.json.supabase_url }}/rest/v1/human_instructions",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "apikey",
                "value": "={{ $('Shop Configuration2').item.json.supabase_key }}"
              },
              {
                "name": "Authorization",
                "value": "=Bearer {{ $('Shop Configuration2').item.json.supabase_key }}"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"product_id\": \"{{ $json.Product_ID }}\",\n  \"shop_id\": \"{{ $json.shop_id }}\",\n  \"instruction\": \"{{ $json.Human_Instructions }}\",\n  \"instruction_type\": \"{{ $json.pattern_type }}\",\n  \"ai_response\": \"{{ $json.ai_response }}\",\n  \"ai_confidence\": {{ $json.ai_confidence }},\n  \"ai_action_taken\": \"{{ $json.solution }}\",\n  \"applied_to_similar\": {{ $json.applied_to_similar }},\n  \"status\": \"EXECUTED\",\n  \"executed_at\": \"{{ $now.toISO() }}\"\n}",
          "options": {}
        },
        "name": "Save Learning to Supabase",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          2704,
          4960
        ],
        "id": "46929706-525b-42d0-adb4-1ec1932a2249",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "url": "=https://mxswxdnnjhhukovixzvb.supabase.co/rest/v1/workflow_status?select=*&order=created_at.desc&limit=100",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "supabaseApi",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "=id",
                "value": "={{ $json.id }}"
              },
              {
                "name": "run_date",
                "value": "={{ $json.run_date }}"
              },
              {
                "name": "shop_id",
                "value": "={{ $json.shop_id }}"
              },
              {
                "name": "shop_name",
                "value": "={{ $json.shop_name }}"
              },
              {
                "name": "phase",
                "value": "={{ $json.phase }}"
              },
              {
                "name": "products_processed",
                "value": "={{ $json.products_processed }}"
              },
              {
                "name": "success_count",
                "value": "={{ $json.success_count }}"
              },
              {
                "name": "failed_count",
                "value": "={{ $json.failed_count }}"
              },
              {
                "name": "budget_used",
                "value": "={{ $json.budget_used }}"
              },
              {
                "name": "duration_seconds",
                "value": "={{ $json.duration_seconds }}"
              },
              {
                "name": "gemini_decision",
                "value": "={{ $json.gemini_decision }}"
              },
              {
                "name": "approval_rate_before",
                "value": "={{ $json.approval_rate_before }}"
              },
              {
                "name": "approval_rate_after",
                "value": "={{ $json.approval_rate_after }}"
              },
              {
                "name": "created_at",
                "value": "={{ $json.created_at }}"
              },
              {
                "name": "updated_at",
                "value": "={{ $json.updated_at }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {}
            ]
          },
          "options": {
            "response": {
              "response": {
                "responseFormat": "json"
              }
            }
          }
        },
        "name": "Get Workflow Status REAL",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1344,
          3248
        ],
        "id": "24dfb842-786a-45ed-89bf-a8cf8b2b15af",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "waitBetweenTries": 3000,
        "credentials": {
          "supabaseApi": {
            "id": "f1qLUdIsbZ2A3wdC",
            "name": "Supabase-MySQL"
          }
        },
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "// FIXED VERSION - handles both array and object responses\nconst response = $input.item.json;\n\n// Check if response is array or needs to be wrapped\nlet decisions = Array.isArray(response) ? response : (response.data || [response]);\n\n// Filter out empty/null entries\ndecisions = decisions.filter(d => d && d.created_at);\n\nif (!decisions || decisions.length === 0) {\n  return [{\n    json: {\n      response: 'üìä MECHTECH Status\\n\\n‚ùå Noch keine Daten!\\n\\nWorkflow l√§uft t√§glich alle 4 Stunden.',\n      recipient: $('Parse Command Input').item.json.source,\n      subject: 'MECHTECH Status Report'\n    }\n  }];\n}\n\nconst lastRun = decisions[0];\nconst total = decisions.reduce((sum, d) => sum + (d.products_processed || 0), 0);\nconst successRate = total > 0 \n  ? ((decisions.reduce((sum, d) => sum + (d.success_count || 0), 0) / total) * 100).toFixed(1)\n  : 0;\n\nconst responseText = `üìä MECHTECH WORKFLOW STATUS\n\n‚úÖ Letzte Ausf√ºhrung:\n- Shop: ${lastRun.shop_name || 'N/A'}\n- Datum: ${new Date(lastRun.created_at).toLocaleString('de-DE')}\n- Phase: ${lastRun.decision_type || 'N/A'}\n- Produkte: ${lastRun.products_processed || 0}\n- Erfolge: ${lastRun.success_count || 0}\n\nüìà Letzte ${decisions.length} Runs:\n- Total Produkte: ${total}\n- Success Rate: ${successRate}%\n- Kosten: ‚Ç¨0.00\n\n‚è∞ N√§chster Run: T√§glich 2:00 AM\n\nüí° Commands:\n- status: Aktueller Status\n- report: Vollst√§ndiger Report\n- help: Hilfe`;\n\nreturn [{\n  json: {\n    response: responseText,\n    recipient: $('Parse Command Input').item.json.source,\n    subject: 'MECHTECH Status Report'\n  }\n}];"
        },
        "name": "Format Status Response",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1616,
          3232
        ],
        "id": "4bd56d4b-4f4e-4696-b41b-e9937892618d",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "waitBetweenTries": 3000,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
        "typeVersion": 1.2,
        "position": [
          864,
          4240
        ],
        "id": "04a8f30d-72eb-494b-87ec-faff1ecf2a2b",
        "name": "MCP Client"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.manualTrigger",
        "typeVersion": 1,
        "position": [
          160,
          3648
        ],
        "id": "c105a095-1fad-40c3-a323-e631b53cb6bd",
        "name": "When clicking ‚ÄòExecute workflow‚Äô"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "hours",
                "hoursInterval": 4
              }
            ]
          }
        },
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.3,
        "position": [
          144,
          3872
        ],
        "id": "fa6bd48c-91d5-4e16-8bc3-f102df17f4e1",
        "name": "Schedule Trigger",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Current Approval Rate: {{ $json.current_approval_rate }}%. Products needing fix: {{ $json.products_needing_fix.length }}. Total products: {{ $json.total_products }}. Approved: {{ $json.approved_count }}. Disapproved: {{ $json.disapproved_count }}.",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "\"Update Gemini System Prompt im Workflow:\n\nDu bist Gemini f√ºr MECHTECH Merchant Center.\n\nT√ÑGLICHE AUFGABE:\n1. Lade Produkte aus Shop (5339977843 + 124485833)\n2. Analysiere jeden Artikel:\n   - Hat Adult Flag? (adult: true, ageGroup: adult)\n   - GTIN/EAN vorhanden?\n   - Text ok? (keine expliziten Begriffe)\n   - Bilder ok? (Explicitness < 70)\n   - Country Feeds ok?\n\n3. Entscheide PRIORIT√ÑT:\n   - Phase 1: Fehlende Adult Flags ‚Üí SOFORT!\n   - Phase 2: Schlechte Texte ‚Üí dann\n   - Phase 3: Bilder problematisch ‚Üí zuletzt\n   - Phase 4: GTIN/EAN fehlt ‚Üí parallel\n\n4. Pro Phase OUTPUT:\n\n{\n  'phase': 'adult_flags|text|images|gtin',\n  'products_count': XXX,\n  'products': [\n    {\n      'sku': 'ABC123',\n      'action': 'set_adult_flag|sanitize_text|check_images|fix_gtin',\n      'current_value': '...',\n      'new_value': '...',\n      'reason': 'Adult content in description',\n      'confidence': 85,\n      'cost': '‚Ç¨0.00'\n    }\n  ],\n  'quality_score_before': 45,\n  'quality_score_after': 52,\n  'approval_rate_before': '0,06%',\n  'approval_rate_after': '1,2%',\n  'estimated_time': '15 min',\n  'next_phase': 'sanitize_text'\n}\n\n5. WICHTIG:\n   - Kostenlos? Wenn NEIN ‚Üí Frag!\n   - Adult Flags = UNBEGRENZT\n   - Text Fix = KOSTENLOS\n   - Bilder = Max 33/Tag\n   - GTIN/EAN = Lookup oder identifier_exists=false\n   - Logging zu Supabase + Sheets\n\n6. REGELN:\n   - Niemals: Preise, Delete, Verf√ºgbarkeit √§ndern\n   - Immer: Adult Flag setzen!\n   - Langsam aber stetig\n   - Logs schreiben vor Update!\n\n7. ERFOLGS-Meldung (KEINE Errors):\n   - An: info@mechtech-support.com\n   - Format: Daily Success Report\n   - Nur Erfolge, keine Errors!\""
          }
        },
        "id": "d693f698-d40b-46a1-88df-ab9dd01765bf",
        "name": "Gemini Daily Decision",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3,
        "position": [
          1552,
          3552
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash",
          "options": {}
        },
        "id": "aa5fcfd4-61e9-4522-8e08-fc5739fd1fd7",
        "name": "Gemini flash_2.0",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          1360,
          3760
        ],
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        }
      },
      {
        "parameters": {
          "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
        "typeVersion": 1.2,
        "position": [
          1472,
          3760
        ],
        "id": "6a4002e5-0908-41de-bd03-1dc359e33cbe",
        "name": "MCP Client1"
      },
      {
        "parameters": {
          "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "supabaseApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {}
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequestTool",
        "typeVersion": 4.3,
        "position": [
          1600,
          3760
        ],
        "id": "69313a23-245e-4812-8f0d-6a0f49f9ae46",
        "name": "Supabase RAG Context",
        "credentials": {
          "supabaseApi": {
            "id": "f1qLUdIsbZ2A3wdC",
            "name": "Supabase-MySQL"
          }
        }
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          2080,
          4000
        ],
        "id": "81c65263-dd9c-47ce-bb36-5ef2c918c51f",
        "name": "Google Gemini Chat Model",
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        }
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/products/{{ $json.product_id }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendBody": true,
          "specifyBody": "json",
          "options": {}
        },
        "name": "Update GTN/EAN",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          2496,
          4112
        ],
        "id": "7a01b7e8-3184-4982-92f4-a0ba03f781a4",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "amount": 2
        },
        "name": "Rate Limiting GTN/EAN",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          2720,
          4208
        ],
        "id": "65ca06d9-ae1b-4669-ba03-4418312d0442",
        "webhookId": "rate-limit-country-webhook",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "// ============================================================================\n// PREPARE GTIN/EAN LOOP - F√ºr Gemini GTIN/EAN Updates\n// ============================================================================\nconst inputData = $input.first().json;\nconst config = $('Shop Configuration2').first().json;\n\n// ‚úÖ Hole Products von Analyze Products2:\nconst analysis = $('Analyze Products2').first().json;\nconst productsToFix = analysis.products_needing_fix || [];\n\n// ‚úÖ Hole Priority und Max Products von Gemini Decision:\nconst decision = $('Gemini Daily Decision').first().json.output || {};\nconst maxProducts = decision.products_to_process || productsToFix.length;\n\n// ‚úÖ Shop ID von Decision ODER Config:\nconst shopId = decision.shop_id || config.shop1_id;\n\n// ‚úÖ Shop Info aus Config:\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\n// Filtere nur Products die GTIN/EAN Updates brauchen\nconst productsNeedingGtinEan = productsToFix.filter(product => {\n  // Pr√ºfe ob Gemini empfohlen hat GTIN/EAN zu aktualisieren\n  return product.needs_gtin_ean === true || \n         product.missing_gtin === true || \n         product.missing_mpn === true ||\n         product.missing_brand === true ||\n         (product.priority && product.priority === 'multi_gtn_ean');\n});\n\n// Slice f√ºr Batch Processing\nconst productsSlice = productsNeedingGtinEan.slice(0, maxProducts);\n\n// ‚úÖ Erstelle Items mit GTIN/EAN Daten:\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    \n    // GTIN/EAN Daten (von Gemini oder Product)\n    gtin: product.gtin || product.gtin_from_gemini || product.recommended_gtin || '',\n    mpn: product.mpn || product.mpn_from_gemini || product.recommended_mpn || '',\n    brand: product.brand || product.brand_from_gemini || product.recommended_brand || '',\n    \n    action: 'gtin_ean',\n    priority: 'multi_gtn_ean',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
        },
        "name": "Prepare GTN/EAN_Loop",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2272,
          4176
        ],
        "id": "f0a9ce99-2f4c-4baf-857a-02c81d0cae4d",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "operation": "appendOrUpdate",
          "documentId": {
            "__rl": true,
            "mode": "id",
            "value": "1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE"
          },
          "sheetName": {
            "__rl": true,
            "mode": "list",
            "value": "üìù Daily_Log"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Timestamp": "={{ $json.run_date }}",
              "Shop": "={{ $json.shop_id }}",
              "Phase": "={{ $json.phase }}",
              "Products Processed": "={{ $json.products_processed }}",
              "Success Count": "={{ $json.success_count }}",
              "Failed Count": "={{ $json.failed_count }}",
              "Status": "={{ $json.created_at }}",
              "Action": "={{ $json.gemini_decision }}",
              "Details": "={{ $json.approval_rate_after }}"
            },
            "matchingColumns": [
              "Timestamp"
            ],
            "schema": [
              {
                "id": "Timestamp",
                "displayName": "Timestamp",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Shop",
                "displayName": "Shop",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Phase",
                "displayName": "Phase",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Action",
                "displayName": "Action",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Products Processed",
                "displayName": "Products Processed",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Success Count",
                "displayName": "Success Count",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Failed Count",
                "displayName": "Failed Count",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Status",
                "displayName": "Status",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Details",
                "displayName": "Details",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false,
            "mappings": [
              {
                "column": "Timestamp",
                "value": "={{ $json.run_date }}"
              },
              {
                "column": "Shop",
                "value": "={{ $json.shop_name }}"
              },
              {
                "column": "Phase",
                "value": "={{ $json.phase }}"
              },
              {
                "column": "Action",
                "value": "Daily Run"
              },
              {
                "column": "Products Processed",
                "value": "={{ $json.products_processed }}"
              },
              {
                "column": "Success Count",
                "value": "={{ $json.success_count }}"
              },
              {
                "column": "Failed Count",
                "value": "={{ $json.failed_count }}"
              },
              {
                "column": "Status",
                "value": "={{ $json.status }}"
              },
              {
                "column": "Details",
                "value": "={{ $json.reasoning }}"
              }
            ]
          },
          "options": {}
        },
        "id": "4d05ceb8-9f63-4593-bc11-609b83f7f012",
        "name": "Log Results_Sheets_01",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          3072,
          4400
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "pbNsBLFTIuL9ArMn",
            "name": "Google Sheets"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.emailReadImap",
        "typeVersion": 2.1,
        "position": [
          160,
          3424
        ],
        "id": "4aafec14-c1cf-4b56-a311-a808641ba07a",
        "name": "Email Trigger (IMAP)1",
        "credentials": {
          "imap": {
            "id": "CdpePT9CweqekWEC",
            "name": "IMAP info@mechtech-support.com"
          }
        }
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "gemini-error-adult-1766027265946",
        "name": "Gemini Error Handler Adult Flags",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          3264,
          3184
        ],
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        }
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "gemini-error-images-1766027265947",
        "name": "Gemini Error Handler Images",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          3264,
          3376
        ],
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        }
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "gemini-error-text-1766027265947",
        "name": "Gemini Error Handler Text",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          3264,
          3568
        ],
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        }
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "gemini-error-quality-1766027265948",
        "name": "Gemini Error Handler Merchant Quality",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          3264,
          3760
        ],
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        }
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "gemini-error-country-1766027265948",
        "name": "Gemini Error Handler Multi Country",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          3264,
          3968
        ],
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        }
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "gemini-error-gtnean-1766027265949",
        "name": "Gemini Error Handler GTN/EAN",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          3264,
          4240
        ],
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        }
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "string": [
                    {
                      "value1": "={{ $json.error && ($json.error.code === 429 || $json.error.code === 400 || $json.error.code === 500) }}",
                      "operation": "equals",
                      "value2": "true"
                    }
                  ]
                },
                "renameOutput": "Error"
              }
            ]
          },
          "options": {},
          "mode": "rules",
          "fallbackOutput": 1
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          3728,
          3200
        ],
        "id": "switch-action-adult-flags",
        "name": "Switch Action Handler Adult Flags",
        "alwaysOutputData": true,
        "retryOnFail": true
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "string": [
                    {
                      "value1": "={{ $json.error && ($json.error.code === 429 || $json.error.code === 400 || $json.error.code === 500) }}",
                      "operation": "equals",
                      "value2": "true"
                    }
                  ]
                },
                "renameOutput": "Error"
              }
            ]
          },
          "options": {},
          "mode": "rules",
          "fallbackOutput": 1
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          3728,
          3392
        ],
        "id": "switch-action-images",
        "name": "Switch Action Handler Images"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "string": [
                    {
                      "value1": "={{ $json.error && ($json.error.code === 429 || $json.error.code === 400 || $json.error.code === 500) }}",
                      "operation": "equals",
                      "value2": "true"
                    }
                  ]
                },
                "renameOutput": "Error"
              }
            ]
          },
          "options": {},
          "mode": "rules",
          "fallbackOutput": 1
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          3728,
          3600
        ],
        "id": "switch-action-text",
        "name": "Switch Action Handler Text"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "string": [
                    {
                      "value1": "={{ $json.error && ($json.error.code === 429 || $json.error.code === 400 || $json.error.code === 500) }}",
                      "operation": "equals",
                      "value2": "true"
                    }
                  ]
                },
                "renameOutput": "Error"
              }
            ]
          },
          "options": {},
          "mode": "rules",
          "fallbackOutput": 1
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          3728,
          3792
        ],
        "id": "switch-action-merchant-quality",
        "name": "Switch Action Handler Merchant Quality"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "string": [
                    {
                      "value1": "={{ $json.error && ($json.error.code === 429 || $json.error.code === 400 || $json.error.code === 500) }}",
                      "operation": "equals",
                      "value2": "true"
                    }
                  ]
                },
                "renameOutput": "Error"
              }
            ]
          },
          "options": {},
          "mode": "rules",
          "fallbackOutput": 1
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          3728,
          4000
        ],
        "id": "switch-action-multi-country",
        "name": "Switch Action Handler Multi Country"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "string": [
                    {
                      "value1": "={{ $json.error && ($json.error.code === 429 || $json.error.code === 400 || $json.error.code === 500) }}",
                      "operation": "equals",
                      "value2": "true"
                    }
                  ]
                },
                "renameOutput": "Error"
              }
            ]
          },
          "options": {},
          "mode": "rules",
          "fallbackOutput": 1
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          3728,
          4192
        ],
        "id": "switch-action-gtn-ean",
        "name": "Switch Action Handler GTN/EAN"
      }
    ],
    "connections": {
      "Chat Trigger (RAG Query)": {
        "main": [
          [
            {
              "node": "Chat Agent (RAG)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gemini Chat Model (RAG)": {
        "ai_languageModel": [
          [
            {
              "node": "Chat Agent (RAG)",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Gemini Embeddings (RAG)": {
        "ai_embedding": [
          [
            {
              "node": "Supabase Vector Store (Retrieve)",
              "type": "ai_embedding",
              "index": 0
            }
          ]
        ]
      },
      "Postgres Chat Memory": {
        "ai_memory": [
          [
            {
              "node": "Chat Agent (RAG)",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Check Last Run": {
        "main": [
          [
            {
              "node": "Get Merchant Products Shop2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Get Merchant Products2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Get Workflow Status REAL",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Products Loop": {
        "main": [
          [
            {
              "node": "Prepare Images Loop",
              "type": "main",
              "index": 0
            },
            {
              "node": "Update Product Adult Flag",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Product Adult Flag": {
        "main": [
          [
            {
              "node": "Rate Limiting",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Rate Limiting": {
        "main": [
          [
            {
              "node": "Prepare Products Loop",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results_Sheets_01",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save to Supabase Products",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            },
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Gemini Error Handler Adult Flags",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Workflow Run": {
        "main": [
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Results to Sheets": {
        "main": [
          [
            {
              "node": "Send Daily Report",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save to Supabase Products",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Daily Report": {
        "main": [
          [
            {
              "node": "Format Report for Email",
              "type": "main",
              "index": 0
            },
            {
              "node": "Check if Expert Needed",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Import Commands from Gmail": {
        "main": [
          [
            {
              "node": "Parse Command Input",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Import Commands from WhatsApp": {
        "main": [
          [
            {
              "node": "Parse Command Input",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format Report for Email": {
        "main": [
          [
            {
              "node": "Export Report to Gmail",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Command Input": {
        "main": [
          [
            {
              "node": "Route Command",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check if Expert Needed": {
        "main": [
          [
            {
              "node": "Send WhatsApp Expert Alert",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Route Command": {
        "main": [
          [
            {
              "node": "Shop Configuration2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Get Workflow Status REAL",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Send Command Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Images Loop": {
        "main": [
          [
            {
              "node": "Prepare Text Loop",
              "type": "main",
              "index": 0
            },
            {
              "node": "Update Product Images",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Product Images": {
        "main": [
          [
            {
              "node": "Rate Limiting Images",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Rate Limiting Images": {
        "main": [
          [
            {
              "node": "Prepare Images Loop",
              "type": "main",
              "index": 0
            },
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results_Sheets_01",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save to Supabase Products",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            },
            {
              "node": "Gemini Error Handler Images",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Text Loop": {
        "main": [
          [
            {
              "node": "Prepare Merchant Quality Loop",
              "type": "main",
              "index": 0
            },
            {
              "node": "Update Product Text",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Product Text": {
        "main": [
          [
            {
              "node": "Rate Limiting Text",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Rate Limiting Text": {
        "main": [
          [
            {
              "node": "Prepare Text Loop",
              "type": "main",
              "index": 0
            },
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results_Sheets_01",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save to Supabase Products",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            },
            {
              "node": "Gemini Error Handler Text",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Handle Invalid Priority": {
        "main": [
          [
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Shop Configuration2": {
        "main": [
          [
            {
              "node": "Check Last Run",
              "type": "main",
              "index": 0
            },
            {
              "node": "Get Merchant Products Shop2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Get Merchant Products2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Merchant Products2": {
        "main": [
          [
            {
              "node": "Analyze Products2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Analyze Products2": {
        "main": [
          [
            {
              "node": "Gemini Daily Decision",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate Results2": {
        "main": [
          [
            {
              "node": "Save Workflow Run",
              "type": "main",
              "index": 0
            },
            {
              "node": "Get Human Instructions",
              "type": "main",
              "index": 0
            },
            {
              "node": "Get Workflow Status REAL",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "JSON Output Parser1": {
        "ai_outputParser": [
          [
            {
              "node": "Gemini Daily Decision",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Merchant Quality Loop": {
        "main": [
          [
            {
              "node": "Prepare Multi Country Loop",
              "type": "main",
              "index": 0
            },
            {
              "node": "Update Merchant Settings",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Merchant Settings": {
        "main": [
          [
            {
              "node": "Rate Limiting Merchant",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Multi Country Loop": {
        "main": [
          [
            {
              "node": "Prepare GTN/EAN_Loop",
              "type": "main",
              "index": 0
            },
            {
              "node": "Update Country Feeds",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Country Feeds": {
        "main": [
          [
            {
              "node": "Rate Limiting Country",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Rate Limiting Merchant": {
        "main": [
          [
            {
              "node": "Prepare Merchant Quality Loop",
              "type": "main",
              "index": 0
            },
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save to Supabase Products",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results_Sheets_01",
              "type": "main",
              "index": 0
            },
            {
              "node": "Gemini Error Handler Merchant Quality",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Rate Limiting Country": {
        "main": [
          [
            {
              "node": "Prepare Multi Country Loop",
              "type": "main",
              "index": 0
            },
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results_Sheets_01",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save to Supabase Products",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            },
            {
              "node": "Gemini Error Handler Multi Country",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Route by Priority": {
        "main": [
          [
            {
              "node": "Prepare Products Loop",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Prepare Images Loop",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Prepare Text Loop",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Prepare Merchant Quality Loop",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Prepare Multi Country Loop",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Prepare GTN/EAN_Loop",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Handle Invalid Priority",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Merchant Products Shop2": {
        "main": [
          [
            {
              "node": "Analyze Products2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save to Supabase Products": {
        "main": [
          [
            {
              "node": "Update Optimization Patterns",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Optimization Patterns": {
        "main": [
          [
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Human Instructions": {
        "main": [
          [
            {
              "node": "Filter Unprocessed Instructions",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter Unprocessed Instructions": {
        "main": [
          [
            {
              "node": "Process Instructions with Gemini",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Instructions with Gemini": {
        "main": [
          [
            {
              "node": "Apply to Similar Products",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gemini Model Learning": {
        "ai_languageModel": [
          [
            {
              "node": "Process Instructions with Gemini",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "JSON Parser Learning": {
        "ai_outputParser": [
          [
            {
              "node": "Process Instructions with Gemini",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Apply to Similar Products": {
        "main": [
          [
            {
              "node": "Update Sheet with AI Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Sheet with AI Response": {
        "main": [
          [
            {
              "node": "Save Learning to Supabase",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Learning to Supabase": {
        "main": [
          [
            {
              "node": "Send Daily Report",
              "type": "main",
              "index": 0
            },
            {
              "node": "Format Report for Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Workflow Status REAL": {
        "main": [
          [
            {
              "node": "Format Status Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format Status Response": {
        "main": [
          [
            {
              "node": "Send Command Response",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Chat Agent (RAG)": {
        "main": [
          []
        ]
      },
      "Supabase Vector Store (Retrieve)": {
        "ai_vectorStore": [
          []
        ]
      },
      "MCP Client": {
        "ai_tool": [
          [
            {
              "node": "Chat Agent (RAG)",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "When clicking ‚ÄòExecute workflow‚Äô": {
        "main": [
          [
            {
              "node": "Shop Configuration2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Schedule Trigger": {
        "main": [
          [
            {
              "node": "Shop Configuration2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gemini Daily Decision": {
        "main": [
          [
            {
              "node": "Route by Priority",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gemini flash_2.0": {
        "ai_languageModel": [
          [
            {
              "node": "Gemini Daily Decision",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "MCP Client1": {
        "ai_tool": [
          [
            {
              "node": "Gemini Daily Decision",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Supabase RAG Context": {
        "ai_tool": [
          [
            {
              "node": "Gemini Daily Decision",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Google Gemini Chat Model": {
        "ai_languageModel": [
          [
            {
              "node": "JSON Output Parser1",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Update GTN/EAN": {
        "main": [
          [
            {
              "node": "Rate Limiting GTN/EAN",
              "type": "main",
              "index": 0
            },
            {
              "node": "AI Error Handler",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Rate Limiting GTN/EAN": {
        "main": [
          [
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results_Sheets_01",
              "type": "main",
              "index": 0
            },
            {
              "node": "Gemini Error Handler GTN/EAN",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Prepare GTN/EAN_Loop": {
        "main": [
          [
            {
              "node": "Update GTN/EAN",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Command Response": {
        "main": [
          [],
          []
        ]
      },
      "2d6517f1-ebbc-48fd-894c-287420175a7a": {
        "main": [
          [
            {
              "node": "9bf990d0-1d87-4bbb-9153-46146b506ae6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "9bf990d0-1d87-4bbb-9153-46146b506ae6": {
        "main": [
          [
            {
              "node": "3245d64d-7810-44de-beaa-f97d55eb2274",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "3245d64d-7810-44de-beaa-f97d55eb2274": {
        "main": [
          [
            {
              "node": "92b514de-5cd0-4f79-9857-123e685a1405",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "39d79c98-55c7-418a-8c36-bce59d3efd3f": {
        "main": [
          [
            {
              "node": "40a1e96b-15f2-4eb0-bdad-bd7532b02a22",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "40a1e96b-15f2-4eb0-bdad-bd7532b02a22": {
        "main": [
          [
            {
              "node": "f0a9ce99-2f4c-4baf-857a-02c81d0cae4d",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "f0a9ce99-2f4c-4baf-857a-02c81d0cae4d": {
        "main": [
          [
            {
              "node": "09ba4846-6da9-425c-a762-4f9f4bc1b4e6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "f49cb6b3-195b-42f6-a025-a0e78d62cfca": {
        "main": [
          [
            {
              "node": "2d6517f1-ebbc-48fd-894c-287420175a7a",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "92b514de-5cd0-4f79-9857-123e685a1405": {
        "main": [
          [
            {
              "node": "40a1e96b-15f2-4eb0-bdad-bd7532b02a22",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Results_Sheets_01": {
        "main": [
          [
            {
              "node": "Send WhatsApp Expert Alert",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Email Trigger (IMAP)1": {
        "main": [
          [
            {
              "node": "Shop Configuration2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Error Handler": {
        "main": [
          [
            {
              "node": "Retry Queue",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Retry Queue": {
        "main": [
          [
            {
              "node": "Expression Repair",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "main": [
        [
          [
            {
              "node": "7a01b7e8-3184-4982-92f4-a0ba03f781a4",
              "type": "main",
              "index": 0
            },
            {
              "node": "errorHandler-1766014501177-9ez5es86k",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "errorHandler-1766014501177-9ez5es86k",
              "type": "main",
              "index": 0
            },
            {
              "node": "4c9f8649-a6b7-45dd-9ed9-b9134be84018",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "4c9f8649-a6b7-45dd-9ed9-b9134be84018",
              "type": "main",
              "index": 0
            },
            {
              "node": "c0c41789-4c7d-4efc-861f-885743a1aff8",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "errorHandler-1766014501177-9ez5es86k",
              "type": "main",
              "index": 1
            },
            {
              "node": "80b0ee00-87d9-44ec-8b62-8c86eda7737b",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "7a01b7e8-3184-4982-92f4-a0ba03f781a4",
              "type": "main",
              "index": 1
            },
            {
              "node": "65ca06d9-ae1b-4669-ba03-4418312d0442",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "c0c41789-4c7d-4efc-861f-885743a1aff8",
              "type": "main",
              "index": 0
            },
            {
              "node": "7a01b7e8-3184-4982-92f4-a0ba03f781a4",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "15586a83-cda8-4ac9-9826-9ed77f24fa1c",
              "type": "main",
              "index": 0
            },
            {
              "node": "ai-error-handler-adult-1766019421751-xxxuhgnln",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "ai-error-handler-adult-1766019421751-xxxuhgnln",
              "type": "main",
              "index": 0
            },
            {
              "node": "retry-queue-adult-1766019421751-10y8tihcx",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "retry-queue-adult-1766019421751-10y8tihcx",
              "type": "main",
              "index": 0
            },
            {
              "node": "expression-repair-adult-1766019421752-5eytl5tjg",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "expression-repair-adult-1766019421752-5eytl5tjg",
              "type": "main",
              "index": 0
            },
            {
              "node": "15586a83-cda8-4ac9-9826-9ed77f24fa1c",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "34310e5a-2422-4ce3-a615-5b8f911b5407",
              "type": "main",
              "index": 0
            },
            {
              "node": "ai-error-handler-text-1766019421752-tx9bpgxr6",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "ai-error-handler-text-1766019421752-tx9bpgxr6",
              "type": "main",
              "index": 0
            },
            {
              "node": "retry-queue-text-1766019421752-b389yhp5y",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "retry-queue-text-1766019421752-b389yhp5y",
              "type": "main",
              "index": 0
            },
            {
              "node": "expression-repair-text-1766019421752-rngvhbii6",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "expression-repair-text-1766019421752-rngvhbii6",
              "type": "main",
              "index": 0
            },
            {
              "node": "34310e5a-2422-4ce3-a615-5b8f911b5407",
              "type": "main",
              "index": 0
            }
          ]
        ]
      ],
      "Expression Repair": {
        "main": [
          [
            {
              "node": "Prepare GTN/EAN_Loop",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gemini Error Handler Adult Flags": {
        "main": [
          [
            {
              "node": "Switch Action Handler Adult Flags",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gemini Error Handler Images": {
        "main": [
          [
            {
              "node": "Switch Action Handler Images",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gemini Error Handler Text": {
        "main": [
          [
            {
              "node": "Switch Action Handler Text",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gemini Error Handler Merchant Quality": {
        "main": [
          [
            {
              "node": "Switch Action Handler Merchant Quality",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gemini Error Handler Multi Country": {
        "main": [
          [
            {
              "node": "Switch Action Handler Multi Country",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gemini Error Handler GTN/EAN": {
        "main": [
          [
            {
              "node": "Switch Action Handler GTN/EAN",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch Action Handler Adult Flags": {
        "main": [
          [
            {
              "node": "Rate Limiting",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Rate Limiting",
              "type": "main",
              "index": 0
            },
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch Action Handler Images": {
        "main": [
          [
            {
              "node": "Rate Limiting Images",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Rate Limiting Images",
              "type": "main",
              "index": 0
            },
            {
              "node": "Prepare Images Loop",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch Action Handler Text": {
        "main": [
          [
            {
              "node": "Rate Limiting Text",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Rate Limiting Text",
              "type": "main",
              "index": 0
            },
            {
              "node": "Prepare Text Loop",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch Action Handler Merchant Quality": {
        "main": [
          [
            {
              "node": "Rate Limiting Merchant",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Rate Limiting Merchant",
              "type": "main",
              "index": 0
            },
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch Action Handler Multi Country": {
        "main": [
          [
            {
              "node": "Rate Limiting Country",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Rate Limiting Country",
              "type": "main",
              "index": 0
            },
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch Action Handler GTN/EAN": {
        "main": [
          [
            {
              "node": "Rate Limiting GTN/EAN",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Rate Limiting GTN/EAN",
              "type": "main",
              "index": 0
            },
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Andree Schulz",
    "name": null,
    "description": null,
    "workflowPublishHistory": [
      {
        "createdAt": "2025-12-18T05:43:22.042Z",
        "id": 277,
        "workflowId": "ftZOou7HNgLOwzE5",
        "versionId": "9fcf4182-2ebc-4572-a5de-3ee73e50ebac",
        "event": "activated",
        "userId": "905b93e2-2ccd-4e6b-a613-4d01485a9251"
      },
      {
        "createdAt": "2025-12-18T05:43:22.522Z",
        "id": 278,
        "workflowId": "ftZOou7HNgLOwzE5",
        "versionId": "9fcf4182-2ebc-4572-a5de-3ee73e50ebac",
        "event": "activated",
        "userId": "905b93e2-2ccd-4e6b-a613-4d01485a9251"
      },
      {
        "createdAt": "2025-12-18T05:43:22.975Z",
        "id": 279,
        "workflowId": "ftZOou7HNgLOwzE5",
        "versionId": "9fcf4182-2ebc-4572-a5de-3ee73e50ebac",
        "event": "activated",
        "userId": "905b93e2-2ccd-4e6b-a613-4d01485a9251"
      }
    ]
  }
}