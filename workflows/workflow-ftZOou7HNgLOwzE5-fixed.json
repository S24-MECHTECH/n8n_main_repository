{
  "updatedAt": "2025-12-25T06:29:06.164Z",
  "createdAt": "2025-12-12T04:29:41.476Z",
  "id": "ftZOou7HNgLOwzE5",
  "name": "***MECHTECH_MERCHANT_CENTER_ADMIN",
  "description": "Dieser Workflow ist ein Google_Merchant_center optimierungs workflow, der durch Gemini, die Artikel f√ºr alle gelisteten shops im Google Merchant Center optimieren soll!",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "availableInChat": true,
        "options": {}
      },
      "id": "7ee31291-7f5d-497e-962f-9700beb07459",
      "name": "Chat Trigger (RAG Query)",
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.4,
      "position": [
        -6016,
        3504
      ],
      "webhookId": "1bcc39ec-5b0a-4f6c-abf6-21235fcb6cb1",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "Du bist der MECHTECH Workflow Assistent!\n\nDu hast Zugriff auf die komplette Historie aller Workflow-Ausf√ºhrungen in der Supabase Vector Database.\n\nDeine Aufgaben:\n1. Beantworte Fragen zur Workflow-Historie (Approval Rates, verarbeitete Produkte, Phasen, etc.)\n2. Analysiere Trends und Muster in den Daten\n3. Gib Empfehlungen basierend auf historischen Daten\n4. Erkl√§re was in bestimmten Zeitr√§umen passiert ist\n\nDu kannst auf folgende Informationen zugreifen:\n- Shop-Namen und IDs\n- Verarbeitete Produkte pro Run\n- Success/Failure Counts\n- Approval Rates\n- Phasen (adult_flags, text, images)\n- Timestamps\n- Reasoning der Gemini Decisions\n\nAntworte auf Deutsch, pr√§zise und hilfreich!"
        }
      },
      "id": "70073f18-20e2-4429-af71-0b53ee034ba9",
      "name": "Chat Agent (RAG)",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -5808,
        3504
      ]
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash-exp",
        "options": {}
      },
      "id": "0f3a589e-6ea5-4290-93eb-3a32368ee6bd",
      "name": "Gemini Chat Model (RAG)",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -5888,
        3696
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "mechtech_chat_session",
        "tableName": "n8n_chat_historie",
        "contextWindowLength": 25
      },
      "id": "7a8d9c0c-1bd7-4a20-a636-680bd8145c7b",
      "name": "Postgres Chat Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        -5712,
        3696
      ],
      "credentials": {
        "postgres": {
          "id": "pIp690wi4X79QCKb",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "useCustomSchema": true,
        "operation": "getAll",
        "tableId": "workflow_runs",
        "returnAll": true,
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "created_at",
              "condition": "gte",
              "keyValue": "=={{ $now.startOf('day').toISO() }}"
            }
          ]
        }
      },
      "id": "5e71bf70-6abd-4e77-adee-bb45f4ab93cb",
      "name": "Check Last Run",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -8384,
        4176
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      },
      "onError": "continueErrorOutput",
      "continueOnFail": true
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// PREPARE PRODUCTS LOOP - FIX: Hole Produkte von Analyze Products2\n// ============================================================================\nconst decision = $input.first().json;  // Von Route by Priority (priority, products_to_process)\nconst analysis = $('Analyze Products2').first().json;  // Direkt von Analyze Products2\n\n// Hole Produkte aus Analyze Products2\nconst productsToFix = analysis.products_needing_fix || [];\nconst maxProducts = decision.products_to_process || productsToFix.length;\n\nconst config = $('SHOP_CONFIGURATION').first().json;\n\n// Shop info aus Decision oder Config\nconst shopId = decision.shop_id || config.shop1_id;\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\nconst productsSlice = productsToFix.slice(0, maxProducts);\n\n// ‚úÖ Gibt Array zur√ºck - n8n wird jedes Item einzeln weiterleiten\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    originalProduct: product, // Behalte original product data\n    action: decision.priority || 'prepare',\n    priority: decision.priority || 'prepare',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
      },
      "id": "21c9e5fa-adfa-48ec-a449-3104b8f94f8c",
      "name": "Prepare Products Loop",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6736,
        3920
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $('SHOP_CONFIGURATION').item.json.shop1_id }}/products/{{ $json.product_id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "adult",
              "value": "true"
            },
            {
              "name": "ageGroup",
              "value": "adult"
            },
            {
              "name": "googleProductCategory",
              "value": "778"
            }
          ]
        },
        "options": {}
      },
      "id": "15f49876-cc59-4f1c-b1f3-c887720e434f",
      "name": "Update Product Adult Flag",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -6272,
        3904
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "tableId": "workflow_runs",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "run_date",
              "fieldValue": "={{ $json.run_date }}"
            },
            {
              "fieldId": "shop_id",
              "fieldValue": "={{ $json.shop_id }}"
            },
            {
              "fieldId": "phase",
              "fieldValue": "={{ $json.phase }}"
            },
            {
              "fieldId": "products_processed",
              "fieldValue": "={{ $json.products_processed }}"
            },
            {
              "fieldId": "success_count",
              "fieldValue": "={{ $json.success_count }}"
            },
            {
              "fieldId": "approval_rate_after",
              "fieldValue": "={{ $json.approval_rate_after }}"
            }
          ]
        }
      },
      "id": "850a1803-9895-464d-9b33-537c0772bb92",
      "name": "Save Workflow Run",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -7680,
        4752
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "mode": "id",
          "value": "1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE"
        },
        "sheetName": {
          "__rl": true,
          "mode": "name",
          "value": "üìù Daily_Log"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Timestamp": "={{ $json.run_date }}",
            "Shop": "={{ $json.shop_id }}",
            "Phase": "={{ $json.phase }}",
            "Products Processed": "={{ $json.products_processed }}",
            "Success Count": "={{ $json.success_count }}",
            "Failed Count": "={{ $json.failed_count }}",
            "Status": "={{ $json.created_at }}",
            "Action": "={{ $json.gemini_decision }}",
            "Details": "={{ $json.approval_rate_after }}"
          },
          "matchingColumns": [
            "Timestamp"
          ],
          "schema": [
            {
              "id": "Timestamp",
              "displayName": "Timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Shop",
              "displayName": "Shop",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Phase",
              "displayName": "Phase",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Action",
              "displayName": "Action",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Products Processed",
              "displayName": "Products Processed",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Success Count",
              "displayName": "Success Count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Failed Count",
              "displayName": "Failed Count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Details",
              "displayName": "Details",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false,
          "mappings": [
            {
              "column": "Timestamp",
              "value": "={{ $json.run_date }}"
            },
            {
              "column": "Shop",
              "value": "={{ $json.shop_name }}"
            },
            {
              "column": "Phase",
              "value": "={{ $json.phase }}"
            },
            {
              "column": "Action",
              "value": "Daily Run"
            },
            {
              "column": "Products Processed",
              "value": "={{ $json.products_processed }}"
            },
            {
              "column": "Success Count",
              "value": "={{ $json.success_count }}"
            },
            {
              "column": "Failed Count",
              "value": "={{ $json.failed_count }}"
            },
            {
              "column": "Status",
              "value": "={{ $json.status }}"
            },
            {
              "column": "Details",
              "value": "={{ $json.reasoning }}"
            }
          ]
        },
        "options": {}
      },
      "id": "602654fc-6a54-4aab-98dc-4cf9cbaf5fdb",
      "name": "Log Results to Sheets",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.4,
      "position": [
        -5728,
        6208
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "pbNsBLFTIuL9ArMn",
          "name": "Google Sheets"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "chatId": "8562069918:AAFtzEUzCDeUchzybcp2l9Cg4WZ0KBmsWzI",
        "text": "=ü§ñ GEMINI DAILY REPORT - {{ $json.shop_name }}\n\nüìä Phase: {{ $json.phase }}\n‚úÖ Verarbeitet: {{ $json.success_count }}\n‚ùå Fehler: {{ $json.failed_count }}\nüìà Approval Rate: {{ $json.approval_rate_after }}%\n\nüí° Reasoning: {{ $json.reasoning }}\n\nAlles OK? üëç",
        "additionalFields": {}
      },
      "id": "0e71a863-39d8-4787-975a-ee4910bac64a",
      "name": "Send Daily Report",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -7072,
        6256
      ],
      "webhookId": "b5c4cc7d-d366-4cd7-ac2c-0a91ed811e96",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "telegramApi": {
          "id": "CefgWOY6zLuQ1eyX",
          "name": "Telegram account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "sendTo": "={{ $json.to }}",
        "subject": "={{ $json.subject }}",
        "message": "={{ $json.html }}",
        "options": {}
      },
      "id": "3aabb920-11b3-452f-8dcf-cb5b725c71f8",
      "name": "Export Report to Gmail",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        -5888,
        6352
      ],
      "webhookId": "da822d06-d1b7-4cfe-804f-5e778bedbac4",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "gmailOAuth2": {
          "id": "piLkk7aEWM1RFevI",
          "name": "s24.mechtech@gmail.com"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "send",
        "recipientPhoneNumber": "<__PLACEHOLDER_VALUE__Expert WhatsApp Number__>",
        "textBody": "=üö® EXPERT ALERT - MECHTECH Merchant Center\n\nShop: {{ $json.shop_name }}\nPhase: {{ $json.phase }}\n\n‚ö†Ô∏è CRITICAL ISSUES:\n‚ùå Failed: {{ $json.failed_count }}\nüìâ Approval Rate: {{ $json.approval_rate_after }}%\n\nImmediate action required!\n\nDetails: {{ $json.reasoning }}",
        "additionalFields": {}
      },
      "id": "d3e29ed5-30b0-46a5-8f0a-53611a72a621",
      "name": "Send WhatsApp Expert Alert",
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1.1,
      "position": [
        -5728,
        6576
      ],
      "webhookId": "fd8ea9df-d0d5-4e11-a0df-a43a8e68297e",
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "const data = $input.item.json; const html = `<h2>ü§ñ MECHTECH Merchant Center Daily Report</h2><h3>Shop: ${data.shop_name}</h3><table border='1' cellpadding='10'><tr><th>Metric</th><th>Value</th></tr><tr><td>Phase</td><td>${data.phase}</td></tr><tr><td>Products Processed</td><td>${data.products_processed}</td></tr><tr><td>Success Count</td><td>${data.success_count}</td></tr><tr><td>Failed Count</td><td>${data.failed_count}</td></tr><tr><td>Approval Rate</td><td>${data.approval_rate_after}%</td></tr><tr><td>Status</td><td>${data.status}</td></tr></table><p><strong>Reasoning:</strong> ${data.reasoning}</p><p><em>Generated: ${data.run_date}</em></p>`; return [{ json: { subject: `Daily Report - ${data.shop_name} - ${data.phase}`, html: html, to: '<__PLACEHOLDER_VALUE__Report Email Address__>' } }];"
      },
      "id": "132312b4-2cce-44b1-ad9d-89ed08efc71e",
      "name": "Format Report for Email",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6288,
        6176
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// FIXED: Only check SUBJECT for commands (ignore spam)\nconst input = $input.item.json;\n\n// Only use subject - ignore body/snippet to avoid spam\nconst subject = (input.subject || '').toLowerCase().trim();\n\n// Check if subject contains \"command\" keyword\nif (!subject.includes('command') && !subject.includes('mechtech')) {\n  // Not a command email - skip it\n  return [];\n}\n\n// Extract command from subject\nconst text = subject.replace('command:', '').replace('mechtech:', '').trim();\n\nlet action = 'unknown';\nlet params = {};\n\nif (text.includes('status')) {\n  action = 'get_status';\n} else if (text.includes('pause')) {\n  action = 'pause_workflow';\n} else if (text.includes('resume')) {\n  action = 'resume_workflow';\n} else if (text.includes('report')) {\n  action = 'send_report';\n} else if (text.includes('help')) {\n  action = 'show_help';\n} else if (text.includes('optimize')) {\n  action = 'run_optimization';\n  // Check which shop\n  if (text.includes('shop1') || text.includes('siliconedolls24')) {\n    params.shop = 'shop1';\n  } else if (text.includes('shop2') || text.includes('dreamdoll')) {\n    params.shop = 'shop2';\n  } else {\n    params.shop = 'both';\n  }\n} else {\n  // Unknown command\n  action = 'unknown';\n}\n\nreturn [{\n  json: {\n    action: action,\n    params: params,\n    original_text: text,\n    source: input.from || input.sender || 'unknown',\n    subject: input.subject || ''\n  }\n}];"
      },
      "id": "00e1c549-bb00-436d-86a4-7b367fe7d17f",
      "name": "Parse Command Input",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8624,
        4016
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "id-1",
              "leftValue": "={{ $json.failed_count }}",
              "rightValue": 10,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            },
            {
              "id": "id-2",
              "leftValue": "={{ $json.approval_rate_after }}",
              "rightValue": 50,
              "operator": {
                "type": "number",
                "operation": "lt"
              }
            }
          ],
          "combinator": "or"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "64eab193-81bd-4180-918e-e98e2e1a1527",
      "name": "Check if Expert Needed",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -6288,
        6368
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.action }}",
                    "rightValue": "get_status",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "445605f9-402d-4973-9957-5754b69fb8fc"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Status"
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {
          "fallbackOutput": "extra",
          "renameFallbackOutput": "Unknown Command"
        }
      },
      "id": "f0161c28-a4ae-4e58-bfac-2dbed4068aba",
      "name": "Route Command",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -8384,
        3984
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "sendTo": "info@mechtech-support.com",
        "subject": "=",
        "emailType": "text",
        "message": "={{ $('Get Workflow Status REAL').item.json.error }}",
        "options": {}
      },
      "id": "67b0076c-d8c8-488e-a213-058c2f51af3b",
      "name": "Send Command Response",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.2,
      "position": [
        -8096,
        3888
      ],
      "webhookId": "5cf94981-2360-49f1-b7d4-6c512f562360",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "credentials": {
        "gmailOAuth2": {
          "id": "piLkk7aEWM1RFevI",
          "name": "s24.mechtech@gmail.com"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// PREPARE IMAGES LOOP - FIX: Hole Produkte von Analyze Products2\n// ============================================================================\nconst decision = $input.first().json;  // Von Route by Priority\nconst analysis = $('Analyze Products2').first().json;  // Direkt von Analyze Products2\n\n// Hole Produkte aus Analyze Products2\nconst productsToFix = analysis.products_needing_fix || [];\nconst maxProducts = decision.products_to_process || productsToFix.length;\n\nconst config = $('SHOP_CONFIGURATION').first().json;\n\n// Shop info aus Decision oder Config\nconst shopId = decision.shop_id || config.shop1_id;\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\nconst productsSlice = productsToFix.slice(0, maxProducts);\n\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    image_link: product.imageLink || product.image_link,\n    action: 'images',\n    priority: 'images',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
      },
      "id": "8925d0f5-5df3-4ea0-a5bf-82f079f9d2b3",
      "name": "Prepare Images Loop",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6736,
        4096
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $('SHOP_CONFIGURATION').item.json.shop1_id }}/products/{{ $json.product.id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "imageLink",
              "value": "={{ $json.product.imageLink }}"
            }
          ]
        },
        "options": {}
      },
      "id": "deb42c69-6a74-4f24-8793-4183a7ee384a",
      "name": "Update Product Images",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -6272,
        4080
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "amount": 2
      },
      "id": "8cfddd90-0a59-4744-a9f6-5a103c424b46",
      "name": "Rate Limiting Images",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -5232,
        4064
      ],
      "webhookId": "03758724-2fd2-4cf0-bc96-1ba04b9fa35c",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $('SHOP_CONFIGURATION').item.json.shop1_id }}/products/{{ $json.product.id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "title",
              "value": "={{ $json.product.title }}"
            },
            {
              "name": "description",
              "value": "={{ $json.product.description }}"
            }
          ]
        },
        "options": {}
      },
      "id": "35e9f617-3388-4125-840c-dfe54b9b9896",
      "name": "Update Product Text",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -6272,
        4256
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "amount": 2
      },
      "id": "6b2da695-ddac-492a-85a5-477b7d0de310",
      "name": "Rate Limiting Text",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -5232,
        4256
      ],
      "webhookId": "fade3537-0739-4667-80c9-7636461ed902",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const input = $input.item.json;\nconst invalidPriority = input.priority || 'unknown';\nconst reasoning = input.reasoning || 'No reasoning provided';\n\nconst errorResult = {\n  processed_count: 0,\n  failed_count: 0,\n  error: 'Invalid priority received from Gemini',\n  invalid_priority: invalidPriority,\n  gemini_reasoning: reasoning,\n  timestamp: new Date().toISOString(),\n  debug_info: {\n    expected_priorities: ['adult_flags', 'images', 'text'],\n    received_priority: invalidPriority,\n    full_gemini_response: input\n  }\n};\n\nreturn [{ json: errorResult }];"
      },
      "id": "6c91bd2a-2b2d-4667-b476-65c4efc415cd",
      "name": "Handle Invalid Priority",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8144,
        4768
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// ANALYZE PRODUCTS2 - ERWEITERTE VERSION\n// Analysiert ALLE Google Merchant Center Issues und taggt Produkte\n// ============================================================================\n\nconst products = $input.item.json.resources || [];\n\n// Helper: Extrahiere Issue Types aus Google Issues Array\nfunction extractIssueTypes(product) {\n  if (!product.issues || product.issues.length === 0) return [];\n  return product.issues.map(issue => issue.servability || issue.attributeName || 'unknown');\n}\n\n// ============================================================================\n// 1. ADULT FLAGS ISSUES\n// ============================================================================\nconst adultIssues = products.filter(p => {\n  const hasAdultFlag = p.adult === true || p.ageGroup === 'adult';\n  const isAdultProduct = p.title?.toLowerCase().includes('adult') || \n                          p.description?.toLowerCase().includes('adult');\n  const issues = extractIssueTypes(p);\n  const hasAdultIssue = issues.includes('adult_content_not_flagged');\n  \n  return (!hasAdultFlag && isAdultProduct) || hasAdultIssue;\n});\n\n// ============================================================================\n// 2. IMAGE ISSUES\n// ============================================================================\nconst imageIssues = products.filter(p => {\n  const issues = extractIssueTypes(p);\n  return !p.imageLink || \n         p.imageLink === '' ||\n         issues.includes('invalid_image_url') ||\n         issues.includes('image_link_crawl_error') ||\n         issues.includes('image_link_broken');\n});\n\n// ============================================================================\n// 3. TEXT/DESCRIPTION ISSUES\n// ============================================================================\nconst textIssues = products.filter(p => {\n  const issues = extractIssueTypes(p);\n  const descTooShort = p.description && p.description.length < 50;\n  const titleTooShort = p.title && p.title.length < 10;\n  \n  return !p.description ||\n         descTooShort ||\n         titleTooShort ||\n         issues.includes('invalid_description') ||\n         issues.includes('missing_description') ||\n         issues.includes('invalid_title');\n});\n\n// ============================================================================\n// 4. GTIN/EAN ISSUES\n// ============================================================================\nconst gtinIssues = products.filter(p => {\n  const issues = extractIssueTypes(p);\n  return !p.gtin || \n         p.gtin === '' ||\n         issues.includes('missing_gtin_or_mpn') ||\n         issues.includes('invalid_gtin');\n});\n\n// ============================================================================\n// 5. MPN ISSUES\n// ============================================================================\nconst mpnIssues = products.filter(p => {\n  return !p.mpn || p.mpn === '';\n});\n\n// ============================================================================\n// 6. BRAND ISSUES\n// ============================================================================\nconst brandIssues = products.filter(p => {\n  const issues = extractIssueTypes(p);\n  return !p.brand || \n         p.brand === '' ||\n         issues.includes('missing_brand');\n});\n\n// ============================================================================\n// 7. IDENTIFIER EXISTS ISSUES\n// ============================================================================\nconst identifierIssues = products.filter(p => {\n  return p.identifierExists === false;\n});\n\n// ============================================================================\n// 8. MERCHANT QUALITY ISSUES\n// ============================================================================\nconst merchantIssues = products.filter(p => {\n  const issues = extractIssueTypes(p);\n  return issues.includes('missing_shipping_info') ||\n         issues.includes('invalid_price') ||\n         issues.includes('missing_category') ||\n         issues.includes('shipping_policy_error');\n});\n\n// ============================================================================\n// 9. COUNTRY/MULTI-COUNTRY ISSUES\n// ============================================================================\nconst countryIssues = products.filter(p => {\n  const issues = extractIssueTypes(p);\n  return issues.includes('country_feed_missing') ||\n         issues.includes('target_country_issue');\n});\n\n// ============================================================================\n// 10. TAG JEDES PRODUKT MIT PRIORITIES\n// ============================================================================\nconst taggedProducts = products.map(p => {\n  const tags = [];\n  const issues = extractIssueTypes(p);\n  \n  // Adult\n  if (!p.adult && (p.title?.toLowerCase().includes('adult') || \n      issues.includes('adult_content_not_flagged'))) {\n    tags.push('adult_flags');\n  }\n  \n  // Images\n  if (!p.imageLink || issues.includes('invalid_image_url') || \n      issues.includes('image_link_crawl_error')) {\n    tags.push('images');\n  }\n  \n  // Text\n  if (!p.description || (p.description && p.description.length < 50) ||\n      issues.includes('invalid_description')) {\n    tags.push('text');\n  }\n  \n  // GTIN\n  if (!p.gtin || issues.includes('missing_gtin_or_mpn')) {\n    tags.push('multi_gtn_ean');\n  }\n  \n  // MPN\n  if (!p.mpn) {\n    tags.push('multi_gtn_ean');\n  }\n  \n  // Brand\n  if (!p.brand || issues.includes('missing_brand')) {\n    tags.push('multi_gtn_ean');\n  }\n  \n  // Merchant\n  if (issues.includes('missing_shipping_info') || \n      issues.includes('invalid_price')) {\n    tags.push('merchant_quality');\n  }\n  \n  // Country\n  if (issues.includes('country_feed_missing')) {\n    tags.push('multi_country');\n  }\n  \n  return {\n    ...p,\n    priority_tags: [...new Set(tags)], // Remove duplicates\n    issue_count: tags.length\n  };\n});\n\n// ============================================================================\n// 11. SAMMLE ALLE PRODUKTE MIT ISSUES\n// ============================================================================\nconst productsNeedingFix = taggedProducts.filter(p => p.priority_tags.length > 0);\n\n// Sort by issue_count (highest first)\nproductsNeedingFix.sort((a, b) => b.issue_count - a.issue_count);\n\n// Rolling Window: max 100 gleichzeitig\nconst batch = productsNeedingFix.slice(0, 100);\n\n// ============================================================================\n// 12. STATISTIKEN\n// ============================================================================\nconst stats = {\n  adult_issues: adultIssues.length,\n  image_issues: imageIssues.length,\n  text_issues: textIssues.length,\n  gtin_issues: gtinIssues.length,\n  mpn_issues: mpnIssues.length,\n  brand_issues: brandIssues.length,\n  identifier_issues: identifierIssues.length,\n  merchant_issues: merchantIssues.length,\n  country_issues: countryIssues.length\n};\n\n// Approval Rate\nconst disapproved = products.filter(p => p.issues && p.issues.length > 0).length;\nconst approved = products.length - disapproved;\nconst approvalRate = products.length > 0 ? ((approved / products.length) * 100).toFixed(2) : 0;\n\nreturn [{\n  json: {\n    products_needing_fix: batch,\n    total_products_with_issues: productsNeedingFix.length,\n    current_approval_rate: approvalRate,\n    total_products: products.length,\n    approved_count: approved,\n    disapproved_count: disapproved,\n    \n    // Detaillierte Stats\n    ...stats,\n    \n    // F√ºr Debugging\n    all_tagged_products: taggedProducts\n  }\n}];\n"
      },
      "id": "0bcf78a4-ef4a-4725-bd32-d260c9023868",
      "name": "Analyze Products2",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8384,
        4368
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// AGGREGATE RESULTS2 - MIT ERROR-HANDLING\n// ============================================================================\nconst allItems = $input.all();\n\nlet processedCount = 0;\nlet failedCount = 0;\nconst errors = [];\n\nallItems.forEach(item => {\n  if (item.json && item.json.processed_count !== undefined) {\n    processedCount += item.json.processed_count || 0;\n  }\n  if (item.error || (item.json && item.json.error)) {\n    failedCount++;\n    errors.push({\n      product_id: item.json?.product_id || item.json?.id || 'unknown',\n      title: item.json?.title || 'N/A',\n      error: item.error?.message || item.json?.error?.message || 'Unknown error',\n      timestamp: new Date().toISOString()\n    });\n  } else if (item.json && item.json.failed_count !== undefined) {\n    failedCount += item.json.failed_count || 0;\n  }\n});\n\nlet config, analysis, decision;\ntry { config = $('SHIOP_CONFIGURATION').first().json; } catch (e) { config = { shop1_id: 'unknown', shop1_name: 'unknown' }; }\ntry { analysis = $('Analyze Products2').first().json; } catch (e) { analysis = { current_approval_rate: 0 }; }\ntry { decision = $('Gemini Daily Decision').first().json; } catch (e) { decision = { priority: 'unknown', reasoning: 'N/A' }; }\n\nconst result = {\n  shop_id: config.shop1_id || 'unknown',\n  shop_name: config.shop1_name || 'unknown',\n  run_date: new Date().toISOString(),\n  phase: decision.priority || decision.decision_type || 'unknown',\n  products_processed: processedCount,\n  success_count: processedCount,\n  failed_count: failedCount,\n  approval_rate_before: analysis.current_approval_rate || 0,\n  approval_rate_after: analysis.current_approval_rate || 0,\n  reasoning: decision.reasoning || decision.reason || 'Processing products',\n  status: failedCount === 0 ? 'success' : failedCount < processedCount ? 'partial_success' : 'failed',\n  error_count: errors.length,\n  errors: errors.length > 0 ? errors.slice(0, 10) : []\n};\n\nreturn [{ json: result }];"
      },
      "id": "5affa3dd-0306-4a45-a768-e5c34db10f95",
      "name": "Aggregate Results2",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7920,
        4768
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// PREPARE MERCHANT QUALITY LOOP - FIX: Hole Produkte von Analyze Products2\n// ============================================================================\nconst decision = $input.first().json;  // Von Route by Priority\nconst analysis = $('Analyze Products2').first().json;  // Direkt von Analyze Products2\n\n// Hole Produkte aus Analyze Products2\nconst productsToFix = analysis.products_needing_fix || [];\nconst maxProducts = decision.products_to_process || productsToFix.length;\n\nconst config = $('SHOP_CONFIGURATION').first().json;\n\n// Shop info aus Decision oder Config\nconst shopId = decision.shop_id || config.shop1_id;\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\nconst productsSlice = productsToFix.slice(0, maxProducts);\n\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    action: 'merchant_quality',\n    priority: 'merchant_quality',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
      },
      "name": "Prepare Merchant Quality Loop",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6736,
        4464
      ],
      "id": "5e197faf-d512-41c0-a461-f8b956a5c912",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/shippingsettings",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"accountId\": \"{{ $json.shop_id }}\",\n  \"services\": [{\n    \"name\": \"Standard Shipping\",\n    \"active\": true,\n    \"deliveryCountry\": \"DE\",\n    \"deliveryTime\": {\n      \"minHandlingTimeInDays\": 1,\n      \"maxHandlingTimeInDays\": 3,\n      \"minTransitTimeInDays\": 2,\n      \"maxTransitTimeInDays\": 5\n    },\n    \"rateGroups\": [{\n      \"singleValue\": {\n        \"flatRate\": {\n          \"value\": \"0\",\n          \"currency\": \"EUR\"\n        }\n      }\n    }]\n  }]\n}",
        "options": {}
      },
      "name": "Update Merchant Settings",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -6272,
        4448
      ],
      "id": "57fcddb5-77a8-4ba8-b4dc-2192621944a0",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "amount": 2
      },
      "name": "Rate Limiting Merchant",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -5232,
        4432
      ],
      "id": "4b35c3df-2960-48e8-965f-04cf264c9664",
      "webhookId": "rate-limit-merchant-webhook",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// PREPARE MULTI COUNTRY LOOP - SEQUENTIELLE VERARBEITUNG\n// ============================================================================\nconst inputItem = $input.first().json;\nconst config = $('SHOP_CONFIGURATION').first().json;\n\n// Multi-Country Logik - sequenziell verarbeiten (ein Item)\nreturn {\n  json: {\n    ...inputItem,\n    action: 'multi_country',\n    priority: 'multi_country',\n    multi_country_processed: true,\n    countries: inputItem.countries || inputItem.countries_from_gemini || [],\n    shipping: inputItem.shipping || []\n  }\n};"
      },
      "name": "Prepare Multi Country Loop",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6736,
        4688
      ],
      "id": "988f55fa-740d-4eef-9df2-920bbcdb193f",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/products/{{ $json.product_id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"destinations\": [\n    {{ $json.countries.map(c => `{\"destinationName\": \"Shopping_ads\", \"country\": \"${c}\"}`).join(',') }}\n  ],\n  \"shipping\": [\n    {{ $json.countries.map(c => `{\"country\": \"${c}\", \"price\": {\"value\": \"0\", \"currency\": \"EUR\"}}`).join(',') }}\n  ]\n}",
        "options": {}
      },
      "name": "Update Country Feeds",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -6272,
        4672
      ],
      "id": "3d833aef-105f-4b29-b39d-210bec84b62e",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "amount": 2
      },
      "name": "Rate Limiting Country",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -5232,
        4656
      ],
      "id": "fe1897ad-0183-411d-ad54-bedc90a0531c",
      "webhookId": "rate-limit-country-webhook",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "adult_flags",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "adult-flags-condition"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Adult Flags"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "images",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "images-condition"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Images"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "text",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "text-condition"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "merchant_quality",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "merchant-quality-condition"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Merchant Quality"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "multi_country",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "multi-country-condition"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Multi Country"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b85d4e72-545e-46d6-9d63-bb8819eeffb5",
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "multi_gtn_ean",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Multi GTN/EAN"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "59b9840f-42a0-40e1-8219-74cda70e3389",
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "H√§ndlerqualit√§t",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "H√§ndlerqualit√§t"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "0c1be4fa-a537-4377-97e3-6f36cd0ba8d0",
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "Gemini_S24",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Gemini_S24"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "51567b03-a03e-487d-9083-fbc339177f75",
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "Gemini_DDC",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Gemini_DDC"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "9d7772c0-b5a4-451e-a8f2-c9852eff5496",
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "GTNI/EAN Hersteller Recherche"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "2d85adf4-528d-4e12-9dff-d4ed344383f6",
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Error‚ÄëAgent"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "renameFallbackOutput": "Fallback"
        }
      },
      "name": "Route by Priority",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -7056,
        4448
      ],
      "id": "b5972a12-c451-453b-86d6-ee3ea66a8de3",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('SHOP_CONFIGURATION').item.json.supabase_url }}/rest/v1/products",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $('SHOP_CONFIGURATION').item.json.supabase_key }}"
            },
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('SHOP_CONFIGURATION').item.json.supabase_key }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Prefer",
              "value": "resolution=merge-duplicates"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"shop_id\": \"{{ $json.shop_id }}\",\n  \"shop_name\": \"{{ $json.shop_name }}\",\n  \"shop_url\": \"{{ $json.shop_id === '5339977843' ? 'www.siliconedolls24.com' : 'www.dreamdoll.de' }}\",\n  \"product_id\": \"{{ $json.product_id }}\",\n  \"offer_id\": \"{{ $json.offer_id }}\",\n  \"title\": \"{{ $json.title }}\",\n  \"image_link\": \"{{ $json.image_link || '' }}\",\n  \"adult_flag_set\": {{ $json.action === 'adult_flags' || $json.priority === 'adult_flags' ? 'true' : 'false' }},\n  \"text_sanitized\": {{ $json.action === 'text' || $json.priority === 'text' ? 'true' : 'false' }},\n  \"image_optimized\": {{ $json.action === 'images' || $json.priority === 'images' ? 'true' : 'false' }},\n  \"feed_optimized\": true,\n  \"shipping_set\": {{ $json.action === 'merchant_quality' || $json.priority === 'merchant_quality' ? 'true' : 'false' }},\n  \"returns_set\": {{ $json.action === 'merchant_quality' || $json.priority === 'merchant_quality' ? 'true' : 'false' }},\n  \"tax_set\": {{ $json.action === 'merchant_quality' || $json.priority === 'merchant_quality' ? 'true' : 'false' }},\n  \"multi_country\": {{ $json.action === 'multi_country' || $json.priority === 'multi_country' ? 'true' : 'false' }},\n  \"status\": \"SUCCESS\",\n  \"last_optimized_at\": \"{{ $now.toISO() }}\"\n}",
        "options": {}
      },
      "name": "Save to Supabase Products",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -6752,
        6608
      ],
      "id": "1a3ed50c-5fbd-4584-9aa0-2ccdd758b69c",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "waitBetweenTries": 3000,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('SHOP_CONFIGURATION').item.json.supabase_url }}/rest/v1/rpc/update_pattern_success",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $('SHOP_CONFIGURATION').item.json.supabase_key }}"
            },
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('SHOP_CONFIGURATION').item.json.supabase_key }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"p_pattern_type\": \"{{ $json.action || $json.priority }}\",\n  \"p_success\": true\n}",
        "options": {}
      },
      "name": "Update Optimization Patterns",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -6288,
        6592
      ],
      "id": "dc92aeb6-cceb-4d91-8162-a6efc34a6092",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1R1fYQTswbGBDzLoizyTNPKVLup1ie0_ksqBTLc5E48s/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": 1181382825,
          "mode": "list",
          "cachedResultName": "üß† AI_Learning",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1R1fYQTswbGBDzLoizyTNPKVLup1ie0_ksqBTLc5E48s/edit#gid=1181382825"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "Timestamp",
              "displayName": "Timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Problem_Type",
              "displayName": "Problem_Type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Human_Instruction",
              "displayName": "Human_Instruction",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "AI_Solution",
              "displayName": "AI_Solution",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Success_Rate",
              "displayName": "Success_Rate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Applied_Count",
              "displayName": "Applied_Count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Pattern_ID",
              "displayName": "Pattern_ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "name": "Get Human Instructions",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.4,
      "position": [
        -7936,
        5264
      ],
      "id": "a56f69ce-a923-4fea-854d-03e5ee5b1f30",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "cztAb4CKfRPRO8KX",
          "name": "Google Sheets account"
        }
      },
      "onError": "continueErrorOutput",
      "continueOnFail": true
    },
    {
      "parameters": {
        "jsCode": "// Filter: Nur Zeilen MIT Human Instructions UND OHNE AI Response\nconst items = $input.all();\n\nconst needsProcessing = items.filter(item => {\n  const row = item.json || {};\n\n  const instruction = (row.Human_Instructions || '').trim();\n  const aiResponse = (row.AI_Response || '').trim();\n\n  return instruction !== '' && aiResponse === '';\n});\n\n// Wenn nichts zu tun ist ‚Üí leeres Array zur√ºckgeben\nreturn needsProcessing;\n"
      },
      "name": "Filter Unprocessed Instructions",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7680,
        5248
      ],
      "id": "bb3f2a87-ddaf-4397-9590-fe9b5ae181cd",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Du bist der Learning Agent f√ºr MECHTECH.\n\nDeine Aufgaben:\n1. Lies die Human Instructions aus Google Sheets.\n2. Verstehe exakt, was der Mensch erreichen will.\n3. Erstelle ein klares Pattern und eine technische L√∂sung.\n4. Bestimme, ob diese L√∂sung auf √§hnliche Produkte angewendet werden kann.\n5. Extrahiere Keywords f√ºr √§hnliche Produkte.\n6. Du erzeugst NUR das JSON. Kein Schreiben in Datenbanken.\n\nWenn der Mensch Fehler macht:\n- Erkenne den Fehler.\n- Formuliere einen freundlichen Hinweis.\n- Schlage eine bessere L√∂sung vor.\n\nAntworte IMMER als JSON im folgenden Format:\n{\n  \"ai_response\": \"Antwort an den Menschen\",\n  \"solution\": \"Technische L√∂sung / Pattern\",\n  \"pattern_type\": \"adult_flags | text | images | merchant_quality | multi_country | multi_gtin_ean\",\n  \"ai_confidence\": 0-100,\n  \"apply_to_similar\": true/false,\n  \"similar_keywords\": [\"keyword1\", \"keyword2\"],\n  \"warning\": \"Optional: Hinweis, wenn Mensch Fehler macht\"\n}\n",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "Du bist der Learning Agent f√ºr MECHTECH!\n\nDeine Aufgabe:\n1. Lese Human Instructions aus Google Sheets\n2. Verstehe was der Mensch will\n3. Erstelle Pattern/L√∂sung\n4. Wende auf √§hnliche Produkte an\n5. Speichere Learning in Supabase\n\nWenn Mensch Fehler macht:\n- Erkenne es!\n- Gib freundlichen Hinweis\n- Schlage bessere L√∂sung vor\n\nAntworte IMMER als JSON:\n{\n  \"ai_response\": \"Deine Antwort an den Menschen\",\n  \"solution\": \"Was du tun wirst\",\n  \"pattern_type\": \"adult_flags|text|images|merchant_quality|multi_country/multi gtn/ean\",\n  \"ai_confidence\": 85,\n  \"apply_to_similar\": true,\n  \"similar_keywords\": [\"keyword1\", \"keyword2\"],\n  \"warning\": \"Optional: Wenn Mensch Fehler macht\"\n}"
        }
      },
      "name": "Process Instructions with Gemini",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        -7440,
        5232
      ],
      "id": "31a278c1-7ca3-4bc6-a1b4-f67b95828fe9",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash-exp",
        "options": {}
      },
      "name": "Gemini Model Learning",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -7440,
        5424
      ],
      "id": "38d988a9-c369-48a7-b325-40a46b498233",
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"product_id\": \"{{ $json.Product_ID }}\",\n  \"product_title\": \"{{ $json.Title }}\",\n  \"human_instruction\": \"{{ $json.Human_Instructions }}\",\n  \"shop_id\": \"{{ $json.Shop_ID }}\",\n  \"category\": \"{{ $json.Category }}\",\n  \"keywords\": \"{{ $json.Keywords }}\",\n  \"notes\": \"{{ $json.Notes }}\"\n}\n"
      },
      "name": "JSON Parser Learning",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        -7296,
        5424
      ],
      "id": "a61ab791-ef51-4dc6-879c-b3ef6d6ed1e1",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// Apply solution to similar products\nconst instruction = $input.item.json;\nconst geminiResponse = $('Process Instructions with Gemini').item.json;\n\nif (!geminiResponse.apply_to_similar) {\n  return [{\n    json: {\n      ...instruction,\n      ai_response: geminiResponse.ai_response,\n      ai_confidence: geminiResponse.ai_confidence,\n      applied_to_similar: 0\n    }\n  }];\n}\n\n// Get all products from previous steps\nconst allProducts = $('Get Merchant Products_DDC').all();\nconst keywords = geminiResponse.similar_keywords || [];\n\n// Find similar products\nconst similarProducts = allProducts.filter(p => {\n  const title = (p.json.title || '').toLowerCase();\n  return keywords.some(keyword => title.includes(keyword.toLowerCase()));\n});\n\nreturn [{\n  json: {\n    ...instruction,\n    ai_response: geminiResponse.ai_response,\n    ai_confidence: geminiResponse.ai_confidence,\n    applied_to_similar: similarProducts.length,\n    similar_product_ids: similarProducts.map(p => p.json.id),\n    pattern_type: geminiResponse.pattern_type,\n    solution: geminiResponse.solution,\n    warning: geminiResponse.warning || null\n  }\n}];"
      },
      "name": "Apply to Similar Products",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7664,
        5552
      ],
      "id": "d4adc74e-f15a-4ce2-8221-317591817dc9",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "=https://docs.google.com/spreadsheets/d/1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE/edit?gid=122021485#gid=122021485",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "=https://docs.google.com/spreadsheets/d/1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE/edit?gid=1872200725#gid=1872200725",
          "mode": "url"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false,
          "mappings": [
            {
              "column": "AI_Response",
              "value": "={{ $json.ai_response }}"
            },
            {
              "column": "AI_Confidence",
              "value": "={{ $json.ai_confidence }}"
            },
            {
              "column": "Applied_To_Similar",
              "value": "={{ $json.applied_to_similar }}"
            }
          ]
        },
        "options": {}
      },
      "name": "Update Sheet with AI Response",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.4,
      "position": [
        -7088,
        5760
      ],
      "id": "a1e125db-5b1b-4181-bfe4-3ec4fd3d0f83",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "cztAb4CKfRPRO8KX",
          "name": "Google Sheets account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $('SHOP_CONFIGURATION').item.json.supabase_url }}/rest/v1/human_instructions",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "apikey",
              "value": "={{ $('SHOP_CONFIGURATION').item.json.supabase_key }}"
            },
            {
              "name": "Authorization",
              "value": "=Bearer {{ $('SHOP_CONFIGURATION').item.json.supabase_key }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"product_id\": \"{{ $json.Product_ID }}\",\n  \"shop_id\": \"{{ $json.shop_id }}\",\n  \"instruction\": \"{{ $json.Human_Instructions }}\",\n  \"instruction_type\": \"{{ $json.pattern_type }}\",\n  \"ai_response\": \"{{ $json.ai_response }}\",\n  \"ai_confidence\": {{ $json.ai_confidence }},\n  \"ai_action_taken\": \"{{ $json.solution }}\",\n  \"applied_to_similar\": {{ $json.applied_to_similar }},\n  \"status\": \"EXECUTED\",\n  \"executed_at\": \"{{ $now.toISO() }}\"\n}",
        "options": {}
      },
      "name": "Save Learning to Supabase",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -7088,
        5536
      ],
      "id": "d60a8c7b-14b6-40bc-a45d-065f7ae0745f",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// FIXED VERSION - handles both array and object responses\nconst response = $input.item.json;\n\n// Check if response is array or needs to be wrapped\nlet decisions = Array.isArray(response) ? response : (response.data || [response]);\n\n// Filter out empty/null entries\ndecisions = decisions.filter(d => d && d.created_at);\n\nif (!decisions || decisions.length === 0) {\n  return [{\n    json: {\n      response: 'üìä MECHTECH Status\\n\\n‚ùå Noch keine Daten!\\n\\nWorkflow l√§uft t√§glich alle 4 Stunden.',\n      recipient: $('Parse Command Input').item.json.source,\n      subject: 'MECHTECH Status Report'\n    }\n  }];\n}\n\nconst lastRun = decisions[0];\nconst total = decisions.reduce((sum, d) => sum + (d.products_processed || 0), 0);\nconst successRate = total > 0 \n  ? ((decisions.reduce((sum, d) => sum + (d.success_count || 0), 0) / total) * 100).toFixed(1)\n  : 0;\n\nconst responseText = `üìä MECHTECH WORKFLOW STATUS\n\n‚úÖ Letzte Ausf√ºhrung:\n- Shop: ${lastRun.shop_name || 'N/A'}\n- Datum: ${new Date(lastRun.created_at).toLocaleString('de-DE')}\n- Phase: ${lastRun.decision_type || 'N/A'}\n- Produkte: ${lastRun.products_processed || 0}\n- Erfolge: ${lastRun.success_count || 0}\n\nüìà Letzte ${decisions.length} Runs:\n- Total Produkte: ${total}\n- Success Rate: ${successRate}%\n- Kosten: ‚Ç¨3.00\n\n‚è∞ N√§chster Run: T√§glich 2:00 AM\n\nüí° Commands:\n- status: Aktueller Status\n- report: Vollst√§ndiger Report\n- help: Hilfe`;\n\nreturn [{\n  json: {\n    response: responseText,\n    recipient: $('Parse Command Input').item.json.source,\n    subject: 'MECHTECH Status Report'\n  }\n}];"
      },
      "name": "Format Status Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7840,
        6192
      ],
      "id": "fc84037e-86c7-491d-9d9b-c4f0f9c3d1da",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        -5568,
        3696
      ],
      "id": "e5c5b910-0e54-42f5-a860-40223b56f3f0",
      "name": "MCP Client"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -8624,
        5008
      ],
      "id": "6ec4192b-4335-431f-82e8-e4ab3583e7c1",
      "name": "When clicking ‚ÄòExecute workflow‚Äô",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "disabled": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 2
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        -8624,
        5264
      ],
      "id": "72c8c105-e206-497b-a1cc-1b93bcae1333",
      "name": "Schedule Trigger",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE",
          "mode": "list",
          "cachedResultName": "MECHTECH Merchant Center Dashboard",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1872200725,
          "mode": "list",
          "cachedResultName": "üìù Daily_Log",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE/edit#gid=1872200725"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Timestamp": "={{ $json.run_date }}{{ $('Check Last Run').item.json.created_at }}",
            "Shop": "={{ $json.shop_id }}",
            "Phase": "={{ $json.phase }}",
            "Products Processed": "={{ $json.products_processed }}",
            "Success Count": "={{ $json.success_count }}",
            "Failed Count": "={{ $json.failed_count }}",
            "Status": "={{ $json.created_at }}",
            "Action": "={{ $json.gemini_decision }}",
            "Details": "={{ $json.approval_rate_after }}"
          },
          "matchingColumns": [
            "Timestamp"
          ],
          "schema": [
            {
              "id": "Timestamp",
              "displayName": "Timestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Shop",
              "displayName": "Shop",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Phase",
              "displayName": "Phase",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Action",
              "displayName": "Action",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Products Processed",
              "displayName": "Products Processed",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Success Count",
              "displayName": "Success Count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Failed Count",
              "displayName": "Failed Count",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Status",
              "displayName": "Status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Details",
              "displayName": "Details",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false,
          "mappings": [
            {
              "column": "Timestamp",
              "value": "={{ $json.run_date }}"
            },
            {
              "column": "Shop",
              "value": "={{ $json.shop_name }}"
            },
            {
              "column": "Phase",
              "value": "={{ $json.phase }}"
            },
            {
              "column": "Action",
              "value": "Daily Run"
            },
            {
              "column": "Products Processed",
              "value": "={{ $json.products_processed }}"
            },
            {
              "column": "Success Count",
              "value": "={{ $json.success_count }}"
            },
            {
              "column": "Failed Count",
              "value": "={{ $json.failed_count }}"
            },
            {
              "column": "Status",
              "value": "={{ $json.status }}"
            },
            {
              "column": "Details",
              "value": "={{ $json.reasoning }}"
            }
          ]
        },
        "options": {}
      },
      "id": "d3286ddf-6aa7-4f3e-a806-e0ba6963ee4f",
      "name": "Log Results_Sheets_01",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.4,
      "position": [
        -5728,
        6016
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "pbNsBLFTIuL9ArMn",
          "name": "Google Sheets"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.emailReadImap",
      "typeVersion": 2.1,
      "position": [
        -8624,
        4784
      ],
      "id": "688575a9-a832-4802-ae6a-70387ea4bacb",
      "name": "Email Trigger (IMAP)1",
      "credentials": {
        "imap": {
          "id": "CdpePT9CweqekWEC",
          "name": "IMAP info@mechtech-support.com"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        -4256,
        3904
      ],
      "id": "0c538ce4-adaf-4863-a51e-3ec57398b3d9",
      "name": "MCP Client2"
    },
    {
      "parameters": {
        "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        -4384,
        3904
      ],
      "id": "715e018e-47d3-4848-868e-f5c9847c2a53",
      "name": "Supabase RAG Context1",
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Error from Update Product Adult Flag: {{ $json.error || $json.message || \"Unknown error\" }}. \nProduct ID: {{ $json.product_id }}. \nAnalyze this error and suggest a fix.",
        "options": {
          "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the Update Product Adult Flag operation and provide actionable solutions.\n\nDu bist ein strikter Fehler-Fix-Agent. Gib deine Antwort AUSSCHLIESSLICH im folgenden JSON-Format zur√ºck:\n\n{\n  \"fix_type\": \"\",\n  \"field\": \"\",\n  \"new_value\": \"\",\n  \"reason\": \"\",\n  \"details\": \"\"\n}\n\nRegeln:\n- fix_type MUSS einer der folgenden Werte sein:\n  \"fix_text\", \"fix_image\", \"fix_gtin\", \"fix_attribute\", \"fix_policy\", \"fix_quality\"\n- field MUSS das betroffene Produktfeld sein (z. B. title, description, image_link, gtin, color, size)\n- new_value MUSS der korrigierte Wert sein\n- reason = kurze Begr√ºndung\n- details = zus√§tzliche Details\n- KEINE weiteren Felder\n- KEIN Text au√üerhalb des JSON\n- KEINE Erkl√§rungen\n- KEINE Kommentare\n- KEINE zus√§tzlichen Objekte"
        }
      },
      "id": "c0278cf2-399a-4b2b-b762-6f4ea6c4ce76",
      "name": "AI Error Analyzer Adult Flags",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -4896,
        3888
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        -4256,
        4112
      ],
      "id": "f1384400-fb23-4789-8fa6-d6852887afa9",
      "name": "MCP Client3"
    },
    {
      "parameters": {
        "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        -4384,
        4112
      ],
      "id": "cc0e7570-253b-42ea-94b0-bb2ba7b5612d",
      "name": "Supabase RAG Context2",
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Error: {{ $json.error || $json.message || \"Unknown error\" }}.\nProduct ID: {{ $json.product_id }}.\nAnalyze this error and suggest a fix.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the current operation and provide actionable solutions.\n\nDu bist ein strikter Fehler-Fix-Agent. Gib deine Antwort AUSSCHLIESSLICH im folgenden JSON-Format zur√ºck:\n\n{\n  \"fix_type\": \"\",\n  \"field\": \"\",\n  \"new_value\": \"\",\n  \"reason\": \"\",\n  \"details\": \"\"\n}\n\nRegeln:\n- fix_type MUSS einer der folgenden Werte sein:\n  \"fix_text\", \"fix_image\", \"fix_gtin\", \"fix_attribute\", \"fix_policy\", \"fix_quality\"\n- field MUSS das betroffene Produktfeld sein (z. B. title, description, image_link, gtin, color, size)\n- new_value MUSS der korrigierte Wert sein\n- reason = kurze Begr√ºndung\n- details = zus√§tzliche Details\n- KEINE weiteren Felder\n- KEIN Text au√üerhalb des JSON\n- KEINE Erkl√§rungen\n- KEINE Kommentare\n- KEINE zus√§tzlichen Objekte\n"
        }
      },
      "id": "03073645-80fc-4d43-87c3-8d55a23161c9",
      "name": "AI Error Analyzer Images",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -4896,
        4096
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        -4256,
        4304
      ],
      "id": "5565001b-21d8-4954-8bfa-0b9d5a3264dc",
      "name": "MCP Client4"
    },
    {
      "parameters": {
        "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        -4384,
        4304
      ],
      "id": "7a8ba9d7-7524-49e3-a1d3-70917362938d",
      "name": "Supabase RAG Context3",
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Error: {{ $json.error || $json.message || \"Unknown error\" }}.\nProduct ID: {{ $json.product_id }}.\nAnalyze this error and suggest a fix.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the current operation and provide actionable solutions.\n\nDu bist ein strikter Fehler-Fix-Agent. Gib deine Antwort AUSSCHLIESSLICH im folgenden JSON-Format zur√ºck:\n\n{\n  \"fix_type\": \"\",\n  \"field\": \"\",\n  \"new_value\": \"\",\n  \"reason\": \"\",\n  \"details\": \"\"\n}\n\nRegeln:\n- fix_type MUSS einer der folgenden Werte sein:\n  \"fix_text\", \"fix_image\", \"fix_gtin\", \"fix_attribute\", \"fix_policy\", \"fix_quality\"\n- field MUSS das betroffene Produktfeld sein (z. B. title, description, image_link, gtin, color, size)\n- new_value MUSS der korrigierte Wert sein\n- reason = kurze Begr√ºndung\n- details = zus√§tzliche Details\n- KEINE weiteren Felder\n- KEIN Text au√üerhalb des JSON\n- KEINE Erkl√§rungen\n- KEINE Kommentare\n- KEINE zus√§tzlichen Objekte"
        }
      },
      "id": "cd7acabd-43fa-4acb-830f-3740bf6537b2",
      "name": "AI Error Analyzer Text",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -4896,
        4288
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        -4256,
        4496
      ],
      "id": "b0b91609-47a2-419d-b767-9b78fcc507d3",
      "name": "MCP Client5"
    },
    {
      "parameters": {
        "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        -4384,
        4496
      ],
      "id": "9595a38e-7aa0-4140-89e9-feee495f3dc8",
      "name": "Supabase RAG Context4",
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -3856,
        4496
      ],
      "id": "2ff7cc7c-9f1a-40d3-995e-d16b1ddb8e81",
      "name": "Google Gemini Chat Model4",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Error from Update Product Merchant Quality: {{ $json.error || $json.message || \"Unknown error\" }}. Product ID: {{ $json.product_id }}. Analyze this error and suggest a fix.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the current operation and provide actionable solutions.\n\nDu bist ein strikter Fehler-Fix-Agent. Gib deine Antwort AUSSCHLIESSLICH im folgenden JSON-Format zur√ºck:\n\n{\n  \"fix_type\": \"\",\n  \"field\": \"\",\n  \"new_value\": \"\",\n  \"reason\": \"\",\n  \"details\": \"\"\n}\n\nRegeln:\n- fix_type MUSS einer der folgenden Werte sein:\n  \"fix_text\", \"fix_image\", \"fix_gtin\", \"fix_attribute\", \"fix_policy\", \"fix_quality\"\n- field MUSS das betroffene Produktfeld sein (z. B. title, description, image_link, gtin, color, size)\n- new_value MUSS der korrigierte Wert sein\n- reason = kurze Begr√ºndung\n- details = zus√§tzliche Details\n- KEINE weiteren Felder\n- KEIN Text au√üerhalb des JSON\n- KEINE Erkl√§rungen\n- KEINE Kommentare\n- KEINE zus√§tzlichen Objekte\n"
        }
      },
      "id": "94e0712d-d081-451e-819b-edff304a72d1",
      "name": "AI Error Analyzer Merchant",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -4896,
        4480
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"priority\": {\n      \"type\": \"string\",\n      \"enum\": [\"adult_flags\"]\n    },\n    \"reasoning\": {\n      \"type\": \"string\"\n    },\n    \"products_to_process\": {\n      \"type\": \"number\"\n    }\n  },\n  \"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}\n",
        "autoFix": true
      },
      "id": "79d00c3f-2d47-4018-a0bc-bc96ae1df9b2",
      "name": "Adult_Flags_Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -4144,
        3904
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"priority\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"enum\": [\"images\"]\n\t\t},\n\t\t\"reasoning\": {\n\t\t\t\"type\": \"string\"\n\t\t},\n\t\t\"products_to_process\": {\n\t\t\t\"type\": \"number\"\n\t\t}\n\t},\n\t\"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}",
        "autoFix": true
      },
      "id": "dbd8cb57-3466-49c5-8434-48a2ab9949cb",
      "name": "Images Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -4144,
        4096
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"priority\": {\n      \"type\": \"string\",\n      \"enum\": [\"text\"]\n    },\n    \"reasoning\": {\n      \"type\": \"string\"\n    },\n    \"products_to_process\": {\n      \"type\": \"number\"\n    }\n  },\n  \"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}\n",
        "autoFix": true
      },
      "id": "639ce28c-33a5-4f6c-8d6c-d5cba352030e",
      "name": "Text_Output_Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -4144,
        4304
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -3856,
        4304
      ],
      "id": "f37560e3-85f8-4d40-96b9-cde5dbc1212a",
      "name": "Google_Gemini_Chat",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        -4384,
        4672
      ],
      "id": "499db9a3-f38b-43d2-a9b6-43d638596ff1",
      "name": "Supabase RAG Context5",
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -3856,
        4672
      ],
      "id": "55a12bf9-bbdd-44f9-8900-5d92d856fe28",
      "name": "Google Gemini Chat Model5",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Error: {{ $json.error || $json.message || \"Unknown error\" }}.\nProduct ID: {{ $json.product_id }}.\nAnalyze this error and suggest a fix.\n",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the current operation and provide actionable solutions.\n\nDu bist ein strikter Fehler-Fix-Agent. Gib deine Antwort AUSSCHLIESSLICH im folgenden JSON-Format zur√ºck:\n\n{\n  \"fix_type\": \"\",\n  \"field\": \"\",\n  \"new_value\": \"\",\n  \"reason\": \"\",\n  \"details\": \"\"\n}\n\nRegeln:\n- fix_type MUSS einer der folgenden Werte sein:\n  \"fix_text\", \"fix_image\", \"fix_gtin\", \"fix_attribute\", \"fix_policy\", \"fix_quality\"\n- field MUSS das betroffene Produktfeld sein (z. B. title, description, image_link, gtin, color, size)\n- new_value MUSS der korrigierte Wert sein\n- reason = kurze Begr√ºndung\n- details = zus√§tzliche Details\n- KEINE weiteren Felder\n- KEIN Text au√üerhalb des JSON\n- KEINE Erkl√§rungen\n- KEINE Kommentare\n- KEINE zus√§tzlichen Objekte\n"
        }
      },
      "id": "7fa96fb5-d399-40d8-8548-b466a90dbcb5",
      "name": "AI Error Analyzer Error_Multi_Country",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -4896,
        4672
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        -4256,
        4672
      ],
      "id": "0fc0cf34-7bef-46e2-bc0f-808efd88d680",
      "name": "MCP Client_6"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"priority\": { \"type\": \"string\", \"enum\": [\"multi_country\"] },\n    \"reasoning\": { \"type\": \"string\" },\n    \"products_to_process\": { \"type\": \"number\" }\n  },\n  \"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}\n",
        "autoFix": true
      },
      "id": "a58b7a91-55ad-425c-87f6-235cb8850206",
      "name": "Country_Out_Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -4144,
        4672
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"priority\": { \"type\": \"string\", \"enum\": [\"merchant_quality\"] },\n    \"reasoning\": { \"type\": \"string\" },\n    \"products_to_process\": { \"type\": \"number\" }\n  },\n  \"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}\n",
        "autoFix": true
      },
      "id": "0392fe48-15ff-4db6-8b81-a96e9efdc195",
      "name": "Merchant_Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -4144,
        4496
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        -4384,
        5344
      ],
      "id": "f15d2546-e1f5-42ac-a8a7-ad152ae1f105",
      "name": "Supabase RAG Context6",
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -3856,
        5344
      ],
      "id": "a36c7607-8b30-43de-8e84-827153f4fd7d",
      "name": "Google Gemini Chat Model6",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        -4256,
        5344
      ],
      "id": "2e81d800-83fc-4bf7-9ead-25c5faa01fdd",
      "name": "MCP Client_"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Error: {{ $json.error || $json.message || \"Unknown error\" }}.\nProduct ID: {{ $json.product_id }}.\nAnalyze this error and suggest a fix.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the current operation and provide actionable solutions.\n\nDu bist ein strikter Fehler-Fix-Agent. Gib deine Antwort AUSSCHLIESSLICH im folgenden JSON-Format zur√ºck:\n\n{\n  \"fix_type\": \"\",\n  \"field\": \"\",\n  \"new_value\": \"\",\n  \"reason\": \"\",\n  \"details\": \"\"\n}\n\nRegeln:\n- fix_type MUSS einer der folgenden Werte sein:\n  \"fix_text\", \"fix_image\", \"fix_gtin\", \"fix_attribute\", \"fix_policy\", \"fix_quality\"\n- field MUSS das betroffene Produktfeld sein (z. B. title, description, image_link, gtin, color, size)\n- new_value MUSS der korrigierte Wert sein\n- reason = kurze Begr√ºndung\n- details = zus√§tzliche Details\n- KEINE weiteren Felder\n- KEIN Text au√üerhalb des JSON\n- KEINE Erkl√§rungen\n- KEINE Kommentare\n- KEINE zus√§tzlichen Objekte"
        }
      },
      "id": "0adf3166-253f-43a1-9303-23063a921239",
      "name": "AI Error Analyzer Error_Multi_GTN/EAN",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -4896,
        5360
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"priority\": { \"type\": \"string\", \"enum\": [\"multi_gtn_ean\"] },\n    \"reasoning\": { \"type\": \"string\" },\n    \"products_to_process\": { \"type\": \"number\" }\n  },\n  \"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}\n",
        "autoFix": true
      },
      "id": "580c4e30-c8ee-4bab-85b1-f9146692a4d2",
      "name": "Multi_GTN/EAN_Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -4144,
        5344
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "id": "39781ea7-277e-4321-9fe9-9dcfdddc5067",
      "name": "Error_GTN/EAN",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -4528,
        5344
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        -4384,
        5568
      ],
      "id": "3e18f633-4d57-4e11-ba15-a98d06472c96",
      "name": "Supabase RAG Context7",
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -3856,
        5584
      ],
      "id": "c055ed73-b6fa-43b6-b572-944eb05953de",
      "name": "Google Gemini Chat Model7",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        -4256,
        5568
      ],
      "id": "d9f49afd-88de-4a15-ab92-cb4bd6286806",
      "name": "MCP Client_1"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// PREPARE H√ÑNDERQUALIT√ÑTR LOOP - F√ºr Gemini H√ÑNDLERQUALIT√ÑT Updates\n// ============================================================================\nconst inputData = $input.first().json;\nconst config = $('SHOP_CONFIGURATION').first().json;\n\n// ‚úÖ Hole Products von Analyze Products2:\nconst analysis = $('Analyze Products2').first().json;\nconst productsToFix = analysis.products_needing_fix || [];\n\n// ‚úÖ Hole Priority und Max Products von Gemini Decision:\nconst decision = $('Gemini Daily Decision').first().json.output || {};\nconst maxProducts = decision.products_to_process || productsToFix.length;\n\n// ‚úÖ Shop ID von Decision ODER Config:\nconst shopId = decision.shop_id || config.shop1_id;\n\n// ‚úÖ Shop Info aus Config:\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\n// Filtere nur H√§ndlerqualit√§t die Updates brauchen\nconst productsNeedingHaendlerqualitaet = productsToFix.filter(product => {\n  // Pr√ºfe ob Gemini empfohlen hat H√§ndlerqualit√§t zu aktualisieren\n  return product.needs_Haendlerqualitaet === true || \n         product.missing_Haendlerqualitaet === true || \n         product.missing_mpn === true ||\n         product.missing_brand === true ||\n         (product.priority && product.priority === 'multi_gtn_ean');\n});\n\n// Slice f√ºr Batch Processing\nconst productsSlice = productsNeedingGtinEan.slice(0, maxProducts);\n\n// ‚úÖ Erstelle Items mit GTIN/EAN Daten:\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    \n    // GTIN/EAN Daten (von Gemini oder Product)\n    gtin: product.gtin || product.gtin_from_gemini || product.recommended_gtin || '',\n    mpn: product.mpn || product.mpn_from_gemini || product.recommended_mpn || '',\n    brand: product.brand || product.brand_from_gemini || product.recommended_brand || '',\n    \n    action: 'gtin_ean',\n    priority: 'multi_gtn_ean',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
      },
      "name": "Prepare H√§ndlerqualit√§t",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6736,
        5552
      ],
      "id": "9f2ebc2c-fb2b-455e-a988-53ba52043087",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"priority\": { \"type\": \"string\", \"enum\": [\"haendlerqualitaet\"] },\n    \"reasoning\": { \"type\": \"string\" },\n    \"products_to_process\": { \"type\": \"number\" }\n  },\n  \"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}\n",
        "autoFix": true
      },
      "id": "3d0df657-7cb2-4e95-a8ff-f0939814bd09",
      "name": "H√§ndlerqualit√§t_Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -4144,
        5568
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Error: {{ $json.error || $json.message || \"Unknown error\" }}.\nProduct ID: {{ $json.product_id }}.\nAnalyze this error and suggest a fix.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the current operation and provide actionable solutions.\n\nDu bist ein strikter Fehler-Fix-Agent. Gib deine Antwort AUSSCHLIESSLICH im folgenden JSON-Format zur√ºck:\n\n{\n  \"fix_type\": \"\",\n  \"field\": \"\",\n  \"new_value\": \"\",\n  \"reason\": \"\",\n  \"details\": \"\"\n}\n\nRegeln:\n- fix_type MUSS einer der folgenden Werte sein:\n  \"fix_text\", \"fix_image\", \"fix_gtin\", \"fix_attribute\", \"fix_policy\", \"fix_quality\"\n- field MUSS das betroffene Produktfeld sein (z. B. title, description, image_link, gtin, color, size)\n- new_value MUSS der korrigierte Wert sein\n- reason = kurze Begr√ºndung\n- details = zus√§tzliche Details\n- KEINE weiteren Felder\n- KEIN Text au√üerhalb des JSON\n- KEINE Erkl√§rungen\n- KEINE Kommentare\n- KEINE zus√§tzlichen Objekte"
        }
      },
      "id": "903be1a0-b6de-4b2b-bef1-8fcdabd46d1c",
      "name": "AI Error Analyzer_H√§ndlerqualit√§t",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -4896,
        5552
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "amount": 2
      },
      "name": "Rate Limiting H√§ndlerqualit√§t",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -5232,
        5520
      ],
      "id": "64eebdec-df1a-4302-aff3-7001e34cf634",
      "webhookId": "rate-limit-country-webhook",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/products/{{ $json.product_id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "options": {}
      },
      "name": "Update H√§ndlerqualit√§t",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -6288,
        5536
      ],
      "id": "a3c598b3-e6b0-4aa8-8276-e3f159577721",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "id": "112ec4e0-09f5-4288-980e-d841b13f3213",
      "name": "Gemini Product Optimizer (NEW)",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -3856,
        5776
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        -4272,
        5776
      ],
      "id": "dc19f75a-cdc1-42bd-b8dc-b0e67b162858",
      "name": "MCP Client_2"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "id": "d314a02f-0b40-4268-81d6-f9f50d4464c1",
      "name": "MC_Prepare_S24",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -4528,
        5776
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://www.googleapis.com/content/v2.1/{{ $('SHOP_CONFIGURATION').item.json.shop1_id }}/productstatuses?maxResults=250",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "id": "1741453e-71b8-43f4-88e7-9215a476eb4e",
      "name": "MC_Get_Products_S24",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -6288,
        5760
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"priority\": { \"type\": \"string\", \"enum\": [\"gemini_s24\"] },\n    \"reasoning\": { \"type\": \"string\" },\n    \"products_to_process\": { \"type\": \"number\" }\n  },\n  \"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}\n",
        "autoFix": true
      },
      "id": "da53eaca-2060-4656-8fc1-7032e697677e",
      "name": "MC_Parse_S24",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -4160,
        5776
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const productsData = $('Get Merchant Products_DDC').first().json;\nconst statusData = $('MC_Get_Products_S24').first().json;\n\nconst products = Array.isArray(productsData.resources) ? productsData.resources : [productsData];\nconst statuses = Array.isArray(statusData.resources) ? statusData.resources : [statusData];\n\nconst statusMap = {};\nstatuses.forEach(s => {\n  if (s.productId) {\n    statusMap[s.productId] = s;\n  }\n});\n\nconst merged = products.map(product => {\n  const productStatus = statusMap[product.id] || {};\n  const issues = productStatus.itemLevelIssues || [];\n  const price = product.price || {};\n\n  return {\n    json: {\n      product_id: product.id,\n      offer_id: product.offerId || null,\n      title: product.title || null,\n      description: product.description || null,\n      link: product.link || null,\n      image_link: product.imageLink || null,\n      additional_image_links: product.additionalImageLinks || [],\n      price: price.value || null,\n      currency: price.currency || null,\n      brand: product.brand || null,\n      gtin: product.gtin || null,\n      mpn: product.mpn || null,\n      identifier_exists: product.identifierExists || false,\n      approval_status: productStatus.destinationStatuses || [],\n      issues: issues,\n      issue_count: issues.length,\n      raw_product: product,\n      raw_status: productStatus\n    }\n  };\n});\n\nreturn merged;"
      },
      "id": "09e126d3-021f-4810-a5e8-ca551a102336",
      "name": "MC Merge Products + Status S24",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -5232,
        5744
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        -4272,
        5984
      ],
      "id": "7b3afa43-70da-4016-bc01-06346b2e6228",
      "name": "MCP Client_3"
    },
    {
      "parameters": {
        "url": "=https://www.googleapis.com/content/v2.1/{{ $('SHOP_CONFIGURATION').item.json.shop1_id }}/productstatuses?maxResults=250",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "id": "58a83a0a-8797-4494-9b71-33dffa74f3e8",
      "name": "MC_Get_Products_DDC",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -6288,
        5968
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const productsData = $('Get Merchant Products_DDC').first().json;\nconst statusData = $('MC_Get_Products_DDC').first().json;\n\nconst products = Array.isArray(productsData.resources) ? productsData.resources : [productsData];\nconst statuses = Array.isArray(statusData.resources) ? statusData.resources : [statusData];\n\nconst statusMap = {};\nstatuses.forEach(s => {\n  if (s.productId) {\n    statusMap[s.productId] = s;\n  }\n});\n\nconst merged = products.map(product => {\n  const productStatus = statusMap[product.id] || {};\n  const issues = productStatus.itemLevelIssues || [];\n  const price = product.price || {};\n\n  return {\n    json: {\n      product_id: product.id,\n      offer_id: product.offerId || null,\n      title: product.title || null,\n      description: product.description || null,\n      link: product.link || null,\n      image_link: product.imageLink || null,\n      additional_image_links: product.additionalImageLinks || [],\n      price: price.value || null,\n      currency: price.currency || null,\n      brand: product.brand || null,\n      gtin: product.gtin || null,\n      mpn: product.mpn || null,\n      identifier_exists: product.identifierExists || false,\n      approval_status: productStatus.destinationStatuses || [],\n      issues: issues,\n      issue_count: issues.length,\n      raw_product: product,\n      raw_status: productStatus\n    }\n  };\n});\n\nreturn merged;"
      },
      "id": "94f461cd-1307-4ad2-ae59-026d39ff8fb4",
      "name": "MC Merge Products + Status DDC",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -5232,
        5952
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "id": "d9a2f7b6-78a9-4cec-96d0-f336c03e3b8a",
      "name": "MC_Pre_DDC",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -4528,
        5984
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        -4400,
        5984
      ],
      "id": "0d22d912-8662-41fe-b241-846d0245107f",
      "name": "Supabase_S24",
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      }
    },
    {
      "parameters": {
        "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        -4400,
        5776
      ],
      "id": "171eff89-ef34-4ff6-969a-40ad66ff2ad8",
      "name": "Supabase_S",
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Error: {{ $json.error || $json.message || \"Unknown error\" }}.\nProduct ID: {{ $json.product_id }}.\nAnalyze this error and suggest a fix.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the current operation and provide actionable solutions.\n\nDu bist ein strikter Fehler-Fix-Agent. Gib deine Antwort AUSSCHLIESSLICH im folgenden JSON-Format zur√ºck:\n\n{\n  \"fix_type\": \"\",\n  \"field\": \"\",\n  \"new_value\": \"\",\n  \"reason\": \"\",\n  \"details\": \"\"\n}\n\nRegeln:\n- fix_type MUSS einer der folgenden Werte sein:\n  \"fix_text\", \"fix_image\", \"fix_gtin\", \"fix_attribute\", \"fix_policy\", \"fix_quality\"\n- field MUSS das betroffene Produktfeld sein (z. B. title, description, image_link, gtin, color, size)\n- new_value MUSS der korrigierte Wert sein\n- reason = kurze Begr√ºndung\n- details = zus√§tzliche Details\n- KEINE weiteren Felder\n- KEIN Text au√üerhalb des JSON\n- KEINE Erkl√§rungen\n- KEINE Kommentare\n- KEINE zus√§tzlichen Objekte"
        }
      },
      "id": "0a1c643e-b833-4b36-b3b2-141f7f80d9f7",
      "name": "Error_Ana_S24",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -4896,
        5760
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Error: {{ $json.error || $json.message || \"Unknown error\" }}.\nProduct ID: {{ $json.product_id }}.\nAnalyze this error and suggest a fix.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the current operation and provide actionable solutions.\n\nDu bist ein strikter Fehler-Fix-Agent. Gib deine Antwort AUSSCHLIESSLICH im folgenden JSON-Format zur√ºck:\n\n{\n  \"fix_type\": \"\",\n  \"field\": \"\",\n  \"new_value\": \"\",\n  \"reason\": \"\",\n  \"details\": \"\"\n}\n\nRegeln:\n- fix_type MUSS einer der folgenden Werte sein:\n  \"fix_text\", \"fix_image\", \"fix_gtin\", \"fix_attribute\", \"fix_policy\", \"fix_quality\"\n- field MUSS das betroffene Produktfeld sein (z. B. title, description, image_link, gtin, color, size)\n- new_value MUSS der korrigierte Wert sein\n- reason = kurze Begr√ºndung\n- details = zus√§tzliche Details\n- KEINE weiteren Felder\n- KEIN Text au√üerhalb des JSON\n- KEINE Erkl√§rungen\n- KEINE Kommentare\n- KEINE zus√§tzlichen Objekte"
        }
      },
      "id": "b1ea717a-bc7e-4dae-95ad-95521a34ecd6",
      "name": "Error_Ana_DDC",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -4896,
        5968
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"priority\": { \"type\": \"string\", \"enum\": [\"gemini_ddc\"] },\n    \"reasoning\": { \"type\": \"string\" },\n    \"products_to_process\": { \"type\": \"number\" }\n  },\n  \"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}\n",
        "autoFix": true
      },
      "id": "8d839cac-ec08-4f96-8443-559df8c7cc17",
      "name": "MC_Parse_DDC",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -4160,
        5984
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "id": "7e5a8bec-b296-49dd-8b49-8b4b8a28a605",
      "name": "Optimizer DDC",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -3872,
        5984
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -3856,
        3904
      ],
      "id": "565157e1-e98e-4d84-97a1-7c8abdd657e9",
      "name": "Gemini_Chat_Adult",
      "alwaysOutputData": true,
      "executeOnce": true,
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -3856,
        4112
      ],
      "id": "732c9479-770d-44f8-8b0a-b72ea3a79fb7",
      "name": "Chat_Images",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "id": "fe166141-d157-4ddf-aac3-72b5d3ca0c11",
      "name": "Error Adult Flags",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -4528,
        3904
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "75b0bfaa-8f58-40c2-a085-5fb672e1762a",
      "name": "Error Images",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -4528,
        4112
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "id": "5bea0d14-1166-426d-8da6-b3e368652a6b",
      "name": "Error Adult Text",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -4528,
        4304
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "id": "24a5d888-9c79-4d6b-998f-b7450f904222",
      "name": "Error Merchant Quality",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -4528,
        4496
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "id": "8d29273e-68be-4e56-9cac-ea01e433b3b8",
      "name": "Error_Multi_Country1",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -4528,
        4672
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "id": "6b146f62-6de5-4061-a667-69de1ab85f71",
      "name": "Error_H√§ndlerquali",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -4528,
        5568
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "Work with your data in supabase",
        "tableName": {
          "__rl": true,
          "value": "workflow_runs",
          "mode": "list",
          "cachedResultName": "workflow_runs"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        -5536,
        3520
      ],
      "id": "f77b6ff5-fbad-4b12-a99c-347b1538988f",
      "name": "Supabase Vector Store",
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-embedding-001"
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
      "typeVersion": 1,
      "position": [
        -5376,
        3696
      ],
      "id": "c5501499-6e5a-47a3-9083-9d6acf7f9d4f",
      "name": "Embeddings Google Gemini",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "url": "=https://www.googleapis.com/content/v2.1/{{ $('SHOP_CONFIGURATION').item.json.shop2_id }}/products?maxResults=100",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "=shop1_name",
              "value": "={{ $json.shop1_id }}{{ $('SHOP_CONFIGURATION').item.json.shop1_id }}"
            },
            {
              "name": "=shop1_name",
              "value": "={{ $json.shop1_name }}{{ $('SHOP_CONFIGURATION').item.json.shop1_name }}"
            },
            {
              "name": "=supabase_url",
              "value": "={{ $json.supabase_url }}{{ $('SHOP_CONFIGURATION').item.json.supabase_url }}"
            },
            {
              "name": "=google_sheet_id",
              "value": "={{ $json.google_sheet_id }}{{ $('SHOP_CONFIGURATION').item.json.google_sheet_id }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "=shop1_id",
              "value": "={{ $json.shop1_id }}{{ $('SHOP_CONFIGURATION').item.json.shop1_id }}"
            },
            {
              "name": "=shop1_name",
              "value": "={{ $json.shop1_id }}{{ $('SHOP_CONFIGURATION').item.json.shop1_name }}"
            },
            {
              "name": "=google_sheet_id",
              "value": "={{ $json.google_sheet_id }}{{ $('SHOP_CONFIGURATION').item.json.google_sheet_id }}"
            },
            {
              "name": "=supabasse_url",
              "value": "={{ $json.supabase_url }}{{ $('SHOP_CONFIGURATION').item.json.supabase_url }}"
            },
            {
              "name": "=supabase_key",
              "value": "={{ $json.supabase_key }}{{ $('SHOP_CONFIGURATION').item.json.supabase_key }}"
            }
          ]
        },
        "options": {}
      },
      "name": "Get Merchant Products_S24",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -8624,
        4400
      ],
      "id": "b084ed99-dd1a-474a-8713-20d469079e2f",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "url": "=https://www.googleapis.com/content/v2.1/{{ $('SHOP_CONFIGURATION').item.json.shop1_id }}/products?maxResults=16400",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "={{ $json.shop2_id }}",
              "value": "={{ $json.shop2_id }}"
            },
            {
              "name": "={{ $json.google_sheet_id }}",
              "value": "={{ $json.google_sheet_id }}"
            },
            {
              "name": "={{ $json.supabase_url }}",
              "value": "={{ $json.supabase_url }}"
            },
            {
              "name": "={{ $json.supabase_key }}",
              "value": "={{ $json.supabase_key }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "={{ $json.shop2_id }}",
              "value": "={{ $json.shop2_id }}"
            },
            {
              "name": "={{ $json.shop2_name }}",
              "value": "={{ $json.shop2_name }}"
            },
            {
              "name": "={{ $json.supabase_url }}",
              "value": "={{ $json.supabase_url }}"
            },
            {
              "name": "={{ $json.supabase_key }}",
              "value": "={{ $json.supabase_key }}"
            }
          ]
        },
        "options": {}
      },
      "name": "Get Merchant Products_DDC",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -8624,
        4608
      ],
      "id": "f1bf74a2-1e34-416e-b1a2-b0cf813b16bc",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const item = $input.item.json;\nconst config = $('SHOP_CONFIGURATION').item.json;\n\nreturn [{\n  json: {\n    shop_id: config.shop1_id,\n    shop_name: config.shop1_name,\n    product_id: item.product_id,\n    offer_id: item.offer_id,\n    title: item.title,\n    description: item.description,\n    link: item.link,\n    image_link: item.image_link,\n    additional_image_links: item.additional_image_links,\n    price: item.price,\n    currency: item.currency,\n    brand: item.brand,\n    gtin: item.gtin,\n    mpn: item.mpn,\n    identifier_exists: item.identifier_exists,\n    issues: item.issues || [],\n    issue_count: item.issue_count || 0,\n    approval_status: item.approval_status || [],\n    needs_optimization: item.issue_count > 0,\n    approval_types: item.approval_status.map(a => a.status || '') || [],\n    timestamp: new Date().toISOString(),\n    raw_product: item.raw_product,\n    raw_status: item.raw_status\n  }\n}];"
      },
      "name": "Prepare MC For Gemini S24_2",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6736,
        5776
      ],
      "id": "ba577180-4b4c-4b27-82f7-d00284e034a6",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const item = $input.item.json;\nconst config = $('SHOP_CONFIGURATION').item.json;\n\nreturn [{\n  json: {\n    shop_id: config.shop1_id,\n    shop_name: config.shop1_name,\n    product_id: item.product_id,\n    offer_id: item.offer_id,\n    title: item.title,\n    description: item.description,\n    link: item.link,\n    image_link: item.image_link,\n    additional_image_links: item.additional_image_links,\n    price: item.price,\n    currency: item.currency,\n    brand: item.brand,\n    gtin: item.gtin,\n    mpn: item.mpn,\n    identifier_exists: item.identifier_exists,\n    issues: item.issues || [],\n    issue_count: item.issue_count || 0,\n    approval_status: item.approval_status || [],\n    needs_optimization: item.issue_count > 0,\n    approval_types: item.approval_status.map(a => a.status || '') || [],\n    timestamp: new Date().toISOString(),\n    raw_product: item.raw_product,\n    raw_status: item.raw_status\n  }\n}];"
      },
      "name": "Prepare MC For Gemini DDC_2",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6736,
        5984
      ],
      "id": "18bd47d0-8964-4de5-a28b-f8e10fba9780",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "shop1_id",
              "name": "shop1_id",
              "value": "5339977843",
              "type": "string"
            },
            {
              "id": "shop1_name",
              "name": "shop1_name",
              "value": "Siliconedolls24",
              "type": "string"
            },
            {
              "id": "shop2_id",
              "name": "shop2_id",
              "value": "124485833",
              "type": "string"
            },
            {
              "id": "shop2_name",
              "name": "shop2_name",
              "value": "DreamDoll",
              "type": "string"
            },
            {
              "id": "google_sheet_id",
              "name": "google_sheet_id",
              "value": "1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE",
              "type": "string"
            },
            {
              "id": "id-6",
              "name": "supabase_url",
              "value": "https://mxswxdnnjhhukovixzvb.supabase.co/functions/v1/database-access",
              "type": "string"
            },
            {
              "id": "id-7",
              "name": "supabase_key",
              "value": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im14c3d4ZG5uamhodWtvdml4enZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3OTM4NDAsImV4cCI6MjA3OTM2OTg0MH0.60grD1zV6gF7Uf80N8CG8eiEwMw3zY5KR0Q-KKvvSWQ",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "name": "SHOP_CONFIGURATION",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -8624,
        4192
      ],
      "id": "23a751d0-04de-4733-ac70-b52782000f1e",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// SMART PRIORITY SCORER\n// Berechnet welche Phase die h√∂chste Priorit√§t hat\n// ============================================================================\n\nconst analysis = $input.first().json;\nconst products = analysis.products_needing_fix || [];\nconst stats = {\n  adult_issues: analysis.adult_issues || 0,\n  image_issues: analysis.image_issues || 0,\n  text_issues: analysis.text_issues || 0,\n  gtin_issues: analysis.gtin_issues || 0,\n  mpn_issues: analysis.mpn_issues || 0,\n  brand_issues: analysis.brand_issues || 0,\n  merchant_issues: analysis.merchant_issues || 0,\n  country_issues: analysis.country_issues || 0\n};\n\n// ============================================================================\n// SEVERITY WEIGHTS (Google Impact Based)\n// ============================================================================\nconst severityWeights = {\n  'adult_flags': 10,      // Highest - Policy Violation\n  'multi_gtn_ean': 9,     // Critical - Required Field\n  'images': 7,            // High - Visibility Impact\n  'text': 6,              // High - Quality Impact\n  'merchant_quality': 5,  // Medium - Trust Issues\n  'multi_country': 4      // Medium - Reach Impact\n};\n\n// ============================================================================\n// BERECHNE SCORES PRO PHASE\n// ============================================================================\nconst phaseScores = {};\n\n// Count wie viele Produkte jede Phase brauchen\nproducts.forEach(product => {\n  if (!product.priority_tags) return;\n  \n  product.priority_tags.forEach(tag => {\n    if (!phaseScores[tag]) {\n      phaseScores[tag] = {\n        count: 0,\n        score: 0,\n        severity: severityWeights[tag] || 1\n      };\n    }\n    phaseScores[tag].count++;\n  });\n});\n\n// Berechne Final Score (count * severity)\nObject.keys(phaseScores).forEach(tag => {\n  phaseScores[tag].score = phaseScores[tag].count * phaseScores[tag].severity;\n});\n\n// ============================================================================\n// FINDE H√ñCHSTE PRIORIT√ÑT\n// ============================================================================\nlet recommendedPriority = null;\nlet maxScore = 0;\n\nObject.entries(phaseScores).forEach(([tag, data]) => {\n  if (data.score > maxScore) {\n    maxScore = data.score;\n    recommendedPriority = tag;\n  }\n});\n\n// Fallback wenn nichts gefunden\nif (!recommendedPriority && products.length > 0) {\n  recommendedPriority = 'adult_flags'; // Default\n}\n\n// ============================================================================\n// STATISTIKEN F√úR GEMINI\n// ============================================================================\nconst priorityRanking = Object.entries(phaseScores)\n  .map(([tag, data]) => ({\n    phase: tag,\n    products_affected: data.count,\n    severity: data.severity,\n    score: data.score\n  }))\n  .sort((a, b) => b.score - a.score);\n\nreturn [{\n  json: {\n    ...analysis,\n    \n    // NEU: Recommended Priority\n    recommended_priority: recommendedPriority,\n    recommended_score: maxScore,\n    \n    // Phase Scores f√ºr Gemini Decision\n    phase_scores: phaseScores,\n    priority_ranking: priorityRanking,\n    \n    // F√ºr Logging\n    scorer_run_at: new Date().toISOString()\n  }\n}];\n"
      },
      "id": "b8eb3bb2-e1ed-4e44-bb17-b342472e52fa",
      "name": "Smart Priority Scorer",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -8144,
        4368
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// PREPARE TEXT LOOP - FIX: Hole Produkte von Analyze Products2\n// ============================================================================\nconst decision = $input.first().json;  // Von Route by Priority\nconst analysis = $('Analyze Products2').first().json;  // Direkt von Analyze Products2\n\n// Hole Produkte aus Analyze Products2\nconst productsToFix = analysis.products_needing_fix || [];\nconst maxProducts = decision.products_to_process || productsToFix.length;\n\nconst config = $('SHOP_CONFIGURATION').first().json;\n\n// Shop info aus Decision oder Config\nconst shopId = decision.shop_id || config.shop1_id;\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\nconst productsSlice = productsToFix.slice(0, maxProducts);\n\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    description: product.description,\n    action: 'text',\n    priority: 'text',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
      },
      "id": "98f92ef7-2479-40ba-a45c-474c768ae959",
      "name": "Prepare Text Loop",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6736,
        4272
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Current Approval Rate: {{ $json.current_approval_rate }}%.\nProducts needing fix: {{ $json.products_needing_fix.length }}.\nTotal products: {{ $json.total_products }}.\nApproved: {{ $json.approved_count }}.\nDisapproved: {{ $json.disapproved_count }}.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "Du bist der Merchant Center Entscheidungen- Agent. Du triffst die Entscheidungen was, wann, wie, mit was, und wo optimiert werden muss und optimiert werden wird!\n\nDu optimierst seit 15 Jahren Google Merchant Center Next und kennst alle Richtlinien, Policy, Qualit√§tsanforderungen, L√§nderregeln, H√§ndlerqualit√§tsfaktoren, GTIN/MPN-Regeln, Bild- und Textanforderungen sowie alle Merchant-Fehlercodes.\n\nDeine Aufgabe:\nEntscheide, welche Optimierungsphase als N√ÑCHSTES ausgef√ºhrt werden soll.\n\nInput:\nDu erh√§ltst eine aggregierte Analyse aus \"Analyze Products2\":\n- total_products\n- approved_count\n- disapproved_count\n- current_approval_rate\n- total_products_with_issues\n- gtin_missing_count\n- mpn_missing_count\n- identifier_issues_count\n- weitere Fehlerindikatoren, falls vorhanden\n\nErlaubte Werte f√ºr \"priority\":\n- \"adult_flags\"\n- \"images\"\n- \"text\"\n- \"merchant_quality\"\n- \"multi_country\"\n- \"multi_gtn_ean\"\n- \"H√§ndlerqualit√§t\"\n- \"Gemini_S24\"\n- \"Gemini_DDC\"\n\nRolling Window:\n- \"products_to_process\" = Anzahl Produkte, die in dieser Phase bearbeitet werden sollen (maximal 100).\n\nAntwortformat:\nGIB AUSSCHLIESSLICH FOLGENDES JSON ZUR√úCK:\n\n{\n  \"priority\": \"adult_flags|images|text|merchant_quality|multi_country|multi_gtn_ean|H√§ndlerqualit√§t|Gemini_S24|Gemini_DDC\",\n  \"products_to_process\": 100,\n  \"reasoning\": \"Kurze, klare Begr√ºndung auf Deutsch\"\n}\n\nRegeln:\n- Viele fehlende GTIN oder identifier_exists=false ‚Üí \"multi_gtn_ean\"\n- Viele Adult-Fehler ‚Üí \"adult_flags\"\n- Viele Bildfehler ‚Üí \"images\"\n- Viele Textfehler ‚Üí \"text\"\n- Viele Merchant-Quality-/Policy-/Versandfehler ‚Üí \"merchant_quality\"\n- Viele Multi-Country-/Destination-Fehler ‚Üí \"multi_country\"\n- H√§ndlerqualit√§tsprobleme ‚Üí \"H√§ndlerqualit√§t\"\n- Shop-spezifische Optimierung ‚Üí \"Gemini_S24\" oder \"Gemini_DDC\"\n- Keine anderen Strings verwenden\n- Keine zus√§tzlichen Felder zur√ºckgeben\n- Keine Erkl√§rtexte au√üerhalb des JSON zur√ºckgeben\n"
        }
      },
      "id": "aea84f7e-fbe0-4db4-bb41-f066f9a7ac0c",
      "name": "Gemini Daily Decision",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -7680,
        4352
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.2,
      "position": [
        -7776,
        4560
      ],
      "id": "82a9b3ad-b7df-4058-b5de-880e26d43198",
      "name": "MCP Client1"
    },
    {
      "parameters": {
        "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        -7424,
        4496
      ],
      "id": "fef9571a-0265-4546-95c5-f34cca431961",
      "name": "Supabase RAG Context",
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"name\": \"Gemini Decision Parser (Bereinigt)\",\n  \"nodes\": [\n    {\n      \"id\": \"Gemini_Decision_Parser\",\n      \"name\": \"Gemini Decision Parser\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"typeVersion\": 2,\n      \"position\": [\n        520,\n        300\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{ $json[\\\"priority\\\"] }}\",\n              \"operation\": \"isNotEmpty\"\n            },\n            {\n              \"value1\": \"={{ $json[\\\"reasoning\\\"] }}\",\n              \"operation\": \"isNotEmpty\"\n            }\n          ],\n          \"number\": [\n            {\n              \"value1\": \"={{ $json[\\\"products_to_process\\\"] }}\",\n              \"operation\": \"larger\",\n              \"value2\": 0\n            }\n          ]\n        }\n      },\n      \"alwaysOutputData\": true,\n      \"continueOnFail\": true\n    },\n    {\n      \"id\": \"Decision_Parser_Schema\",\n      \"name\": \"Decision Parser Schema\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"typeVersion\": 2,\n      \"position\": [\n        760,\n        300\n      ],\n      \"parameters\": {\n        \"keepOnlySet\": true,\n        \"values\": {\n          \"json\": {\n            \"schema\": {\n              \"type\": \"object\",\n              \"properties\": {\n                \"priority\": {\n                  \"type\": \"string\",\n                  \"enum\": [\n                    \"adult_flags\",\n                    \"images\",\n                    \"text\",\n                    \"merchant_quality\",\n                    \"multi_country\",\n                    \"multi_gtn_ean\",\n                    \"haendlerqualitaet\",\n                    \"gemini_s24\",\n                    \"gemini_ddc\",\n                    \"gtin_ean\"\n                  ]\n                },\n                \"reasoning\": {\n                  \"type\": \"string\"\n                },\n                \"products_to_process\": {\n                  \"type\": \"number\"\n                }\n              },\n              \"required\": [\n                \"priority\",\n                \"reasoning\",\n                \"products_to_process\"\n              ]\n            }\n          }\n        }\n      },\n      \"alwaysOutputData\": true,\n      \"continueOnFail\": true\n    }\n  ],\n  \"connections\": {\n    \"Gemini Decision Parser\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Decision Parser Schema\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  ],\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"version\": 2\n}\n"
      },
      "id": "8c597f49-9913-45db-a2ad-4703b7038af3",
      "name": "Decision_Parser",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -7488,
        4672
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "id": "c0920c34-1cc4-412f-8fc8-cad334e5f0f5",
      "name": "Decision_Chat",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -7920,
        4560
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "sessionIdType": "={\n  \"sessionIdType\": \"customKey\", \n  \"key\": \"={{ $('SHOP_CONFIGURATION').first().json.shop_id }}_gemini_decisions\"\n}",
        "sessionKey": "",
        "tableName": "gemini_decisions",
        "contextWindowLength": 5000
      },
      "id": "a217c71b-534b-4989-9a87-abee5dade736",
      "name": "Postgres Gemini_Decisions",
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        -7632,
        4560
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "postgres": {
          "id": "pIp690wi4X79QCKb",
          "name": "Postgres account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "403ce6f0-4c58-4f50-8495-f458e6339fb1",
              "leftValue": "={{ $json.error }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            },
            {
              "id": "7842d907-c4e8-48c4-b883-243baa6a0d8d",
              "leftValue": "={{ $json.index }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            },
            {
              "id": "58e94ee6-f472-4e9a-a65b-7e7aaf2bf3a2",
              "leftValue": "shop_name",
              "rightValue": "={{ $json.shop_name }}",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "4412ba1d-1f8a-41a7-a9a4-ed3a6521573f",
              "leftValue": "error",
              "rightValue": "={{ $json.error }}",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "53e205c6-bf84-49af-b043-1e149634ea19",
              "leftValue": "title",
              "rightValue": "={{ $json.title }}",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "648c93b9-3555-4e82-af05-34f247e5c8d3",
              "leftValue": "originalProdukt",
              "rightValue": "={{ $json.originalProduct }}",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "1ec1efa9-49b5-4657-9308-cac1a5002923",
              "leftValue": "action",
              "rightValue": "={{ $json.action }}",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "e9c242ef-e36b-45da-9fb2-6d4ee3fee517",
              "leftValue": "prioritys",
              "rightValue": "={{ $json.priority }}",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -5552,
        4256
      ],
      "id": "d633ce1b-63b4-4ae8-a366-3a8b3254349c",
      "name": "Error Parser",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "b2c98774-f1a8-4f7a-b97b-2fccd72d2150",
              "name": "json",
              "value": "={\n  \"schema\": {\n    \"type\": \"object\",\n    \"properties\": {\n      \"error_type\": {\n        \"type\": \"string\",\n        \"enum\": [\n          \"adult_error\",\n          \"image_error\",\n          \"text_error\",\n          \"merchant_quality_error\",\n          \"multi_country_error\",\n          \"multi_gtn_ean_error\",\n          \"haendlerqualitaet_error\",\n          \"gemini_s24_error\",\n          \"gemini_ddc_error\"\n        ]\n      },\n      \"reason\": { \"type\": \"string\" },\n      \"product_id\": { \"type\": \"string\" },\n      \"source_phase\": { \"type\": \"string\" }\n    },\n    \"required\": [\"error_type\", \"reason\"]\n  }\n}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -5504,
        4992
      ],
      "id": "d4107f3b-bf0c-4d6e-a495-83b8d2d42245",
      "name": "Error Parser Schema",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "d22bbe90-1182-4ed6-a91a-e7c69d4dd539",
                    "leftValue": "adult_error",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "adult_error"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "1a4dd5f7-6f40-4dc6-b8bd-6a54ac99818b",
                    "leftValue": "image_error",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "image_error"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4b723ded-1a79-49ac-a54b-1b975869d4ab",
                    "leftValue": "text_error",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text_error"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "427b489b-7a24-4f72-b727-d6884b1889f4",
                    "leftValue": "merchant_quality_error",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "merchant_quality_error"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "41c2e24b-6318-44bc-9339-3a6f073e2c79",
                    "leftValue": "multi_country_error",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "multi_country_error"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "ac751250-d719-4d7d-92b3-63ff5e91d46d",
                    "leftValue": "multi_gtn_ean_error",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "multi_gtn_ean_error"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "c84a954c-f142-4a34-b7ce-9da57980d801",
                    "leftValue": "haendlerqualitaet_error",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "haendlerqualitaet_error"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "fa8c67c5-5173-4f10-b19f-40e9b65dfc28",
                    "leftValue": "gemini_s24_error",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "gemini_s24_error"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "12c04466-9e30-469f-95ec-d310d90a1b30",
                    "leftValue": "gemini_ddc_error",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "gemini_ddc_error"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -4976,
        4832
      ],
      "id": "9e51d2b1-e4e3-491b-8b87-102e6259c594",
      "name": "Error Router",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "d22bbe90-1182-4ed6-a91a-e7c69d4dd539",
                    "leftValue": "={{$json[\"fix_type\"]}}",
                    "rightValue": "fix_adult",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "fix_adult"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "1a4dd5f7-6f40-4dc6-b8bd-6a54ac99818b",
                    "leftValue": "={{$json[\"fix_type\"]}}",
                    "rightValue": "fix_image",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "fix_image"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "4b723ded-1a79-49ac-a54b-1b975869d4ab",
                    "leftValue": "={{$json[\"fix_type\"]}}",
                    "rightValue": "fix_text",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "fix_text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "427b489b-7a24-4f72-b727-d6884b1889f4",
                    "leftValue": "={{$json[\"fix_type\"]}}",
                    "rightValue": "fix_merchant_quality",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "fix_merchant_quality"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "41c2e24b-6318-44bc-9339-3a6f073e2c79",
                    "leftValue": "={{$json[\"fix_type\"]}}",
                    "rightValue": "fix_multi_country",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "fix_multi_country"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "ac751250-d719-4d7d-92b3-63ff5e91d46d",
                    "leftValue": "={{$json[\"fix_type\"]}}",
                    "rightValue": "fix_multi_gtn_ean",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "fix_multi_gtn_ean"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "c84a954c-f142-4a34-b7ce-9da57980d801",
                    "leftValue": "={{$json[\"fix_type\"]}}",
                    "rightValue": "fix_haendlerqualitaet",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "fix_haendlerqualitaet"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "fa8c67c5-5173-4f10-b19f-40e9b65dfc28",
                    "leftValue": "={{$json[\"fix_type\"]}}",
                    "rightValue": "fix_gemini_s24",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "fix_gemini_s24"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "12c04466-9e30-469f-95ec-d310d90a1b30",
                    "leftValue": "={{$json[\"fix_type\"]}}",
                    "rightValue": "fix_gemini_ddc",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "fix_gemini_ddc"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [
        -4736,
        4832
      ],
      "id": "59f08941-2740-4178-a412-84acc6a704bb",
      "name": "Fix Errors Router",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c24e863d-0d5d-4f0f-a9bb-67c4d905368e",
              "name": "image_url",
              "value": "={{$json[\"image_url\"]}}",
              "type": "string"
            },
            {
              "id": "089fc571-6427-4371-9faa-fb87c42c2995",
              "name": "details",
              "value": "={{$json[\"details\"]}}",
              "type": "string"
            },
            {
              "id": "9ebe7e77-259b-4821-8fe8-dfa136cfe99a",
              "name": "reason",
              "value": "={{$json[\"reason\"]}}",
              "type": "string"
            },
            {
              "id": "908d4e7c-edb0-43ef-a109-66b444224b8b",
              "name": "new_value ",
              "value": "={{$json[\"new_value\"]}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3616,
        4080
      ],
      "id": "2a413d7c-ad79-4e45-923d-5f35ba97612a",
      "name": "Fix image (adult)",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c24e863d-0d5d-4f0f-a9bb-67c4d905368e",
              "name": "field",
              "value": "=={{$json[\"field\"]}}",
              "type": "string"
            },
            {
              "id": "089fc571-6427-4371-9faa-fb87c42c2995",
              "name": "new_value",
              "value": "=={{$json[\"new_value\"]}}",
              "type": "string"
            },
            {
              "id": "9ebe7e77-259b-4821-8fe8-dfa136cfe99a",
              "name": "reason",
              "value": "={{$json[\"reason\"]}}",
              "type": "string"
            },
            {
              "id": "f85ffb74-6889-401a-b713-27e2aad4ae65",
              "name": "details",
              "value": "={{$json[\"details\"]}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3616,
        4272
      ],
      "id": "f1883e4c-d6a1-4a19-b3bd-b0f7e5818a5b",
      "name": "Fix text",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "amount": 2
      },
      "id": "91ead233-4bc3-4b21-998b-d86e38adf3ab",
      "name": "Rate Limiting_Adult",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -5232,
        3888
      ],
      "webhookId": "77aa4d35-4b1e-410d-9f22-138e57a732c7",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c24e863d-0d5d-4f0f-a9bb-67c4d905368e",
              "name": "field",
              "value": "=={{$json[\"field\"]}}",
              "type": "string"
            },
            {
              "id": "089fc571-6427-4371-9faa-fb87c42c2995",
              "name": "new_value",
              "value": "=={{$json[\"new_value\"]}}",
              "type": "string"
            },
            {
              "id": "9ebe7e77-259b-4821-8fe8-dfa136cfe99a",
              "name": "reason",
              "value": "={{$json[\"reason\"]}}",
              "type": "string"
            },
            {
              "id": "f85ffb74-6889-401a-b713-27e2aad4ae65",
              "name": "details",
              "value": "={{$json[\"details\"]}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3616,
        4480
      ],
      "id": "e217eb47-8346-4e31-a8e8-6ac485fae98e",
      "name": "Fix merchant",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c24e863d-0d5d-4f0f-a9bb-67c4d905368e",
              "name": "field",
              "value": "=={{$json[\"field\"]}}",
              "type": "string"
            },
            {
              "id": "089fc571-6427-4371-9faa-fb87c42c2995",
              "name": "new_value",
              "value": "=={{$json[\"new_value\"]}}",
              "type": "string"
            },
            {
              "id": "9ebe7e77-259b-4821-8fe8-dfa136cfe99a",
              "name": "reason",
              "value": "={{$json[\"reason\"]}}",
              "type": "string"
            },
            {
              "id": "f85ffb74-6889-401a-b713-27e2aad4ae65",
              "name": "details",
              "value": "={{$json[\"details\"]}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3616,
        4656
      ],
      "id": "55c11c99-2437-49e1-b6d2-c43a83cb0a84",
      "name": "Fix Multi_Country",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c24e863d-0d5d-4f0f-a9bb-67c4d905368e",
              "name": "field",
              "value": "=={{$json[\"field\"]}}",
              "type": "string"
            },
            {
              "id": "089fc571-6427-4371-9faa-fb87c42c2995",
              "name": "new_value",
              "value": "=={{$json[\"new_value\"]}}",
              "type": "string"
            },
            {
              "id": "9ebe7e77-259b-4821-8fe8-dfa136cfe99a",
              "name": "reason",
              "value": "={{$json[\"reason\"]}}",
              "type": "string"
            },
            {
              "id": "f85ffb74-6889-401a-b713-27e2aad4ae65",
              "name": "details",
              "value": "={{$json[\"details\"]}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3632,
        5328
      ],
      "id": "ae6d61fd-d248-44fb-9ebf-3c134e5c60a0",
      "name": "Fix Multi_GTN/EAN",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c24e863d-0d5d-4f0f-a9bb-67c4d905368e",
              "name": "field",
              "value": "=={{$json[\"field\"]}}",
              "type": "string"
            },
            {
              "id": "089fc571-6427-4371-9faa-fb87c42c2995",
              "name": "new_value",
              "value": "=={{$json[\"new_value\"]}}",
              "type": "string"
            },
            {
              "id": "9ebe7e77-259b-4821-8fe8-dfa136cfe99a",
              "name": "reason",
              "value": "={{$json[\"reason\"]}}",
              "type": "string"
            },
            {
              "id": "f85ffb74-6889-401a-b713-27e2aad4ae65",
              "name": "details",
              "value": "={{$json[\"details\"]}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3632,
        5520
      ],
      "id": "c3a2599b-5419-4710-a356-bcabdde0e40e",
      "name": "Fix Multi_H√§ndler_Qualit√§t",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c24e863d-0d5d-4f0f-a9bb-67c4d905368e",
              "name": "field",
              "value": "=={{$json[\"field\"]}}",
              "type": "string"
            },
            {
              "id": "089fc571-6427-4371-9faa-fb87c42c2995",
              "name": "new_value",
              "value": "=={{$json[\"new_value\"]}}",
              "type": "string"
            },
            {
              "id": "9ebe7e77-259b-4821-8fe8-dfa136cfe99a",
              "name": "reason",
              "value": "={{$json[\"reason\"]}}",
              "type": "string"
            },
            {
              "id": "f85ffb74-6889-401a-b713-27e2aad4ae65",
              "name": "details",
              "value": "={{$json[\"details\"]}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3632,
        5776
      ],
      "id": "3451b6e5-7c4a-4f62-9d3b-2daa378f546b",
      "name": "Fix Multi_S24",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c24e863d-0d5d-4f0f-a9bb-67c4d905368e",
              "name": "field",
              "value": "=={{$json[\"field\"]}}",
              "type": "string"
            },
            {
              "id": "089fc571-6427-4371-9faa-fb87c42c2995",
              "name": "new_value",
              "value": "=={{$json[\"new_value\"]}}",
              "type": "string"
            },
            {
              "id": "9ebe7e77-259b-4821-8fe8-dfa136cfe99a",
              "name": "reason",
              "value": "={{$json[\"reason\"]}}",
              "type": "string"
            },
            {
              "id": "f85ffb74-6889-401a-b713-27e2aad4ae65",
              "name": "details",
              "value": "={{$json[\"details\"]}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3632,
        5984
      ],
      "id": "cdd5fad4-2f3a-43bc-a62c-21621afc0b6e",
      "name": "Fix Multi_DDC",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c24e863d-0d5d-4f0f-a9bb-67c4d905368e",
              "name": "new_value",
              "value": "={{$json[\"new_value\"]}}",
              "type": "string"
            },
            {
              "id": "089fc571-6427-4371-9faa-fb87c42c2995",
              "name": "field",
              "value": "={{$json[\"field\"]}}",
              "type": "string"
            },
            {
              "id": "9ebe7e77-259b-4821-8fe8-dfa136cfe99a",
              "name": "reason",
              "value": "={{$json[\"reason\"]}}",
              "type": "string"
            },
            {
              "id": "3522707f-aa20-4af2-ad2f-f9535d393df6",
              "name": "details",
              "value": "={{$json[\"details\"]}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3616,
        3888
      ],
      "id": "9248351c-aba3-4085-872e-c7949e5e8d3c",
      "name": "Fix Adult",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0c4d06f3-3700-4dc7-9458-db784bcadcb0",
              "name": "updated_product",
              "value": "=={{ { ...$json, [ $json[\"field\"] ]: $json[\"new_value\"] } }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3376,
        3888
      ],
      "id": "95df1498-1e2a-4579-969f-9d9155b4484f",
      "name": "Merge Fix with Product_Adult",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0c4d06f3-3700-4dc7-9458-db784bcadcb0",
              "name": "updated_product",
              "value": "=={{ { ...$json, [ $json[\"field\"] ]: $json[\"new_value\"] } }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3376,
        4064
      ],
      "id": "093fbcaf-a89d-4f3d-8207-006573cca18c",
      "name": "Merge Fix with Product_Image",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0c4d06f3-3700-4dc7-9458-db784bcadcb0",
              "name": "updated_product",
              "value": "=={{ { ...$json, [ $json[\"field\"] ]: $json[\"new_value\"] } }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3376,
        4256
      ],
      "id": "57168b00-1982-4cad-b099-1ca2ffe66e3f",
      "name": "Merge Fix with Product_Text",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0c4d06f3-3700-4dc7-9458-db784bcadcb0",
              "name": "updated_product",
              "value": "=={{ { ...$json, [ $json[\"field\"] ]: $json[\"new_value\"] } }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3376,
        4464
      ],
      "id": "b13178c9-421d-4a40-9b3c-6e0744a66e8d",
      "name": "Merge Fix with Product_Merchant",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0c4d06f3-3700-4dc7-9458-db784bcadcb0",
              "name": "updated_product",
              "value": "=={{ { ...$json, [ $json[\"field\"] ]: $json[\"new_value\"] } }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3376,
        4640
      ],
      "id": "9bf4abc6-fc09-4706-8e69-e640e65f534a",
      "name": "Merge Fix with Product_Country",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0c4d06f3-3700-4dc7-9458-db784bcadcb0",
              "name": "updated_product",
              "value": "=={{ { ...$json, [ $json[\"field\"] ]: $json[\"new_value\"] } }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3392,
        5312
      ],
      "id": "4349118d-4f24-49b2-803d-fc21b3d2ea61",
      "name": "Merge Fix with Product_GTNI/EAN",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0c4d06f3-3700-4dc7-9458-db784bcadcb0",
              "name": "updated_product",
              "value": "=={{ { ...$json, [ $json[\"field\"] ]: $json[\"new_value\"] } }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3392,
        5504
      ],
      "id": "a3d06df3-261b-4b8a-a5e1-08b1a5427f7c",
      "name": "Merge Fix with Product_H√§ndler_Quali",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0c4d06f3-3700-4dc7-9458-db784bcadcb0",
              "name": "updated_product",
              "value": "=={{ { ...$json, [ $json[\"field\"] ]: $json[\"new_value\"] } }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3392,
        5760
      ],
      "id": "979c4597-5b01-4cbd-8b14-16eb713b0a06",
      "name": "Merge Fix with Product_S24",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0c4d06f3-3700-4dc7-9458-db784bcadcb0",
              "name": "updated_product",
              "value": "=={{ { ...$json, [ $json[\"field\"] ]: $json[\"new_value\"] } }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3392,
        5968
      ],
      "id": "c7eca4d3-1b04-499a-abd4-f127addef50d",
      "name": "Merge Fix with Product_DDC",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $('SHOP_CONFIGURATION').item.json.shop1_id }}/products/{{ $json.product_id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "adult",
              "value": "true"
            },
            {
              "name": "ageGroup",
              "value": "adult"
            },
            {
              "name": "googleProductCategory",
              "value": "778"
            },
            {
              "name": "updated_product",
              "value": "=={{$json[\"updated_product\"]}}\n"
            }
          ]
        },
        "options": {}
      },
      "id": "4135fa04-596a-4ceb-9493-e04e3d421da2",
      "name": "Update Product FIX Adult Flag",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -3120,
        3888
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $('SHOP_CONFIGURATION').item.json.shop1_id }}/products/{{ $json.product.id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "imageLink",
              "value": "={{ $json.product.imageLink }}"
            },
            {
              "name": "updated_product",
              "value": "=={{ $json[\"updated_product\"] }}"
            }
          ]
        },
        "options": {}
      },
      "id": "8513eaf4-d6ff-46bb-81fd-00be374a7bb6",
      "name": "Update Product FIX_Images",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -3120,
        4064
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $('SHOP_CONFIGURATION').item.json.shop1_id }}/products/{{ $json.product.id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "title",
              "value": "={{ $json.product.title }}"
            },
            {
              "name": "description",
              "value": "=={{ $json.product.description }}"
            }
          ]
        },
        "options": {}
      },
      "id": "82d10836-5cde-4b40-8e42-a36b8ddee5b9",
      "name": "Update Product FIX_Text",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -3120,
        4256
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/shippingsettings",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "value": "=={{ $json[\"updated_product\"] }}"
            }
          ]
        },
        "options": {}
      },
      "name": "Update_Product_FIX_Merchant Settings",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -3120,
        4464
      ],
      "id": "292b28f7-9d5a-4b94-a289-50c721be678f",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/products/{{ $json.product_id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "value": "=={{ $json[\"updated_product\"] }}"
            }
          ]
        },
        "options": {}
      },
      "name": "Update_Product_FIX_Country Feeds",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -3120,
        4640
      ],
      "id": "98b4a7fd-417d-4a23-90df-17572e97752d",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/products/{{ $json.product_id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "value": "=={{ $json[\"updated_product\"] }}"
            }
          ]
        },
        "options": {}
      },
      "name": "Update_Product_FIX_H√§ndlerqualit√§t",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -3136,
        5504
      ],
      "id": "7193df7b-644a-4e9d-bc68-bcadb90f2e31",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/products/{{ $json.product_id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "value": "=={{ $json[\"updated_product\"] }}"
            }
          ]
        },
        "options": {}
      },
      "name": "Update GTN/EAN1",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -3136,
        5312
      ],
      "id": "3f32c008-4e86-40be-8225-d05abe7d6875",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/products/{{ $json.product_id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "value": "=={{ $json[\"updated_product\"] }}"
            }
          ]
        },
        "options": {}
      },
      "name": "Update_Prod_FIX_S24",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -3136,
        5760
      ],
      "id": "afb595ab-0fee-4814-b811-37e5109bb8d1",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/products/{{ $json.product_id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "value": "=={{ $json[\"updated_product\"] }}"
            }
          ]
        },
        "options": {}
      },
      "name": "Update_Prod_FIX_DDC",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -3136,
        5968
      ],
      "id": "934e81fc-810a-4002-aa14-9ff8f733b533",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "ZyZC3w7hfJ55uqot",
          "name": "Google_mechtech-merchant"
        },
        "googleOAuth2Api": {
          "id": "OFpjIV18thb8kzda",
          "name": "Google Merchant_Center"
        }
      },
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "amount": 3
      },
      "name": "Rate Limiting GTN/EAN",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -5232,
        5264
      ],
      "id": "36d282f1-12b1-4bf8-a319-d56583d034d9",
      "webhookId": "rate-limit-country-webhook",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// PREPARE GTIN/EAN LOOP - F√ºr Google Merchant Center GTIN/EAN Updates\n// ============================================================================\nconst inputData = $input.first().json;\nconst config = $('SHOP_CONFIGURATION').first().json;\n\n// ‚úÖ Hole Products von Analyze Products2:\nconst analysis = $('Analyze Products2').first().json;\nconst productsToFix = analysis.products_needing_fix || [];\n\n// ‚úÖ Hole Priority und Max Products von Gemini Decision:\nconst decision = $('Gemini Daily Decision').first().json.output || {};\nconst maxProducts = decision.products_to_process || productsToFix.length;\n\n// ‚úÖ Shop ID von Decision ODER Config:\nconst shopId = decision.shop_id || config.shop1_id;\n\n// ‚úÖ Shop Info aus Config:\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\n// Filtere nur Products die GTIN/EAN Updates brauchen\nconst productsNeedingGtinEan = productsToFix.filter(product => {\n  return product.needs_gtin_ean === true || \n         product.missing_gtin === true || \n         product.missing_mpn === true ||\n         product.missing_brand === true ||\n         (product.priority && product.priority === 'multi_gtn_ean');\n});\n\n// Slice f√ºr Batch Processing\nconst productsSlice = productsNeedingGtinEan.slice(0, maxProducts);\n\n// ‚úÖ Erstelle Items mit GTIN/EAN Daten:\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,  // ‚úÖ BEHALTEN!\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    \n    // ‚úÖ GTIN/EAN Daten - ALLE Fallbacks!\n    gtin: product.gtin || product.gtin_from_gemini || product.recommended_gtin || '',\n    mpn: product.mpn || product.mpn_from_gemini || product.recommended_mpn || '',\n    brand: product.brand || product.brand_from_gemini || product.recommended_brand || '',\n    \n    // ‚úÖ NEU: Google Standard Fields\n    identifier_exists: !!(\n      product.gtin || product.gtin_from_gemini || product.recommended_gtin ||\n      product.mpn || product.mpn_from_gemini || product.recommended_mpn\n    ),\n    \n    // ‚úÖ NEU: Lookup Flag\n    needs_gtin_lookup: !(product.gtin || product.gtin_from_gemini) && \n                       !(product.mpn || product.mpn_from_gemini),\n    \n    action: 'gtin_ean',\n    priority: 'multi_gtn_ean',\n    index: index + 1,\n    total: productsSlice.length,\n    timestamp: new Date().toISOString()  // ‚úÖ NEU\n  }\n}));"
      },
      "name": "Prepare GTN/EAN_Loop",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6736,
        5296
      ],
      "id": "e126a6ee-89db-4e78-9b5e-eb930e9f1cd9",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.needs_gtin_lookup }}"
            }
          ]
        }
      },
      "id": "15a73a3b-d231-48c1-8782-744f556b66d3",
      "name": "Route: GTIN Lookup Needed?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -6272,
        5040
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "const response = $input.item.json;\nconst statusCode = response.statusCode || response.status;\nconst isSuccess = (statusCode >= 200 && statusCode < 300) || response.id;\n\n// ‚úÖ Google Merchant Center Error Format\nconst errorDetails = !isSuccess ? {\n  error_code: statusCode,\n  error_message: response.body?.error?.message || response.error?.message || response.message || 'Unknown error',\n  error_type: response.body?.error?.errors?.[0]?.reason || 'unknown',\n  retry_recommended: [429, 500, 503].includes(statusCode)\n} : null;\n\nreturn [{\n  json: {\n    product_id: $('Prepare GTN/EAN_Loop').first().json.product_id,\n    offer_id: $('Prepare GTN/EAN_Loop').first().json.offer_id,\n    update_status: isSuccess ? 'success' : 'failed',\n    status_code: statusCode,\n    \n    // ‚úÖ BEHALTE wenn Build PATCH Body existiert:\n    updated_fields: $('Build PATCH Body')?.first()?.json?.changes_count || 0,\n    \n    // ‚úÖ Changed Fields\n    updated_gtin: $('Prepare GTN/EAN_Loop').first().json.gtin || null,\n    updated_mpn: $('Prepare GTN/EAN_Loop').first().json.mpn || null,\n    updated_brand: $('Prepare GTN/EAN_Loop').first().json.brand || null,\n    \n    // ‚úÖ Error Details (f√ºr Switch Node!)\n    error: errorDetails,\n    \n    // Metadata\n    timestamp: new Date().toISOString(),\n    phase: 'gtin_ean',\n    shop_id: $('Prepare GTN/EAN_Loop').first().json.shop_id,\n    \n    // ‚úÖ BEHALTE Full Response f√ºr Debugging\n    response: response\n  }\n}];"
      },
      "id": "83ec61f0-7a43-46fb-b5e8-4bd3a87d010d",
      "name": "Log Update Res_GTNI",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6000,
        5280
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "agent": "reActAgent",
        "text": "=Product: {{ $json.title }}\nBrand: {{ $json.extracted_brand || $json.brand || 'Unknown' }}\nManufacturer: {{ $json.extracted_manufacturer || 'Unknown' }}\nProduct URL: {{ $json.product_url || '' }}\nImage URL: {{ $json.image_link || '' }}\nDescription: {{ $json.description || '' }}\n\nFind valid manufacturer product identifiers (GTIN, EAN, UPC, MPN) for this product.",
        "options": {
          "humanMessageTemplate": "Recherchiere die Artikelnummern der Hersteller aus dem Internet und gib mir alle Artikelnummern der Hersteller, die Google im Google Merchant  Center erwartet oder  akzeptiert aus dem Output Parser zur√ºck. Nutze f√ºr die Artikel-nummern Suche die Informationen aus dem Google Merchant Center Artikel-Namen, Artikel-Bezeichnung, Artikel Link, Artikel- Bilder-URL und Artikelbild; Artikelbeschreibung, um den Herstellernamen Hersteller Firmen-Name oder die Marke ermitteln zu k√∂nnen! falls keine weiteren Informationen verf√ºgbar sind, gebe leere Felder zur√ºck."
        }
      },
      "id": "4d19d138-16e5-4a52-ada7-300bd4d51228",
      "name": "Find Missing GTIN",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1,
      "position": [
        -6640,
        4880
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput",
      "notes": "Dieser Agent sucht GTNI / EAN Nummern von Herstellern f√ºr das Google Merchant Center Next f√ºr S24 & DDC Shops"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"jsonSchema\": {\n    \"type\": \"object\",\n    \"properties\": {\n      \"gtin\": {\n        \"type\": [\"string\", \"null\"],\n        \"description\": \"GTIN/EAN/UPC code (8, 10, 12, 13, or 14 digits) or null if not found\"\n      },\n      \"mpn\": {\n        \"type\": [\"string\", \"null\"],\n        \"description\": \"Manufacturer Part Number or null if not found\"\n      },\n      \"identifier_type\": {\n        \"type\": \"string\",\n        \"enum\": [\"GTIN-8\", \"GTIN-12\", \"GTIN-13\", \"GTIN-14\", \"UPC\", \"EAN\", \"ISBN-10\", \"ISBN-13\", \"JAN\", \"ITF-14\", \"CCC\", \"CCIC\", \"MPN\"],\n        \"description\": \"Type of identifier found\"\n      },\n      \"source\": {\n        \"type\": \"string\",\n        \"description\": \"URL or source where identifier was found\"\n      },\n      \"confidence\": {\n        \"type\": \"number\",\n        \"minimum\": 0,\n        \"maximum\": 100,\n        \"description\": \"Confidence score 0-100\"\n      },\n      \"error\": {\n        \"type\": [\"string\", \"null\"],\n        \"description\": \"Error message if identifier not found, null otherwise\"\n      }\n    },\n    \"required\": [\"gtin\", \"mpn\", \"identifier_type\", \"source\", \"confidence\"]\n  }\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        -6480,
        5136
      ],
      "id": "217d9801-c359-46bd-96ae-eed722349244",
      "name": "GTNI_Parser",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1DzEcE22sizLdLIvv2v4ObdcRPFdNIey7nQHJJPrHge8",
          "mode": "list",
          "cachedResultName": "MECHTECH_Merchant_Center_Producer_Leads",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1DzEcE22sizLdLIvv2v4ObdcRPFdNIey7nQHJJPrHge8/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 333943058,
          "mode": "list",
          "cachedResultName": "MECHTECH_Producer_GTNI/EAN",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1DzEcE22sizLdLIvv2v4ObdcRPFdNIey7nQHJJPrHge8/edit#gid=333943058"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Datum": "={{ $today }}",
            "Produktname": "={{ $json.title }}",
            "Herstellernummer MPN/": "={{ $json.output.mpn || 'Not found' }}",
            "EAN/GTIN": "={{ $json.output.gtin || 'Not found' }}",
            "Produkt URL": "={{ $json.product_url || '' }}",
            "Kategorie": "={{ $json.product_type || '' }}",
            "Notizen": "={{ $json.output.error || 'No identifier found' }}",
            "Datum der Erfassung": "={{ $now }}",
            "www.siliconedolls24.com": "={{ $('SHOP_CONFIGURATION').item.json.shop1_name }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Datum",
              "displayName": "Datum",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Produktname",
              "displayName": "Produktname",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Herstellernummer MPN/",
              "displayName": "Herstellernummer MPN/",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "EAN/GTIN",
              "displayName": "EAN/GTIN",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Produkt URL",
              "displayName": "Produkt URL",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "www.siliconedolls24.com",
              "displayName": "www.siliconedolls24.com",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "www.dreamdoll.de",
              "displayName": "www.dreamdoll.de",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Kategorie",
              "displayName": "Kategorie",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Notizen",
              "displayName": "Notizen",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Datum der Erfassung",
              "displayName": "Datum der Erfassung",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -5232,
        4864
      ],
      "id": "699e8124-db31-4044-aaa4-b8c25dbb0b5e",
      "name": "Google Sheets1",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "cztAb4CKfRPRO8KX",
          "name": "Google Sheets account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// ============================================================================\n// EXTRACT MANUFACTURER INFO - Extract brand/manufacturer from product data\n// ============================================================================\nconst product = $input.item.json;\n\n// Helper function to extract brand from various sources\nfunction extractBrand(product) {\n  // 1. Check if brand already exists\n  if (product.brand && product.brand.trim()) {\n    return product.brand.trim();\n  }\n  \n  // 2. Try to extract from title\n  const title = product.title || '';\n  const titleWords = title.split(/[\\s-]+/);\n  \n  // Common brand patterns in title (first word often brand)\n  if (titleWords.length > 0 && titleWords[0].length > 2) {\n    const potentialBrand = titleWords[0];\n    // Filter out common non-brand words\n    const excludeWords = ['the', 'a', 'an', 'new', 'used', 'original', 'genuine'];\n    if (!excludeWords.includes(potentialBrand.toLowerCase())) {\n      return potentialBrand;\n    }\n  }\n  \n  // 3. Try to extract from URL\n  const url = product.shop_url || product.link || '';\n  const urlMatch = url.match(/\\/([a-zA-Z0-9-]+)\\//g);\n  if (urlMatch && urlMatch.length > 0) {\n    // Often brand is in URL path\n    const urlParts = urlMatch.map(part => part.replace(/\\//g, ''));\n    for (const part of urlParts) {\n      if (part.length > 2 && !['product', 'item', 'shop', 'store'].includes(part.toLowerCase())) {\n        return part;\n      }\n    }\n  }\n  \n  return null;\n}\n\n// Helper function to extract manufacturer info from description\nfunction extractManufacturerFromDescription(description) {\n  if (!description) return null;\n  \n  const patterns = [\n    /manufacturer[:\\s]+([a-zA-Z0-9\\s-]+)/i,\n    /brand[:\\s]+([a-zA-Z0-9\\s-]+)/i,\n    /made by[:\\s]+([a-zA-Z0-9\\s-]+)/i,\n    /produced by[:\\s]+([a-zA-Z0-9\\s-]+)/i\n  ];\n  \n  for (const pattern of patterns) {\n    const match = description.match(pattern);\n    if (match && match[1]) {\n      return match[1].trim().split(/[,\\.\\n]/)[0];\n    }\n  }\n  \n  return null;\n}\n\n// Extract brand/manufacturer\nconst extractedBrand = extractBrand(product);\nconst descriptionBrand = extractManufacturerFromDescription(product.description || '');\n\n// Prepare search context for GTIN lookup\nconst searchContext = {\n  title: product.title || '',\n  brand: extractedBrand || descriptionBrand || product.brand || 'Unknown',\n  mpn: product.mpn || '',\n  url: product.shop_url || product.link || '',\n  image_url: product.image_link || product.imageLink || '',\n  description_snippet: (product.description || '').substring(0, 200)\n};\n\nreturn {\n  json: {\n    ...product,\n    extracted_brand: extractedBrand,\n    description_brand: descriptionBrand,\n    final_brand: extractedBrand || descriptionBrand || product.brand || null,\n    search_context: searchContext,\n    extraction_timestamp: new Date().toISOString()\n  }\n};"
      },
      "id": "5f4619cf-12c9-4086-bceb-1ae4595debac",
      "name": "Extract Manufacturer Info",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6272,
        5280
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// BUILD PATCH BODY - Google Merchant Center GTIN/EAN Update\n// ============================================================================\n\n// Get data from previous nodes\nconst prepareData = $('Prepare GTN/EAN_Loop').first().json;\nconst foundGtin = $('Find Missing GTIN')?.first()?.json?.output || null;\nconst mergedData = $('Merge Found GTIN Data')?.first()?.json || null;\n\n// Determine which GTIN/MPN/Brand to use (priority: merged > found > original)\nconst gtin = mergedData?.gtin || foundGtin?.gtin || prepareData.gtin || null;\nconst mpn = mergedData?.mpn || foundGtin?.mpn || prepareData.mpn || null;\nconst brand = mergedData?.brand || foundGtin?.brand || prepareData.brand || null;\n\n// Build the PATCH body for Google Merchant Center\nconst patchBody = {};\nlet changesCount = 0;\n\n// Add GTIN if available\nif (gtin) {\n  patchBody.gtin = gtin;\n  changesCount++;\n}\n\n// Add MPN if available\nif (mpn) {\n  patchBody.mpn = mpn;\n  changesCount++;\n}\n\n// Add Brand if available\nif (brand) {\n  patchBody.brand = brand;\n  changesCount++;\n}\n\n// Set identifierExists based on whether we have GTIN or MPN\nconst hasIdentifier = !!(gtin || mpn);\npatchBody.identifierExists = hasIdentifier;\nchangesCount++;\n\n// Return the PATCH body with metadata\nreturn [{\n  json: {\n    product_id: prepareData.product_id,\n    offer_id: prepareData.offer_id,\n    shop_id: prepareData.shop_id,\n    patch_body: patchBody,\n    changes_count: changesCount,\n    has_gtin: !!gtin,\n    has_mpn: !!mpn,\n    has_brand: !!brand,\n    identifier_exists: hasIdentifier,\n    timestamp: new Date().toISOString()\n  }\n}];"
      },
      "id": "fffa0bbb-31c0-4d64-8cec-0b0ccaf9ec10",
      "name": "Build PATCH Body",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6000,
        5072
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "PATCH",
        "url": "=https://merchantapi.googleapis.com/products/v1beta/accounts/{{ $json.shop_id }}/products/{{ $json.product_id }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.patch_body }}",
        "options": {
          "timeout": 30000
        }
      },
      "id": "2afb192b-d883-448e-ac73-3a8cfe5c7ac5",
      "name": "Update Product in GMC",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -5728,
        5072
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleOAuth2Api": {
          "id": "DClo09haz5afTzd8",
          "name": "Google_Custom_search"
        }
      },
      "onError": "continueErrorOutput",
      "continueOnFail": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "id-1",
              "leftValue": "={{ $json.output.gtin }}",
              "operator": {
                "type": "string",
                "operation": "notEmpty"
              }
            },
            {
              "id": "id-2",
              "leftValue": "={{ $json.output.mpn }}",
              "operator": {
                "type": "string",
                "operation": "notEmpty"
              }
            },
            {
              "id": "id-3",
              "leftValue": "={{ $json.output.confidence }}",
              "rightValue": 70,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "9e128df4-0ef6-4708-bbfc-313f8c376d74",
      "name": "Check: GTIN Found?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        -6272,
        4864
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================================\n// LOOP CONTROLLER - Check if more products need processing\n// ============================================================================\n\n// Get the current product data from Log Update Res_GTNI\nconst currentProduct = $input.first().json;\n\n// Get the original loop data from Prepare GTN/EAN_Loop\nconst loopData = $('Prepare GTN/EAN_Loop').all();\nconst totalProducts = loopData.length;\n\n// Get current index from the processed product\nconst currentIndex = currentProduct.index || 0;\n\n// Determine if we should continue the loop\nconst hasMoreProducts = currentIndex < totalProducts;\n\nif (hasMoreProducts) {\n  // Continue loop - return data to trigger next iteration\n  return [{\n    json: {\n      continue_loop: true,\n      current_index: currentIndex,\n      total_products: totalProducts,\n      remaining: totalProducts - currentIndex,\n      next_product: loopData[currentIndex]?.json || null,\n      timestamp: new Date().toISOString()\n    }\n  }];\n} else {\n  // Exit loop - all products processed\n  return [{\n    json: {\n      continue_loop: false,\n      current_index: currentIndex,\n      total_products: totalProducts,\n      remaining: 0,\n      loop_completed: true,\n      timestamp: new Date().toISOString()\n    }\n  }];\n}"
      },
      "id": "4186699a-b85c-4fc4-a915-e6eb9a6c4ae1",
      "name": "Loop Controller",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -5232,
        5056
      ],
      "alwaysOutputData": true,
      "retryOnFail": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "id-1",
              "name": "gtin",
              "value": "={{ $json.output.gtin }}",
              "type": "string"
            },
            {
              "id": "id-2",
              "name": "mpn",
              "value": "={{ $json.output.mpn }}",
              "type": "string"
            },
            {
              "id": "id-3",
              "name": "brand",
              "value": "={{ $json.output.brand || $json.brand }}",
              "type": "string"
            },
            {
              "id": "id-4",
              "name": "identifier_type",
              "value": "={{ $json.output.identifier_type }}",
              "type": "string"
            },
            {
              "id": "id-5",
              "name": "source",
              "value": "={{ $json.output.source }}",
              "type": "string"
            },
            {
              "id": "id-6",
              "name": "confidence",
              "value": "={{ $json.output.confidence }}",
              "type": "number"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "id": "84651633-ef89-449c-9bac-ef71b7de9a32",
      "name": "Merge Found GTIN Data",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -6000,
        4864
      ],
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b85d4e72-545e-46d6-9d63-bb8819eeffb5",
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "multi_gtn_ean",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Multi GTN/EAN"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "9d7772c0-b5a4-451e-a8f2-c9852eff5496",
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "GTNI/EAN Hersteller Recherche"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "2d85adf4-528d-4e12-9dff-d4ed344383f6",
                    "leftValue": "={{ $json.output.priority }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Error‚ÄëAgent"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra",
          "renameFallbackOutput": "Fallback"
        }
      },
      "name": "Route by Priority1",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -7056,
        5008
      ],
      "id": "70f7e6dd-6801-46d5-81a2-72e2deaaf7d0",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash-lite-preview-02-05",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -6768,
        5040
      ],
      "id": "d44ef084-2ede-4e49-9d57-56f5fc2d25dc",
      "name": "Gemini Chat",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googlePalmApi": {
          "id": "iTt5j2CqCJvCx7sv",
          "name": "Google Gemini(PaLM) Api account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "toolDescription": "Search the web for manufacturer product identifiers (GTIN, EAN, MPN) using Google Custom Search",
        "url": "https://www.googleapis.com/customsearch/v1",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "key",
              "value": "={{ $fromAI('api_key', 'Google API Key', 'string') }}"
            },
            {
              "name": "cx",
              "value": "={{ $fromAI('search_engine_id', 'Custom Search Engine ID', 'string') }}"
            },
            {
              "name": "q",
              "value": "={{ $fromAI('search_query', 'Search query for product identifiers', 'string') }}"
            }
          ]
        },
        "options": {}
      },
      "id": "510479f0-c458-4165-add2-34430269f894",
      "name": "Web Search GTNI",
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.3,
      "position": [
        -6656,
        5136
      ]
    },
    {
      "parameters": {
        "content": "## GTNI / EAN HERSTELLER NUMMER SUCHEN",
        "height": 672,
        "width": 1440,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -6800,
        4832
      ],
      "id": "74dd4b21-606b-4a92-a679-f61c73d43ac7",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE",
          "mode": "list",
          "cachedResultName": "MECHTECH Merchant Center Dashboard",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 1479069768,
          "mode": "list",
          "cachedResultName": " üìù Daily_Log_Updates",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE/edit#gid=1479069768"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Datum": "={{ $today }}",
            "Produktname": "={{ $json.title }}",
            "Herstellernummer MPN/": "={{ $json.output.mpn || 'Not found' }}",
            "EAN/GTIN": "={{ $json.output.gtin || 'Not found' }}",
            "Produkt URL": "={{ $json.product_url || '' }}",
            "Kategorie": "={{ $json.product_type || '' }}",
            "Notizen": "={{ $json.output.error || 'No identifier found' }}",
            "Datum der Erfassung": "={{ $now }}",
            "www.siliconedolls24.com": "={{ $json.shop1_id }}",
            "www.dreamdoll.de": "={{ $json.shop2_id }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Datum",
              "displayName": "Datum",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Produktname",
              "displayName": "Produktname",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Herstellernummer MPN/",
              "displayName": "Herstellernummer MPN/",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "EAN/GTIN",
              "displayName": "EAN/GTIN",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Produkt URL",
              "displayName": "Produkt URL",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "www.siliconedolls24.com",
              "displayName": "www.siliconedolls24.com",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "www.dreamdoll.de",
              "displayName": "www.dreamdoll.de",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Kategorie",
              "displayName": "Kategorie",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Notizen",
              "displayName": "Notizen",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "Datum der Erfassung",
              "displayName": "Datum der Erfassung",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -3104,
        4992
      ],
      "id": "5def5634-3469-4abf-a9f3-de26a4e03957",
      "name": "Google Sheets",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "cztAb4CKfRPRO8KX",
          "name": "Google Sheets account"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "url": "=https://mxswxdnnjhhukovixzvb.supabase.co/rest/v1/workflow_status?select=*&order=created_at.desc&limit=100",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "supabaseApi",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "=id",
              "value": "={{ $('SHOP_CONFIGURATION').item.json.shop1_id }}"
            },
            {
              "name": "run_date",
              "value": "={{ $json.run_date }}"
            },
            {
              "name": "shop1_id",
              "value": "={{ $('SHOP_CONFIGURATION').item.json.shop1_name }}"
            },
            {
              "name": "shop1_name",
              "value": "={{ $('SHOP_CONFIGURATION').item.json.shop1_name }}"
            },
            {
              "name": "phase",
              "value": "={{ $json.phase }}"
            },
            {
              "name": "products_processed",
              "value": "={{ $json.products_processed }}"
            },
            {
              "name": "success_count",
              "value": "={{ $json.success_count }}"
            },
            {
              "name": "failed_count",
              "value": "={{ $json.failed_count }}"
            },
            {
              "name": "budget_used",
              "value": "={{ $json.budget_used }}"
            },
            {
              "name": "duration_seconds",
              "value": "={{ $json.duration_seconds }}"
            },
            {
              "name": "gemini_decision",
              "value": "={{ $json.gemini_decision }}"
            },
            {
              "name": "approval_rate_before",
              "value": "={{ $json.approval_rate_before }}"
            },
            {
              "name": "approval_rate_after",
              "value": "={{ $json.approval_rate_after }}"
            },
            {
              "name": "created_at",
              "value": "={{ $json.created_at }}"
            },
            {
              "name": "updated_at",
              "value": "={{ $json.updated_at }}"
            }
          ]
        },
        "options": {}
      },
      "name": "Get Workflow Status REAL",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -8144,
        4176
      ],
      "id": "0ae2ff72-9936-4c02-8a0c-fca086b08b1b",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "waitBetweenTries": 3000,
      "credentials": {
        "supabaseApi": {
          "id": "f1qLUdIsbZ2A3wdC",
          "name": "Supabase-MySQL"
        }
      },
      "continueOnFail": true,
      "onError": "continueErrorOutput"
    }
  ],
  "connections": {
    "2d6517f1-ebbc-48fd-894c-287420175a7a": {
      "main": [
        [
          {
            "node": "9bf990d0-1d87-4bbb-9153-46146b506ae6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "9bf990d0-1d87-4bbb-9153-46146b506ae6": {
      "main": [
        [
          {
            "node": "3245d64d-7810-44de-beaa-f97d55eb2274",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "3245d64d-7810-44de-beaa-f97d55eb2274": {
      "main": [
        [
          {
            "node": "92b514de-5cd0-4f79-9857-123e685a1405",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "39d79c98-55c7-418a-8c36-bce59d3efd3f": {
      "main": [
        [
          {
            "node": "40a1e96b-15f2-4eb0-bdad-bd7532b02a22",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "40a1e96b-15f2-4eb0-bdad-bd7532b02a22": {
      "main": [
        [
          {
            "node": "f0a9ce99-2f4c-4baf-857a-02c81d0cae4d",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "f0a9ce99-2f4c-4baf-857a-02c81d0cae4d": {
      "main": [
        [
          {
            "node": "09ba4846-6da9-425c-a762-4f9f4bc1b4e6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "f49cb6b3-195b-42f6-a025-a0e78d62cfca": {
      "main": [
        [
          {
            "node": "2d6517f1-ebbc-48fd-894c-287420175a7a",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "92b514de-5cd0-4f79-9857-123e685a1405": {
      "main": [
        [
          {
            "node": "40a1e96b-15f2-4eb0-bdad-bd7532b02a22",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Error Handler": {
      "main": [
        [
          {
            "node": "Retry Queue",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Retry Queue": {
      "main": [
        [
          {
            "node": "Expression Repair",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "main": [
      [
        [
          {
            "node": "7a01b7e8-3184-4982-92f4-a0ba03f781a4",
            "type": "main",
            "index": 0
          },
          {
            "node": "errorHandler-1766014501177-9ez5es86k",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "errorHandler-1766014501177-9ez5es86k",
            "type": "main",
            "index": 0
          },
          {
            "node": "4c9f8649-a6b7-45dd-9ed9-b9134be84018",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "4c9f8649-a6b7-45dd-9ed9-b9134be84018",
            "type": "main",
            "index": 0
          },
          {
            "node": "c0c41789-4c7d-4efc-861f-885743a1aff8",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "errorHandler-1766014501177-9ez5es86k",
            "type": "main",
            "index": 1
          },
          {
            "node": "80b0ee00-87d9-44ec-8b62-8c86eda7737b",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "7a01b7e8-3184-4982-92f4-a0ba03f781a4",
            "type": "main",
            "index": 1
          },
          {
            "node": "65ca06d9-ae1b-4669-ba03-4418312d0442",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "c0c41789-4c7d-4efc-861f-885743a1aff8",
            "type": "main",
            "index": 0
          },
          {
            "node": "7a01b7e8-3184-4982-92f4-a0ba03f781a4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "15586a83-cda8-4ac9-9826-9ed77f24fa1c",
            "type": "main",
            "index": 0
          },
          {
            "node": "ai-error-handler-adult-1766019421751-xxxuhgnln",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ai-error-handler-adult-1766019421751-xxxuhgnln",
            "type": "main",
            "index": 0
          },
          {
            "node": "retry-queue-adult-1766019421751-10y8tihcx",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "retry-queue-adult-1766019421751-10y8tihcx",
            "type": "main",
            "index": 0
          },
          {
            "node": "expression-repair-adult-1766019421752-5eytl5tjg",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "expression-repair-adult-1766019421752-5eytl5tjg",
            "type": "main",
            "index": 0
          },
          {
            "node": "15586a83-cda8-4ac9-9826-9ed77f24fa1c",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "34310e5a-2422-4ce3-a615-5b8f911b5407",
            "type": "main",
            "index": 0
          },
          {
            "node": "ai-error-handler-text-1766019421752-tx9bpgxr6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ai-error-handler-text-1766019421752-tx9bpgxr6",
            "type": "main",
            "index": 0
          },
          {
            "node": "retry-queue-text-1766019421752-b389yhp5y",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "retry-queue-text-1766019421752-b389yhp5y",
            "type": "main",
            "index": 0
          },
          {
            "node": "expression-repair-text-1766019421752-rngvhbii6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "expression-repair-text-1766019421752-rngvhbii6",
            "type": "main",
            "index": 0
          },
          {
            "node": "34310e5a-2422-4ce3-a615-5b8f911b5407",
            "type": "main",
            "index": 0
          }
        ]
      ]
    ],
    "Expression Repair": {
      "main": [
        [
          {
            "node": "Prepare GTN/EAN_Loop",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Chat Trigger (RAG Query)": {
      "main": [
        [
          {
            "node": "Chat Agent (RAG)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Chat Model (RAG)": {
      "ai_languageModel": [
        [
          {
            "node": "Chat Agent (RAG)",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "Chat Agent (RAG)",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Check Last Run": {
      "main": [
        [
          {
            "node": "Get Workflow Status REAL",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Products Loop": {
      "main": [
        [
          {
            "node": "Update Product Adult Flag",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Product Adult Flag": {
      "main": [
        [
          {
            "node": "Rate Limiting_Adult",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results_Sheets_01",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error Parser",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Workflow Run": {
      "main": [
        [
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log Results to Sheets": {
      "main": [
        [
          {
            "node": "Send Daily Report",
            "type": "main",
            "index": 0
          },
          {
            "node": "Save to Supabase Products",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Daily Report": {
      "main": [
        [
          {
            "node": "Format Report for Email",
            "type": "main",
            "index": 0
          },
          {
            "node": "Check if Expert Needed",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Report for Email": {
      "main": [
        [
          {
            "node": "Export Report to Gmail",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Command Input": {
      "main": [
        [
          {
            "node": "Route Command",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check if Expert Needed": {
      "main": [
        [
          {
            "node": "Send WhatsApp Expert Alert",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Format Report for Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route Command": {
      "main": [
        [
          {
            "node": "SHOP_CONFIGURATION",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Prepare Images Loop": {
      "main": [
        [
          {
            "node": "Update Product Images",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Product Images": {
      "main": [
        [
          {
            "node": "Rate Limiting Images",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results_Sheets_01",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error Parser",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rate Limiting Images": {
      "main": [
        [
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Update Product Text": {
      "main": [
        [
          {
            "node": "Rate Limiting Text",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results_Sheets_01",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error Parser",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rate Limiting Text": {
      "main": [
        [
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Handle Invalid Priority": {
      "main": [
        [
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate Results2": {
      "main": [
        [
          {
            "node": "Save Workflow Run",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Human Instructions",
            "type": "main",
            "index": 0
          },
          {
            "node": "Format Status Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Merchant Quality Loop": {
      "main": [
        [
          {
            "node": "Update Merchant Settings",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Merchant Settings": {
      "main": [
        [
          {
            "node": "Rate Limiting Merchant",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results_Sheets_01",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error Parser",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Multi Country Loop": {
      "main": [
        [
          {
            "node": "Update Country Feeds",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Country Feeds": {
      "main": [
        [
          {
            "node": "Rate Limiting Country",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results_Sheets_01",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error Parser",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rate Limiting Merchant": {
      "main": [
        [
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Rate Limiting Country": {
      "main": [
        [
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Route by Priority": {
      "main": [
        [
          {
            "node": "Prepare Products Loop",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare Images Loop",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare Text Loop",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare Merchant Quality Loop",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare Multi Country Loop",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Route by Priority1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare H√§ndlerqualit√§t",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare MC For Gemini S24_2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare MC For Gemini DDC_2",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [],
        [
          {
            "node": "AI Error Analyzer Adult Flags",
            "type": "main",
            "index": 0
          },
          {
            "node": "AI Error Analyzer Images",
            "type": "main",
            "index": 0
          },
          {
            "node": "AI Error Analyzer Text",
            "type": "main",
            "index": 0
          },
          {
            "node": "AI Error Analyzer Merchant",
            "type": "main",
            "index": 0
          },
          {
            "node": "AI Error Analyzer Error_Multi_Country",
            "type": "main",
            "index": 0
          },
          {
            "node": "AI Error Analyzer Error_Multi_GTN/EAN",
            "type": "main",
            "index": 0
          },
          {
            "node": "AI Error Analyzer_H√§ndlerqualit√§t",
            "type": "main",
            "index": 0
          },
          {
            "node": "Error_Ana_S24",
            "type": "main",
            "index": 0
          },
          {
            "node": "Error_Ana_DDC",
            "type": "main",
            "index": 0
          },
          {
            "node": "Handle Invalid Priority",
            "type": "main",
            "index": 0
          },
          {
            "node": "Gemini Daily Decision",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Save to Supabase Products": {
      "main": [
        [
          {
            "node": "Update Optimization Patterns",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Optimization Patterns": {
      "main": [
        [
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results_Sheets_01",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Human Instructions": {
      "main": [
        [
          {
            "node": "Filter Unprocessed Instructions",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Unprocessed Instructions": {
      "main": [
        [
          {
            "node": "Process Instructions with Gemini",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Instructions with Gemini": {
      "main": [
        [
          {
            "node": "Apply to Similar Products",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Model Learning": {
      "ai_languageModel": [
        [
          {
            "node": "Process Instructions with Gemini",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "JSON Parser Learning": {
      "ai_outputParser": [
        [
          {
            "node": "Process Instructions with Gemini",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Apply to Similar Products": {
      "main": [
        [
          {
            "node": "Save Learning to Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Sheet with AI Response": {
      "main": [
        [
          {
            "node": "Send Daily Report",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Learning to Supabase": {
      "main": [
        [
          {
            "node": "Update Sheet with AI Response",
            "type": "main",
            "index": 0
          },
          {
            "node": "Gemini Daily Decision",
            "type": "main",
            "index": 0
          },
          {
            "node": "Process Instructions with Gemini",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Status Response": {
      "main": [
        [
          {
            "node": "Format Report for Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client": {
      "ai_tool": [
        [
          {
            "node": "Chat Agent (RAG)",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‚ÄòExecute workflow‚Äô": {
      "main": [
        []
      ]
    },
    "Log Results_Sheets_01": {
      "main": [
        [
          {
            "node": "Send WhatsApp Expert Alert",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results to Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client2": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer Adult Flags",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase RAG Context1": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer Adult Flags",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client3": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer Images",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase RAG Context2": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer Images",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client4": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer Text",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase RAG Context3": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer Text",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client5": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer Merchant",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase RAG Context4": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer Merchant",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "Merchant_Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Adult_Flags_Parser": {
      "ai_outputParser": [
        []
      ]
    },
    "Images Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Error Analyzer Images",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Text_Output_Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Error Analyzer Text",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Google_Gemini_Chat": {
      "ai_languageModel": [
        [
          {
            "node": "Text_Output_Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Supabase RAG Context5": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer Error_Multi_Country",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model5": {
      "ai_languageModel": [
        [
          {
            "node": "Country_Out_Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client_6": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer Error_Multi_Country",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Country_Out_Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Error Analyzer Error_Multi_Country",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Merchant_Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Error Analyzer Merchant",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Supabase RAG Context6": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer Error_Multi_GTN/EAN",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model6": {
      "ai_languageModel": [
        [
          {
            "node": "Multi_GTN/EAN_Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client_": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer Error_Multi_GTN/EAN",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Multi_GTN/EAN_Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Error Analyzer Error_Multi_GTN/EAN",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Error_GTN/EAN": {
      "ai_languageModel": [
        [
          {
            "node": "AI Error Analyzer Error_Multi_GTN/EAN",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Supabase RAG Context7": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer_H√§ndlerqualit√§t",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model7": {
      "ai_languageModel": [
        [
          {
            "node": "H√§ndlerqualit√§t_Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Prepare H√§ndlerqualit√§t": {
      "main": [
        [
          {
            "node": "Update H√§ndlerqualit√§t",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "H√§ndlerqualit√§t_Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Error Analyzer_H√§ndlerqualit√§t",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Rate Limiting H√§ndlerqualit√§t": {
      "main": [
        [
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Update H√§ndlerqualit√§t": {
      "main": [
        [
          {
            "node": "Rate Limiting H√§ndlerqualit√§t",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results_Sheets_01",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error Parser",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Error Analyzer_H√§ndlerqualit√§t": {
      "main": [
        [
          {
            "node": "Fix Errors Router",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "AI Error Analyzer Error_Multi_GTN/EAN": {
      "main": [
        [
          {
            "node": "Fix Errors Router",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "AI Error Analyzer Error_Multi_Country": {
      "main": [
        [
          {
            "node": "Fix Errors Router",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "AI Error Analyzer Merchant": {
      "main": [
        [
          {
            "node": "Fix Errors Router",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "AI Error Analyzer Text": {
      "main": [
        [
          {
            "node": "Fix Errors Router",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "AI Error Analyzer Images": {
      "main": [
        [
          {
            "node": "Fix Errors Router",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "AI Error Analyzer Adult Flags": {
      "main": [
        [
          {
            "node": "Fix Errors Router",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Gemini Product Optimizer (NEW)": {
      "ai_languageModel": [
        [
          {
            "node": "MC_Parse_S24",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client_1": {
      "ai_tool": [
        [
          {
            "node": "AI Error Analyzer_H√§ndlerqualit√§t",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client_2": {
      "ai_tool": [
        [
          {
            "node": "Error_Ana_S24",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "MC_Prepare_S24": {
      "ai_languageModel": [
        [
          {
            "node": "Error_Ana_S24",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "MC_Get_Products_S24": {
      "main": [
        [
          {
            "node": "MC Merge Products + Status S24",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results_Sheets_01",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MC_Parse_S24": {
      "ai_outputParser": [
        [
          {
            "node": "Error_Ana_S24",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "MC Merge Products + Status S24": {
      "main": [
        [],
        []
      ]
    },
    "MCP Client_3": {
      "ai_tool": [
        [
          {
            "node": "Error_Ana_DDC",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "MC_Get_Products_DDC": {
      "main": [
        [
          {
            "node": "MC Merge Products + Status DDC",
            "type": "main",
            "index": 0
          },
          {
            "node": "Log Results_Sheets_01",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MC Merge Products + Status DDC": {
      "main": [
        [],
        [
          {
            "node": "Error_Ana_DDC",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MC_Pre_DDC": {
      "ai_languageModel": [
        [
          {
            "node": "Error_Ana_DDC",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Supabase_S24": {
      "ai_tool": [
        [
          {
            "node": "Error_Ana_DDC",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase_S": {
      "ai_tool": [
        [
          {
            "node": "Error_Ana_S24",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Error_Ana_S24": {
      "main": [
        [
          {
            "node": "Fix Errors Router",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "MC_Parse_DDC": {
      "ai_outputParser": [
        [
          {
            "node": "Error_Ana_DDC",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Optimizer DDC": {
      "ai_languageModel": [
        [
          {
            "node": "MC_Parse_DDC",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Error_Ana_DDC": {
      "main": [
        [
          {
            "node": "Fix Errors Router",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Gemini_Chat_Adult": {
      "ai_languageModel": [
        [
          {
            "node": "Adult_Flags_Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Chat_Images": {
      "ai_languageModel": [
        [
          {
            "node": "Images Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Error Adult Flags": {
      "ai_languageModel": [
        [
          {
            "node": "AI Error Analyzer Adult Flags",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Error Images": {
      "ai_languageModel": [
        [
          {
            "node": "AI Error Analyzer Images",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Error Adult Text": {
      "ai_languageModel": [
        [
          {
            "node": "AI Error Analyzer Text",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Error Merchant Quality": {
      "ai_languageModel": [
        [
          {
            "node": "AI Error Analyzer Merchant",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Error_Multi_Country1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Error Analyzer Error_Multi_Country",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Error_H√§ndlerquali": {
      "ai_languageModel": [
        [
          {
            "node": "AI Error Analyzer_H√§ndlerqualit√§t",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store": {
      "ai_tool": [
        [
          {
            "node": "Chat Agent (RAG)",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings Google Gemini": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ],
      "main": [
        [
          {
            "node": "Chat Agent (RAG)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Merchant Products_S24": {
      "main": [
        [
          {
            "node": "Analyze Products2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Merchant Products_DDC": {
      "main": [
        [
          {
            "node": "Analyze Products2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare MC For Gemini S24_2": {
      "main": [
        [
          {
            "node": "MC_Get_Products_S24",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare MC For Gemini DDC_2": {
      "main": [
        [
          {
            "node": "MC_Get_Products_DDC",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SHOP_CONFIGURATION": {
      "main": [
        [
          {
            "node": "Check Last Run",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze Products2": {
      "main": [
        [
          {
            "node": "Smart Priority Scorer",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Smart Priority Scorer": {
      "main": [
        [
          {
            "node": "Gemini Daily Decision",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Handle Invalid Priority",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Text Loop": {
      "main": [
        [
          {
            "node": "Update Product Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Parse Command Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "MCP Client1": {
      "ai_tool": [
        [
          {
            "node": "Gemini Daily Decision",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase RAG Context": {
      "ai_tool": [
        [
          {
            "node": "Gemini Daily Decision",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Decision_Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Gemini Daily Decision",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Decision_Chat": {
      "ai_languageModel": [
        [
          {
            "node": "Gemini Daily Decision",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Gemini_Decisions": {
      "ai_memory": [
        [
          {
            "node": "Gemini Daily Decision",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Daily Decision": {
      "main": [
        [
          {
            "node": "Route by Priority",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error Parser": {
      "main": [
        [
          {
            "node": "Error Parser Schema",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error Parser Schema": {
      "main": [
        [
          {
            "node": "Error Router",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error Router": {
      "main": [
        [
          {
            "node": "AI Error Analyzer Adult Flags",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Error Analyzer Images",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Error Analyzer Text",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [
          {
            "node": "AI Error Analyzer Merchant",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Error Analyzer Error_Multi_Country",
            "type": "main",
            "index": 0
          },
          {
            "node": "AI Error Analyzer Error_Multi_GTN/EAN",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Error Analyzer_H√§ndlerqualit√§t",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error_Ana_S24",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error_Ana_DDC",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Fix Errors Router": {
      "main": [
        [
          {
            "node": "Fix Adult",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fix image (adult)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fix text",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fix merchant",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fix Multi_Country",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fix Multi_GTN/EAN",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fix Multi_H√§ndler_Qualit√§t",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fix Multi_S24",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Fix Multi_DDC",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rate Limiting_Adult": {
      "main": [
        [
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Fix Adult": {
      "main": [
        [
          {
            "node": "Merge Fix with Product_Adult",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Fix with Product_Adult": {
      "main": [
        [
          {
            "node": "Update Product FIX Adult Flag",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fix image (adult)": {
      "main": [
        [
          {
            "node": "Merge Fix with Product_Image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fix text": {
      "main": [
        [
          {
            "node": "Merge Fix with Product_Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fix merchant": {
      "main": [
        [
          {
            "node": "Merge Fix with Product_Merchant",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fix Multi_Country": {
      "main": [
        [
          {
            "node": "Merge Fix with Product_Country",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fix Multi_GTN/EAN": {
      "main": [
        [
          {
            "node": "Merge Fix with Product_GTNI/EAN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fix Multi_H√§ndler_Qualit√§t": {
      "main": [
        [
          {
            "node": "Merge Fix with Product_H√§ndler_Quali",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fix Multi_S24": {
      "main": [
        [
          {
            "node": "Merge Fix with Product_S24",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fix Multi_DDC": {
      "main": [
        [
          {
            "node": "Merge Fix with Product_DDC",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Fix with Product_Image": {
      "main": [
        [
          {
            "node": "Update Product FIX_Images",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Fix with Product_Text": {
      "main": [
        [
          {
            "node": "Update Product FIX_Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Fix with Product_Merchant": {
      "main": [
        [
          {
            "node": "Update_Product_FIX_Merchant Settings",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Fix with Product_Country": {
      "main": [
        [
          {
            "node": "Update_Product_FIX_Country Feeds",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Fix with Product_GTNI/EAN": {
      "main": [
        [
          {
            "node": "Update GTN/EAN1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Fix with Product_H√§ndler_Quali": {
      "main": [
        [
          {
            "node": "Update_Product_FIX_H√§ndlerqualit√§t",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Fix with Product_S24": {
      "main": [
        [
          {
            "node": "Update_Prod_FIX_S24",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Fix with Product_DDC": {
      "main": [
        [
          {
            "node": "Update_Prod_FIX_DDC",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rate Limiting GTN/EAN": {
      "main": [
        [
          {
            "node": "Aggregate Results2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare GTN/EAN_Loop": {
      "main": [
        [
          {
            "node": "Route: GTIN Lookup Needed?",
            "type": "main",
            "index": 0
          },
          {
            "node": "Extract Manufacturer Info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route: GTIN Lookup Needed?": {
      "main": [
        [
          {
            "node": "Find Missing GTIN",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Build PATCH Body",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Log Update Res_GTNI": {
      "main": [
        [
          {
            "node": "Rate Limiting GTN/EAN",
            "type": "main",
            "index": 0
          },
          {
            "node": "Loop Controller",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Find Missing GTIN": {
      "main": [
        [
          {
            "node": "Google Sheets1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Check: GTIN Found?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GTNI_Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Find Missing GTIN",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Extract Manufacturer Info": {
      "main": [
        [
          {
            "node": "Route: GTIN Lookup Needed?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build PATCH Body": {
      "main": [
        [
          {
            "node": "Update Product in GMC",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Product in GMC": {
      "main": [
        [
          {
            "node": "Log Update Res_GTNI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check: GTIN Found?": {
      "main": [
        [
          {
            "node": "Merge Found GTIN Data",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Loop Controller": {
      "main": [
        [
          {
            "node": "Rate Limiting GTN/EAN",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Found GTIN Data": {
      "main": [
        [
          {
            "node": "Build PATCH Body",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route by Priority1": {
      "main": [
        [
          {
            "node": "Prepare GTN/EAN_Loop",
            "type": "main",
            "index": 0
          }
        ],
        [],
        [],
        [
          {
            "node": "AI Error Analyzer Error_Multi_GTN/EAN",
            "type": "main",
            "index": 0
          },
          {
            "node": "Gemini Daily Decision",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Error Parser",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Chat": {
      "ai_languageModel": [
        [
          {
            "node": "Find Missing GTIN",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Web Search GTNI": {
      "ai_tool": [
        [
          {
            "node": "Find Missing GTIN",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Update Product FIX_Images": {
      "main": [
        [
          {
            "node": "Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Product FIX Adult Flag": {
      "main": [
        [
          {
            "node": "Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Product FIX_Text": {
      "main": [
        [
          {
            "node": "Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update_Product_FIX_Merchant Settings": {
      "main": [
        [
          {
            "node": "Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update_Product_FIX_Country Feeds": {
      "main": [
        [
          {
            "node": "Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update GTN/EAN1": {
      "main": [
        [
          {
            "node": "Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update_Product_FIX_H√§ndlerqualit√§t": {
      "main": [
        [
          {
            "node": "Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update_Prod_FIX_S24": {
      "main": [
        [
          {
            "node": "Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update_Prod_FIX_DDC": {
      "main": [
        [
          {
            "node": "Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "8cfddd90-0a59-4744-a9f6-5a103c424b46": {
      "main": [
        [
          {
            "node": "5affa3dd-0306-4a45-a768-e5c34db10f95",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "6b2da695-ddac-492a-85a5-477b7d0de310": {
      "main": [
        [
          {
            "node": "5affa3dd-0306-4a45-a768-e5c34db10f95",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "4b35c3df-2960-48e8-965f-04cf264c9664": {
      "main": [
        [
          {
            "node": "5affa3dd-0306-4a45-a768-e5c34db10f95",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "fe1897ad-0183-411d-ad54-bedc90a0531c": {
      "main": [
        [
          {
            "node": "5affa3dd-0306-4a45-a768-e5c34db10f95",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "64eebdec-df1a-4302-aff3-7001e34cf634": {
      "main": [
        [
          {
            "node": "5affa3dd-0306-4a45-a768-e5c34db10f95",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "91ead233-4bc3-4b21-998b-d86e38adf3ab": {
      "main": [
        [
          {
            "node": "5affa3dd-0306-4a45-a768-e5c34db10f95",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "36d282f1-12b1-4bf8-a319-d56583d034d9": {
      "main": [
        [
          {
            "node": "5affa3dd-0306-4a45-a768-e5c34db10f95",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Workflow Status REAL": {
      "main": [
        [
          {
            "node": "Get Merchant Products_S24",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "timeSavedMode": "fixed",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false
  },
  "staticData": {
    "node:Schedule Trigger": {
      "recurrenceRules": [
        4
      ]
    },
    "node:MCP Polling Trigger": {
      "recurrenceRules": []
    },
    "node:Import Commands from Gmail": {
      "Import Commands from Gmail": {
        "lastTimeChecked": 1765824135,
        "possibleDuplicates": [
          "19b235202b40cabe",
          "19b1b0de26275989"
        ]
      }
    },
    "node:Schedule Trigger (Daily 2 AM)": {
      "recurrenceRules": []
    },
    "node:Schedule Daily 2AM": {
      "recurrenceRules": []
    },
    "node:Email Trigger (IMAP)1": {
      "lastMessageUid": 53045
    }
  },
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {
    "AI Error Analyzer Adult Flags": [
      {
        "json": {
          "output": {
            "priority": "images",
            "reasoning": "All adult flags and texts are OK, but images may need to be checked.",
            "products_to_process": 33
          }
        }
      }
    ],
    "AI Error Analyzer Images": [
      {
        "json": {
          "output": {
            "priority": "images",
            "reasoning": "All adult flags and texts are OK, but images may need to be checked.",
            "products_to_process": 33
          }
        }
      }
    ],
    "AI Error Analyzer Text": [
      {
        "json": {
          "output": {
            "priority": "images",
            "reasoning": "All adult flags and texts are OK, but images may need to be checked.",
            "products_to_process": 33
          }
        }
      }
    ],
    "AI Error Analyzer Merchant": [
      {
        "json": {
          "output": {
            "priority": "images",
            "reasoning": "All adult flags and texts are OK, but images may need to be checked.",
            "products_to_process": 33
          }
        }
      }
    ],
    "AI Error Analyzer Error_Multi_Country": [
      {
        "json": {
          "output": {
            "priority": "images",
            "reasoning": "All adult flags and texts are OK, but images may need to be checked.",
            "products_to_process": 33
          }
        }
      }
    ],
    "AI Error Analyzer Error_Multi_GTN/EAN": [
      {
        "json": {
          "output": {
            "priority": "images",
            "reasoning": "All adult flags and texts are OK, but images may need to be checked.",
            "products_to_process": 33
          }
        }
      }
    ],
    "AI Error Analyzer_H√§ndlerqualit√§t": [
      {
        "json": {
          "output": {
            "priority": "images",
            "reasoning": "All adult flags and texts are OK, but images may need to be checked.",
            "products_to_process": 33
          }
        }
      }
    ],
    "Error_Ana_S24": [
      {
        "json": {
          "output": {
            "priority": "images",
            "reasoning": "All adult flags and texts are OK, but images may need to be checked.",
            "products_to_process": 33
          }
        }
      }
    ],
    "Error_Ana_DDC": [
      {
        "json": {
          "output": {
            "priority": "images",
            "reasoning": "All adult flags and texts are OK, but images may need to be checked.",
            "products_to_process": 33
          }
        }
      }
    ],
    "Gemini Daily Decision": [
      {
        "json": {
          "output": {
            "priority": "images",
            "reasoning": "All adult flags and texts are OK, but images may need to be checked.",
            "products_to_process": 33
          }
        }
      }
    ]
  },
  "versionId": "23af49d6-3c74-49be-bd89-f13e86d6b199",
  "activeVersionId": "23af49d6-3c74-49be-bd89-f13e86d6b199",
  "versionCounter": 1034,
  "triggerCount": 2,
  "shared": [
    {
      "updatedAt": "2025-12-12T04:29:41.486Z",
      "createdAt": "2025-12-12T04:29:41.486Z",
      "role": "workflow:owner",
      "workflowId": "ftZOou7HNgLOwzE5",
      "projectId": "eYBRLdtGaWLyIIOy",
      "project": {
        "updatedAt": "2025-11-06T02:18:23.292Z",
        "createdAt": "2025-11-06T01:50:03.327Z",
        "id": "eYBRLdtGaWLyIIOy",
        "name": "Andree Schulz <info@mechtech-support.com>",
        "type": "personal",
        "icon": null,
        "description": null,
        "creatorId": "905b93e2-2ccd-4e6b-a613-4d01485a9251",
        "projectRelations": [
          {
            "updatedAt": "2025-11-06T01:50:03.327Z",
            "createdAt": "2025-11-06T01:50:03.327Z",
            "userId": "905b93e2-2ccd-4e6b-a613-4d01485a9251",
            "projectId": "eYBRLdtGaWLyIIOy",
            "user": {
              "updatedAt": "2025-12-24T23:26:53.000Z",
              "createdAt": "2025-11-06T01:50:02.958Z",
              "id": "905b93e2-2ccd-4e6b-a613-4d01485a9251",
              "email": "info@mechtech-support.com",
              "firstName": "Andree",
              "lastName": "Schulz",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2025-11-06T02:19:06.535Z",
                "personalization_survey_n8n_version": "1.118.2",
                "companySize": "<20",
                "companyType": "ecommerce",
                "role": "business-owner",
                "reportedSource": "youtube"
              },
              "settings": {
                "userActivated": true,
                "easyAIWorkflowOnboarded": true,
                "firstSuccessfulWorkflowId": "uok6olNDUiRKpaE8",
                "userActivatedAt": 1764952348935,
                "npsSurvey": {
                  "responded": true,
                  "lastShownAt": 1765239138708
                }
              },
              "disabled": false,
              "mfaEnabled": false,
              "lastActiveAt": "2025-12-24",
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": [],
  "activeVersion": {
    "updatedAt": "2025-12-25T06:29:06.174Z",
    "createdAt": "2025-12-25T06:29:06.174Z",
    "versionId": "23af49d6-3c74-49be-bd89-f13e86d6b199",
    "workflowId": "ftZOou7HNgLOwzE5",
    "nodes": [
      {
        "parameters": {
          "availableInChat": true,
          "options": {}
        },
        "id": "7ee31291-7f5d-497e-962f-9700beb07459",
        "name": "Chat Trigger (RAG Query)",
        "type": "@n8n/n8n-nodes-langchain.chatTrigger",
        "typeVersion": 1.4,
        "position": [
          -6016,
          3504
        ],
        "webhookId": "1bcc39ec-5b0a-4f6c-abf6-21235fcb6cb1",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueRegularOutput"
      },
      {
        "parameters": {
          "options": {
            "systemMessage": "Du bist der MECHTECH Workflow Assistent!\n\nDu hast Zugriff auf die komplette Historie aller Workflow-Ausf√ºhrungen in der Supabase Vector Database.\n\nDeine Aufgaben:\n1. Beantworte Fragen zur Workflow-Historie (Approval Rates, verarbeitete Produkte, Phasen, etc.)\n2. Analysiere Trends und Muster in den Daten\n3. Gib Empfehlungen basierend auf historischen Daten\n4. Erkl√§re was in bestimmten Zeitr√§umen passiert ist\n\nDu kannst auf folgende Informationen zugreifen:\n- Shop-Namen und IDs\n- Verarbeitete Produkte pro Run\n- Success/Failure Counts\n- Approval Rates\n- Phasen (adult_flags, text, images)\n- Timestamps\n- Reasoning der Gemini Decisions\n\nAntworte auf Deutsch, pr√§zise und hilfreich!"
          }
        },
        "id": "70073f18-20e2-4429-af71-0b53ee034ba9",
        "name": "Chat Agent (RAG)",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3,
        "position": [
          -5808,
          3504
        ]
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash-exp",
          "options": {}
        },
        "id": "0f3a589e-6ea5-4290-93eb-3a32368ee6bd",
        "name": "Gemini Chat Model (RAG)",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -5888,
          3696
        ],
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        }
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "mechtech_chat_session",
          "tableName": "n8n_chat_historie",
          "contextWindowLength": 25
        },
        "id": "7a8d9c0c-1bd7-4a20-a636-680bd8145c7b",
        "name": "Postgres Chat Memory",
        "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
        "typeVersion": 1.3,
        "position": [
          -5712,
          3696
        ],
        "credentials": {
          "postgres": {
            "id": "pIp690wi4X79QCKb",
            "name": "Postgres account"
          }
        }
      },
      {
        "parameters": {
          "useCustomSchema": true,
          "operation": "getAll",
          "tableId": "workflow_runs",
          "returnAll": true,
          "matchType": "allFilters",
          "filters": {
            "conditions": [
              {
                "keyName": "created_at",
                "condition": "gte",
                "keyValue": "=={{ $now.startOf('day').toISO() }}"
              }
            ]
          }
        },
        "id": "5e71bf70-6abd-4e77-adee-bb45f4ab93cb",
        "name": "Check Last Run",
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          -8384,
          4176
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "waitBetweenTries": 3000,
        "credentials": {
          "supabaseApi": {
            "id": "f1qLUdIsbZ2A3wdC",
            "name": "Supabase-MySQL"
          }
        },
        "onError": "continueErrorOutput",
        "continueOnFail": true
      },
      {
        "parameters": {
          "jsCode": "// ============================================================================\n// PREPARE PRODUCTS LOOP - FIX: Hole Produkte von Analyze Products2\n// ============================================================================\nconst decision = $input.first().json;  // Von Route by Priority (priority, products_to_process)\nconst analysis = $('Analyze Products2').first().json;  // Direkt von Analyze Products2\n\n// Hole Produkte aus Analyze Products2\nconst productsToFix = analysis.products_needing_fix || [];\nconst maxProducts = decision.products_to_process || productsToFix.length;\n\nconst config = $('SHOP_CONFIGURATION').first().json;\n\n// Shop info aus Decision oder Config\nconst shopId = decision.shop_id || config.shop1_id;\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\nconst productsSlice = productsToFix.slice(0, maxProducts);\n\n// ‚úÖ Gibt Array zur√ºck - n8n wird jedes Item einzeln weiterleiten\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    originalProduct: product, // Behalte original product data\n    action: decision.priority || 'prepare',\n    priority: decision.priority || 'prepare',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
        },
        "id": "21c9e5fa-adfa-48ec-a449-3104b8f94f8c",
        "name": "Prepare Products Loop",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -6736,
          3920
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $('SHOP_CONFIGURATION').item.json.shop1_id }}/products/{{ $json.product_id }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "adult",
                "value": "true"
              },
              {
                "name": "ageGroup",
                "value": "adult"
              },
              {
                "name": "googleProductCategory",
                "value": "778"
              }
            ]
          },
          "options": {}
        },
        "id": "15f49876-cc59-4f1c-b1f3-c887720e434f",
        "name": "Update Product Adult Flag",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -6272,
          3904
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "tableId": "workflow_runs",
          "fieldsUi": {
            "fieldValues": [
              {
                "fieldId": "run_date",
                "fieldValue": "={{ $json.run_date }}"
              },
              {
                "fieldId": "shop_id",
                "fieldValue": "={{ $json.shop_id }}"
              },
              {
                "fieldId": "phase",
                "fieldValue": "={{ $json.phase }}"
              },
              {
                "fieldId": "products_processed",
                "fieldValue": "={{ $json.products_processed }}"
              },
              {
                "fieldId": "success_count",
                "fieldValue": "={{ $json.success_count }}"
              },
              {
                "fieldId": "approval_rate_after",
                "fieldValue": "={{ $json.approval_rate_after }}"
              }
            ]
          }
        },
        "id": "850a1803-9895-464d-9b33-537c0772bb92",
        "name": "Save Workflow Run",
        "type": "n8n-nodes-base.supabase",
        "typeVersion": 1,
        "position": [
          -7680,
          4752
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "supabaseApi": {
            "id": "f1qLUdIsbZ2A3wdC",
            "name": "Supabase-MySQL"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "operation": "appendOrUpdate",
          "documentId": {
            "__rl": true,
            "mode": "id",
            "value": "1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE"
          },
          "sheetName": {
            "__rl": true,
            "mode": "name",
            "value": "üìù Daily_Log"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Timestamp": "={{ $json.run_date }}",
              "Shop": "={{ $json.shop_id }}",
              "Phase": "={{ $json.phase }}",
              "Products Processed": "={{ $json.products_processed }}",
              "Success Count": "={{ $json.success_count }}",
              "Failed Count": "={{ $json.failed_count }}",
              "Status": "={{ $json.created_at }}",
              "Action": "={{ $json.gemini_decision }}",
              "Details": "={{ $json.approval_rate_after }}"
            },
            "matchingColumns": [
              "Timestamp"
            ],
            "schema": [
              {
                "id": "Timestamp",
                "displayName": "Timestamp",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Shop",
                "displayName": "Shop",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Phase",
                "displayName": "Phase",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Action",
                "displayName": "Action",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Products Processed",
                "displayName": "Products Processed",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Success Count",
                "displayName": "Success Count",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Failed Count",
                "displayName": "Failed Count",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Status",
                "displayName": "Status",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Details",
                "displayName": "Details",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false,
            "mappings": [
              {
                "column": "Timestamp",
                "value": "={{ $json.run_date }}"
              },
              {
                "column": "Shop",
                "value": "={{ $json.shop_name }}"
              },
              {
                "column": "Phase",
                "value": "={{ $json.phase }}"
              },
              {
                "column": "Action",
                "value": "Daily Run"
              },
              {
                "column": "Products Processed",
                "value": "={{ $json.products_processed }}"
              },
              {
                "column": "Success Count",
                "value": "={{ $json.success_count }}"
              },
              {
                "column": "Failed Count",
                "value": "={{ $json.failed_count }}"
              },
              {
                "column": "Status",
                "value": "={{ $json.status }}"
              },
              {
                "column": "Details",
                "value": "={{ $json.reasoning }}"
              }
            ]
          },
          "options": {}
        },
        "id": "602654fc-6a54-4aab-98dc-4cf9cbaf5fdb",
        "name": "Log Results to Sheets",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          -5728,
          6208
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "pbNsBLFTIuL9ArMn",
            "name": "Google Sheets"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "chatId": "8562069918:AAFtzEUzCDeUchzybcp2l9Cg4WZ0KBmsWzI",
          "text": "=ü§ñ GEMINI DAILY REPORT - {{ $json.shop_name }}\n\nüìä Phase: {{ $json.phase }}\n‚úÖ Verarbeitet: {{ $json.success_count }}\n‚ùå Fehler: {{ $json.failed_count }}\nüìà Approval Rate: {{ $json.approval_rate_after }}%\n\nüí° Reasoning: {{ $json.reasoning }}\n\nAlles OK? üëç",
          "additionalFields": {}
        },
        "id": "0e71a863-39d8-4787-975a-ee4910bac64a",
        "name": "Send Daily Report",
        "type": "n8n-nodes-base.telegram",
        "typeVersion": 1.2,
        "position": [
          -7072,
          6256
        ],
        "webhookId": "b5c4cc7d-d366-4cd7-ac2c-0a91ed811e96",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "telegramApi": {
            "id": "CefgWOY6zLuQ1eyX",
            "name": "Telegram account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "sendTo": "={{ $json.to }}",
          "subject": "={{ $json.subject }}",
          "message": "={{ $json.html }}",
          "options": {}
        },
        "id": "3aabb920-11b3-452f-8dcf-cb5b725c71f8",
        "name": "Export Report to Gmail",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          -5888,
          6352
        ],
        "webhookId": "da822d06-d1b7-4cfe-804f-5e778bedbac4",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "gmailOAuth2": {
            "id": "piLkk7aEWM1RFevI",
            "name": "s24.mechtech@gmail.com"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "operation": "send",
          "recipientPhoneNumber": "<__PLACEHOLDER_VALUE__Expert WhatsApp Number__>",
          "textBody": "=üö® EXPERT ALERT - MECHTECH Merchant Center\n\nShop: {{ $json.shop_name }}\nPhase: {{ $json.phase }}\n\n‚ö†Ô∏è CRITICAL ISSUES:\n‚ùå Failed: {{ $json.failed_count }}\nüìâ Approval Rate: {{ $json.approval_rate_after }}%\n\nImmediate action required!\n\nDetails: {{ $json.reasoning }}",
          "additionalFields": {}
        },
        "id": "d3e29ed5-30b0-46a5-8f0a-53611a72a621",
        "name": "Send WhatsApp Expert Alert",
        "type": "n8n-nodes-base.whatsApp",
        "typeVersion": 1.1,
        "position": [
          -5728,
          6576
        ],
        "webhookId": "fd8ea9df-d0d5-4e11-a0df-a43a8e68297e",
        "disabled": true
      },
      {
        "parameters": {
          "jsCode": "const data = $input.item.json; const html = `<h2>ü§ñ MECHTECH Merchant Center Daily Report</h2><h3>Shop: ${data.shop_name}</h3><table border='1' cellpadding='10'><tr><th>Metric</th><th>Value</th></tr><tr><td>Phase</td><td>${data.phase}</td></tr><tr><td>Products Processed</td><td>${data.products_processed}</td></tr><tr><td>Success Count</td><td>${data.success_count}</td></tr><tr><td>Failed Count</td><td>${data.failed_count}</td></tr><tr><td>Approval Rate</td><td>${data.approval_rate_after}%</td></tr><tr><td>Status</td><td>${data.status}</td></tr></table><p><strong>Reasoning:</strong> ${data.reasoning}</p><p><em>Generated: ${data.run_date}</em></p>`; return [{ json: { subject: `Daily Report - ${data.shop_name} - ${data.phase}`, html: html, to: '<__PLACEHOLDER_VALUE__Report Email Address__>' } }];"
        },
        "id": "132312b4-2cce-44b1-ad9d-89ed08efc71e",
        "name": "Format Report for Email",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -6288,
          6176
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "// FIXED: Only check SUBJECT for commands (ignore spam)\nconst input = $input.item.json;\n\n// Only use subject - ignore body/snippet to avoid spam\nconst subject = (input.subject || '').toLowerCase().trim();\n\n// Check if subject contains \"command\" keyword\nif (!subject.includes('command') && !subject.includes('mechtech')) {\n  // Not a command email - skip it\n  return [];\n}\n\n// Extract command from subject\nconst text = subject.replace('command:', '').replace('mechtech:', '').trim();\n\nlet action = 'unknown';\nlet params = {};\n\nif (text.includes('status')) {\n  action = 'get_status';\n} else if (text.includes('pause')) {\n  action = 'pause_workflow';\n} else if (text.includes('resume')) {\n  action = 'resume_workflow';\n} else if (text.includes('report')) {\n  action = 'send_report';\n} else if (text.includes('help')) {\n  action = 'show_help';\n} else if (text.includes('optimize')) {\n  action = 'run_optimization';\n  // Check which shop\n  if (text.includes('shop1') || text.includes('siliconedolls24')) {\n    params.shop = 'shop1';\n  } else if (text.includes('shop2') || text.includes('dreamdoll')) {\n    params.shop = 'shop2';\n  } else {\n    params.shop = 'both';\n  }\n} else {\n  // Unknown command\n  action = 'unknown';\n}\n\nreturn [{\n  json: {\n    action: action,\n    params: params,\n    original_text: text,\n    source: input.from || input.sender || 'unknown',\n    subject: input.subject || ''\n  }\n}];"
        },
        "id": "00e1c549-bb00-436d-86a4-7b367fe7d17f",
        "name": "Parse Command Input",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -8624,
          4016
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "loose",
              "version": 3
            },
            "conditions": [
              {
                "id": "id-1",
                "leftValue": "={{ $json.failed_count }}",
                "rightValue": 10,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              },
              {
                "id": "id-2",
                "leftValue": "={{ $json.approval_rate_after }}",
                "rightValue": 50,
                "operator": {
                  "type": "number",
                  "operation": "lt"
                }
              }
            ],
            "combinator": "or"
          },
          "looseTypeValidation": true,
          "options": {}
        },
        "id": "64eab193-81bd-4180-918e-e98e2e1a1527",
        "name": "Check if Expert Needed",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          -6288,
          6368
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "loose",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.action }}",
                      "rightValue": "get_status",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "445605f9-402d-4973-9957-5754b69fb8fc"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Status"
              }
            ]
          },
          "looseTypeValidation": true,
          "options": {
            "fallbackOutput": "extra",
            "renameFallbackOutput": "Unknown Command"
          }
        },
        "id": "f0161c28-a4ae-4e58-bfac-2dbed4068aba",
        "name": "Route Command",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.4,
        "position": [
          -8384,
          3984
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "sendTo": "info@mechtech-support.com",
          "subject": "=",
          "emailType": "text",
          "message": "={{ $('Get Workflow Status REAL').item.json.error }}",
          "options": {}
        },
        "id": "67b0076c-d8c8-488e-a213-058c2f51af3b",
        "name": "Send Command Response",
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.2,
        "position": [
          -8096,
          3888
        ],
        "webhookId": "5cf94981-2360-49f1-b7d4-6c512f562360",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "waitBetweenTries": 3000,
        "credentials": {
          "gmailOAuth2": {
            "id": "piLkk7aEWM1RFevI",
            "name": "s24.mechtech@gmail.com"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "// ============================================================================\n// PREPARE IMAGES LOOP - FIX: Hole Produkte von Analyze Products2\n// ============================================================================\nconst decision = $input.first().json;  // Von Route by Priority\nconst analysis = $('Analyze Products2').first().json;  // Direkt von Analyze Products2\n\n// Hole Produkte aus Analyze Products2\nconst productsToFix = analysis.products_needing_fix || [];\nconst maxProducts = decision.products_to_process || productsToFix.length;\n\nconst config = $('SHOP_CONFIGURATION').first().json;\n\n// Shop info aus Decision oder Config\nconst shopId = decision.shop_id || config.shop1_id;\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\nconst productsSlice = productsToFix.slice(0, maxProducts);\n\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    image_link: product.imageLink || product.image_link,\n    action: 'images',\n    priority: 'images',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
        },
        "id": "8925d0f5-5df3-4ea0-a5bf-82f079f9d2b3",
        "name": "Prepare Images Loop",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -6736,
          4096
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $('SHOP_CONFIGURATION').item.json.shop1_id }}/products/{{ $json.product.id }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "imageLink",
                "value": "={{ $json.product.imageLink }}"
              }
            ]
          },
          "options": {}
        },
        "id": "deb42c69-6a74-4f24-8793-4183a7ee384a",
        "name": "Update Product Images",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          -6272,
          4080
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "amount": 2
        },
        "id": "8cfddd90-0a59-4744-a9f6-5a103c424b46",
        "name": "Rate Limiting Images",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          -5232,
          4064
        ],
        "webhookId": "03758724-2fd2-4cf0-bc96-1ba04b9fa35c",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $('SHOP_CONFIGURATION').item.json.shop1_id }}/products/{{ $json.product.id }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "title",
                "value": "={{ $json.product.title }}"
              },
              {
                "name": "description",
                "value": "={{ $json.product.description }}"
              }
            ]
          },
          "options": {}
        },
        "id": "35e9f617-3388-4125-840c-dfe54b9b9896",
        "name": "Update Product Text",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          -6272,
          4256
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "amount": 2
        },
        "id": "6b2da695-ddac-492a-85a5-477b7d0de310",
        "name": "Rate Limiting Text",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          -5232,
          4256
        ],
        "webhookId": "fade3537-0739-4667-80c9-7636461ed902",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "const input = $input.item.json;\nconst invalidPriority = input.priority || 'unknown';\nconst reasoning = input.reasoning || 'No reasoning provided';\n\nconst errorResult = {\n  processed_count: 0,\n  failed_count: 0,\n  error: 'Invalid priority received from Gemini',\n  invalid_priority: invalidPriority,\n  gemini_reasoning: reasoning,\n  timestamp: new Date().toISOString(),\n  debug_info: {\n    expected_priorities: ['adult_flags', 'images', 'text'],\n    received_priority: invalidPriority,\n    full_gemini_response: input\n  }\n};\n\nreturn [{ json: errorResult }];"
        },
        "id": "6c91bd2a-2b2d-4667-b476-65c4efc415cd",
        "name": "Handle Invalid Priority",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -8144,
          4768
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "// ============================================================================\n// ANALYZE PRODUCTS2 - ERWEITERTE VERSION\n// Analysiert ALLE Google Merchant Center Issues und taggt Produkte\n// ============================================================================\n\nconst products = $input.item.json.resources || [];\n\n// Helper: Extrahiere Issue Types aus Google Issues Array\nfunction extractIssueTypes(product) {\n  if (!product.issues || product.issues.length === 0) return [];\n  return product.issues.map(issue => issue.servability || issue.attributeName || 'unknown');\n}\n\n// ============================================================================\n// 1. ADULT FLAGS ISSUES\n// ============================================================================\nconst adultIssues = products.filter(p => {\n  const hasAdultFlag = p.adult === true || p.ageGroup === 'adult';\n  const isAdultProduct = p.title?.toLowerCase().includes('adult') || \n                          p.description?.toLowerCase().includes('adult');\n  const issues = extractIssueTypes(p);\n  const hasAdultIssue = issues.includes('adult_content_not_flagged');\n  \n  return (!hasAdultFlag && isAdultProduct) || hasAdultIssue;\n});\n\n// ============================================================================\n// 2. IMAGE ISSUES\n// ============================================================================\nconst imageIssues = products.filter(p => {\n  const issues = extractIssueTypes(p);\n  return !p.imageLink || \n         p.imageLink === '' ||\n         issues.includes('invalid_image_url') ||\n         issues.includes('image_link_crawl_error') ||\n         issues.includes('image_link_broken');\n});\n\n// ============================================================================\n// 3. TEXT/DESCRIPTION ISSUES\n// ============================================================================\nconst textIssues = products.filter(p => {\n  const issues = extractIssueTypes(p);\n  const descTooShort = p.description && p.description.length < 50;\n  const titleTooShort = p.title && p.title.length < 10;\n  \n  return !p.description ||\n         descTooShort ||\n         titleTooShort ||\n         issues.includes('invalid_description') ||\n         issues.includes('missing_description') ||\n         issues.includes('invalid_title');\n});\n\n// ============================================================================\n// 4. GTIN/EAN ISSUES\n// ============================================================================\nconst gtinIssues = products.filter(p => {\n  const issues = extractIssueTypes(p);\n  return !p.gtin || \n         p.gtin === '' ||\n         issues.includes('missing_gtin_or_mpn') ||\n         issues.includes('invalid_gtin');\n});\n\n// ============================================================================\n// 5. MPN ISSUES\n// ============================================================================\nconst mpnIssues = products.filter(p => {\n  return !p.mpn || p.mpn === '';\n});\n\n// ============================================================================\n// 6. BRAND ISSUES\n// ============================================================================\nconst brandIssues = products.filter(p => {\n  const issues = extractIssueTypes(p);\n  return !p.brand || \n         p.brand === '' ||\n         issues.includes('missing_brand');\n});\n\n// ============================================================================\n// 7. IDENTIFIER EXISTS ISSUES\n// ============================================================================\nconst identifierIssues = products.filter(p => {\n  return p.identifierExists === false;\n});\n\n// ============================================================================\n// 8. MERCHANT QUALITY ISSUES\n// ============================================================================\nconst merchantIssues = products.filter(p => {\n  const issues = extractIssueTypes(p);\n  return issues.includes('missing_shipping_info') ||\n         issues.includes('invalid_price') ||\n         issues.includes('missing_category') ||\n         issues.includes('shipping_policy_error');\n});\n\n// ============================================================================\n// 9. COUNTRY/MULTI-COUNTRY ISSUES\n// ============================================================================\nconst countryIssues = products.filter(p => {\n  const issues = extractIssueTypes(p);\n  return issues.includes('country_feed_missing') ||\n         issues.includes('target_country_issue');\n});\n\n// ============================================================================\n// 10. TAG JEDES PRODUKT MIT PRIORITIES\n// ============================================================================\nconst taggedProducts = products.map(p => {\n  const tags = [];\n  const issues = extractIssueTypes(p);\n  \n  // Adult\n  if (!p.adult && (p.title?.toLowerCase().includes('adult') || \n      issues.includes('adult_content_not_flagged'))) {\n    tags.push('adult_flags');\n  }\n  \n  // Images\n  if (!p.imageLink || issues.includes('invalid_image_url') || \n      issues.includes('image_link_crawl_error')) {\n    tags.push('images');\n  }\n  \n  // Text\n  if (!p.description || (p.description && p.description.length < 50) ||\n      issues.includes('invalid_description')) {\n    tags.push('text');\n  }\n  \n  // GTIN\n  if (!p.gtin || issues.includes('missing_gtin_or_mpn')) {\n    tags.push('multi_gtn_ean');\n  }\n  \n  // MPN\n  if (!p.mpn) {\n    tags.push('multi_gtn_ean');\n  }\n  \n  // Brand\n  if (!p.brand || issues.includes('missing_brand')) {\n    tags.push('multi_gtn_ean');\n  }\n  \n  // Merchant\n  if (issues.includes('missing_shipping_info') || \n      issues.includes('invalid_price')) {\n    tags.push('merchant_quality');\n  }\n  \n  // Country\n  if (issues.includes('country_feed_missing')) {\n    tags.push('multi_country');\n  }\n  \n  return {\n    ...p,\n    priority_tags: [...new Set(tags)], // Remove duplicates\n    issue_count: tags.length\n  };\n});\n\n// ============================================================================\n// 11. SAMMLE ALLE PRODUKTE MIT ISSUES\n// ============================================================================\nconst productsNeedingFix = taggedProducts.filter(p => p.priority_tags.length > 0);\n\n// Sort by issue_count (highest first)\nproductsNeedingFix.sort((a, b) => b.issue_count - a.issue_count);\n\n// Rolling Window: max 100 gleichzeitig\nconst batch = productsNeedingFix.slice(0, 100);\n\n// ============================================================================\n// 12. STATISTIKEN\n// ============================================================================\nconst stats = {\n  adult_issues: adultIssues.length,\n  image_issues: imageIssues.length,\n  text_issues: textIssues.length,\n  gtin_issues: gtinIssues.length,\n  mpn_issues: mpnIssues.length,\n  brand_issues: brandIssues.length,\n  identifier_issues: identifierIssues.length,\n  merchant_issues: merchantIssues.length,\n  country_issues: countryIssues.length\n};\n\n// Approval Rate\nconst disapproved = products.filter(p => p.issues && p.issues.length > 0).length;\nconst approved = products.length - disapproved;\nconst approvalRate = products.length > 0 ? ((approved / products.length) * 100).toFixed(2) : 0;\n\nreturn [{\n  json: {\n    products_needing_fix: batch,\n    total_products_with_issues: productsNeedingFix.length,\n    current_approval_rate: approvalRate,\n    total_products: products.length,\n    approved_count: approved,\n    disapproved_count: disapproved,\n    \n    // Detaillierte Stats\n    ...stats,\n    \n    // F√ºr Debugging\n    all_tagged_products: taggedProducts\n  }\n}];\n"
        },
        "id": "0bcf78a4-ef4a-4725-bd32-d260c9023868",
        "name": "Analyze Products2",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -8384,
          4368
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "// ============================================================================\n// AGGREGATE RESULTS2 - MIT ERROR-HANDLING\n// ============================================================================\nconst allItems = $input.all();\n\nlet processedCount = 0;\nlet failedCount = 0;\nconst errors = [];\n\nallItems.forEach(item => {\n  if (item.json && item.json.processed_count !== undefined) {\n    processedCount += item.json.processed_count || 0;\n  }\n  if (item.error || (item.json && item.json.error)) {\n    failedCount++;\n    errors.push({\n      product_id: item.json?.product_id || item.json?.id || 'unknown',\n      title: item.json?.title || 'N/A',\n      error: item.error?.message || item.json?.error?.message || 'Unknown error',\n      timestamp: new Date().toISOString()\n    });\n  } else if (item.json && item.json.failed_count !== undefined) {\n    failedCount += item.json.failed_count || 0;\n  }\n});\n\nlet config, analysis, decision;\ntry { config = $('SHIOP_CONFIGURATION').first().json; } catch (e) { config = { shop1_id: 'unknown', shop1_name: 'unknown' }; }\ntry { analysis = $('Analyze Products2').first().json; } catch (e) { analysis = { current_approval_rate: 0 }; }\ntry { decision = $('Gemini Daily Decision').first().json; } catch (e) { decision = { priority: 'unknown', reasoning: 'N/A' }; }\n\nconst result = {\n  shop_id: config.shop1_id || 'unknown',\n  shop_name: config.shop1_name || 'unknown',\n  run_date: new Date().toISOString(),\n  phase: decision.priority || decision.decision_type || 'unknown',\n  products_processed: processedCount,\n  success_count: processedCount,\n  failed_count: failedCount,\n  approval_rate_before: analysis.current_approval_rate || 0,\n  approval_rate_after: analysis.current_approval_rate || 0,\n  reasoning: decision.reasoning || decision.reason || 'Processing products',\n  status: failedCount === 0 ? 'success' : failedCount < processedCount ? 'partial_success' : 'failed',\n  error_count: errors.length,\n  errors: errors.length > 0 ? errors.slice(0, 10) : []\n};\n\nreturn [{ json: result }];"
        },
        "id": "5affa3dd-0306-4a45-a768-e5c34db10f95",
        "name": "Aggregate Results2",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -7920,
          4768
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "// ============================================================================\n// PREPARE MERCHANT QUALITY LOOP - FIX: Hole Produkte von Analyze Products2\n// ============================================================================\nconst decision = $input.first().json;  // Von Route by Priority\nconst analysis = $('Analyze Products2').first().json;  // Direkt von Analyze Products2\n\n// Hole Produkte aus Analyze Products2\nconst productsToFix = analysis.products_needing_fix || [];\nconst maxProducts = decision.products_to_process || productsToFix.length;\n\nconst config = $('SHOP_CONFIGURATION').first().json;\n\n// Shop info aus Decision oder Config\nconst shopId = decision.shop_id || config.shop1_id;\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\nconst productsSlice = productsToFix.slice(0, maxProducts);\n\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    action: 'merchant_quality',\n    priority: 'merchant_quality',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
        },
        "name": "Prepare Merchant Quality Loop",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -6736,
          4464
        ],
        "id": "5e197faf-d512-41c0-a461-f8b956a5c912",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/shippingsettings",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"accountId\": \"{{ $json.shop_id }}\",\n  \"services\": [{\n    \"name\": \"Standard Shipping\",\n    \"active\": true,\n    \"deliveryCountry\": \"DE\",\n    \"deliveryTime\": {\n      \"minHandlingTimeInDays\": 1,\n      \"maxHandlingTimeInDays\": 3,\n      \"minTransitTimeInDays\": 2,\n      \"maxTransitTimeInDays\": 5\n    },\n    \"rateGroups\": [{\n      \"singleValue\": {\n        \"flatRate\": {\n          \"value\": \"0\",\n          \"currency\": \"EUR\"\n        }\n      }\n    }]\n  }]\n}",
          "options": {}
        },
        "name": "Update Merchant Settings",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -6272,
          4448
        ],
        "id": "57fcddb5-77a8-4ba8-b4dc-2192621944a0",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "amount": 2
        },
        "name": "Rate Limiting Merchant",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          -5232,
          4432
        ],
        "id": "4b35c3df-2960-48e8-965f-04cf264c9664",
        "webhookId": "rate-limit-merchant-webhook",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "// ============================================================================\n// PREPARE MULTI COUNTRY LOOP - SEQUENTIELLE VERARBEITUNG\n// ============================================================================\nconst inputItem = $input.first().json;\nconst config = $('SHOP_CONFIGURATION').first().json;\n\n// Multi-Country Logik - sequenziell verarbeiten (ein Item)\nreturn {\n  json: {\n    ...inputItem,\n    action: 'multi_country',\n    priority: 'multi_country',\n    multi_country_processed: true,\n    countries: inputItem.countries || inputItem.countries_from_gemini || [],\n    shipping: inputItem.shipping || []\n  }\n};"
        },
        "name": "Prepare Multi Country Loop",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -6736,
          4688
        ],
        "id": "988f55fa-740d-4eef-9df2-920bbcdb193f",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/products/{{ $json.product_id }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"destinations\": [\n    {{ $json.countries.map(c => `{\"destinationName\": \"Shopping_ads\", \"country\": \"${c}\"}`).join(',') }}\n  ],\n  \"shipping\": [\n    {{ $json.countries.map(c => `{\"country\": \"${c}\", \"price\": {\"value\": \"0\", \"currency\": \"EUR\"}}`).join(',') }}\n  ]\n}",
          "options": {}
        },
        "name": "Update Country Feeds",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -6272,
          4672
        ],
        "id": "3d833aef-105f-4b29-b39d-210bec84b62e",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "amount": 2
        },
        "name": "Rate Limiting Country",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          -5232,
          4656
        ],
        "id": "fe1897ad-0183-411d-ad54-bedc90a0531c",
        "webhookId": "rate-limit-country-webhook",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "adult_flags",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "adult-flags-condition"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Adult Flags"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "images",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "images-condition"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Images"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "text",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "text-condition"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Text"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "merchant_quality",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "merchant-quality-condition"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Merchant Quality"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "multi_country",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      },
                      "id": "multi-country-condition"
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Multi Country"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "b85d4e72-545e-46d6-9d63-bb8819eeffb5",
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "multi_gtn_ean",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Multi GTN/EAN"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "59b9840f-42a0-40e1-8219-74cda70e3389",
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "H√§ndlerqualit√§t",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "H√§ndlerqualit√§t"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "0c1be4fa-a537-4377-97e3-6f36cd0ba8d0",
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "Gemini_S24",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Gemini_S24"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "51567b03-a03e-487d-9083-fbc339177f75",
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "Gemini_DDC",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Gemini_DDC"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "9d7772c0-b5a4-451e-a8f2-c9852eff5496",
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "GTNI/EAN Hersteller Recherche"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "2d85adf4-528d-4e12-9dff-d4ed344383f6",
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Error‚ÄëAgent"
              }
            ]
          },
          "options": {
            "fallbackOutput": "extra",
            "renameFallbackOutput": "Fallback"
          }
        },
        "name": "Route by Priority",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          -7056,
          4448
        ],
        "id": "b5972a12-c451-453b-86d6-ee3ea66a8de3",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $('SHOP_CONFIGURATION').item.json.supabase_url }}/rest/v1/products",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "apikey",
                "value": "={{ $('SHOP_CONFIGURATION').item.json.supabase_key }}"
              },
              {
                "name": "Authorization",
                "value": "=Bearer {{ $('SHOP_CONFIGURATION').item.json.supabase_key }}"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              },
              {
                "name": "Prefer",
                "value": "resolution=merge-duplicates"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"shop_id\": \"{{ $json.shop_id }}\",\n  \"shop_name\": \"{{ $json.shop_name }}\",\n  \"shop_url\": \"{{ $json.shop_id === '5339977843' ? 'www.siliconedolls24.com' : 'www.dreamdoll.de' }}\",\n  \"product_id\": \"{{ $json.product_id }}\",\n  \"offer_id\": \"{{ $json.offer_id }}\",\n  \"title\": \"{{ $json.title }}\",\n  \"image_link\": \"{{ $json.image_link || '' }}\",\n  \"adult_flag_set\": {{ $json.action === 'adult_flags' || $json.priority === 'adult_flags' ? 'true' : 'false' }},\n  \"text_sanitized\": {{ $json.action === 'text' || $json.priority === 'text' ? 'true' : 'false' }},\n  \"image_optimized\": {{ $json.action === 'images' || $json.priority === 'images' ? 'true' : 'false' }},\n  \"feed_optimized\": true,\n  \"shipping_set\": {{ $json.action === 'merchant_quality' || $json.priority === 'merchant_quality' ? 'true' : 'false' }},\n  \"returns_set\": {{ $json.action === 'merchant_quality' || $json.priority === 'merchant_quality' ? 'true' : 'false' }},\n  \"tax_set\": {{ $json.action === 'merchant_quality' || $json.priority === 'merchant_quality' ? 'true' : 'false' }},\n  \"multi_country\": {{ $json.action === 'multi_country' || $json.priority === 'multi_country' ? 'true' : 'false' }},\n  \"status\": \"SUCCESS\",\n  \"last_optimized_at\": \"{{ $now.toISO() }}\"\n}",
          "options": {}
        },
        "name": "Save to Supabase Products",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -6752,
          6608
        ],
        "id": "1a3ed50c-5fbd-4584-9aa0-2ccdd758b69c",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "waitBetweenTries": 3000,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $('SHOP_CONFIGURATION').item.json.supabase_url }}/rest/v1/rpc/update_pattern_success",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "apikey",
                "value": "={{ $('SHOP_CONFIGURATION').item.json.supabase_key }}"
              },
              {
                "name": "Authorization",
                "value": "=Bearer {{ $('SHOP_CONFIGURATION').item.json.supabase_key }}"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"p_pattern_type\": \"{{ $json.action || $json.priority }}\",\n  \"p_success\": true\n}",
          "options": {}
        },
        "name": "Update Optimization Patterns",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -6288,
          6592
        ],
        "id": "dc92aeb6-cceb-4d91-8162-a6efc34a6092",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "operation": "appendOrUpdate",
          "documentId": {
            "__rl": true,
            "value": "https://docs.google.com/spreadsheets/d/1R1fYQTswbGBDzLoizyTNPKVLup1ie0_ksqBTLc5E48s/edit?gid=0#gid=0",
            "mode": "url"
          },
          "sheetName": {
            "__rl": true,
            "value": 1181382825,
            "mode": "list",
            "cachedResultName": "üß† AI_Learning",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1R1fYQTswbGBDzLoizyTNPKVLup1ie0_ksqBTLc5E48s/edit#gid=1181382825"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {},
            "matchingColumns": [],
            "schema": [
              {
                "id": "Timestamp",
                "displayName": "Timestamp",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Problem_Type",
                "displayName": "Problem_Type",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Human_Instruction",
                "displayName": "Human_Instruction",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "AI_Solution",
                "displayName": "AI_Solution",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Success_Rate",
                "displayName": "Success_Rate",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Applied_Count",
                "displayName": "Applied_Count",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              },
              {
                "id": "Pattern_ID",
                "displayName": "Pattern_ID",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "name": "Get Human Instructions",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          -7936,
          5264
        ],
        "id": "a56f69ce-a923-4fea-854d-03e5ee5b1f30",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "waitBetweenTries": 3000,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "cztAb4CKfRPRO8KX",
            "name": "Google Sheets account"
          }
        },
        "onError": "continueErrorOutput",
        "continueOnFail": true
      },
      {
        "parameters": {
          "jsCode": "// Filter: Nur Zeilen MIT Human Instructions UND OHNE AI Response\nconst items = $input.all();\n\nconst needsProcessing = items.filter(item => {\n  const row = item.json || {};\n\n  const instruction = (row.Human_Instructions || '').trim();\n  const aiResponse = (row.AI_Response || '').trim();\n\n  return instruction !== '' && aiResponse === '';\n});\n\n// Wenn nichts zu tun ist ‚Üí leeres Array zur√ºckgeben\nreturn needsProcessing;\n"
        },
        "name": "Filter Unprocessed Instructions",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -7680,
          5248
        ],
        "id": "bb3f2a87-ddaf-4397-9590-fe9b5ae181cd",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Du bist der Learning Agent f√ºr MECHTECH.\n\nDeine Aufgaben:\n1. Lies die Human Instructions aus Google Sheets.\n2. Verstehe exakt, was der Mensch erreichen will.\n3. Erstelle ein klares Pattern und eine technische L√∂sung.\n4. Bestimme, ob diese L√∂sung auf √§hnliche Produkte angewendet werden kann.\n5. Extrahiere Keywords f√ºr √§hnliche Produkte.\n6. Du erzeugst NUR das JSON. Kein Schreiben in Datenbanken.\n\nWenn der Mensch Fehler macht:\n- Erkenne den Fehler.\n- Formuliere einen freundlichen Hinweis.\n- Schlage eine bessere L√∂sung vor.\n\nAntworte IMMER als JSON im folgenden Format:\n{\n  \"ai_response\": \"Antwort an den Menschen\",\n  \"solution\": \"Technische L√∂sung / Pattern\",\n  \"pattern_type\": \"adult_flags | text | images | merchant_quality | multi_country | multi_gtin_ean\",\n  \"ai_confidence\": 0-100,\n  \"apply_to_similar\": true/false,\n  \"similar_keywords\": [\"keyword1\", \"keyword2\"],\n  \"warning\": \"Optional: Hinweis, wenn Mensch Fehler macht\"\n}\n",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "Du bist der Learning Agent f√ºr MECHTECH!\n\nDeine Aufgabe:\n1. Lese Human Instructions aus Google Sheets\n2. Verstehe was der Mensch will\n3. Erstelle Pattern/L√∂sung\n4. Wende auf √§hnliche Produkte an\n5. Speichere Learning in Supabase\n\nWenn Mensch Fehler macht:\n- Erkenne es!\n- Gib freundlichen Hinweis\n- Schlage bessere L√∂sung vor\n\nAntworte IMMER als JSON:\n{\n  \"ai_response\": \"Deine Antwort an den Menschen\",\n  \"solution\": \"Was du tun wirst\",\n  \"pattern_type\": \"adult_flags|text|images|merchant_quality|multi_country/multi gtn/ean\",\n  \"ai_confidence\": 85,\n  \"apply_to_similar\": true,\n  \"similar_keywords\": [\"keyword1\", \"keyword2\"],\n  \"warning\": \"Optional: Wenn Mensch Fehler macht\"\n}"
          }
        },
        "name": "Process Instructions with Gemini",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.7,
        "position": [
          -7440,
          5232
        ],
        "id": "31a278c1-7ca3-4bc6-a1b4-f67b95828fe9",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash-exp",
          "options": {}
        },
        "name": "Gemini Model Learning",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -7440,
          5424
        ],
        "id": "38d988a9-c369-48a7-b325-40a46b498233",
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        }
      },
      {
        "parameters": {
          "jsonSchemaExample": "{\n  \"product_id\": \"{{ $json.Product_ID }}\",\n  \"product_title\": \"{{ $json.Title }}\",\n  \"human_instruction\": \"{{ $json.Human_Instructions }}\",\n  \"shop_id\": \"{{ $json.Shop_ID }}\",\n  \"category\": \"{{ $json.Category }}\",\n  \"keywords\": \"{{ $json.Keywords }}\",\n  \"notes\": \"{{ $json.Notes }}\"\n}\n"
        },
        "name": "JSON Parser Learning",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.2,
        "position": [
          -7296,
          5424
        ],
        "id": "a61ab791-ef51-4dc6-879c-b3ef6d6ed1e1",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "// Apply solution to similar products\nconst instruction = $input.item.json;\nconst geminiResponse = $('Process Instructions with Gemini').item.json;\n\nif (!geminiResponse.apply_to_similar) {\n  return [{\n    json: {\n      ...instruction,\n      ai_response: geminiResponse.ai_response,\n      ai_confidence: geminiResponse.ai_confidence,\n      applied_to_similar: 0\n    }\n  }];\n}\n\n// Get all products from previous steps\nconst allProducts = $('Get Merchant Products_DDC').all();\nconst keywords = geminiResponse.similar_keywords || [];\n\n// Find similar products\nconst similarProducts = allProducts.filter(p => {\n  const title = (p.json.title || '').toLowerCase();\n  return keywords.some(keyword => title.includes(keyword.toLowerCase()));\n});\n\nreturn [{\n  json: {\n    ...instruction,\n    ai_response: geminiResponse.ai_response,\n    ai_confidence: geminiResponse.ai_confidence,\n    applied_to_similar: similarProducts.length,\n    similar_product_ids: similarProducts.map(p => p.json.id),\n    pattern_type: geminiResponse.pattern_type,\n    solution: geminiResponse.solution,\n    warning: geminiResponse.warning || null\n  }\n}];"
        },
        "name": "Apply to Similar Products",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -7664,
          5552
        ],
        "id": "d4adc74e-f15a-4ce2-8221-317591817dc9",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "operation": "update",
          "documentId": {
            "__rl": true,
            "value": "=https://docs.google.com/spreadsheets/d/1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE/edit?gid=122021485#gid=122021485",
            "mode": "url"
          },
          "sheetName": {
            "__rl": true,
            "value": "=https://docs.google.com/spreadsheets/d/1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE/edit?gid=1872200725#gid=1872200725",
            "mode": "url"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {},
            "matchingColumns": [],
            "schema": [],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false,
            "mappings": [
              {
                "column": "AI_Response",
                "value": "={{ $json.ai_response }}"
              },
              {
                "column": "AI_Confidence",
                "value": "={{ $json.ai_confidence }}"
              },
              {
                "column": "Applied_To_Similar",
                "value": "={{ $json.applied_to_similar }}"
              }
            ]
          },
          "options": {}
        },
        "name": "Update Sheet with AI Response",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          -7088,
          5760
        ],
        "id": "a1e125db-5b1b-4181-bfe4-3ec4fd3d0f83",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "cztAb4CKfRPRO8KX",
            "name": "Google Sheets account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "={{ $('SHOP_CONFIGURATION').item.json.supabase_url }}/rest/v1/human_instructions",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "apikey",
                "value": "={{ $('SHOP_CONFIGURATION').item.json.supabase_key }}"
              },
              {
                "name": "Authorization",
                "value": "=Bearer {{ $('SHOP_CONFIGURATION').item.json.supabase_key }}"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"product_id\": \"{{ $json.Product_ID }}\",\n  \"shop_id\": \"{{ $json.shop_id }}\",\n  \"instruction\": \"{{ $json.Human_Instructions }}\",\n  \"instruction_type\": \"{{ $json.pattern_type }}\",\n  \"ai_response\": \"{{ $json.ai_response }}\",\n  \"ai_confidence\": {{ $json.ai_confidence }},\n  \"ai_action_taken\": \"{{ $json.solution }}\",\n  \"applied_to_similar\": {{ $json.applied_to_similar }},\n  \"status\": \"EXECUTED\",\n  \"executed_at\": \"{{ $now.toISO() }}\"\n}",
          "options": {}
        },
        "name": "Save Learning to Supabase",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -7088,
          5536
        ],
        "id": "d60a8c7b-14b6-40bc-a45d-065f7ae0745f",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "// FIXED VERSION - handles both array and object responses\nconst response = $input.item.json;\n\n// Check if response is array or needs to be wrapped\nlet decisions = Array.isArray(response) ? response : (response.data || [response]);\n\n// Filter out empty/null entries\ndecisions = decisions.filter(d => d && d.created_at);\n\nif (!decisions || decisions.length === 0) {\n  return [{\n    json: {\n      response: 'üìä MECHTECH Status\\n\\n‚ùå Noch keine Daten!\\n\\nWorkflow l√§uft t√§glich alle 4 Stunden.',\n      recipient: $('Parse Command Input').item.json.source,\n      subject: 'MECHTECH Status Report'\n    }\n  }];\n}\n\nconst lastRun = decisions[0];\nconst total = decisions.reduce((sum, d) => sum + (d.products_processed || 0), 0);\nconst successRate = total > 0 \n  ? ((decisions.reduce((sum, d) => sum + (d.success_count || 0), 0) / total) * 100).toFixed(1)\n  : 0;\n\nconst responseText = `üìä MECHTECH WORKFLOW STATUS\n\n‚úÖ Letzte Ausf√ºhrung:\n- Shop: ${lastRun.shop_name || 'N/A'}\n- Datum: ${new Date(lastRun.created_at).toLocaleString('de-DE')}\n- Phase: ${lastRun.decision_type || 'N/A'}\n- Produkte: ${lastRun.products_processed || 0}\n- Erfolge: ${lastRun.success_count || 0}\n\nüìà Letzte ${decisions.length} Runs:\n- Total Produkte: ${total}\n- Success Rate: ${successRate}%\n- Kosten: ‚Ç¨3.00\n\n‚è∞ N√§chster Run: T√§glich 2:00 AM\n\nüí° Commands:\n- status: Aktueller Status\n- report: Vollst√§ndiger Report\n- help: Hilfe`;\n\nreturn [{\n  json: {\n    response: responseText,\n    recipient: $('Parse Command Input').item.json.source,\n    subject: 'MECHTECH Status Report'\n  }\n}];"
        },
        "name": "Format Status Response",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -7840,
          6192
        ],
        "id": "fc84037e-86c7-491d-9d9b-c4f0f9c3d1da",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "waitBetweenTries": 3000,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
        "typeVersion": 1.2,
        "position": [
          -5568,
          3696
        ],
        "id": "e5c5b910-0e54-42f5-a860-40223b56f3f0",
        "name": "MCP Client"
      },
      {
        "parameters": {},
        "type": "n8n-nodes-base.manualTrigger",
        "typeVersion": 1,
        "position": [
          -8624,
          5008
        ],
        "id": "6ec4192b-4335-431f-82e8-e4ab3583e7c1",
        "name": "When clicking ‚ÄòExecute workflow‚Äô",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "disabled": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "rule": {
            "interval": [
              {
                "field": "minutes",
                "minutesInterval": 2
              }
            ]
          }
        },
        "type": "n8n-nodes-base.scheduleTrigger",
        "typeVersion": 1.3,
        "position": [
          -8624,
          5264
        ],
        "id": "72c8c105-e206-497b-a1cc-1b93bcae1333",
        "name": "Schedule Trigger",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "operation": "appendOrUpdate",
          "documentId": {
            "__rl": true,
            "value": "1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE",
            "mode": "list",
            "cachedResultName": "MECHTECH Merchant Center Dashboard",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1872200725,
            "mode": "list",
            "cachedResultName": "üìù Daily_Log",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE/edit#gid=1872200725"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Timestamp": "={{ $json.run_date }}{{ $('Check Last Run').item.json.created_at }}",
              "Shop": "={{ $json.shop_id }}",
              "Phase": "={{ $json.phase }}",
              "Products Processed": "={{ $json.products_processed }}",
              "Success Count": "={{ $json.success_count }}",
              "Failed Count": "={{ $json.failed_count }}",
              "Status": "={{ $json.created_at }}",
              "Action": "={{ $json.gemini_decision }}",
              "Details": "={{ $json.approval_rate_after }}"
            },
            "matchingColumns": [
              "Timestamp"
            ],
            "schema": [
              {
                "id": "Timestamp",
                "displayName": "Timestamp",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Shop",
                "displayName": "Shop",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Phase",
                "displayName": "Phase",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Action",
                "displayName": "Action",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Products Processed",
                "displayName": "Products Processed",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Success Count",
                "displayName": "Success Count",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Failed Count",
                "displayName": "Failed Count",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Status",
                "displayName": "Status",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Details",
                "displayName": "Details",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false,
            "mappings": [
              {
                "column": "Timestamp",
                "value": "={{ $json.run_date }}"
              },
              {
                "column": "Shop",
                "value": "={{ $json.shop_name }}"
              },
              {
                "column": "Phase",
                "value": "={{ $json.phase }}"
              },
              {
                "column": "Action",
                "value": "Daily Run"
              },
              {
                "column": "Products Processed",
                "value": "={{ $json.products_processed }}"
              },
              {
                "column": "Success Count",
                "value": "={{ $json.success_count }}"
              },
              {
                "column": "Failed Count",
                "value": "={{ $json.failed_count }}"
              },
              {
                "column": "Status",
                "value": "={{ $json.status }}"
              },
              {
                "column": "Details",
                "value": "={{ $json.reasoning }}"
              }
            ]
          },
          "options": {}
        },
        "id": "d3286ddf-6aa7-4f3e-a806-e0ba6963ee4f",
        "name": "Log Results_Sheets_01",
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.4,
        "position": [
          -5728,
          6016
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "pbNsBLFTIuL9ArMn",
            "name": "Google Sheets"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "options": {}
        },
        "type": "n8n-nodes-base.emailReadImap",
        "typeVersion": 2.1,
        "position": [
          -8624,
          4784
        ],
        "id": "688575a9-a832-4802-ae6a-70387ea4bacb",
        "name": "Email Trigger (IMAP)1",
        "credentials": {
          "imap": {
            "id": "CdpePT9CweqekWEC",
            "name": "IMAP info@mechtech-support.com"
          }
        },
        "disabled": true
      },
      {
        "parameters": {
          "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
        "typeVersion": 1.2,
        "position": [
          -4256,
          3904
        ],
        "id": "0c538ce4-adaf-4863-a51e-3ec57398b3d9",
        "name": "MCP Client2"
      },
      {
        "parameters": {
          "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "supabaseApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {}
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequestTool",
        "typeVersion": 4.3,
        "position": [
          -4384,
          3904
        ],
        "id": "715e018e-47d3-4848-868e-f5c9847c2a53",
        "name": "Supabase RAG Context1",
        "credentials": {
          "supabaseApi": {
            "id": "f1qLUdIsbZ2A3wdC",
            "name": "Supabase-MySQL"
          }
        }
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Error from Update Product Adult Flag: {{ $json.error || $json.message || \"Unknown error\" }}. \nProduct ID: {{ $json.product_id }}. \nAnalyze this error and suggest a fix.",
          "options": {
            "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the Update Product Adult Flag operation and provide actionable solutions.\n\nDu bist ein strikter Fehler-Fix-Agent. Gib deine Antwort AUSSCHLIESSLICH im folgenden JSON-Format zur√ºck:\n\n{\n  \"fix_type\": \"\",\n  \"field\": \"\",\n  \"new_value\": \"\",\n  \"reason\": \"\",\n  \"details\": \"\"\n}\n\nRegeln:\n- fix_type MUSS einer der folgenden Werte sein:\n  \"fix_text\", \"fix_image\", \"fix_gtin\", \"fix_attribute\", \"fix_policy\", \"fix_quality\"\n- field MUSS das betroffene Produktfeld sein (z. B. title, description, image_link, gtin, color, size)\n- new_value MUSS der korrigierte Wert sein\n- reason = kurze Begr√ºndung\n- details = zus√§tzliche Details\n- KEINE weiteren Felder\n- KEIN Text au√üerhalb des JSON\n- KEINE Erkl√§rungen\n- KEINE Kommentare\n- KEINE zus√§tzlichen Objekte"
          }
        },
        "id": "c0278cf2-399a-4b2b-b762-6f4ea6c4ce76",
        "name": "AI Error Analyzer Adult Flags",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3,
        "position": [
          -4896,
          3888
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
        "typeVersion": 1.2,
        "position": [
          -4256,
          4112
        ],
        "id": "f1384400-fb23-4789-8fa6-d6852887afa9",
        "name": "MCP Client3"
      },
      {
        "parameters": {
          "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "supabaseApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {}
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequestTool",
        "typeVersion": 4.3,
        "position": [
          -4384,
          4112
        ],
        "id": "cc0e7570-253b-42ea-94b0-bb2ba7b5612d",
        "name": "Supabase RAG Context2",
        "credentials": {
          "supabaseApi": {
            "id": "f1qLUdIsbZ2A3wdC",
            "name": "Supabase-MySQL"
          }
        }
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Error: {{ $json.error || $json.message || \"Unknown error\" }}.\nProduct ID: {{ $json.product_id }}.\nAnalyze this error and suggest a fix.",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the current operation and provide actionable solutions.\n\nDu bist ein strikter Fehler-Fix-Agent. Gib deine Antwort AUSSCHLIESSLICH im folgenden JSON-Format zur√ºck:\n\n{\n  \"fix_type\": \"\",\n  \"field\": \"\",\n  \"new_value\": \"\",\n  \"reason\": \"\",\n  \"details\": \"\"\n}\n\nRegeln:\n- fix_type MUSS einer der folgenden Werte sein:\n  \"fix_text\", \"fix_image\", \"fix_gtin\", \"fix_attribute\", \"fix_policy\", \"fix_quality\"\n- field MUSS das betroffene Produktfeld sein (z. B. title, description, image_link, gtin, color, size)\n- new_value MUSS der korrigierte Wert sein\n- reason = kurze Begr√ºndung\n- details = zus√§tzliche Details\n- KEINE weiteren Felder\n- KEIN Text au√üerhalb des JSON\n- KEINE Erkl√§rungen\n- KEINE Kommentare\n- KEINE zus√§tzlichen Objekte\n"
          }
        },
        "id": "03073645-80fc-4d43-87c3-8d55a23161c9",
        "name": "AI Error Analyzer Images",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3,
        "position": [
          -4896,
          4096
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
        "typeVersion": 1.2,
        "position": [
          -4256,
          4304
        ],
        "id": "5565001b-21d8-4954-8bfa-0b9d5a3264dc",
        "name": "MCP Client4"
      },
      {
        "parameters": {
          "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "supabaseApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {}
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequestTool",
        "typeVersion": 4.3,
        "position": [
          -4384,
          4304
        ],
        "id": "7a8ba9d7-7524-49e3-a1d3-70917362938d",
        "name": "Supabase RAG Context3",
        "credentials": {
          "supabaseApi": {
            "id": "f1qLUdIsbZ2A3wdC",
            "name": "Supabase-MySQL"
          }
        }
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Error: {{ $json.error || $json.message || \"Unknown error\" }}.\nProduct ID: {{ $json.product_id }}.\nAnalyze this error and suggest a fix.",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the current operation and provide actionable solutions.\n\nDu bist ein strikter Fehler-Fix-Agent. Gib deine Antwort AUSSCHLIESSLICH im folgenden JSON-Format zur√ºck:\n\n{\n  \"fix_type\": \"\",\n  \"field\": \"\",\n  \"new_value\": \"\",\n  \"reason\": \"\",\n  \"details\": \"\"\n}\n\nRegeln:\n- fix_type MUSS einer der folgenden Werte sein:\n  \"fix_text\", \"fix_image\", \"fix_gtin\", \"fix_attribute\", \"fix_policy\", \"fix_quality\"\n- field MUSS das betroffene Produktfeld sein (z. B. title, description, image_link, gtin, color, size)\n- new_value MUSS der korrigierte Wert sein\n- reason = kurze Begr√ºndung\n- details = zus√§tzliche Details\n- KEINE weiteren Felder\n- KEIN Text au√üerhalb des JSON\n- KEINE Erkl√§rungen\n- KEINE Kommentare\n- KEINE zus√§tzlichen Objekte"
          }
        },
        "id": "cd7acabd-43fa-4acb-830f-3740bf6537b2",
        "name": "AI Error Analyzer Text",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3,
        "position": [
          -4896,
          4288
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
        "typeVersion": 1.2,
        "position": [
          -4256,
          4496
        ],
        "id": "b0b91609-47a2-419d-b767-9b78fcc507d3",
        "name": "MCP Client5"
      },
      {
        "parameters": {
          "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "supabaseApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {}
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequestTool",
        "typeVersion": 4.3,
        "position": [
          -4384,
          4496
        ],
        "id": "9595a38e-7aa0-4140-89e9-feee495f3dc8",
        "name": "Supabase RAG Context4",
        "credentials": {
          "supabaseApi": {
            "id": "f1qLUdIsbZ2A3wdC",
            "name": "Supabase-MySQL"
          }
        }
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -3856,
          4496
        ],
        "id": "2ff7cc7c-9f1a-40d3-995e-d16b1ddb8e81",
        "name": "Google Gemini Chat Model4",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Error from Update Product Merchant Quality: {{ $json.error || $json.message || \"Unknown error\" }}. Product ID: {{ $json.product_id }}. Analyze this error and suggest a fix.",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the current operation and provide actionable solutions.\n\nDu bist ein strikter Fehler-Fix-Agent. Gib deine Antwort AUSSCHLIESSLICH im folgenden JSON-Format zur√ºck:\n\n{\n  \"fix_type\": \"\",\n  \"field\": \"\",\n  \"new_value\": \"\",\n  \"reason\": \"\",\n  \"details\": \"\"\n}\n\nRegeln:\n- fix_type MUSS einer der folgenden Werte sein:\n  \"fix_text\", \"fix_image\", \"fix_gtin\", \"fix_attribute\", \"fix_policy\", \"fix_quality\"\n- field MUSS das betroffene Produktfeld sein (z. B. title, description, image_link, gtin, color, size)\n- new_value MUSS der korrigierte Wert sein\n- reason = kurze Begr√ºndung\n- details = zus√§tzliche Details\n- KEINE weiteren Felder\n- KEIN Text au√üerhalb des JSON\n- KEINE Erkl√§rungen\n- KEINE Kommentare\n- KEINE zus√§tzlichen Objekte\n"
          }
        },
        "id": "94e0712d-d081-451e-819b-edff304a72d1",
        "name": "AI Error Analyzer Merchant",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3,
        "position": [
          -4896,
          4480
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "schemaType": "manual",
          "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"priority\": {\n      \"type\": \"string\",\n      \"enum\": [\"adult_flags\"]\n    },\n    \"reasoning\": {\n      \"type\": \"string\"\n    },\n    \"products_to_process\": {\n      \"type\": \"number\"\n    }\n  },\n  \"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}\n",
          "autoFix": true
        },
        "id": "79d00c3f-2d47-4018-a0bc-bc96ae1df9b2",
        "name": "Adult_Flags_Parser",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.3,
        "position": [
          -4144,
          3904
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "schemaType": "manual",
          "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"priority\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"enum\": [\"images\"]\n\t\t},\n\t\t\"reasoning\": {\n\t\t\t\"type\": \"string\"\n\t\t},\n\t\t\"products_to_process\": {\n\t\t\t\"type\": \"number\"\n\t\t}\n\t},\n\t\"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}",
          "autoFix": true
        },
        "id": "dbd8cb57-3466-49c5-8434-48a2ab9949cb",
        "name": "Images Parser",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.3,
        "position": [
          -4144,
          4096
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "schemaType": "manual",
          "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"priority\": {\n      \"type\": \"string\",\n      \"enum\": [\"text\"]\n    },\n    \"reasoning\": {\n      \"type\": \"string\"\n    },\n    \"products_to_process\": {\n      \"type\": \"number\"\n    }\n  },\n  \"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}\n",
          "autoFix": true
        },
        "id": "639ce28c-33a5-4f6c-8d6c-d5cba352030e",
        "name": "Text_Output_Parser",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.3,
        "position": [
          -4144,
          4304
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -3856,
          4304
        ],
        "id": "f37560e3-85f8-4d40-96b9-cde5dbc1212a",
        "name": "Google_Gemini_Chat",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "supabaseApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {}
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequestTool",
        "typeVersion": 4.3,
        "position": [
          -4384,
          4672
        ],
        "id": "499db9a3-f38b-43d2-a9b6-43d638596ff1",
        "name": "Supabase RAG Context5",
        "credentials": {
          "supabaseApi": {
            "id": "f1qLUdIsbZ2A3wdC",
            "name": "Supabase-MySQL"
          }
        }
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -3856,
          4672
        ],
        "id": "55a12bf9-bbdd-44f9-8900-5d92d856fe28",
        "name": "Google Gemini Chat Model5",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Error: {{ $json.error || $json.message || \"Unknown error\" }}.\nProduct ID: {{ $json.product_id }}.\nAnalyze this error and suggest a fix.\n",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the current operation and provide actionable solutions.\n\nDu bist ein strikter Fehler-Fix-Agent. Gib deine Antwort AUSSCHLIESSLICH im folgenden JSON-Format zur√ºck:\n\n{\n  \"fix_type\": \"\",\n  \"field\": \"\",\n  \"new_value\": \"\",\n  \"reason\": \"\",\n  \"details\": \"\"\n}\n\nRegeln:\n- fix_type MUSS einer der folgenden Werte sein:\n  \"fix_text\", \"fix_image\", \"fix_gtin\", \"fix_attribute\", \"fix_policy\", \"fix_quality\"\n- field MUSS das betroffene Produktfeld sein (z. B. title, description, image_link, gtin, color, size)\n- new_value MUSS der korrigierte Wert sein\n- reason = kurze Begr√ºndung\n- details = zus√§tzliche Details\n- KEINE weiteren Felder\n- KEIN Text au√üerhalb des JSON\n- KEINE Erkl√§rungen\n- KEINE Kommentare\n- KEINE zus√§tzlichen Objekte\n"
          }
        },
        "id": "7fa96fb5-d399-40d8-8548-b466a90dbcb5",
        "name": "AI Error Analyzer Error_Multi_Country",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3,
        "position": [
          -4896,
          4672
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
        "typeVersion": 1.2,
        "position": [
          -4256,
          4672
        ],
        "id": "0fc0cf34-7bef-46e2-bc0f-808efd88d680",
        "name": "MCP Client_6"
      },
      {
        "parameters": {
          "schemaType": "manual",
          "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"priority\": { \"type\": \"string\", \"enum\": [\"multi_country\"] },\n    \"reasoning\": { \"type\": \"string\" },\n    \"products_to_process\": { \"type\": \"number\" }\n  },\n  \"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}\n",
          "autoFix": true
        },
        "id": "a58b7a91-55ad-425c-87f6-235cb8850206",
        "name": "Country_Out_Parser",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.3,
        "position": [
          -4144,
          4672
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "schemaType": "manual",
          "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"priority\": { \"type\": \"string\", \"enum\": [\"merchant_quality\"] },\n    \"reasoning\": { \"type\": \"string\" },\n    \"products_to_process\": { \"type\": \"number\" }\n  },\n  \"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}\n",
          "autoFix": true
        },
        "id": "0392fe48-15ff-4db6-8b81-a96e9efdc195",
        "name": "Merchant_Parser",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.3,
        "position": [
          -4144,
          4496
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "supabaseApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {}
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequestTool",
        "typeVersion": 4.3,
        "position": [
          -4384,
          5344
        ],
        "id": "f15d2546-e1f5-42ac-a8a7-ad152ae1f105",
        "name": "Supabase RAG Context6",
        "credentials": {
          "supabaseApi": {
            "id": "f1qLUdIsbZ2A3wdC",
            "name": "Supabase-MySQL"
          }
        }
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -3856,
          5344
        ],
        "id": "a36c7607-8b30-43de-8e84-827153f4fd7d",
        "name": "Google Gemini Chat Model6",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
        "typeVersion": 1.2,
        "position": [
          -4256,
          5344
        ],
        "id": "2e81d800-83fc-4bf7-9ead-25c5faa01fdd",
        "name": "MCP Client_"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Error: {{ $json.error || $json.message || \"Unknown error\" }}.\nProduct ID: {{ $json.product_id }}.\nAnalyze this error and suggest a fix.",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the current operation and provide actionable solutions.\n\nDu bist ein strikter Fehler-Fix-Agent. Gib deine Antwort AUSSCHLIESSLICH im folgenden JSON-Format zur√ºck:\n\n{\n  \"fix_type\": \"\",\n  \"field\": \"\",\n  \"new_value\": \"\",\n  \"reason\": \"\",\n  \"details\": \"\"\n}\n\nRegeln:\n- fix_type MUSS einer der folgenden Werte sein:\n  \"fix_text\", \"fix_image\", \"fix_gtin\", \"fix_attribute\", \"fix_policy\", \"fix_quality\"\n- field MUSS das betroffene Produktfeld sein (z. B. title, description, image_link, gtin, color, size)\n- new_value MUSS der korrigierte Wert sein\n- reason = kurze Begr√ºndung\n- details = zus√§tzliche Details\n- KEINE weiteren Felder\n- KEIN Text au√üerhalb des JSON\n- KEINE Erkl√§rungen\n- KEINE Kommentare\n- KEINE zus√§tzlichen Objekte"
          }
        },
        "id": "0adf3166-253f-43a1-9303-23063a921239",
        "name": "AI Error Analyzer Error_Multi_GTN/EAN",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3,
        "position": [
          -4896,
          5360
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "schemaType": "manual",
          "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"priority\": { \"type\": \"string\", \"enum\": [\"multi_gtn_ean\"] },\n    \"reasoning\": { \"type\": \"string\" },\n    \"products_to_process\": { \"type\": \"number\" }\n  },\n  \"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}\n",
          "autoFix": true
        },
        "id": "580c4e30-c8ee-4bab-85b1-f9146692a4d2",
        "name": "Multi_GTN/EAN_Parser",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.3,
        "position": [
          -4144,
          5344
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash",
          "options": {}
        },
        "id": "39781ea7-277e-4321-9fe9-9dcfdddc5067",
        "name": "Error_GTN/EAN",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -4528,
          5344
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "supabaseApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {}
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequestTool",
        "typeVersion": 4.3,
        "position": [
          -4384,
          5568
        ],
        "id": "3e18f633-4d57-4e11-ba15-a98d06472c96",
        "name": "Supabase RAG Context7",
        "credentials": {
          "supabaseApi": {
            "id": "f1qLUdIsbZ2A3wdC",
            "name": "Supabase-MySQL"
          }
        }
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -3856,
          5584
        ],
        "id": "c055ed73-b6fa-43b6-b572-944eb05953de",
        "name": "Google Gemini Chat Model7",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
        "typeVersion": 1.2,
        "position": [
          -4256,
          5568
        ],
        "id": "d9f49afd-88de-4a15-ab92-cb4bd6286806",
        "name": "MCP Client_1"
      },
      {
        "parameters": {
          "jsCode": "// ============================================================================\n// PREPARE H√ÑNDERQUALIT√ÑTR LOOP - F√ºr Gemini H√ÑNDLERQUALIT√ÑT Updates\n// ============================================================================\nconst inputData = $input.first().json;\nconst config = $('SHOP_CONFIGURATION').first().json;\n\n// ‚úÖ Hole Products von Analyze Products2:\nconst analysis = $('Analyze Products2').first().json;\nconst productsToFix = analysis.products_needing_fix || [];\n\n// ‚úÖ Hole Priority und Max Products von Gemini Decision:\nconst decision = $('Gemini Daily Decision').first().json.output || {};\nconst maxProducts = decision.products_to_process || productsToFix.length;\n\n// ‚úÖ Shop ID von Decision ODER Config:\nconst shopId = decision.shop_id || config.shop1_id;\n\n// ‚úÖ Shop Info aus Config:\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\n// Filtere nur H√§ndlerqualit√§t die Updates brauchen\nconst productsNeedingHaendlerqualitaet = productsToFix.filter(product => {\n  // Pr√ºfe ob Gemini empfohlen hat H√§ndlerqualit√§t zu aktualisieren\n  return product.needs_Haendlerqualitaet === true || \n         product.missing_Haendlerqualitaet === true || \n         product.missing_mpn === true ||\n         product.missing_brand === true ||\n         (product.priority && product.priority === 'multi_gtn_ean');\n});\n\n// Slice f√ºr Batch Processing\nconst productsSlice = productsNeedingGtinEan.slice(0, maxProducts);\n\n// ‚úÖ Erstelle Items mit GTIN/EAN Daten:\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    \n    // GTIN/EAN Daten (von Gemini oder Product)\n    gtin: product.gtin || product.gtin_from_gemini || product.recommended_gtin || '',\n    mpn: product.mpn || product.mpn_from_gemini || product.recommended_mpn || '',\n    brand: product.brand || product.brand_from_gemini || product.recommended_brand || '',\n    \n    action: 'gtin_ean',\n    priority: 'multi_gtn_ean',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
        },
        "name": "Prepare H√§ndlerqualit√§t",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -6736,
          5552
        ],
        "id": "9f2ebc2c-fb2b-455e-a988-53ba52043087",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "schemaType": "manual",
          "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"priority\": { \"type\": \"string\", \"enum\": [\"haendlerqualitaet\"] },\n    \"reasoning\": { \"type\": \"string\" },\n    \"products_to_process\": { \"type\": \"number\" }\n  },\n  \"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}\n",
          "autoFix": true
        },
        "id": "3d0df657-7cb2-4e95-a8ff-f0939814bd09",
        "name": "H√§ndlerqualit√§t_Parser",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.3,
        "position": [
          -4144,
          5568
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Error: {{ $json.error || $json.message || \"Unknown error\" }}.\nProduct ID: {{ $json.product_id }}.\nAnalyze this error and suggest a fix.",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the current operation and provide actionable solutions.\n\nDu bist ein strikter Fehler-Fix-Agent. Gib deine Antwort AUSSCHLIESSLICH im folgenden JSON-Format zur√ºck:\n\n{\n  \"fix_type\": \"\",\n  \"field\": \"\",\n  \"new_value\": \"\",\n  \"reason\": \"\",\n  \"details\": \"\"\n}\n\nRegeln:\n- fix_type MUSS einer der folgenden Werte sein:\n  \"fix_text\", \"fix_image\", \"fix_gtin\", \"fix_attribute\", \"fix_policy\", \"fix_quality\"\n- field MUSS das betroffene Produktfeld sein (z. B. title, description, image_link, gtin, color, size)\n- new_value MUSS der korrigierte Wert sein\n- reason = kurze Begr√ºndung\n- details = zus√§tzliche Details\n- KEINE weiteren Felder\n- KEIN Text au√üerhalb des JSON\n- KEINE Erkl√§rungen\n- KEINE Kommentare\n- KEINE zus√§tzlichen Objekte"
          }
        },
        "id": "903be1a0-b6de-4b2b-bef1-8fcdabd46d1c",
        "name": "AI Error Analyzer_H√§ndlerqualit√§t",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3,
        "position": [
          -4896,
          5552
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "amount": 2
        },
        "name": "Rate Limiting H√§ndlerqualit√§t",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          -5232,
          5520
        ],
        "id": "64eebdec-df1a-4302-aff3-7001e34cf634",
        "webhookId": "rate-limit-country-webhook",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/products/{{ $json.product_id }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendBody": true,
          "specifyBody": "json",
          "options": {}
        },
        "name": "Update H√§ndlerqualit√§t",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -6288,
          5536
        ],
        "id": "a3c598b3-e6b0-4aa8-8276-e3f159577721",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash",
          "options": {}
        },
        "id": "112ec4e0-09f5-4288-980e-d841b13f3213",
        "name": "Gemini Product Optimizer (NEW)",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -3856,
          5776
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        }
      },
      {
        "parameters": {
          "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
        "typeVersion": 1.2,
        "position": [
          -4272,
          5776
        ],
        "id": "dc19f75a-cdc1-42bd-b8dc-b0e67b162858",
        "name": "MCP Client_2"
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash",
          "options": {}
        },
        "id": "d314a02f-0b40-4268-81d6-f9f50d4464c1",
        "name": "MC_Prepare_S24",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -4528,
          5776
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        }
      },
      {
        "parameters": {
          "url": "=https://www.googleapis.com/content/v2.1/{{ $('SHOP_CONFIGURATION').item.json.shop1_id }}/productstatuses?maxResults=250",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "options": {
            "response": {
              "response": {
                "responseFormat": "json"
              }
            }
          }
        },
        "id": "1741453e-71b8-43f4-88e7-9215a476eb4e",
        "name": "MC_Get_Products_S24",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -6288,
          5760
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "schemaType": "manual",
          "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"priority\": { \"type\": \"string\", \"enum\": [\"gemini_s24\"] },\n    \"reasoning\": { \"type\": \"string\" },\n    \"products_to_process\": { \"type\": \"number\" }\n  },\n  \"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}\n",
          "autoFix": true
        },
        "id": "da53eaca-2060-4656-8fc1-7032e697677e",
        "name": "MC_Parse_S24",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.3,
        "position": [
          -4160,
          5776
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "const productsData = $('Get Merchant Products_DDC').first().json;\nconst statusData = $('MC_Get_Products_S24').first().json;\n\nconst products = Array.isArray(productsData.resources) ? productsData.resources : [productsData];\nconst statuses = Array.isArray(statusData.resources) ? statusData.resources : [statusData];\n\nconst statusMap = {};\nstatuses.forEach(s => {\n  if (s.productId) {\n    statusMap[s.productId] = s;\n  }\n});\n\nconst merged = products.map(product => {\n  const productStatus = statusMap[product.id] || {};\n  const issues = productStatus.itemLevelIssues || [];\n  const price = product.price || {};\n\n  return {\n    json: {\n      product_id: product.id,\n      offer_id: product.offerId || null,\n      title: product.title || null,\n      description: product.description || null,\n      link: product.link || null,\n      image_link: product.imageLink || null,\n      additional_image_links: product.additionalImageLinks || [],\n      price: price.value || null,\n      currency: price.currency || null,\n      brand: product.brand || null,\n      gtin: product.gtin || null,\n      mpn: product.mpn || null,\n      identifier_exists: product.identifierExists || false,\n      approval_status: productStatus.destinationStatuses || [],\n      issues: issues,\n      issue_count: issues.length,\n      raw_product: product,\n      raw_status: productStatus\n    }\n  };\n});\n\nreturn merged;"
        },
        "id": "09e126d3-021f-4810-a5e8-ca551a102336",
        "name": "MC Merge Products + Status S24",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -5232,
          5744
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
        "typeVersion": 1.2,
        "position": [
          -4272,
          5984
        ],
        "id": "7b3afa43-70da-4016-bc01-06346b2e6228",
        "name": "MCP Client_3"
      },
      {
        "parameters": {
          "url": "=https://www.googleapis.com/content/v2.1/{{ $('SHOP_CONFIGURATION').item.json.shop1_id }}/productstatuses?maxResults=250",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "options": {
            "response": {
              "response": {
                "responseFormat": "json"
              }
            }
          }
        },
        "id": "58a83a0a-8797-4494-9b71-33dffa74f3e8",
        "name": "MC_Get_Products_DDC",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -6288,
          5968
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "const productsData = $('Get Merchant Products_DDC').first().json;\nconst statusData = $('MC_Get_Products_DDC').first().json;\n\nconst products = Array.isArray(productsData.resources) ? productsData.resources : [productsData];\nconst statuses = Array.isArray(statusData.resources) ? statusData.resources : [statusData];\n\nconst statusMap = {};\nstatuses.forEach(s => {\n  if (s.productId) {\n    statusMap[s.productId] = s;\n  }\n});\n\nconst merged = products.map(product => {\n  const productStatus = statusMap[product.id] || {};\n  const issues = productStatus.itemLevelIssues || [];\n  const price = product.price || {};\n\n  return {\n    json: {\n      product_id: product.id,\n      offer_id: product.offerId || null,\n      title: product.title || null,\n      description: product.description || null,\n      link: product.link || null,\n      image_link: product.imageLink || null,\n      additional_image_links: product.additionalImageLinks || [],\n      price: price.value || null,\n      currency: price.currency || null,\n      brand: product.brand || null,\n      gtin: product.gtin || null,\n      mpn: product.mpn || null,\n      identifier_exists: product.identifierExists || false,\n      approval_status: productStatus.destinationStatuses || [],\n      issues: issues,\n      issue_count: issues.length,\n      raw_product: product,\n      raw_status: productStatus\n    }\n  };\n});\n\nreturn merged;"
        },
        "id": "94f461cd-1307-4ad2-ae59-026d39ff8fb4",
        "name": "MC Merge Products + Status DDC",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -5232,
          5952
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash",
          "options": {}
        },
        "id": "d9a2f7b6-78a9-4cec-96d0-f336c03e3b8a",
        "name": "MC_Pre_DDC",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -4528,
          5984
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "supabaseApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {}
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequestTool",
        "typeVersion": 4.3,
        "position": [
          -4400,
          5984
        ],
        "id": "0d22d912-8662-41fe-b241-846d0245107f",
        "name": "Supabase_S24",
        "credentials": {
          "supabaseApi": {
            "id": "f1qLUdIsbZ2A3wdC",
            "name": "Supabase-MySQL"
          }
        }
      },
      {
        "parameters": {
          "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "supabaseApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {}
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequestTool",
        "typeVersion": 4.3,
        "position": [
          -4400,
          5776
        ],
        "id": "171eff89-ef34-4ff6-969a-40ad66ff2ad8",
        "name": "Supabase_S",
        "credentials": {
          "supabaseApi": {
            "id": "f1qLUdIsbZ2A3wdC",
            "name": "Supabase-MySQL"
          }
        }
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Error: {{ $json.error || $json.message || \"Unknown error\" }}.\nProduct ID: {{ $json.product_id }}.\nAnalyze this error and suggest a fix.",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the current operation and provide actionable solutions.\n\nDu bist ein strikter Fehler-Fix-Agent. Gib deine Antwort AUSSCHLIESSLICH im folgenden JSON-Format zur√ºck:\n\n{\n  \"fix_type\": \"\",\n  \"field\": \"\",\n  \"new_value\": \"\",\n  \"reason\": \"\",\n  \"details\": \"\"\n}\n\nRegeln:\n- fix_type MUSS einer der folgenden Werte sein:\n  \"fix_text\", \"fix_image\", \"fix_gtin\", \"fix_attribute\", \"fix_policy\", \"fix_quality\"\n- field MUSS das betroffene Produktfeld sein (z. B. title, description, image_link, gtin, color, size)\n- new_value MUSS der korrigierte Wert sein\n- reason = kurze Begr√ºndung\n- details = zus√§tzliche Details\n- KEINE weiteren Felder\n- KEIN Text au√üerhalb des JSON\n- KEINE Erkl√§rungen\n- KEINE Kommentare\n- KEINE zus√§tzlichen Objekte"
          }
        },
        "id": "0a1c643e-b833-4b36-b3b2-141f7f80d9f7",
        "name": "Error_Ana_S24",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3,
        "position": [
          -4896,
          5760
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Error: {{ $json.error || $json.message || \"Unknown error\" }}.\nProduct ID: {{ $json.product_id }}.\nAnalyze this error and suggest a fix.",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "You are an AI error analyzer for the MECHTECH workflow. Your task is to analyze errors from the current operation and provide actionable solutions.\n\nDu bist ein strikter Fehler-Fix-Agent. Gib deine Antwort AUSSCHLIESSLICH im folgenden JSON-Format zur√ºck:\n\n{\n  \"fix_type\": \"\",\n  \"field\": \"\",\n  \"new_value\": \"\",\n  \"reason\": \"\",\n  \"details\": \"\"\n}\n\nRegeln:\n- fix_type MUSS einer der folgenden Werte sein:\n  \"fix_text\", \"fix_image\", \"fix_gtin\", \"fix_attribute\", \"fix_policy\", \"fix_quality\"\n- field MUSS das betroffene Produktfeld sein (z. B. title, description, image_link, gtin, color, size)\n- new_value MUSS der korrigierte Wert sein\n- reason = kurze Begr√ºndung\n- details = zus√§tzliche Details\n- KEINE weiteren Felder\n- KEIN Text au√üerhalb des JSON\n- KEINE Erkl√§rungen\n- KEINE Kommentare\n- KEINE zus√§tzlichen Objekte"
          }
        },
        "id": "b1ea717a-bc7e-4dae-95ad-95521a34ecd6",
        "name": "Error_Ana_DDC",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3,
        "position": [
          -4896,
          5968
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "schemaType": "manual",
          "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"priority\": { \"type\": \"string\", \"enum\": [\"gemini_ddc\"] },\n    \"reasoning\": { \"type\": \"string\" },\n    \"products_to_process\": { \"type\": \"number\" }\n  },\n  \"required\": [\"priority\", \"reasoning\", \"products_to_process\"]\n}\n",
          "autoFix": true
        },
        "id": "8d839cac-ec08-4f96-8443-559df8c7cc17",
        "name": "MC_Parse_DDC",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.3,
        "position": [
          -4160,
          5984
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash",
          "options": {}
        },
        "id": "7e5a8bec-b296-49dd-8b49-8b4b8a28a605",
        "name": "Optimizer DDC",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -3872,
          5984
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -3856,
          3904
        ],
        "id": "565157e1-e98e-4d84-97a1-7c8abdd657e9",
        "name": "Gemini_Chat_Adult",
        "alwaysOutputData": true,
        "executeOnce": true,
        "retryOnFail": true,
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -3856,
          4112
        ],
        "id": "732c9479-770d-44f8-8b0a-b72ea3a79fb7",
        "name": "Chat_Images",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash",
          "options": {}
        },
        "id": "fe166141-d157-4ddf-aac3-72b5d3ca0c11",
        "name": "Error Adult Flags",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -4528,
          3904
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "75b0bfaa-8f58-40c2-a085-5fb672e1762a",
        "name": "Error Images",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -4528,
          4112
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash",
          "options": {}
        },
        "id": "5bea0d14-1166-426d-8da6-b3e368652a6b",
        "name": "Error Adult Text",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -4528,
          4304
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash",
          "options": {}
        },
        "id": "24a5d888-9c79-4d6b-998f-b7450f904222",
        "name": "Error Merchant Quality",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -4528,
          4496
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash",
          "options": {}
        },
        "id": "8d29273e-68be-4e56-9cac-ea01e433b3b8",
        "name": "Error_Multi_Country1",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -4528,
          4672
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        }
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash",
          "options": {}
        },
        "id": "6b146f62-6de5-4061-a667-69de1ab85f71",
        "name": "Error_H√§ndlerquali",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -4528,
          5568
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "mode": "retrieve-as-tool",
          "toolDescription": "Work with your data in supabase",
          "tableName": {
            "__rl": true,
            "value": "workflow_runs",
            "mode": "list",
            "cachedResultName": "workflow_runs"
          },
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
        "typeVersion": 1.3,
        "position": [
          -5536,
          3520
        ],
        "id": "f77b6ff5-fbad-4b12-a99c-347b1538988f",
        "name": "Supabase Vector Store",
        "credentials": {
          "supabaseApi": {
            "id": "f1qLUdIsbZ2A3wdC",
            "name": "Supabase-MySQL"
          }
        }
      },
      {
        "parameters": {
          "modelName": "models/gemini-embedding-001"
        },
        "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
        "typeVersion": 1,
        "position": [
          -5376,
          3696
        ],
        "id": "c5501499-6e5a-47a3-9083-9d6acf7f9d4f",
        "name": "Embeddings Google Gemini",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "url": "=https://www.googleapis.com/content/v2.1/{{ $('SHOP_CONFIGURATION').item.json.shop2_id }}/products?maxResults=100",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "=shop1_name",
                "value": "={{ $json.shop1_id }}{{ $('SHOP_CONFIGURATION').item.json.shop1_id }}"
              },
              {
                "name": "=shop1_name",
                "value": "={{ $json.shop1_name }}{{ $('SHOP_CONFIGURATION').item.json.shop1_name }}"
              },
              {
                "name": "=supabase_url",
                "value": "={{ $json.supabase_url }}{{ $('SHOP_CONFIGURATION').item.json.supabase_url }}"
              },
              {
                "name": "=google_sheet_id",
                "value": "={{ $json.google_sheet_id }}{{ $('SHOP_CONFIGURATION').item.json.google_sheet_id }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "=shop1_id",
                "value": "={{ $json.shop1_id }}{{ $('SHOP_CONFIGURATION').item.json.shop1_id }}"
              },
              {
                "name": "=shop1_name",
                "value": "={{ $json.shop1_id }}{{ $('SHOP_CONFIGURATION').item.json.shop1_name }}"
              },
              {
                "name": "=google_sheet_id",
                "value": "={{ $json.google_sheet_id }}{{ $('SHOP_CONFIGURATION').item.json.google_sheet_id }}"
              },
              {
                "name": "=supabasse_url",
                "value": "={{ $json.supabase_url }}{{ $('SHOP_CONFIGURATION').item.json.supabase_url }}"
              },
              {
                "name": "=supabase_key",
                "value": "={{ $json.supabase_key }}{{ $('SHOP_CONFIGURATION').item.json.supabase_key }}"
              }
            ]
          },
          "options": {}
        },
        "name": "Get Merchant Products_S24",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -8624,
          4400
        ],
        "id": "b084ed99-dd1a-474a-8713-20d469079e2f",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "url": "=https://www.googleapis.com/content/v2.1/{{ $('SHOP_CONFIGURATION').item.json.shop1_id }}/products?maxResults=16400",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "={{ $json.shop2_id }}",
                "value": "={{ $json.shop2_id }}"
              },
              {
                "name": "={{ $json.google_sheet_id }}",
                "value": "={{ $json.google_sheet_id }}"
              },
              {
                "name": "={{ $json.supabase_url }}",
                "value": "={{ $json.supabase_url }}"
              },
              {
                "name": "={{ $json.supabase_key }}",
                "value": "={{ $json.supabase_key }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "={{ $json.shop2_id }}",
                "value": "={{ $json.shop2_id }}"
              },
              {
                "name": "={{ $json.shop2_name }}",
                "value": "={{ $json.shop2_name }}"
              },
              {
                "name": "={{ $json.supabase_url }}",
                "value": "={{ $json.supabase_url }}"
              },
              {
                "name": "={{ $json.supabase_key }}",
                "value": "={{ $json.supabase_key }}"
              }
            ]
          },
          "options": {}
        },
        "name": "Get Merchant Products_DDC",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -8624,
          4608
        ],
        "id": "f1bf74a2-1e34-416e-b1a2-b0cf813b16bc",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "const item = $input.item.json;\nconst config = $('SHOP_CONFIGURATION').item.json;\n\nreturn [{\n  json: {\n    shop_id: config.shop1_id,\n    shop_name: config.shop1_name,\n    product_id: item.product_id,\n    offer_id: item.offer_id,\n    title: item.title,\n    description: item.description,\n    link: item.link,\n    image_link: item.image_link,\n    additional_image_links: item.additional_image_links,\n    price: item.price,\n    currency: item.currency,\n    brand: item.brand,\n    gtin: item.gtin,\n    mpn: item.mpn,\n    identifier_exists: item.identifier_exists,\n    issues: item.issues || [],\n    issue_count: item.issue_count || 0,\n    approval_status: item.approval_status || [],\n    needs_optimization: item.issue_count > 0,\n    approval_types: item.approval_status.map(a => a.status || '') || [],\n    timestamp: new Date().toISOString(),\n    raw_product: item.raw_product,\n    raw_status: item.raw_status\n  }\n}];"
        },
        "name": "Prepare MC For Gemini S24_2",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -6736,
          5776
        ],
        "id": "ba577180-4b4c-4b27-82f7-d00284e034a6",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "const item = $input.item.json;\nconst config = $('SHOP_CONFIGURATION').item.json;\n\nreturn [{\n  json: {\n    shop_id: config.shop1_id,\n    shop_name: config.shop1_name,\n    product_id: item.product_id,\n    offer_id: item.offer_id,\n    title: item.title,\n    description: item.description,\n    link: item.link,\n    image_link: item.image_link,\n    additional_image_links: item.additional_image_links,\n    price: item.price,\n    currency: item.currency,\n    brand: item.brand,\n    gtin: item.gtin,\n    mpn: item.mpn,\n    identifier_exists: item.identifier_exists,\n    issues: item.issues || [],\n    issue_count: item.issue_count || 0,\n    approval_status: item.approval_status || [],\n    needs_optimization: item.issue_count > 0,\n    approval_types: item.approval_status.map(a => a.status || '') || [],\n    timestamp: new Date().toISOString(),\n    raw_product: item.raw_product,\n    raw_status: item.raw_status\n  }\n}];"
        },
        "name": "Prepare MC For Gemini DDC_2",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -6736,
          5984
        ],
        "id": "18bd47d0-8964-4de5-a28b-f8e10fba9780",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "shop1_id",
                "name": "shop1_id",
                "value": "5339977843",
                "type": "string"
              },
              {
                "id": "shop1_name",
                "name": "shop1_name",
                "value": "Siliconedolls24",
                "type": "string"
              },
              {
                "id": "shop2_id",
                "name": "shop2_id",
                "value": "124485833",
                "type": "string"
              },
              {
                "id": "shop2_name",
                "name": "shop2_name",
                "value": "DreamDoll",
                "type": "string"
              },
              {
                "id": "google_sheet_id",
                "name": "google_sheet_id",
                "value": "1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE",
                "type": "string"
              },
              {
                "id": "id-6",
                "name": "supabase_url",
                "value": "https://mxswxdnnjhhukovixzvb.supabase.co/functions/v1/database-access",
                "type": "string"
              },
              {
                "id": "id-7",
                "name": "supabase_key",
                "value": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im14c3d4ZG5uamhodWtvdml4enZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM3OTM4NDAsImV4cCI6MjA3OTM2OTg0MH0.60grD1zV6gF7Uf80N8CG8eiEwMw3zY5KR0Q-KKvvSWQ",
                "type": "string"
              }
            ]
          },
          "includeOtherFields": true,
          "options": {}
        },
        "name": "SHOP_CONFIGURATION",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -8624,
          4192
        ],
        "id": "23a751d0-04de-4733-ac70-b52782000f1e",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "waitBetweenTries": 3000,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "// ============================================================================\n// SMART PRIORITY SCORER\n// Berechnet welche Phase die h√∂chste Priorit√§t hat\n// ============================================================================\n\nconst analysis = $input.first().json;\nconst products = analysis.products_needing_fix || [];\nconst stats = {\n  adult_issues: analysis.adult_issues || 0,\n  image_issues: analysis.image_issues || 0,\n  text_issues: analysis.text_issues || 0,\n  gtin_issues: analysis.gtin_issues || 0,\n  mpn_issues: analysis.mpn_issues || 0,\n  brand_issues: analysis.brand_issues || 0,\n  merchant_issues: analysis.merchant_issues || 0,\n  country_issues: analysis.country_issues || 0\n};\n\n// ============================================================================\n// SEVERITY WEIGHTS (Google Impact Based)\n// ============================================================================\nconst severityWeights = {\n  'adult_flags': 10,      // Highest - Policy Violation\n  'multi_gtn_ean': 9,     // Critical - Required Field\n  'images': 7,            // High - Visibility Impact\n  'text': 6,              // High - Quality Impact\n  'merchant_quality': 5,  // Medium - Trust Issues\n  'multi_country': 4      // Medium - Reach Impact\n};\n\n// ============================================================================\n// BERECHNE SCORES PRO PHASE\n// ============================================================================\nconst phaseScores = {};\n\n// Count wie viele Produkte jede Phase brauchen\nproducts.forEach(product => {\n  if (!product.priority_tags) return;\n  \n  product.priority_tags.forEach(tag => {\n    if (!phaseScores[tag]) {\n      phaseScores[tag] = {\n        count: 0,\n        score: 0,\n        severity: severityWeights[tag] || 1\n      };\n    }\n    phaseScores[tag].count++;\n  });\n});\n\n// Berechne Final Score (count * severity)\nObject.keys(phaseScores).forEach(tag => {\n  phaseScores[tag].score = phaseScores[tag].count * phaseScores[tag].severity;\n});\n\n// ============================================================================\n// FINDE H√ñCHSTE PRIORIT√ÑT\n// ============================================================================\nlet recommendedPriority = null;\nlet maxScore = 0;\n\nObject.entries(phaseScores).forEach(([tag, data]) => {\n  if (data.score > maxScore) {\n    maxScore = data.score;\n    recommendedPriority = tag;\n  }\n});\n\n// Fallback wenn nichts gefunden\nif (!recommendedPriority && products.length > 0) {\n  recommendedPriority = 'adult_flags'; // Default\n}\n\n// ============================================================================\n// STATISTIKEN F√úR GEMINI\n// ============================================================================\nconst priorityRanking = Object.entries(phaseScores)\n  .map(([tag, data]) => ({\n    phase: tag,\n    products_affected: data.count,\n    severity: data.severity,\n    score: data.score\n  }))\n  .sort((a, b) => b.score - a.score);\n\nreturn [{\n  json: {\n    ...analysis,\n    \n    // NEU: Recommended Priority\n    recommended_priority: recommendedPriority,\n    recommended_score: maxScore,\n    \n    // Phase Scores f√ºr Gemini Decision\n    phase_scores: phaseScores,\n    priority_ranking: priorityRanking,\n    \n    // F√ºr Logging\n    scorer_run_at: new Date().toISOString()\n  }\n}];\n"
        },
        "id": "b8eb3bb2-e1ed-4e44-bb17-b342472e52fa",
        "name": "Smart Priority Scorer",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -8144,
          4368
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "// ============================================================================\n// PREPARE TEXT LOOP - FIX: Hole Produkte von Analyze Products2\n// ============================================================================\nconst decision = $input.first().json;  // Von Route by Priority\nconst analysis = $('Analyze Products2').first().json;  // Direkt von Analyze Products2\n\n// Hole Produkte aus Analyze Products2\nconst productsToFix = analysis.products_needing_fix || [];\nconst maxProducts = decision.products_to_process || productsToFix.length;\n\nconst config = $('SHOP_CONFIGURATION').first().json;\n\n// Shop info aus Decision oder Config\nconst shopId = decision.shop_id || config.shop1_id;\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\nconst productsSlice = productsToFix.slice(0, maxProducts);\n\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    description: product.description,\n    action: 'text',\n    priority: 'text',\n    index: index + 1,\n    total: productsSlice.length\n  }\n}));"
        },
        "id": "98f92ef7-2479-40ba-a45c-474c768ae959",
        "name": "Prepare Text Loop",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -6736,
          4272
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Current Approval Rate: {{ $json.current_approval_rate }}%.\nProducts needing fix: {{ $json.products_needing_fix.length }}.\nTotal products: {{ $json.total_products }}.\nApproved: {{ $json.approved_count }}.\nDisapproved: {{ $json.disapproved_count }}.",
          "hasOutputParser": true,
          "options": {
            "systemMessage": "Du bist der Merchant Center Entscheidungen- Agent. Du triffst die Entscheidungen was, wann, wie, mit was, und wo optimiert werden muss und optimiert werden wird!\n\nDu optimierst seit 15 Jahren Google Merchant Center Next und kennst alle Richtlinien, Policy, Qualit√§tsanforderungen, L√§nderregeln, H√§ndlerqualit√§tsfaktoren, GTIN/MPN-Regeln, Bild- und Textanforderungen sowie alle Merchant-Fehlercodes.\n\nDeine Aufgabe:\nEntscheide, welche Optimierungsphase als N√ÑCHSTES ausgef√ºhrt werden soll.\n\nInput:\nDu erh√§ltst eine aggregierte Analyse aus \"Analyze Products2\":\n- total_products\n- approved_count\n- disapproved_count\n- current_approval_rate\n- total_products_with_issues\n- gtin_missing_count\n- mpn_missing_count\n- identifier_issues_count\n- weitere Fehlerindikatoren, falls vorhanden\n\nErlaubte Werte f√ºr \"priority\":\n- \"adult_flags\"\n- \"images\"\n- \"text\"\n- \"merchant_quality\"\n- \"multi_country\"\n- \"multi_gtn_ean\"\n- \"H√§ndlerqualit√§t\"\n- \"Gemini_S24\"\n- \"Gemini_DDC\"\n\nRolling Window:\n- \"products_to_process\" = Anzahl Produkte, die in dieser Phase bearbeitet werden sollen (maximal 100).\n\nAntwortformat:\nGIB AUSSCHLIESSLICH FOLGENDES JSON ZUR√úCK:\n\n{\n  \"priority\": \"adult_flags|images|text|merchant_quality|multi_country|multi_gtn_ean|H√§ndlerqualit√§t|Gemini_S24|Gemini_DDC\",\n  \"products_to_process\": 100,\n  \"reasoning\": \"Kurze, klare Begr√ºndung auf Deutsch\"\n}\n\nRegeln:\n- Viele fehlende GTIN oder identifier_exists=false ‚Üí \"multi_gtn_ean\"\n- Viele Adult-Fehler ‚Üí \"adult_flags\"\n- Viele Bildfehler ‚Üí \"images\"\n- Viele Textfehler ‚Üí \"text\"\n- Viele Merchant-Quality-/Policy-/Versandfehler ‚Üí \"merchant_quality\"\n- Viele Multi-Country-/Destination-Fehler ‚Üí \"multi_country\"\n- H√§ndlerqualit√§tsprobleme ‚Üí \"H√§ndlerqualit√§t\"\n- Shop-spezifische Optimierung ‚Üí \"Gemini_S24\" oder \"Gemini_DDC\"\n- Keine anderen Strings verwenden\n- Keine zus√§tzlichen Felder zur√ºckgeben\n- Keine Erkl√§rtexte au√üerhalb des JSON zur√ºckgeben\n"
          }
        },
        "id": "aea84f7e-fbe0-4db4-bb41-f066f9a7ac0c",
        "name": "Gemini Daily Decision",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 3,
        "position": [
          -7680,
          4352
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "endpointUrl": "https://n8n.srv1091615.hstgr.cloud/mcp/c8608713-c52f-4e9f-9407-bb716a2d49ff",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
        "typeVersion": 1.2,
        "position": [
          -7776,
          4560
        ],
        "id": "82a9b3ad-b7df-4058-b5de-880e26d43198",
        "name": "MCP Client1"
      },
      {
        "parameters": {
          "url": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "supabaseApi",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequestTool",
        "typeVersion": 4.3,
        "position": [
          -7424,
          4496
        ],
        "id": "fef9571a-0265-4546-95c5-f34cca431961",
        "name": "Supabase RAG Context",
        "credentials": {
          "supabaseApi": {
            "id": "f1qLUdIsbZ2A3wdC",
            "name": "Supabase-MySQL"
          }
        }
      },
      {
        "parameters": {
          "schemaType": "manual",
          "inputSchema": "{\n  \"name\": \"Gemini Decision Parser (Bereinigt)\",\n  \"nodes\": [\n    {\n      \"id\": \"Gemini_Decision_Parser\",\n      \"name\": \"Gemini Decision Parser\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"typeVersion\": 2,\n      \"position\": [\n        520,\n        300\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{ $json[\\\"priority\\\"] }}\",\n              \"operation\": \"isNotEmpty\"\n            },\n            {\n              \"value1\": \"={{ $json[\\\"reasoning\\\"] }}\",\n              \"operation\": \"isNotEmpty\"\n            }\n          ],\n          \"number\": [\n            {\n              \"value1\": \"={{ $json[\\\"products_to_process\\\"] }}\",\n              \"operation\": \"larger\",\n              \"value2\": 0\n            }\n          ]\n        }\n      },\n      \"alwaysOutputData\": true,\n      \"continueOnFail\": true\n    },\n    {\n      \"id\": \"Decision_Parser_Schema\",\n      \"name\": \"Decision Parser Schema\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"typeVersion\": 2,\n      \"position\": [\n        760,\n        300\n      ],\n      \"parameters\": {\n        \"keepOnlySet\": true,\n        \"values\": {\n          \"json\": {\n            \"schema\": {\n              \"type\": \"object\",\n              \"properties\": {\n                \"priority\": {\n                  \"type\": \"string\",\n                  \"enum\": [\n                    \"adult_flags\",\n                    \"images\",\n                    \"text\",\n                    \"merchant_quality\",\n                    \"multi_country\",\n                    \"multi_gtn_ean\",\n                    \"haendlerqualitaet\",\n                    \"gemini_s24\",\n                    \"gemini_ddc\",\n                    \"gtin_ean\"\n                  ]\n                },\n                \"reasoning\": {\n                  \"type\": \"string\"\n                },\n                \"products_to_process\": {\n                  \"type\": \"number\"\n                }\n              },\n              \"required\": [\n                \"priority\",\n                \"reasoning\",\n                \"products_to_process\"\n              ]\n            }\n          }\n        }\n      },\n      \"alwaysOutputData\": true,\n      \"continueOnFail\": true\n    }\n  ],\n  \"connections\": {\n    \"Gemini Decision Parser\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Decision Parser Schema\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  ],\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"version\": 2\n}\n"
        },
        "id": "8c597f49-9913-45db-a2ad-4703b7038af3",
        "name": "Decision_Parser",
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.3,
        "position": [
          -7488,
          4672
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash",
          "options": {}
        },
        "id": "c0920c34-1cc4-412f-8fc8-cad334e5f0f5",
        "name": "Decision_Chat",
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -7920,
          4560
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "sessionIdType": "={\n  \"sessionIdType\": \"customKey\", \n  \"key\": \"={{ $('SHOP_CONFIGURATION').first().json.shop_id }}_gemini_decisions\"\n}",
          "sessionKey": "",
          "tableName": "gemini_decisions",
          "contextWindowLength": 5000
        },
        "id": "a217c71b-534b-4989-9a87-abee5dade736",
        "name": "Postgres Gemini_Decisions",
        "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
        "typeVersion": 1.3,
        "position": [
          -7632,
          4560
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "postgres": {
            "id": "pIp690wi4X79QCKb",
            "name": "Postgres account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "403ce6f0-4c58-4f50-8495-f458e6339fb1",
                "leftValue": "={{ $json.error }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty",
                  "singleValue": true
                }
              },
              {
                "id": "7842d907-c4e8-48c4-b883-243baa6a0d8d",
                "leftValue": "={{ $json.index }}",
                "rightValue": "",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty",
                  "singleValue": true
                }
              },
              {
                "id": "58e94ee6-f472-4e9a-a65b-7e7aaf2bf3a2",
                "leftValue": "shop_name",
                "rightValue": "={{ $json.shop_name }}",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              },
              {
                "id": "4412ba1d-1f8a-41a7-a9a4-ed3a6521573f",
                "leftValue": "error",
                "rightValue": "={{ $json.error }}",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              },
              {
                "id": "53e205c6-bf84-49af-b043-1e149634ea19",
                "leftValue": "title",
                "rightValue": "={{ $json.title }}",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              },
              {
                "id": "648c93b9-3555-4e82-af05-34f247e5c8d3",
                "leftValue": "originalProdukt",
                "rightValue": "={{ $json.originalProduct }}",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              },
              {
                "id": "1ec1efa9-49b5-4657-9308-cac1a5002923",
                "leftValue": "action",
                "rightValue": "={{ $json.action }}",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              },
              {
                "id": "e9c242ef-e36b-45da-9fb2-6d4ee3fee517",
                "leftValue": "prioritys",
                "rightValue": "={{ $json.priority }}",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          -5552,
          4256
        ],
        "id": "d633ce1b-63b4-4ae8-a366-3a8b3254349c",
        "name": "Error Parser",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "b2c98774-f1a8-4f7a-b97b-2fccd72d2150",
                "name": "json",
                "value": "={\n  \"schema\": {\n    \"type\": \"object\",\n    \"properties\": {\n      \"error_type\": {\n        \"type\": \"string\",\n        \"enum\": [\n          \"adult_error\",\n          \"image_error\",\n          \"text_error\",\n          \"merchant_quality_error\",\n          \"multi_country_error\",\n          \"multi_gtn_ean_error\",\n          \"haendlerqualitaet_error\",\n          \"gemini_s24_error\",\n          \"gemini_ddc_error\"\n        ]\n      },\n      \"reason\": { \"type\": \"string\" },\n      \"product_id\": { \"type\": \"string\" },\n      \"source_phase\": { \"type\": \"string\" }\n    },\n    \"required\": [\"error_type\", \"reason\"]\n  }\n}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -5504,
          4992
        ],
        "id": "d4107f3b-bf0c-4d6e-a495-83b8d2d42245",
        "name": "Error Parser Schema",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "d22bbe90-1182-4ed6-a91a-e7c69d4dd539",
                      "leftValue": "adult_error",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "adult_error"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "1a4dd5f7-6f40-4dc6-b8bd-6a54ac99818b",
                      "leftValue": "image_error",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "image_error"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "4b723ded-1a79-49ac-a54b-1b975869d4ab",
                      "leftValue": "text_error",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "text_error"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "427b489b-7a24-4f72-b727-d6884b1889f4",
                      "leftValue": "merchant_quality_error",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "merchant_quality_error"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "41c2e24b-6318-44bc-9339-3a6f073e2c79",
                      "leftValue": "multi_country_error",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "multi_country_error"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "ac751250-d719-4d7d-92b3-63ff5e91d46d",
                      "leftValue": "multi_gtn_ean_error",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "multi_gtn_ean_error"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "c84a954c-f142-4a34-b7ce-9da57980d801",
                      "leftValue": "haendlerqualitaet_error",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "haendlerqualitaet_error"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "fa8c67c5-5173-4f10-b19f-40e9b65dfc28",
                      "leftValue": "gemini_s24_error",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "gemini_s24_error"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "12c04466-9e30-469f-95ec-d310d90a1b30",
                      "leftValue": "gemini_ddc_error",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "gemini_ddc_error"
              }
            ]
          },
          "options": {
            "fallbackOutput": "extra"
          }
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.4,
        "position": [
          -4976,
          4832
        ],
        "id": "9e51d2b1-e4e3-491b-8b87-102e6259c594",
        "name": "Error Router",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "d22bbe90-1182-4ed6-a91a-e7c69d4dd539",
                      "leftValue": "={{$json[\"fix_type\"]}}",
                      "rightValue": "fix_adult",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "fix_adult"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "1a4dd5f7-6f40-4dc6-b8bd-6a54ac99818b",
                      "leftValue": "={{$json[\"fix_type\"]}}",
                      "rightValue": "fix_image",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "fix_image"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "4b723ded-1a79-49ac-a54b-1b975869d4ab",
                      "leftValue": "={{$json[\"fix_type\"]}}",
                      "rightValue": "fix_text",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "fix_text"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "427b489b-7a24-4f72-b727-d6884b1889f4",
                      "leftValue": "={{$json[\"fix_type\"]}}",
                      "rightValue": "fix_merchant_quality",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "fix_merchant_quality"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "41c2e24b-6318-44bc-9339-3a6f073e2c79",
                      "leftValue": "={{$json[\"fix_type\"]}}",
                      "rightValue": "fix_multi_country",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "fix_multi_country"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "ac751250-d719-4d7d-92b3-63ff5e91d46d",
                      "leftValue": "={{$json[\"fix_type\"]}}",
                      "rightValue": "fix_multi_gtn_ean",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "fix_multi_gtn_ean"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "c84a954c-f142-4a34-b7ce-9da57980d801",
                      "leftValue": "={{$json[\"fix_type\"]}}",
                      "rightValue": "fix_haendlerqualitaet",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "fix_haendlerqualitaet"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "fa8c67c5-5173-4f10-b19f-40e9b65dfc28",
                      "leftValue": "={{$json[\"fix_type\"]}}",
                      "rightValue": "fix_gemini_s24",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "fix_gemini_s24"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 3
                  },
                  "conditions": [
                    {
                      "id": "12c04466-9e30-469f-95ec-d310d90a1b30",
                      "leftValue": "={{$json[\"fix_type\"]}}",
                      "rightValue": "fix_gemini_ddc",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "fix_gemini_ddc"
              }
            ]
          },
          "options": {
            "fallbackOutput": "extra"
          }
        },
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.4,
        "position": [
          -4736,
          4832
        ],
        "id": "59f08941-2740-4178-a412-84acc6a704bb",
        "name": "Fix Errors Router",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "c24e863d-0d5d-4f0f-a9bb-67c4d905368e",
                "name": "image_url",
                "value": "={{$json[\"image_url\"]}}",
                "type": "string"
              },
              {
                "id": "089fc571-6427-4371-9faa-fb87c42c2995",
                "name": "details",
                "value": "={{$json[\"details\"]}}",
                "type": "string"
              },
              {
                "id": "9ebe7e77-259b-4821-8fe8-dfa136cfe99a",
                "name": "reason",
                "value": "={{$json[\"reason\"]}}",
                "type": "string"
              },
              {
                "id": "908d4e7c-edb0-43ef-a109-66b444224b8b",
                "name": "new_value ",
                "value": "={{$json[\"new_value\"]}}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -3616,
          4080
        ],
        "id": "2a413d7c-ad79-4e45-923d-5f35ba97612a",
        "name": "Fix image (adult)",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "c24e863d-0d5d-4f0f-a9bb-67c4d905368e",
                "name": "field",
                "value": "=={{$json[\"field\"]}}",
                "type": "string"
              },
              {
                "id": "089fc571-6427-4371-9faa-fb87c42c2995",
                "name": "new_value",
                "value": "=={{$json[\"new_value\"]}}",
                "type": "string"
              },
              {
                "id": "9ebe7e77-259b-4821-8fe8-dfa136cfe99a",
                "name": "reason",
                "value": "={{$json[\"reason\"]}}",
                "type": "string"
              },
              {
                "id": "f85ffb74-6889-401a-b713-27e2aad4ae65",
                "name": "details",
                "value": "={{$json[\"details\"]}}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -3616,
          4272
        ],
        "id": "f1883e4c-d6a1-4a19-b3bd-b0f7e5818a5b",
        "name": "Fix text",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "amount": 2
        },
        "id": "91ead233-4bc3-4b21-998b-d86e38adf3ab",
        "name": "Rate Limiting_Adult",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          -5232,
          3888
        ],
        "webhookId": "77aa4d35-4b1e-410d-9f22-138e57a732c7",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "c24e863d-0d5d-4f0f-a9bb-67c4d905368e",
                "name": "field",
                "value": "=={{$json[\"field\"]}}",
                "type": "string"
              },
              {
                "id": "089fc571-6427-4371-9faa-fb87c42c2995",
                "name": "new_value",
                "value": "=={{$json[\"new_value\"]}}",
                "type": "string"
              },
              {
                "id": "9ebe7e77-259b-4821-8fe8-dfa136cfe99a",
                "name": "reason",
                "value": "={{$json[\"reason\"]}}",
                "type": "string"
              },
              {
                "id": "f85ffb74-6889-401a-b713-27e2aad4ae65",
                "name": "details",
                "value": "={{$json[\"details\"]}}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -3616,
          4480
        ],
        "id": "e217eb47-8346-4e31-a8e8-6ac485fae98e",
        "name": "Fix merchant",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "c24e863d-0d5d-4f0f-a9bb-67c4d905368e",
                "name": "field",
                "value": "=={{$json[\"field\"]}}",
                "type": "string"
              },
              {
                "id": "089fc571-6427-4371-9faa-fb87c42c2995",
                "name": "new_value",
                "value": "=={{$json[\"new_value\"]}}",
                "type": "string"
              },
              {
                "id": "9ebe7e77-259b-4821-8fe8-dfa136cfe99a",
                "name": "reason",
                "value": "={{$json[\"reason\"]}}",
                "type": "string"
              },
              {
                "id": "f85ffb74-6889-401a-b713-27e2aad4ae65",
                "name": "details",
                "value": "={{$json[\"details\"]}}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -3616,
          4656
        ],
        "id": "55c11c99-2437-49e1-b6d2-c43a83cb0a84",
        "name": "Fix Multi_Country",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "c24e863d-0d5d-4f0f-a9bb-67c4d905368e",
                "name": "field",
                "value": "=={{$json[\"field\"]}}",
                "type": "string"
              },
              {
                "id": "089fc571-6427-4371-9faa-fb87c42c2995",
                "name": "new_value",
                "value": "=={{$json[\"new_value\"]}}",
                "type": "string"
              },
              {
                "id": "9ebe7e77-259b-4821-8fe8-dfa136cfe99a",
                "name": "reason",
                "value": "={{$json[\"reason\"]}}",
                "type": "string"
              },
              {
                "id": "f85ffb74-6889-401a-b713-27e2aad4ae65",
                "name": "details",
                "value": "={{$json[\"details\"]}}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -3632,
          5328
        ],
        "id": "ae6d61fd-d248-44fb-9ebf-3c134e5c60a0",
        "name": "Fix Multi_GTN/EAN",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "c24e863d-0d5d-4f0f-a9bb-67c4d905368e",
                "name": "field",
                "value": "=={{$json[\"field\"]}}",
                "type": "string"
              },
              {
                "id": "089fc571-6427-4371-9faa-fb87c42c2995",
                "name": "new_value",
                "value": "=={{$json[\"new_value\"]}}",
                "type": "string"
              },
              {
                "id": "9ebe7e77-259b-4821-8fe8-dfa136cfe99a",
                "name": "reason",
                "value": "={{$json[\"reason\"]}}",
                "type": "string"
              },
              {
                "id": "f85ffb74-6889-401a-b713-27e2aad4ae65",
                "name": "details",
                "value": "={{$json[\"details\"]}}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -3632,
          5520
        ],
        "id": "c3a2599b-5419-4710-a356-bcabdde0e40e",
        "name": "Fix Multi_H√§ndler_Qualit√§t",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "c24e863d-0d5d-4f0f-a9bb-67c4d905368e",
                "name": "field",
                "value": "=={{$json[\"field\"]}}",
                "type": "string"
              },
              {
                "id": "089fc571-6427-4371-9faa-fb87c42c2995",
                "name": "new_value",
                "value": "=={{$json[\"new_value\"]}}",
                "type": "string"
              },
              {
                "id": "9ebe7e77-259b-4821-8fe8-dfa136cfe99a",
                "name": "reason",
                "value": "={{$json[\"reason\"]}}",
                "type": "string"
              },
              {
                "id": "f85ffb74-6889-401a-b713-27e2aad4ae65",
                "name": "details",
                "value": "={{$json[\"details\"]}}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -3632,
          5776
        ],
        "id": "3451b6e5-7c4a-4f62-9d3b-2daa378f546b",
        "name": "Fix Multi_S24",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "c24e863d-0d5d-4f0f-a9bb-67c4d905368e",
                "name": "field",
                "value": "=={{$json[\"field\"]}}",
                "type": "string"
              },
              {
                "id": "089fc571-6427-4371-9faa-fb87c42c2995",
                "name": "new_value",
                "value": "=={{$json[\"new_value\"]}}",
                "type": "string"
              },
              {
                "id": "9ebe7e77-259b-4821-8fe8-dfa136cfe99a",
                "name": "reason",
                "value": "={{$json[\"reason\"]}}",
                "type": "string"
              },
              {
                "id": "f85ffb74-6889-401a-b713-27e2aad4ae65",
                "name": "details",
                "value": "={{$json[\"details\"]}}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -3632,
          5984
        ],
        "id": "cdd5fad4-2f3a-43bc-a62c-21621afc0b6e",
        "name": "Fix Multi_DDC",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "c24e863d-0d5d-4f0f-a9bb-67c4d905368e",
                "name": "new_value",
                "value": "={{$json[\"new_value\"]}}",
                "type": "string"
              },
              {
                "id": "089fc571-6427-4371-9faa-fb87c42c2995",
                "name": "field",
                "value": "={{$json[\"field\"]}}",
                "type": "string"
              },
              {
                "id": "9ebe7e77-259b-4821-8fe8-dfa136cfe99a",
                "name": "reason",
                "value": "={{$json[\"reason\"]}}",
                "type": "string"
              },
              {
                "id": "3522707f-aa20-4af2-ad2f-f9535d393df6",
                "name": "details",
                "value": "={{$json[\"details\"]}}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -3616,
          3888
        ],
        "id": "9248351c-aba3-4085-872e-c7949e5e8d3c",
        "name": "Fix Adult",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "0c4d06f3-3700-4dc7-9458-db784bcadcb0",
                "name": "updated_product",
                "value": "=={{ { ...$json, [ $json[\"field\"] ]: $json[\"new_value\"] } }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -3376,
          3888
        ],
        "id": "95df1498-1e2a-4579-969f-9d9155b4484f",
        "name": "Merge Fix with Product_Adult",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "0c4d06f3-3700-4dc7-9458-db784bcadcb0",
                "name": "updated_product",
                "value": "=={{ { ...$json, [ $json[\"field\"] ]: $json[\"new_value\"] } }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -3376,
          4064
        ],
        "id": "093fbcaf-a89d-4f3d-8207-006573cca18c",
        "name": "Merge Fix with Product_Image",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "0c4d06f3-3700-4dc7-9458-db784bcadcb0",
                "name": "updated_product",
                "value": "=={{ { ...$json, [ $json[\"field\"] ]: $json[\"new_value\"] } }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -3376,
          4256
        ],
        "id": "57168b00-1982-4cad-b099-1ca2ffe66e3f",
        "name": "Merge Fix with Product_Text",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "0c4d06f3-3700-4dc7-9458-db784bcadcb0",
                "name": "updated_product",
                "value": "=={{ { ...$json, [ $json[\"field\"] ]: $json[\"new_value\"] } }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -3376,
          4464
        ],
        "id": "b13178c9-421d-4a40-9b3c-6e0744a66e8d",
        "name": "Merge Fix with Product_Merchant",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "0c4d06f3-3700-4dc7-9458-db784bcadcb0",
                "name": "updated_product",
                "value": "=={{ { ...$json, [ $json[\"field\"] ]: $json[\"new_value\"] } }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -3376,
          4640
        ],
        "id": "9bf4abc6-fc09-4706-8e69-e640e65f534a",
        "name": "Merge Fix with Product_Country",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "0c4d06f3-3700-4dc7-9458-db784bcadcb0",
                "name": "updated_product",
                "value": "=={{ { ...$json, [ $json[\"field\"] ]: $json[\"new_value\"] } }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -3392,
          5312
        ],
        "id": "4349118d-4f24-49b2-803d-fc21b3d2ea61",
        "name": "Merge Fix with Product_GTNI/EAN",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "0c4d06f3-3700-4dc7-9458-db784bcadcb0",
                "name": "updated_product",
                "value": "=={{ { ...$json, [ $json[\"field\"] ]: $json[\"new_value\"] } }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -3392,
          5504
        ],
        "id": "a3d06df3-261b-4b8a-a5e1-08b1a5427f7c",
        "name": "Merge Fix with Product_H√§ndler_Quali",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "0c4d06f3-3700-4dc7-9458-db784bcadcb0",
                "name": "updated_product",
                "value": "=={{ { ...$json, [ $json[\"field\"] ]: $json[\"new_value\"] } }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -3392,
          5760
        ],
        "id": "979c4597-5b01-4cbd-8b14-16eb713b0a06",
        "name": "Merge Fix with Product_S24",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "0c4d06f3-3700-4dc7-9458-db784bcadcb0",
                "name": "updated_product",
                "value": "=={{ { ...$json, [ $json[\"field\"] ]: $json[\"new_value\"] } }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -3392,
          5968
        ],
        "id": "c7eca4d3-1b04-499a-abd4-f127addef50d",
        "name": "Merge Fix with Product_DDC",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $('SHOP_CONFIGURATION').item.json.shop1_id }}/products/{{ $json.product_id }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "adult",
                "value": "true"
              },
              {
                "name": "ageGroup",
                "value": "adult"
              },
              {
                "name": "googleProductCategory",
                "value": "778"
              },
              {
                "name": "updated_product",
                "value": "=={{$json[\"updated_product\"]}}\n"
              }
            ]
          },
          "options": {}
        },
        "id": "4135fa04-596a-4ceb-9493-e04e3d421da2",
        "name": "Update Product FIX Adult Flag",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -3120,
          3888
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $('SHOP_CONFIGURATION').item.json.shop1_id }}/products/{{ $json.product.id }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "imageLink",
                "value": "={{ $json.product.imageLink }}"
              },
              {
                "name": "updated_product",
                "value": "=={{ $json[\"updated_product\"] }}"
              }
            ]
          },
          "options": {}
        },
        "id": "8513eaf4-d6ff-46bb-81fd-00be374a7bb6",
        "name": "Update Product FIX_Images",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          -3120,
          4064
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $('SHOP_CONFIGURATION').item.json.shop1_id }}/products/{{ $json.product.id }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "title",
                "value": "={{ $json.product.title }}"
              },
              {
                "name": "description",
                "value": "=={{ $json.product.description }}"
              }
            ]
          },
          "options": {}
        },
        "id": "82d10836-5cde-4b40-8e42-a36b8ddee5b9",
        "name": "Update Product FIX_Text",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          -3120,
          4256
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/shippingsettings",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "value": "=={{ $json[\"updated_product\"] }}"
              }
            ]
          },
          "options": {}
        },
        "name": "Update_Product_FIX_Merchant Settings",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -3120,
          4464
        ],
        "id": "292b28f7-9d5a-4b94-a289-50c721be678f",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/products/{{ $json.product_id }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "value": "=={{ $json[\"updated_product\"] }}"
              }
            ]
          },
          "options": {}
        },
        "name": "Update_Product_FIX_Country Feeds",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -3120,
          4640
        ],
        "id": "98b4a7fd-417d-4a23-90df-17572e97752d",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/products/{{ $json.product_id }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "value": "=={{ $json[\"updated_product\"] }}"
              }
            ]
          },
          "options": {}
        },
        "name": "Update_Product_FIX_H√§ndlerqualit√§t",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -3136,
          5504
        ],
        "id": "7193df7b-644a-4e9d-bc68-bcadb90f2e31",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/products/{{ $json.product_id }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "value": "=={{ $json[\"updated_product\"] }}"
              }
            ]
          },
          "options": {}
        },
        "name": "Update GTN/EAN1",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -3136,
          5312
        ],
        "id": "3f32c008-4e86-40be-8225-d05abe7d6875",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/products/{{ $json.product_id }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "value": "=={{ $json[\"updated_product\"] }}"
              }
            ]
          },
          "options": {}
        },
        "name": "Update_Prod_FIX_S24",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -3136,
          5760
        ],
        "id": "afb595ab-0fee-4814-b811-37e5109bb8d1",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "=https://www.googleapis.com/content/v2.1/{{ $json.shop_id }}/products/{{ $json.product_id }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "value": "=={{ $json[\"updated_product\"] }}"
              }
            ]
          },
          "options": {}
        },
        "name": "Update_Prod_FIX_DDC",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -3136,
          5968
        ],
        "id": "934e81fc-810a-4002-aa14-9ff8f733b533",
        "retryOnFail": true,
        "alwaysOutputData": true,
        "credentials": {
          "googleApi": {
            "id": "ZyZC3w7hfJ55uqot",
            "name": "Google_mechtech-merchant"
          },
          "googleOAuth2Api": {
            "id": "OFpjIV18thb8kzda",
            "name": "Google Merchant_Center"
          }
        },
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "amount": 3
        },
        "name": "Rate Limiting GTN/EAN",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          -5232,
          5264
        ],
        "id": "36d282f1-12b1-4bf8-a319-d56583d034d9",
        "webhookId": "rate-limit-country-webhook",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "// ============================================================================\n// PREPARE GTIN/EAN LOOP - F√ºr Google Merchant Center GTIN/EAN Updates\n// ============================================================================\nconst inputData = $input.first().json;\nconst config = $('SHOP_CONFIGURATION').first().json;\n\n// ‚úÖ Hole Products von Analyze Products2:\nconst analysis = $('Analyze Products2').first().json;\nconst productsToFix = analysis.products_needing_fix || [];\n\n// ‚úÖ Hole Priority und Max Products von Gemini Decision:\nconst decision = $('Gemini Daily Decision').first().json.output || {};\nconst maxProducts = decision.products_to_process || productsToFix.length;\n\n// ‚úÖ Shop ID von Decision ODER Config:\nconst shopId = decision.shop_id || config.shop1_id;\n\n// ‚úÖ Shop Info aus Config:\nconst shopName = shopId === config.shop1_id ? config.shop1_name : config.shop2_name;\nconst shopUrl = shopId === config.shop1_id ? config.shop1_url : config.shop2_url;\n\n// Filtere nur Products die GTIN/EAN Updates brauchen\nconst productsNeedingGtinEan = productsToFix.filter(product => {\n  return product.needs_gtin_ean === true || \n         product.missing_gtin === true || \n         product.missing_mpn === true ||\n         product.missing_brand === true ||\n         (product.priority && product.priority === 'multi_gtn_ean');\n});\n\n// Slice f√ºr Batch Processing\nconst productsSlice = productsNeedingGtinEan.slice(0, maxProducts);\n\n// ‚úÖ Erstelle Items mit GTIN/EAN Daten:\nreturn productsSlice.map((product, index) => ({\n  json: {\n    shop_id: shopId,\n    shop_name: shopName,\n    shop_url: shopUrl,  // ‚úÖ BEHALTEN!\n    product_id: product.productId || product.id,\n    offer_id: product.offerId,\n    title: product.title,\n    \n    // ‚úÖ GTIN/EAN Daten - ALLE Fallbacks!\n    gtin: product.gtin || product.gtin_from_gemini || product.recommended_gtin || '',\n    mpn: product.mpn || product.mpn_from_gemini || product.recommended_mpn || '',\n    brand: product.brand || product.brand_from_gemini || product.recommended_brand || '',\n    \n    // ‚úÖ NEU: Google Standard Fields\n    identifier_exists: !!(\n      product.gtin || product.gtin_from_gemini || product.recommended_gtin ||\n      product.mpn || product.mpn_from_gemini || product.recommended_mpn\n    ),\n    \n    // ‚úÖ NEU: Lookup Flag\n    needs_gtin_lookup: !(product.gtin || product.gtin_from_gemini) && \n                       !(product.mpn || product.mpn_from_gemini),\n    \n    action: 'gtin_ean',\n    priority: 'multi_gtn_ean',\n    index: index + 1,\n    total: productsSlice.length,\n    timestamp: new Date().toISOString()  // ‚úÖ NEU\n  }\n}));"
        },
        "name": "Prepare GTN/EAN_Loop",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -6736,
          5296
        ],
        "id": "e126a6ee-89db-4e78-9b5e-eb930e9f1cd9",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "conditions": {
            "boolean": [
              {
                "value1": "={{ $json.needs_gtin_lookup }}"
              }
            ]
          }
        },
        "id": "15a73a3b-d231-48c1-8782-744f556b66d3",
        "name": "Route: GTIN Lookup Needed?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 1,
        "position": [
          -6272,
          5040
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "const response = $input.item.json;\nconst statusCode = response.statusCode || response.status;\nconst isSuccess = (statusCode >= 200 && statusCode < 300) || response.id;\n\n// ‚úÖ Google Merchant Center Error Format\nconst errorDetails = !isSuccess ? {\n  error_code: statusCode,\n  error_message: response.body?.error?.message || response.error?.message || response.message || 'Unknown error',\n  error_type: response.body?.error?.errors?.[0]?.reason || 'unknown',\n  retry_recommended: [429, 500, 503].includes(statusCode)\n} : null;\n\nreturn [{\n  json: {\n    product_id: $('Prepare GTN/EAN_Loop').first().json.product_id,\n    offer_id: $('Prepare GTN/EAN_Loop').first().json.offer_id,\n    update_status: isSuccess ? 'success' : 'failed',\n    status_code: statusCode,\n    \n    // ‚úÖ BEHALTE wenn Build PATCH Body existiert:\n    updated_fields: $('Build PATCH Body')?.first()?.json?.changes_count || 0,\n    \n    // ‚úÖ Changed Fields\n    updated_gtin: $('Prepare GTN/EAN_Loop').first().json.gtin || null,\n    updated_mpn: $('Prepare GTN/EAN_Loop').first().json.mpn || null,\n    updated_brand: $('Prepare GTN/EAN_Loop').first().json.brand || null,\n    \n    // ‚úÖ Error Details (f√ºr Switch Node!)\n    error: errorDetails,\n    \n    // Metadata\n    timestamp: new Date().toISOString(),\n    phase: 'gtin_ean',\n    shop_id: $('Prepare GTN/EAN_Loop').first().json.shop_id,\n    \n    // ‚úÖ BEHALTE Full Response f√ºr Debugging\n    response: response\n  }\n}];"
        },
        "id": "83ec61f0-7a43-46fb-b5e8-4bd3a87d010d",
        "name": "Log Update Res_GTNI",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -6000,
          5280
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "agent": "reActAgent",
          "text": "=Product: {{ $json.title }}\nBrand: {{ $json.extracted_brand || $json.brand || 'Unknown' }}\nManufacturer: {{ $json.extracted_manufacturer || 'Unknown' }}\nProduct URL: {{ $json.product_url || '' }}\nImage URL: {{ $json.image_link || '' }}\nDescription: {{ $json.description || '' }}\n\nFind valid manufacturer product identifiers (GTIN, EAN, UPC, MPN) for this product.",
          "options": {
            "humanMessageTemplate": "Recherchiere die Artikelnummern der Hersteller aus dem Internet und gib mir alle Artikelnummern der Hersteller, die Google im Google Merchant  Center erwartet oder  akzeptiert aus dem Output Parser zur√ºck. Nutze f√ºr die Artikel-nummern Suche die Informationen aus dem Google Merchant Center Artikel-Namen, Artikel-Bezeichnung, Artikel Link, Artikel- Bilder-URL und Artikelbild; Artikelbeschreibung, um den Herstellernamen Hersteller Firmen-Name oder die Marke ermitteln zu k√∂nnen! falls keine weiteren Informationen verf√ºgbar sind, gebe leere Felder zur√ºck."
          }
        },
        "id": "4d19d138-16e5-4a52-ada7-300bd4d51228",
        "name": "Find Missing GTIN",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1,
        "position": [
          -6640,
          4880
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput",
        "notes": "Dieser Agent sucht GTNI / EAN Nummern von Herstellern f√ºr das Google Merchant Center Next f√ºr S24 & DDC Shops"
      },
      {
        "parameters": {
          "jsonSchemaExample": "{\n  \"jsonSchema\": {\n    \"type\": \"object\",\n    \"properties\": {\n      \"gtin\": {\n        \"type\": [\"string\", \"null\"],\n        \"description\": \"GTIN/EAN/UPC code (8, 10, 12, 13, or 14 digits) or null if not found\"\n      },\n      \"mpn\": {\n        \"type\": [\"string\", \"null\"],\n        \"description\": \"Manufacturer Part Number or null if not found\"\n      },\n      \"identifier_type\": {\n        \"type\": \"string\",\n        \"enum\": [\"GTIN-8\", \"GTIN-12\", \"GTIN-13\", \"GTIN-14\", \"UPC\", \"EAN\", \"ISBN-10\", \"ISBN-13\", \"JAN\", \"ITF-14\", \"CCC\", \"CCIC\", \"MPN\"],\n        \"description\": \"Type of identifier found\"\n      },\n      \"source\": {\n        \"type\": \"string\",\n        \"description\": \"URL or source where identifier was found\"\n      },\n      \"confidence\": {\n        \"type\": \"number\",\n        \"minimum\": 0,\n        \"maximum\": 100,\n        \"description\": \"Confidence score 0-100\"\n      },\n      \"error\": {\n        \"type\": [\"string\", \"null\"],\n        \"description\": \"Error message if identifier not found, null otherwise\"\n      }\n    },\n    \"required\": [\"gtin\", \"mpn\", \"identifier_type\", \"source\", \"confidence\"]\n  }\n}"
        },
        "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
        "typeVersion": 1.3,
        "position": [
          -6480,
          5136
        ],
        "id": "217d9801-c359-46bd-96ae-eed722349244",
        "name": "GTNI_Parser",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "1DzEcE22sizLdLIvv2v4ObdcRPFdNIey7nQHJJPrHge8",
            "mode": "list",
            "cachedResultName": "MECHTECH_Merchant_Center_Producer_Leads",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1DzEcE22sizLdLIvv2v4ObdcRPFdNIey7nQHJJPrHge8/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 333943058,
            "mode": "list",
            "cachedResultName": "MECHTECH_Producer_GTNI/EAN",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1DzEcE22sizLdLIvv2v4ObdcRPFdNIey7nQHJJPrHge8/edit#gid=333943058"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Datum": "={{ $today }}",
              "Produktname": "={{ $json.title }}",
              "Herstellernummer MPN/": "={{ $json.output.mpn || 'Not found' }}",
              "EAN/GTIN": "={{ $json.output.gtin || 'Not found' }}",
              "Produkt URL": "={{ $json.product_url || '' }}",
              "Kategorie": "={{ $json.product_type || '' }}",
              "Notizen": "={{ $json.output.error || 'No identifier found' }}",
              "Datum der Erfassung": "={{ $now }}",
              "www.siliconedolls24.com": "={{ $('SHOP_CONFIGURATION').item.json.shop1_name }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "Datum",
                "displayName": "Datum",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Produktname",
                "displayName": "Produktname",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Herstellernummer MPN/",
                "displayName": "Herstellernummer MPN/",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "EAN/GTIN",
                "displayName": "EAN/GTIN",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Produkt URL",
                "displayName": "Produkt URL",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "www.siliconedolls24.com",
                "displayName": "www.siliconedolls24.com",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "www.dreamdoll.de",
                "displayName": "www.dreamdoll.de",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Kategorie",
                "displayName": "Kategorie",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Notizen",
                "displayName": "Notizen",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Datum der Erfassung",
                "displayName": "Datum der Erfassung",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -5232,
          4864
        ],
        "id": "699e8124-db31-4044-aaa4-b8c25dbb0b5e",
        "name": "Google Sheets1",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "cztAb4CKfRPRO8KX",
            "name": "Google Sheets account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "mode": "runOnceForEachItem",
          "jsCode": "// ============================================================================\n// EXTRACT MANUFACTURER INFO - Extract brand/manufacturer from product data\n// ============================================================================\nconst product = $input.item.json;\n\n// Helper function to extract brand from various sources\nfunction extractBrand(product) {\n  // 1. Check if brand already exists\n  if (product.brand && product.brand.trim()) {\n    return product.brand.trim();\n  }\n  \n  // 2. Try to extract from title\n  const title = product.title || '';\n  const titleWords = title.split(/[\\s-]+/);\n  \n  // Common brand patterns in title (first word often brand)\n  if (titleWords.length > 0 && titleWords[0].length > 2) {\n    const potentialBrand = titleWords[0];\n    // Filter out common non-brand words\n    const excludeWords = ['the', 'a', 'an', 'new', 'used', 'original', 'genuine'];\n    if (!excludeWords.includes(potentialBrand.toLowerCase())) {\n      return potentialBrand;\n    }\n  }\n  \n  // 3. Try to extract from URL\n  const url = product.shop_url || product.link || '';\n  const urlMatch = url.match(/\\/([a-zA-Z0-9-]+)\\//g);\n  if (urlMatch && urlMatch.length > 0) {\n    // Often brand is in URL path\n    const urlParts = urlMatch.map(part => part.replace(/\\//g, ''));\n    for (const part of urlParts) {\n      if (part.length > 2 && !['product', 'item', 'shop', 'store'].includes(part.toLowerCase())) {\n        return part;\n      }\n    }\n  }\n  \n  return null;\n}\n\n// Helper function to extract manufacturer info from description\nfunction extractManufacturerFromDescription(description) {\n  if (!description) return null;\n  \n  const patterns = [\n    /manufacturer[:\\s]+([a-zA-Z0-9\\s-]+)/i,\n    /brand[:\\s]+([a-zA-Z0-9\\s-]+)/i,\n    /made by[:\\s]+([a-zA-Z0-9\\s-]+)/i,\n    /produced by[:\\s]+([a-zA-Z0-9\\s-]+)/i\n  ];\n  \n  for (const pattern of patterns) {\n    const match = description.match(pattern);\n    if (match && match[1]) {\n      return match[1].trim().split(/[,\\.\\n]/)[0];\n    }\n  }\n  \n  return null;\n}\n\n// Extract brand/manufacturer\nconst extractedBrand = extractBrand(product);\nconst descriptionBrand = extractManufacturerFromDescription(product.description || '');\n\n// Prepare search context for GTIN lookup\nconst searchContext = {\n  title: product.title || '',\n  brand: extractedBrand || descriptionBrand || product.brand || 'Unknown',\n  mpn: product.mpn || '',\n  url: product.shop_url || product.link || '',\n  image_url: product.image_link || product.imageLink || '',\n  description_snippet: (product.description || '').substring(0, 200)\n};\n\nreturn {\n  json: {\n    ...product,\n    extracted_brand: extractedBrand,\n    description_brand: descriptionBrand,\n    final_brand: extractedBrand || descriptionBrand || product.brand || null,\n    search_context: searchContext,\n    extraction_timestamp: new Date().toISOString()\n  }\n};"
        },
        "id": "5f4619cf-12c9-4086-bceb-1ae4595debac",
        "name": "Extract Manufacturer Info",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -6272,
          5280
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "// ============================================================================\n// BUILD PATCH BODY - Google Merchant Center GTIN/EAN Update\n// ============================================================================\n\n// Get data from previous nodes\nconst prepareData = $('Prepare GTN/EAN_Loop').first().json;\nconst foundGtin = $('Find Missing GTIN')?.first()?.json?.output || null;\nconst mergedData = $('Merge Found GTIN Data')?.first()?.json || null;\n\n// Determine which GTIN/MPN/Brand to use (priority: merged > found > original)\nconst gtin = mergedData?.gtin || foundGtin?.gtin || prepareData.gtin || null;\nconst mpn = mergedData?.mpn || foundGtin?.mpn || prepareData.mpn || null;\nconst brand = mergedData?.brand || foundGtin?.brand || prepareData.brand || null;\n\n// Build the PATCH body for Google Merchant Center\nconst patchBody = {};\nlet changesCount = 0;\n\n// Add GTIN if available\nif (gtin) {\n  patchBody.gtin = gtin;\n  changesCount++;\n}\n\n// Add MPN if available\nif (mpn) {\n  patchBody.mpn = mpn;\n  changesCount++;\n}\n\n// Add Brand if available\nif (brand) {\n  patchBody.brand = brand;\n  changesCount++;\n}\n\n// Set identifierExists based on whether we have GTIN or MPN\nconst hasIdentifier = !!(gtin || mpn);\npatchBody.identifierExists = hasIdentifier;\nchangesCount++;\n\n// Return the PATCH body with metadata\nreturn [{\n  json: {\n    product_id: prepareData.product_id,\n    offer_id: prepareData.offer_id,\n    shop_id: prepareData.shop_id,\n    patch_body: patchBody,\n    changes_count: changesCount,\n    has_gtin: !!gtin,\n    has_mpn: !!mpn,\n    has_brand: !!brand,\n    identifier_exists: hasIdentifier,\n    timestamp: new Date().toISOString()\n  }\n}];"
        },
        "id": "fffa0bbb-31c0-4d64-8cec-0b0ccaf9ec10",
        "name": "Build PATCH Body",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -6000,
          5072
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "PATCH",
          "url": "=https://merchantapi.googleapis.com/products/v1beta/accounts/{{ $json.shop_id }}/products/{{ $json.product_id }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "googleOAuth2Api",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ $json.patch_body }}",
          "options": {
            "timeout": 30000
          }
        },
        "id": "2afb192b-d883-448e-ac73-3a8cfe5c7ac5",
        "name": "Update Product in GMC",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          -5728,
          5072
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleOAuth2Api": {
            "id": "DClo09haz5afTzd8",
            "name": "Google_Custom_search"
          }
        },
        "onError": "continueErrorOutput",
        "continueOnFail": true
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict",
              "version": 3
            },
            "conditions": [
              {
                "id": "id-1",
                "leftValue": "={{ $json.output.gtin }}",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty"
                }
              },
              {
                "id": "id-2",
                "leftValue": "={{ $json.output.mpn }}",
                "operator": {
                  "type": "string",
                  "operation": "notEmpty"
                }
              },
              {
                "id": "id-3",
                "leftValue": "={{ $json.output.confidence }}",
                "rightValue": 70,
                "operator": {
                  "type": "number",
                  "operation": "gt"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "9e128df4-0ef6-4708-bbfc-313f8c376d74",
        "name": "Check: GTIN Found?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.3,
        "position": [
          -6272,
          4864
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "jsCode": "// ============================================================================\n// LOOP CONTROLLER - Check if more products need processing\n// ============================================================================\n\n// Get the current product data from Log Update Res_GTNI\nconst currentProduct = $input.first().json;\n\n// Get the original loop data from Prepare GTN/EAN_Loop\nconst loopData = $('Prepare GTN/EAN_Loop').all();\nconst totalProducts = loopData.length;\n\n// Get current index from the processed product\nconst currentIndex = currentProduct.index || 0;\n\n// Determine if we should continue the loop\nconst hasMoreProducts = currentIndex < totalProducts;\n\nif (hasMoreProducts) {\n  // Continue loop - return data to trigger next iteration\n  return [{\n    json: {\n      continue_loop: true,\n      current_index: currentIndex,\n      total_products: totalProducts,\n      remaining: totalProducts - currentIndex,\n      next_product: loopData[currentIndex]?.json || null,\n      timestamp: new Date().toISOString()\n    }\n  }];\n} else {\n  // Exit loop - all products processed\n  return [{\n    json: {\n      continue_loop: false,\n      current_index: currentIndex,\n      total_products: totalProducts,\n      remaining: 0,\n      loop_completed: true,\n      timestamp: new Date().toISOString()\n    }\n  }];\n}"
        },
        "id": "4186699a-b85c-4fc4-a915-e6eb9a6c4ae1",
        "name": "Loop Controller",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -5232,
          5056
        ],
        "alwaysOutputData": true,
        "retryOnFail": true
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "id-1",
                "name": "gtin",
                "value": "={{ $json.output.gtin }}",
                "type": "string"
              },
              {
                "id": "id-2",
                "name": "mpn",
                "value": "={{ $json.output.mpn }}",
                "type": "string"
              },
              {
                "id": "id-3",
                "name": "brand",
                "value": "={{ $json.output.brand || $json.brand }}",
                "type": "string"
              },
              {
                "id": "id-4",
                "name": "identifier_type",
                "value": "={{ $json.output.identifier_type }}",
                "type": "string"
              },
              {
                "id": "id-5",
                "name": "source",
                "value": "={{ $json.output.source }}",
                "type": "string"
              },
              {
                "id": "id-6",
                "name": "confidence",
                "value": "={{ $json.output.confidence }}",
                "type": "number"
              }
            ]
          },
          "includeOtherFields": true,
          "options": {}
        },
        "id": "84651633-ef89-449c-9bac-ef71b7de9a32",
        "name": "Merge Found GTIN Data",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -6000,
          4864
        ],
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "b85d4e72-545e-46d6-9d63-bb8819eeffb5",
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "multi_gtn_ean",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Multi GTN/EAN"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "9d7772c0-b5a4-451e-a8f2-c9852eff5496",
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "GTNI/EAN Hersteller Recherche"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict",
                    "version": 2
                  },
                  "conditions": [
                    {
                      "id": "2d85adf4-528d-4e12-9dff-d4ed344383f6",
                      "leftValue": "={{ $json.output.priority }}",
                      "rightValue": "",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Error‚ÄëAgent"
              }
            ]
          },
          "options": {
            "fallbackOutput": "extra",
            "renameFallbackOutput": "Fallback"
          }
        },
        "name": "Route by Priority1",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3.2,
        "position": [
          -7056,
          5008
        ],
        "id": "70f7e6dd-6801-46d5-81a2-72e2deaaf7d0",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "modelName": "models/gemini-2.0-flash-lite-preview-02-05",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
        "typeVersion": 1,
        "position": [
          -6768,
          5040
        ],
        "id": "d44ef084-2ede-4e49-9d57-56f5fc2d25dc",
        "name": "Gemini Chat",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googlePalmApi": {
            "id": "iTt5j2CqCJvCx7sv",
            "name": "Google Gemini(PaLM) Api account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "toolDescription": "Search the web for manufacturer product identifiers (GTIN, EAN, MPN) using Google Custom Search",
          "url": "https://www.googleapis.com/customsearch/v1",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "key",
                "value": "={{ $fromAI('api_key', 'Google API Key', 'string') }}"
              },
              {
                "name": "cx",
                "value": "={{ $fromAI('search_engine_id', 'Custom Search Engine ID', 'string') }}"
              },
              {
                "name": "q",
                "value": "={{ $fromAI('search_query', 'Search query for product identifiers', 'string') }}"
              }
            ]
          },
          "options": {}
        },
        "id": "510479f0-c458-4165-add2-34430269f894",
        "name": "Web Search GTNI",
        "type": "n8n-nodes-base.httpRequestTool",
        "typeVersion": 4.3,
        "position": [
          -6656,
          5136
        ]
      },
      {
        "parameters": {
          "content": "## GTNI / EAN HERSTELLER NUMMER SUCHEN",
          "height": 672,
          "width": 1440,
          "color": 5
        },
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -6800,
          4832
        ],
        "id": "74dd4b21-606b-4a92-a679-f61c73d43ac7",
        "name": "Sticky Note7"
      },
      {
        "parameters": {
          "operation": "append",
          "documentId": {
            "__rl": true,
            "value": "1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE",
            "mode": "list",
            "cachedResultName": "MECHTECH Merchant Center Dashboard",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE/edit?usp=drivesdk"
          },
          "sheetName": {
            "__rl": true,
            "value": 1479069768,
            "mode": "list",
            "cachedResultName": " üìù Daily_Log_Updates",
            "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1FuWn5ID8VNHlFNxCdwY_6fuWJ1QbjYSXuaBXx4MOrAE/edit#gid=1479069768"
          },
          "columns": {
            "mappingMode": "defineBelow",
            "value": {
              "Datum": "={{ $today }}",
              "Produktname": "={{ $json.title }}",
              "Herstellernummer MPN/": "={{ $json.output.mpn || 'Not found' }}",
              "EAN/GTIN": "={{ $json.output.gtin || 'Not found' }}",
              "Produkt URL": "={{ $json.product_url || '' }}",
              "Kategorie": "={{ $json.product_type || '' }}",
              "Notizen": "={{ $json.output.error || 'No identifier found' }}",
              "Datum der Erfassung": "={{ $now }}",
              "www.siliconedolls24.com": "={{ $json.shop1_id }}",
              "www.dreamdoll.de": "={{ $json.shop2_id }}"
            },
            "matchingColumns": [],
            "schema": [
              {
                "id": "Datum",
                "displayName": "Datum",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Produktname",
                "displayName": "Produktname",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Herstellernummer MPN/",
                "displayName": "Herstellernummer MPN/",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "EAN/GTIN",
                "displayName": "EAN/GTIN",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Produkt URL",
                "displayName": "Produkt URL",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "www.siliconedolls24.com",
                "displayName": "www.siliconedolls24.com",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "www.dreamdoll.de",
                "displayName": "www.dreamdoll.de",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Kategorie",
                "displayName": "Kategorie",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Notizen",
                "displayName": "Notizen",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              },
              {
                "id": "Datum der Erfassung",
                "displayName": "Datum der Erfassung",
                "required": false,
                "defaultMatch": false,
                "display": true,
                "type": "string",
                "canBeUsedToMatch": true,
                "removed": false
              }
            ],
            "attemptToConvertTypes": false,
            "convertFieldsToString": false
          },
          "options": {}
        },
        "type": "n8n-nodes-base.googleSheets",
        "typeVersion": 4.7,
        "position": [
          -3104,
          4992
        ],
        "id": "5def5634-3469-4abf-a9f3-de26a4e03957",
        "name": "Google Sheets",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "credentials": {
          "googleSheetsOAuth2Api": {
            "id": "cztAb4CKfRPRO8KX",
            "name": "Google Sheets account"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "url": "=https://mxswxdnnjhhukovixzvb.supabase.co/rest/v1/workflow_status?select=*&order=created_at.desc&limit=100",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "supabaseApi",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "=id",
                "value": "={{ $('SHOP_CONFIGURATION').item.json.shop1_id }}"
              },
              {
                "name": "run_date",
                "value": "={{ $json.run_date }}"
              },
              {
                "name": "shop1_id",
                "value": "={{ $('SHOP_CONFIGURATION').item.json.shop1_name }}"
              },
              {
                "name": "shop1_name",
                "value": "={{ $('SHOP_CONFIGURATION').item.json.shop1_name }}"
              },
              {
                "name": "phase",
                "value": "={{ $json.phase }}"
              },
              {
                "name": "products_processed",
                "value": "={{ $json.products_processed }}"
              },
              {
                "name": "success_count",
                "value": "={{ $json.success_count }}"
              },
              {
                "name": "failed_count",
                "value": "={{ $json.failed_count }}"
              },
              {
                "name": "budget_used",
                "value": "={{ $json.budget_used }}"
              },
              {
                "name": "duration_seconds",
                "value": "={{ $json.duration_seconds }}"
              },
              {
                "name": "gemini_decision",
                "value": "={{ $json.gemini_decision }}"
              },
              {
                "name": "approval_rate_before",
                "value": "={{ $json.approval_rate_before }}"
              },
              {
                "name": "approval_rate_after",
                "value": "={{ $json.approval_rate_after }}"
              },
              {
                "name": "created_at",
                "value": "={{ $json.created_at }}"
              },
              {
                "name": "updated_at",
                "value": "={{ $json.updated_at }}"
              }
            ]
          },
          "options": {}
        },
        "name": "Get Workflow Status REAL",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          -8144,
          4176
        ],
        "id": "0ae2ff72-9936-4c02-8a0c-fca086b08b1b",
        "alwaysOutputData": true,
        "retryOnFail": true,
        "waitBetweenTries": 3000,
        "credentials": {
          "supabaseApi": {
            "id": "f1qLUdIsbZ2A3wdC",
            "name": "Supabase-MySQL"
          }
        },
        "continueOnFail": true,
        "onError": "continueErrorOutput"
      }
    ],
    "connections": {
      "2d6517f1-ebbc-48fd-894c-287420175a7a": {
        "main": [
          [
            {
              "node": "9bf990d0-1d87-4bbb-9153-46146b506ae6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "9bf990d0-1d87-4bbb-9153-46146b506ae6": {
        "main": [
          [
            {
              "node": "3245d64d-7810-44de-beaa-f97d55eb2274",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "3245d64d-7810-44de-beaa-f97d55eb2274": {
        "main": [
          [
            {
              "node": "92b514de-5cd0-4f79-9857-123e685a1405",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "39d79c98-55c7-418a-8c36-bce59d3efd3f": {
        "main": [
          [
            {
              "node": "40a1e96b-15f2-4eb0-bdad-bd7532b02a22",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "40a1e96b-15f2-4eb0-bdad-bd7532b02a22": {
        "main": [
          [
            {
              "node": "f0a9ce99-2f4c-4baf-857a-02c81d0cae4d",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "f0a9ce99-2f4c-4baf-857a-02c81d0cae4d": {
        "main": [
          [
            {
              "node": "09ba4846-6da9-425c-a762-4f9f4bc1b4e6",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "f49cb6b3-195b-42f6-a025-a0e78d62cfca": {
        "main": [
          [
            {
              "node": "2d6517f1-ebbc-48fd-894c-287420175a7a",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "92b514de-5cd0-4f79-9857-123e685a1405": {
        "main": [
          [
            {
              "node": "40a1e96b-15f2-4eb0-bdad-bd7532b02a22",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Error Handler": {
        "main": [
          [
            {
              "node": "Retry Queue",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Retry Queue": {
        "main": [
          [
            {
              "node": "Expression Repair",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "main": [
        [
          [
            {
              "node": "7a01b7e8-3184-4982-92f4-a0ba03f781a4",
              "type": "main",
              "index": 0
            },
            {
              "node": "errorHandler-1766014501177-9ez5es86k",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "errorHandler-1766014501177-9ez5es86k",
              "type": "main",
              "index": 0
            },
            {
              "node": "4c9f8649-a6b7-45dd-9ed9-b9134be84018",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "4c9f8649-a6b7-45dd-9ed9-b9134be84018",
              "type": "main",
              "index": 0
            },
            {
              "node": "c0c41789-4c7d-4efc-861f-885743a1aff8",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "errorHandler-1766014501177-9ez5es86k",
              "type": "main",
              "index": 1
            },
            {
              "node": "80b0ee00-87d9-44ec-8b62-8c86eda7737b",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "7a01b7e8-3184-4982-92f4-a0ba03f781a4",
              "type": "main",
              "index": 1
            },
            {
              "node": "65ca06d9-ae1b-4669-ba03-4418312d0442",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "c0c41789-4c7d-4efc-861f-885743a1aff8",
              "type": "main",
              "index": 0
            },
            {
              "node": "7a01b7e8-3184-4982-92f4-a0ba03f781a4",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "15586a83-cda8-4ac9-9826-9ed77f24fa1c",
              "type": "main",
              "index": 0
            },
            {
              "node": "ai-error-handler-adult-1766019421751-xxxuhgnln",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "ai-error-handler-adult-1766019421751-xxxuhgnln",
              "type": "main",
              "index": 0
            },
            {
              "node": "retry-queue-adult-1766019421751-10y8tihcx",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "retry-queue-adult-1766019421751-10y8tihcx",
              "type": "main",
              "index": 0
            },
            {
              "node": "expression-repair-adult-1766019421752-5eytl5tjg",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "expression-repair-adult-1766019421752-5eytl5tjg",
              "type": "main",
              "index": 0
            },
            {
              "node": "15586a83-cda8-4ac9-9826-9ed77f24fa1c",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "34310e5a-2422-4ce3-a615-5b8f911b5407",
              "type": "main",
              "index": 0
            },
            {
              "node": "ai-error-handler-text-1766019421752-tx9bpgxr6",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "ai-error-handler-text-1766019421752-tx9bpgxr6",
              "type": "main",
              "index": 0
            },
            {
              "node": "retry-queue-text-1766019421752-b389yhp5y",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "retry-queue-text-1766019421752-b389yhp5y",
              "type": "main",
              "index": 0
            },
            {
              "node": "expression-repair-text-1766019421752-rngvhbii6",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "expression-repair-text-1766019421752-rngvhbii6",
              "type": "main",
              "index": 0
            },
            {
              "node": "34310e5a-2422-4ce3-a615-5b8f911b5407",
              "type": "main",
              "index": 0
            }
          ]
        ]
      ],
      "Expression Repair": {
        "main": [
          [
            {
              "node": "Prepare GTN/EAN_Loop",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Chat Trigger (RAG Query)": {
        "main": [
          [
            {
              "node": "Chat Agent (RAG)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gemini Chat Model (RAG)": {
        "ai_languageModel": [
          [
            {
              "node": "Chat Agent (RAG)",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Postgres Chat Memory": {
        "ai_memory": [
          [
            {
              "node": "Chat Agent (RAG)",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Check Last Run": {
        "main": [
          [
            {
              "node": "Get Workflow Status REAL",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Products Loop": {
        "main": [
          [
            {
              "node": "Update Product Adult Flag",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Product Adult Flag": {
        "main": [
          [
            {
              "node": "Rate Limiting_Adult",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results_Sheets_01",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Error Parser",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Workflow Run": {
        "main": [
          [
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Results to Sheets": {
        "main": [
          [
            {
              "node": "Send Daily Report",
              "type": "main",
              "index": 0
            },
            {
              "node": "Save to Supabase Products",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Send Daily Report": {
        "main": [
          [
            {
              "node": "Format Report for Email",
              "type": "main",
              "index": 0
            },
            {
              "node": "Check if Expert Needed",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format Report for Email": {
        "main": [
          [
            {
              "node": "Export Report to Gmail",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Parse Command Input": {
        "main": [
          [
            {
              "node": "Route Command",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check if Expert Needed": {
        "main": [
          [
            {
              "node": "Send WhatsApp Expert Alert",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Format Report for Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Route Command": {
        "main": [
          [
            {
              "node": "SHOP_CONFIGURATION",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Prepare Images Loop": {
        "main": [
          [
            {
              "node": "Update Product Images",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Product Images": {
        "main": [
          [
            {
              "node": "Rate Limiting Images",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results_Sheets_01",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Error Parser",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Rate Limiting Images": {
        "main": [
          [
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Update Product Text": {
        "main": [
          [
            {
              "node": "Rate Limiting Text",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results_Sheets_01",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Error Parser",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Rate Limiting Text": {
        "main": [
          [
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Handle Invalid Priority": {
        "main": [
          [
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate Results2": {
        "main": [
          [
            {
              "node": "Save Workflow Run",
              "type": "main",
              "index": 0
            },
            {
              "node": "Get Human Instructions",
              "type": "main",
              "index": 0
            },
            {
              "node": "Format Status Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Merchant Quality Loop": {
        "main": [
          [
            {
              "node": "Update Merchant Settings",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Merchant Settings": {
        "main": [
          [
            {
              "node": "Rate Limiting Merchant",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results_Sheets_01",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Error Parser",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Multi Country Loop": {
        "main": [
          [
            {
              "node": "Update Country Feeds",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Country Feeds": {
        "main": [
          [
            {
              "node": "Rate Limiting Country",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results_Sheets_01",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Error Parser",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Rate Limiting Merchant": {
        "main": [
          [
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Rate Limiting Country": {
        "main": [
          [
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Route by Priority": {
        "main": [
          [
            {
              "node": "Prepare Products Loop",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Prepare Images Loop",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Prepare Text Loop",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Prepare Merchant Quality Loop",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Prepare Multi Country Loop",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Route by Priority1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Prepare H√§ndlerqualit√§t",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Prepare MC For Gemini S24_2",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Prepare MC For Gemini DDC_2",
              "type": "main",
              "index": 0
            }
          ],
          [],
          [],
          [
            {
              "node": "AI Error Analyzer Adult Flags",
              "type": "main",
              "index": 0
            },
            {
              "node": "AI Error Analyzer Images",
              "type": "main",
              "index": 0
            },
            {
              "node": "AI Error Analyzer Text",
              "type": "main",
              "index": 0
            },
            {
              "node": "AI Error Analyzer Merchant",
              "type": "main",
              "index": 0
            },
            {
              "node": "AI Error Analyzer Error_Multi_Country",
              "type": "main",
              "index": 0
            },
            {
              "node": "AI Error Analyzer Error_Multi_GTN/EAN",
              "type": "main",
              "index": 0
            },
            {
              "node": "AI Error Analyzer_H√§ndlerqualit√§t",
              "type": "main",
              "index": 0
            },
            {
              "node": "Error_Ana_S24",
              "type": "main",
              "index": 0
            },
            {
              "node": "Error_Ana_DDC",
              "type": "main",
              "index": 0
            },
            {
              "node": "Handle Invalid Priority",
              "type": "main",
              "index": 0
            },
            {
              "node": "Gemini Daily Decision",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Save to Supabase Products": {
        "main": [
          [
            {
              "node": "Update Optimization Patterns",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Optimization Patterns": {
        "main": [
          [
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results_Sheets_01",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Human Instructions": {
        "main": [
          [
            {
              "node": "Filter Unprocessed Instructions",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Filter Unprocessed Instructions": {
        "main": [
          [
            {
              "node": "Process Instructions with Gemini",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Process Instructions with Gemini": {
        "main": [
          [
            {
              "node": "Apply to Similar Products",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gemini Model Learning": {
        "ai_languageModel": [
          [
            {
              "node": "Process Instructions with Gemini",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "JSON Parser Learning": {
        "ai_outputParser": [
          [
            {
              "node": "Process Instructions with Gemini",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Apply to Similar Products": {
        "main": [
          [
            {
              "node": "Save Learning to Supabase",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Sheet with AI Response": {
        "main": [
          [
            {
              "node": "Send Daily Report",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Save Learning to Supabase": {
        "main": [
          [
            {
              "node": "Update Sheet with AI Response",
              "type": "main",
              "index": 0
            },
            {
              "node": "Gemini Daily Decision",
              "type": "main",
              "index": 0
            },
            {
              "node": "Process Instructions with Gemini",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format Status Response": {
        "main": [
          [
            {
              "node": "Format Report for Email",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "MCP Client": {
        "ai_tool": [
          [
            {
              "node": "Chat Agent (RAG)",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "When clicking ‚ÄòExecute workflow‚Äô": {
        "main": [
          []
        ]
      },
      "Log Results_Sheets_01": {
        "main": [
          [
            {
              "node": "Send WhatsApp Expert Alert",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results to Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "MCP Client2": {
        "ai_tool": [
          [
            {
              "node": "AI Error Analyzer Adult Flags",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Supabase RAG Context1": {
        "ai_tool": [
          [
            {
              "node": "AI Error Analyzer Adult Flags",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "MCP Client3": {
        "ai_tool": [
          [
            {
              "node": "AI Error Analyzer Images",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Supabase RAG Context2": {
        "ai_tool": [
          [
            {
              "node": "AI Error Analyzer Images",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "MCP Client4": {
        "ai_tool": [
          [
            {
              "node": "AI Error Analyzer Text",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Supabase RAG Context3": {
        "ai_tool": [
          [
            {
              "node": "AI Error Analyzer Text",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "MCP Client5": {
        "ai_tool": [
          [
            {
              "node": "AI Error Analyzer Merchant",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Supabase RAG Context4": {
        "ai_tool": [
          [
            {
              "node": "AI Error Analyzer Merchant",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Google Gemini Chat Model4": {
        "ai_languageModel": [
          [
            {
              "node": "Merchant_Parser",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Adult_Flags_Parser": {
        "ai_outputParser": [
          []
        ]
      },
      "Images Parser": {
        "ai_outputParser": [
          [
            {
              "node": "AI Error Analyzer Images",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Text_Output_Parser": {
        "ai_outputParser": [
          [
            {
              "node": "AI Error Analyzer Text",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Google_Gemini_Chat": {
        "ai_languageModel": [
          [
            {
              "node": "Text_Output_Parser",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Supabase RAG Context5": {
        "ai_tool": [
          [
            {
              "node": "AI Error Analyzer Error_Multi_Country",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Google Gemini Chat Model5": {
        "ai_languageModel": [
          [
            {
              "node": "Country_Out_Parser",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "MCP Client_6": {
        "ai_tool": [
          [
            {
              "node": "AI Error Analyzer Error_Multi_Country",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Country_Out_Parser": {
        "ai_outputParser": [
          [
            {
              "node": "AI Error Analyzer Error_Multi_Country",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Merchant_Parser": {
        "ai_outputParser": [
          [
            {
              "node": "AI Error Analyzer Merchant",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Supabase RAG Context6": {
        "ai_tool": [
          [
            {
              "node": "AI Error Analyzer Error_Multi_GTN/EAN",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Google Gemini Chat Model6": {
        "ai_languageModel": [
          [
            {
              "node": "Multi_GTN/EAN_Parser",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "MCP Client_": {
        "ai_tool": [
          [
            {
              "node": "AI Error Analyzer Error_Multi_GTN/EAN",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Multi_GTN/EAN_Parser": {
        "ai_outputParser": [
          [
            {
              "node": "AI Error Analyzer Error_Multi_GTN/EAN",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Error_GTN/EAN": {
        "ai_languageModel": [
          [
            {
              "node": "AI Error Analyzer Error_Multi_GTN/EAN",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Supabase RAG Context7": {
        "ai_tool": [
          [
            {
              "node": "AI Error Analyzer_H√§ndlerqualit√§t",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Google Gemini Chat Model7": {
        "ai_languageModel": [
          [
            {
              "node": "H√§ndlerqualit√§t_Parser",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Prepare H√§ndlerqualit√§t": {
        "main": [
          [
            {
              "node": "Update H√§ndlerqualit√§t",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "H√§ndlerqualit√§t_Parser": {
        "ai_outputParser": [
          [
            {
              "node": "AI Error Analyzer_H√§ndlerqualit√§t",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Rate Limiting H√§ndlerqualit√§t": {
        "main": [
          [
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Update H√§ndlerqualit√§t": {
        "main": [
          [
            {
              "node": "Rate Limiting H√§ndlerqualit√§t",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results_Sheets_01",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Error Parser",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "AI Error Analyzer_H√§ndlerqualit√§t": {
        "main": [
          [
            {
              "node": "Fix Errors Router",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "AI Error Analyzer Error_Multi_GTN/EAN": {
        "main": [
          [
            {
              "node": "Fix Errors Router",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "AI Error Analyzer Error_Multi_Country": {
        "main": [
          [
            {
              "node": "Fix Errors Router",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "AI Error Analyzer Merchant": {
        "main": [
          [
            {
              "node": "Fix Errors Router",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "AI Error Analyzer Text": {
        "main": [
          [
            {
              "node": "Fix Errors Router",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "AI Error Analyzer Images": {
        "main": [
          [
            {
              "node": "Fix Errors Router",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "AI Error Analyzer Adult Flags": {
        "main": [
          [
            {
              "node": "Fix Errors Router",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Gemini Product Optimizer (NEW)": {
        "ai_languageModel": [
          [
            {
              "node": "MC_Parse_S24",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "MCP Client_1": {
        "ai_tool": [
          [
            {
              "node": "AI Error Analyzer_H√§ndlerqualit√§t",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "MCP Client_2": {
        "ai_tool": [
          [
            {
              "node": "Error_Ana_S24",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "MC_Prepare_S24": {
        "ai_languageModel": [
          [
            {
              "node": "Error_Ana_S24",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "MC_Get_Products_S24": {
        "main": [
          [
            {
              "node": "MC Merge Products + Status S24",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results_Sheets_01",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "MC_Parse_S24": {
        "ai_outputParser": [
          [
            {
              "node": "Error_Ana_S24",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "MC Merge Products + Status S24": {
        "main": [
          [],
          []
        ]
      },
      "MCP Client_3": {
        "ai_tool": [
          [
            {
              "node": "Error_Ana_DDC",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "MC_Get_Products_DDC": {
        "main": [
          [
            {
              "node": "MC Merge Products + Status DDC",
              "type": "main",
              "index": 0
            },
            {
              "node": "Log Results_Sheets_01",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "MC Merge Products + Status DDC": {
        "main": [
          [],
          [
            {
              "node": "Error_Ana_DDC",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "MC_Pre_DDC": {
        "ai_languageModel": [
          [
            {
              "node": "Error_Ana_DDC",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Supabase_S24": {
        "ai_tool": [
          [
            {
              "node": "Error_Ana_DDC",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Supabase_S": {
        "ai_tool": [
          [
            {
              "node": "Error_Ana_S24",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Error_Ana_S24": {
        "main": [
          [
            {
              "node": "Fix Errors Router",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "MC_Parse_DDC": {
        "ai_outputParser": [
          [
            {
              "node": "Error_Ana_DDC",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Optimizer DDC": {
        "ai_languageModel": [
          [
            {
              "node": "MC_Parse_DDC",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Error_Ana_DDC": {
        "main": [
          [
            {
              "node": "Fix Errors Router",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Gemini_Chat_Adult": {
        "ai_languageModel": [
          [
            {
              "node": "Adult_Flags_Parser",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Chat_Images": {
        "ai_languageModel": [
          [
            {
              "node": "Images Parser",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Error Adult Flags": {
        "ai_languageModel": [
          [
            {
              "node": "AI Error Analyzer Adult Flags",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Error Images": {
        "ai_languageModel": [
          [
            {
              "node": "AI Error Analyzer Images",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Error Adult Text": {
        "ai_languageModel": [
          [
            {
              "node": "AI Error Analyzer Text",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Error Merchant Quality": {
        "ai_languageModel": [
          [
            {
              "node": "AI Error Analyzer Merchant",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Error_Multi_Country1": {
        "ai_languageModel": [
          [
            {
              "node": "AI Error Analyzer Error_Multi_Country",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Error_H√§ndlerquali": {
        "ai_languageModel": [
          [
            {
              "node": "AI Error Analyzer_H√§ndlerqualit√§t",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Supabase Vector Store": {
        "ai_tool": [
          [
            {
              "node": "Chat Agent (RAG)",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Embeddings Google Gemini": {
        "ai_embedding": [
          [
            {
              "node": "Supabase Vector Store",
              "type": "ai_embedding",
              "index": 0
            }
          ]
        ],
        "main": [
          [
            {
              "node": "Chat Agent (RAG)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Merchant Products_S24": {
        "main": [
          [
            {
              "node": "Analyze Products2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Merchant Products_DDC": {
        "main": [
          [
            {
              "node": "Analyze Products2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare MC For Gemini S24_2": {
        "main": [
          [
            {
              "node": "MC_Get_Products_S24",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare MC For Gemini DDC_2": {
        "main": [
          [
            {
              "node": "MC_Get_Products_DDC",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "SHOP_CONFIGURATION": {
        "main": [
          [
            {
              "node": "Check Last Run",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Analyze Products2": {
        "main": [
          [
            {
              "node": "Smart Priority Scorer",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Smart Priority Scorer": {
        "main": [
          [
            {
              "node": "Gemini Daily Decision",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Handle Invalid Priority",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Text Loop": {
        "main": [
          [
            {
              "node": "Update Product Text",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Schedule Trigger": {
        "main": [
          [
            {
              "node": "Parse Command Input",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "MCP Client1": {
        "ai_tool": [
          [
            {
              "node": "Gemini Daily Decision",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Supabase RAG Context": {
        "ai_tool": [
          [
            {
              "node": "Gemini Daily Decision",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Decision_Parser": {
        "ai_outputParser": [
          [
            {
              "node": "Gemini Daily Decision",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Decision_Chat": {
        "ai_languageModel": [
          [
            {
              "node": "Gemini Daily Decision",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Postgres Gemini_Decisions": {
        "ai_memory": [
          [
            {
              "node": "Gemini Daily Decision",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "Gemini Daily Decision": {
        "main": [
          [
            {
              "node": "Route by Priority",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Parser": {
        "main": [
          [
            {
              "node": "Error Parser Schema",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Parser Schema": {
        "main": [
          [
            {
              "node": "Error Router",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Error Router": {
        "main": [
          [
            {
              "node": "AI Error Analyzer Adult Flags",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "AI Error Analyzer Images",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "AI Error Analyzer Text",
              "type": "main",
              "index": 0
            }
          ],
          [],
          [
            {
              "node": "AI Error Analyzer Merchant",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "AI Error Analyzer Error_Multi_Country",
              "type": "main",
              "index": 0
            },
            {
              "node": "AI Error Analyzer Error_Multi_GTN/EAN",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "AI Error Analyzer_H√§ndlerqualit√§t",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Error_Ana_S24",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Error_Ana_DDC",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Fix Errors Router": {
        "main": [
          [
            {
              "node": "Fix Adult",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Fix image (adult)",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Fix text",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Fix merchant",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Fix Multi_Country",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Fix Multi_GTN/EAN",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Fix Multi_H√§ndler_Qualit√§t",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Fix Multi_S24",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Fix Multi_DDC",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Rate Limiting_Adult": {
        "main": [
          [
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Fix Adult": {
        "main": [
          [
            {
              "node": "Merge Fix with Product_Adult",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge Fix with Product_Adult": {
        "main": [
          [
            {
              "node": "Update Product FIX Adult Flag",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fix image (adult)": {
        "main": [
          [
            {
              "node": "Merge Fix with Product_Image",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fix text": {
        "main": [
          [
            {
              "node": "Merge Fix with Product_Text",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fix merchant": {
        "main": [
          [
            {
              "node": "Merge Fix with Product_Merchant",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fix Multi_Country": {
        "main": [
          [
            {
              "node": "Merge Fix with Product_Country",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fix Multi_GTN/EAN": {
        "main": [
          [
            {
              "node": "Merge Fix with Product_GTNI/EAN",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fix Multi_H√§ndler_Qualit√§t": {
        "main": [
          [
            {
              "node": "Merge Fix with Product_H√§ndler_Quali",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fix Multi_S24": {
        "main": [
          [
            {
              "node": "Merge Fix with Product_S24",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fix Multi_DDC": {
        "main": [
          [
            {
              "node": "Merge Fix with Product_DDC",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge Fix with Product_Image": {
        "main": [
          [
            {
              "node": "Update Product FIX_Images",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge Fix with Product_Text": {
        "main": [
          [
            {
              "node": "Update Product FIX_Text",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge Fix with Product_Merchant": {
        "main": [
          [
            {
              "node": "Update_Product_FIX_Merchant Settings",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge Fix with Product_Country": {
        "main": [
          [
            {
              "node": "Update_Product_FIX_Country Feeds",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge Fix with Product_GTNI/EAN": {
        "main": [
          [
            {
              "node": "Update GTN/EAN1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge Fix with Product_H√§ndler_Quali": {
        "main": [
          [
            {
              "node": "Update_Product_FIX_H√§ndlerqualit√§t",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge Fix with Product_S24": {
        "main": [
          [
            {
              "node": "Update_Prod_FIX_S24",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge Fix with Product_DDC": {
        "main": [
          [
            {
              "node": "Update_Prod_FIX_DDC",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Rate Limiting GTN/EAN": {
        "main": [
          [
            {
              "node": "Aggregate Results2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare GTN/EAN_Loop": {
        "main": [
          [
            {
              "node": "Route: GTIN Lookup Needed?",
              "type": "main",
              "index": 0
            },
            {
              "node": "Extract Manufacturer Info",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Route: GTIN Lookup Needed?": {
        "main": [
          [
            {
              "node": "Find Missing GTIN",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Build PATCH Body",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Log Update Res_GTNI": {
        "main": [
          [
            {
              "node": "Rate Limiting GTN/EAN",
              "type": "main",
              "index": 0
            },
            {
              "node": "Loop Controller",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Find Missing GTIN": {
        "main": [
          [
            {
              "node": "Google Sheets1",
              "type": "main",
              "index": 0
            },
            {
              "node": "Check: GTIN Found?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "GTNI_Parser": {
        "ai_outputParser": [
          [
            {
              "node": "Find Missing GTIN",
              "type": "ai_outputParser",
              "index": 0
            }
          ]
        ]
      },
      "Extract Manufacturer Info": {
        "main": [
          [
            {
              "node": "Route: GTIN Lookup Needed?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Build PATCH Body": {
        "main": [
          [
            {
              "node": "Update Product in GMC",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Product in GMC": {
        "main": [
          [
            {
              "node": "Log Update Res_GTNI",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check: GTIN Found?": {
        "main": [
          [
            {
              "node": "Merge Found GTIN Data",
              "type": "main",
              "index": 0
            }
          ],
          []
        ]
      },
      "Loop Controller": {
        "main": [
          [
            {
              "node": "Rate Limiting GTN/EAN",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Merge Found GTIN Data": {
        "main": [
          [
            {
              "node": "Build PATCH Body",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Route by Priority1": {
        "main": [
          [
            {
              "node": "Prepare GTN/EAN_Loop",
              "type": "main",
              "index": 0
            }
          ],
          [],
          [],
          [
            {
              "node": "AI Error Analyzer Error_Multi_GTN/EAN",
              "type": "main",
              "index": 0
            },
            {
              "node": "Gemini Daily Decision",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Error Parser",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Gemini Chat": {
        "ai_languageModel": [
          [
            {
              "node": "Find Missing GTIN",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Web Search GTNI": {
        "ai_tool": [
          [
            {
              "node": "Find Missing GTIN",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "Update Product FIX_Images": {
        "main": [
          [
            {
              "node": "Google Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Product FIX Adult Flag": {
        "main": [
          [
            {
              "node": "Google Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update Product FIX_Text": {
        "main": [
          [
            {
              "node": "Google Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update_Product_FIX_Merchant Settings": {
        "main": [
          [
            {
              "node": "Google Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update_Product_FIX_Country Feeds": {
        "main": [
          [
            {
              "node": "Google Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update GTN/EAN1": {
        "main": [
          [
            {
              "node": "Google Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update_Product_FIX_H√§ndlerqualit√§t": {
        "main": [
          [
            {
              "node": "Google Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update_Prod_FIX_S24": {
        "main": [
          [
            {
              "node": "Google Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Update_Prod_FIX_DDC": {
        "main": [
          [
            {
              "node": "Google Sheets",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "8cfddd90-0a59-4744-a9f6-5a103c424b46": {
        "main": [
          [
            {
              "node": "5affa3dd-0306-4a45-a768-e5c34db10f95",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "6b2da695-ddac-492a-85a5-477b7d0de310": {
        "main": [
          [
            {
              "node": "5affa3dd-0306-4a45-a768-e5c34db10f95",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "4b35c3df-2960-48e8-965f-04cf264c9664": {
        "main": [
          [
            {
              "node": "5affa3dd-0306-4a45-a768-e5c34db10f95",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "fe1897ad-0183-411d-ad54-bedc90a0531c": {
        "main": [
          [
            {
              "node": "5affa3dd-0306-4a45-a768-e5c34db10f95",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "64eebdec-df1a-4302-aff3-7001e34cf634": {
        "main": [
          [
            {
              "node": "5affa3dd-0306-4a45-a768-e5c34db10f95",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "91ead233-4bc3-4b21-998b-d86e38adf3ab": {
        "main": [
          [
            {
              "node": "5affa3dd-0306-4a45-a768-e5c34db10f95",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "36d282f1-12b1-4bf8-a319-d56583d034d9": {
        "main": [
          [
            {
              "node": "5affa3dd-0306-4a45-a768-e5c34db10f95",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Workflow Status REAL": {
        "main": [
          [
            {
              "node": "Get Merchant Products_S24",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Andree Schulz",
    "name": null,
    "description": null,
    "autosaved": false,
    "workflowPublishHistory": [
      {
        "createdAt": "2025-12-25T06:29:14.585Z",
        "id": 301,
        "workflowId": "ftZOou7HNgLOwzE5",
        "versionId": "23af49d6-3c74-49be-bd89-f13e86d6b199",
        "event": "activated",
        "userId": "905b93e2-2ccd-4e6b-a613-4d01485a9251"
      }
    ]
  },
  "_metadata": {
    "exportedAt": "2025-12-25T06:35:20.020Z",
    "exportedBy": "save-workflow-to-github.js",
    "workflowId": "ftZOou7HNgLOwzE5",
    "workflowName": "***MECHTECH_MERCHANT_CENTER_ADMIN"
  }
}